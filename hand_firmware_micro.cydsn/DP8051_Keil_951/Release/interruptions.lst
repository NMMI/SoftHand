C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE INTERRUPTIONS
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Release\interruptions.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\4.1\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -interruptions.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(NDEBUG) WL(2) PR(.\DP8051
                    -_Keil_951\Release/interruptions.lst) CD OT(8,SPEED) OJ(.\DP8051_Keil_951\Release\interruptions.obj)

line level    source

*** MESSAGE C286 IN LINE 0 OF (null): license limits optimization to level 5
   1          // ----------------------------------------------------------------------------
   2          // BSD 3-Clause License
   3          
   4          // Copyright (c) 2016, qbrobotics
   5          // Copyright (c) 2017, Centro "E.Piaggio"
   6          // All rights reserved.
   7          
   8          // Redistribution and use in source and binary forms, with or without
   9          // modification, are permitted provided that the following conditions are met:
  10          
  11          // * Redistributions of source code must retain the above copyright notice, this
  12          //   list of conditions and the following disclaimer.
  13          
  14          // * Redistributions in binary form must reproduce the above copyright notice,
  15          //   this list of conditions and the following disclaimer in the documentation
  16          //   and/or other materials provided with the distribution.
  17          
  18          // * Neither the name of the copyright holder nor the names of its
  19          //   contributors may be used to endorse or promote products derived from
  20          //   this software without specific prior written permission.
  21          
  22          // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  23          // AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  24          // IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  25          // DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
  26          // FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  27          // DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
  28          // SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
  29          // CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  30          // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  31          // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  32          // POSSIBILITY OF SUCH DAMAGE.
  33          // ----------------------------------------------------------------------------
  34          
  35          /**
  36          * \file         interruptions.c
  37          *
  38          * \brief        Interruption handling and firmware core functions
  39          * \date         October 01, 2017
  40          * \author       _Centro "E.Piaggio"_
  41          * \copyright    (C) 2012-2016 qbrobotics. All rights reserved.
  42          * \copyright    (C) 2017 Centro "E.Piaggio". All rights reserved.
  43          */
  44          
  45          
  46          //=================================================================     includes
  47          #include <interruptions.h>
  48          #include <command_processing.h>
  49          #include <globals.h>
  50          #include <utils.h>
  51          
  52          
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 2   

  53          //==============================================================================
  54          //                                                            RS485 RX INTERRUPT
  55          //==============================================================================
  56          // Processing RS-485 data frame:
  57          //
  58          // - 0:     Waits for beggining characters
  59          // - 1:     Waits for ID;
  60          // - 2:     Data length;
  61          // - 3:     Receive all bytes;
  62          // - 4:     Wait for another device end of transmission;
  63          //
  64          //==============================================================================
  65          
  66          // PWM values needed to obtain 11.5 V given a certain input tension
  67          // Numbers are sperimentally calculated //[index] (millivolts)
  68          static const uint8 pwm_preload_values[29] = {100,    //0 (11500)
  69                                                        83,
  70                                                        78,
  71                                                        76,
  72                                                        74,
  73                                                        72,    //5 (14000)
  74                                                        70,
  75                                                        68,
  76                                                        67,
  77                                                        65,
  78                                                        64,    //10 (16500)
  79                                                        63,
  80                                                        62,
  81                                                        61,
  82                                                        60,
  83                                                        59,    //15 (19000)
  84                                                        58,
  85                                                        57,
  86                                                        56,
  87                                                        56,
  88                                                        55,    //20 (21500)
  89                                                        54,
  90                                                        54,
  91                                                        53,
  92                                                        52,
  93                                                        52,    //25 (24000)
  94                                                        52,
  95                                                        51,
  96                                                        51};   //28 (25500)
  97          
  98          CYCODE uint8 pwm_preload_values_6v[32] = {  100,  //0 (6000)
  99                                                       76,
 100                                                       71,
 101                                                       68,
 102                                                       66,
 103                                                       64,   //5 (8750)
 104                                                       62,
 105                                                       60,
 106                                                       58,
 107                                                       56,
 108                                                       54,   //10 (11500)
 109                                                       53,
 110                                                       52,
 111                                                       51,
 112                                                       50,
 113                                                       49,   //15 (14250)
 114                                                       47,
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 3   

 115                                                       46,
 116                                                       45,
 117                                                       44,
 118                                                       43,   //20 (17000)
 119                                                       42,
 120                                                       41,
 121                                                       40,
 122                                                       39,
 123                                                       38,   //25 (19750)
 124                                                       37,
 125                                                       37,
 126                                                       37,
 127                                                       37,
 128                                                       36};  //30 (22500)
 129          //==============================================================================
 130          //                                                            WATCHDOG INTERRUPT
 131          //==============================================================================
 132          
 133          CY_ISR(ISR_WATCHDOG_Handler){
 134   1      
 135   1          // Set WDT flag
 136   1          
 137   1          watchdog_flag = TRUE;
 138   1      
 139   1      }
 140          
 141          //==============================================================================
 142          //                                                            RS485 RX INTERRUPT
 143          //==============================================================================
 144          
 145          CY_ISR(ISR_RS485_RX_ExInterrupt) {
 146   1      
 147   1          // Set RS485 flag
 148   1          
 149   1          interrupt_flag = TRUE;
 150   1           
 151   1      }
 152          
 153          //==============================================================================
 154          //                                                        CYCLES TIMER INTERRUPT
 155          //==============================================================================
 156          CY_ISR(ISR_CYCLES_Handler){
 157   1      
 158   1          // Set cycles interrupt flag
 159   1          
 160   1          cycles_interrupt_flag = TRUE;
 161   1          
 162   1          CYCLES_TIMER_STATUS;
 163   1      
 164   1      }
 165          
 166          //==============================================================================
 167          //                                                             INTERRUPT MANAGER
 168          //==============================================================================
 169          // Manage interrupt from RS485 
 170          //==============================================================================
 171          // Processing RS-485 data frame:
 172          //
 173          // - WAIT_START:    Waits for beginning characters;
 174          // - WAIT_ID:       Waits for ID;
 175          // - WAIT_LENGTH:   Data length;
 176          // - RECEIVE:       Receive all bytes;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 4   

 177          // - UNLOAD:        Wait for another device end of transmission;
 178          //
 179          //==============================================================================
 180          
 181          void interrupt_manager(){
 182   1      
 183   1          
 184   1          //===========================================     local variables definition
 185   1      
 186   1          static uint8 CYDATA state = WAIT_START;                      // state
 187   1          
 188   1          //------------------------------------------------- local data packet
 189   1          static uint8 CYDATA data_packet_index;
 190   1          static uint8 CYDATA data_packet_length;
 191   1          static uint8 data_packet_buffer[128];                     
 192   1          static uint8 CYDATA rx_queue[3];                    // last 2 bytes received
 193   1          //-------------------------------------------------
 194   1      
 195   1          uint8 CYDATA    rx_data;                            // RS485 UART rx data
 196   1          CYBIT           rx_data_type;                       // my id?
 197   1          uint8 CYDATA    package_count = 0;                     
 198   1      
 199   1          //======================================================     receive routine
 200   1          
 201   1          // Get data until buffer is not empty 
 202   1          
 203   1          while(UART_RS485_GetRxBufferSize() && (package_count < 6)){  
 204   2              // 6 - estimated maximum number of packets we can read without blocking firmware execution
 205   2              
 206   2              // Get next char
 207   2              rx_data = UART_RS485_GetChar();
 208   2              
 209   2              switch (state) {
 210   3                  //-----     wait for frame start     -------------------------------
 211   3                  case WAIT_START:
 212   3                  
 213   3                      rx_queue[0] = rx_queue[1];
 214   3                      rx_queue[1] = rx_queue[2];
 215   3                      rx_queue[2] = rx_data;
 216   3                      
 217   3                      // Check for header configuration package
 218   3                      if ((rx_queue[1] == 58) && (rx_queue[2] == 58)) {
 219   4                          rx_queue[0] = 0;
 220   4                          rx_queue[1] = 0;
 221   4                          rx_queue[2] = 0;
 222   4                          state       = WAIT_ID;                    
 223   4                      }else
 224   3                          if ((rx_queue[0] == 63) &&      //ASCII - ?
 225   3                              (rx_queue[1] == 13) &&      //ASCII - CR
 226   3                              (rx_queue[2] == 10))        //ASCII - LF)
 227   3                              infoGet(INFO_ALL);
 228   3                      break;
 229   3      
 230   3                  //-----     wait for id     ----------------------------------------
 231   3                  case  WAIT_ID:
 232   3      
 233   3                      // packet is for my ID or is broadcast
 234   3                      if (rx_data == c_mem.id || rx_data == 0)
 235   3                          rx_data_type = FALSE;
 236   3                      else                //packet is for others
 237   3                          rx_data_type = TRUE;
 238   3                      
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 5   

 239   3                      data_packet_length = 0;
 240   3                      state = WAIT_LENGTH;
 241   3                      break;
 242   3      
 243   3                  //-----     wait for length     ------------------------------------
 244   3                  case  WAIT_LENGTH:
 245   3      
 246   3       
 247   3                      data_packet_length = rx_data;
 248   3                      // check validity of pack length
 249   3                      if (data_packet_length <= 1) {
 250   4                          data_packet_length = 0;
 251   4                          state = WAIT_START;
 252   4                      } else if (data_packet_length > 128) {
 253   4                          data_packet_length = 0;
 254   4                          state = WAIT_START;
 255   4                      } else {
 256   4                          data_packet_index = 0;
 257   4                          
 258   4                          if(rx_data_type == FALSE)
 259   4                              state = RECEIVE;          // packet for me or broadcast
 260   4                          else
 261   4                              state = UNLOAD;           // packet for others
 262   4                      }
 263   3                      break;
 264   3      
 265   3                  //-----     receiving     -------------------------------------------
 266   3                  case RECEIVE:
 267   3      
 268   3                      data_packet_buffer[data_packet_index] = rx_data;
 269   3                      data_packet_index++;
 270   3                      
 271   3                      // check end of transmission
 272   3                      if (data_packet_index >= data_packet_length) {
 273   4                          // verify if frame ID corresponded to the device ID
 274   4                          if (rx_data_type == FALSE) {
 275   5                              // copying data from buffer to global packet
 276   5                              memcpy(g_rx.buffer, data_packet_buffer, data_packet_length);
 277   5                              g_rx.length = data_packet_length;
 278   5                              g_rx.ready  = 1;
 279   5                              commProcess();
 280   5                          }
 281   4                          
 282   4                          data_packet_index  = 0;
 283   4                          data_packet_length = 0;
 284   4                          state              = WAIT_START;
 285   4                          package_count++;
 286   4                      
 287   4                      }
 288   3                      break;
 289   3      
 290   3                  //-----     other device is receving     ---------------------------
 291   3                  case UNLOAD:
 292   3                      if (!(--data_packet_length)) {
 293   4                          data_packet_index  = 0;
 294   4                          data_packet_length = 0;
 295   4                          RS485_CTS_Write(1);
 296   4                          RS485_CTS_Write(0);
 297   4                          state              = WAIT_START;
 298   4                          package_count++;
 299   4                      }
 300   3                      break;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 6   

 301   3              }
 302   2          }
 303   1      }
 304          //==============================================================================
 305          //                                                            FUNCTION SCHEDULER
 306          //==============================================================================
 307          // Call all the function with the right frequency
 308          //==============================================================================
 309          // Base frequency 1000 Hz
 310          //==============================================================================
 311          
 312          void function_scheduler(void) {
 313   1       
 314   1          static uint16 counter_calibration = DIV_INIT_VALUE;
 315   1          CYBIT write_cycles = FALSE;
 316   1          timer_value0 = (uint32)MY_TIMER_ReadCounter();
 317   1      
 318   1          // Start ADC Conversion, SOC = 1
 319   1      
 320   1          ADC_SOC_Write(0x01); 
 321   1          
 322   1          // Check Interrupt 
 323   1      
 324   1          if (interrupt_flag){
 325   2              interrupt_flag = FALSE;
 326   2              interrupt_manager();
 327   2              write_cycles = TRUE;
 328   2          }
 329   1        
 330   1          //---------------------------------- Get Encoders
 331   1      
 332   1          encoder_reading(0); 
 333   1          
 334   1          // Check Interrupt     
 335   1          
 336   1          if (interrupt_flag){
 337   2              interrupt_flag = FALSE;
 338   2              interrupt_manager();
 339   2              write_cycles = TRUE;
 340   2          }   
 341   1          
 342   1          encoder_reading(1);
 343   1          
 344   1          // Check Interrupt 
 345   1          
 346   1          if (interrupt_flag){
 347   2              interrupt_flag = FALSE;
 348   2              interrupt_manager();
 349   2              write_cycles = TRUE;
 350   2          }
 351   1          
 352   1          encoder_reading(2);
 353   1          
 354   1          // Check Interrupt 
 355   1          
 356   1          if (interrupt_flag){
 357   2              interrupt_flag = FALSE;
 358   2              interrupt_manager();
 359   2              write_cycles = TRUE;
 360   2          }
 361   1      
 362   1          //---------------------------------- Control Motor
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 7   

 363   1         
 364   1          motor_control();
 365   1      
 366   1          // Check Interrupt 
 367   1      
 368   1          if (interrupt_flag){
 369   2              interrupt_flag = FALSE;
 370   2              interrupt_manager();
 371   2              write_cycles = TRUE;
 372   2          }
 373   1      
 374   1          //---------------------------------- Read conversion buffer - LOCK function
 375   1      
 376   1          analog_read_end();
 377   1      
 378   1          if (interrupt_flag){
 379   2              interrupt_flag = FALSE;
 380   2              interrupt_manager();
 381   2              write_cycles = TRUE;
 382   2          }
 383   1      
 384   1          //---------------------------------- Control Overcurrent
 385   1      
 386   1          overcurrent_control();
 387   1          
 388   1          // Check Interrupt 
 389   1          
 390   1          if (interrupt_flag){
 391   2              interrupt_flag = FALSE;
 392   2              interrupt_manager();
 393   2              write_cycles = TRUE;
 394   2          }
 395   1      
 396   1          //---------------------------------- Calibration 
 397   1      
 398   1          // Divider 10, freq = 500 Hz
 399   1          if (calib.enabled == TRUE) {
 400   2              if (counter_calibration == CALIBRATION_DIV) {
 401   3                  calibration();
 402   3                  counter_calibration = 0;
 403   3              }
 404   2              counter_calibration++;
 405   2          }
 406   1      
 407   1          // Check Interrupt 
 408   1          
 409   1          if (interrupt_flag){
 410   2              interrupt_flag = FALSE;
 411   2              interrupt_manager();
 412   2              write_cycles = TRUE;
 413   2          }
 414   1          
 415   1          //---------------------------------- Rest position check
 416   1          
 417   1          // Divider 10, freq = 500 Hz
 418   1          if (c_mem.rest_position_flag == TRUE){
 419   2              if (counter_calibration == CALIBRATION_DIV) {
 420   3                      check_rest_position();
 421   3                      counter_calibration = 0;
 422   3              }
 423   2              counter_calibration++;
 424   2      
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 8   

 425   2              // Check Interrupt     
 426   2              if (interrupt_flag){
 427   3                  interrupt_flag = FALSE;
 428   3                  interrupt_manager();
 429   3                              write_cycles = TRUE;
 430   3              }
 431   2          } 
 432   1      
 433   1          //---------------------------------- Control Cycles Counter
 434   1      
 435   1          cycles_counter_update();
 436   1      
 437   1          // Check Cycles Interrupt 
 438   1          
 439   1          if (cycles_interrupt_flag){
 440   2              cycles_interrupt_flag = FALSE;
 441   2      
 442   2              // Cycles are written only every 120 seconds (CYCLES_TIMER interrupt)
 443   2              // to save EEPROM writings (1M maximum)
 444   2              if(can_write) {
 445   3                  cycles_status = PREPARE_DATA;
 446   3                  
 447   3                  //Update time variable
 448   3                  g_mem.total_time_on = g_mem.total_time_on + 120;  // Add 120 seconds.
 449   3              }
 450   2          }
 451   1          
 452   1          // Check Interrupt 
 453   1          
 454   1          if (interrupt_flag){
 455   2              interrupt_flag = FALSE;
 456   2              interrupt_manager();
 457   2          }
 458   1          
 459   1          //---------------------------------- Update States
 460   1          
 461   1          // Load k-1 state
 462   1          memcpy( &g_measOld, &g_meas, sizeof(g_meas) );
 463   1          memcpy( &g_refOld, &g_ref, sizeof(g_ref) );
 464   1      
 465   1          // Load k+1 state
 466   1          memcpy( &g_ref, &g_refNew, sizeof(g_ref) );
 467   1      
 468   1          if (interrupt_flag){
 469   2              interrupt_flag = FALSE;
 470   2              interrupt_manager();
 471   2              write_cycles = TRUE;
 472   2          }
 473   1      
 474   1          timer_value = (uint32)MY_TIMER_ReadCounter();
 475   1          cycle_time = (float)((timer_value0 - timer_value)/1000000.0);
 476   1          MY_TIMER_WriteCounter(5000000);
 477   1      
 478   1      }
 479          
 480          //==============================================================================
 481          //                                                                MOTORS CONTROL
 482          //==============================================================================
 483          
 484          void motor_control() {
 485   1      
 486   1          int32 CYDATA pwm_input = 0;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 9   

 487   1      
 488   1          int32 CYDATA pos_error;         // position error
 489   1          int32 CYDATA curr_error;        // current error
 490   1      
 491   1          int32 CYDATA i_ref;             // current reference
 492   1          int32 CYDATA handle_value;
 493   1      
 494   1          int32 CYDATA err_emg_1, err_emg_2;
 495   1      
 496   1          int32 CYDATA k_p = c_mem.k_p;  
 497   1          int32 CYDATA k_i = c_mem.k_i; 
 498   1          int32 CYDATA k_d = c_mem.k_d; 
 499   1      
 500   1          int32 CYDATA k_p_c = c_mem.k_p_c;  
 501   1          int32 CYDATA k_i_c = c_mem.k_i_c; 
 502   1          int32 CYDATA k_d_c = c_mem.k_d_c;   
 503   1      
 504   1          int32 CYDATA k_p_dl = c_mem.k_p_dl;  
 505   1          int32 CYDATA k_i_dl = c_mem.k_i_dl; 
 506   1          int32 CYDATA k_d_dl = c_mem.k_d_dl;
 507   1          
 508   1          int32 CYDATA k_p_c_dl = c_mem.k_p_c_dl;  
 509   1          int32 CYDATA k_i_c_dl = c_mem.k_i_c_dl; 
 510   1          int32 CYDATA k_d_c_dl = c_mem.k_d_c_dl;   
 511   1      
 512   1          // Static Variables
 513   1      
 514   1          static int32 pos_error_sum;     // position error sum for integral
 515   1          static int32 curr_error_sum;    // current error sum for integral
 516   1          
 517   1          static int32 prev_pos_err;      // previous position error for deriv. control
 518   1          static int32 prev_curr_err;     // previous current error for deriv. control
 519   1      
 520   1          static CYBIT motor_dir = FALSE;
 521   1      
 522   1          static uint8 current_emg = 0;   // 0 NONE
 523   1                                          // 1 EMG 1
 524   1                                          // 2 EMG 2
 525   1                                          // wait for both to get down
 526   1      
 527   1          err_emg_1 = g_meas.emg[0] - c_mem.emg_threshold[0];
 528   1          err_emg_2 = g_meas.emg[1] - c_mem.emg_threshold[1];
 529   1      
 530   1          // =========================== POSITION INPUT ==============================
 531   1          switch(c_mem.input_mode) {
 532   2      
 533   2              case INPUT_MODE_ENCODER3:
 534   2      
 535   2                  // Calculate handle value based on position of handle in the
 536   2                  // sensor chain and multiplication factor between handle and motor position
 537   2                  if (c_mem.double_encoder_on_off) 
 538   2                      handle_value = g_meas.pos[2] * c_mem.motor_handle_ratio;
 539   2                  else
 540   2                      handle_value = g_meas.pos[1] * c_mem.motor_handle_ratio;
 541   2                  
 542   2      
 543   2                  // Read handle and use it as reference for the motor
 544   2                  if (((handle_value - g_ref.pos[0]) > c_mem.max_step_pos) && (c_mem.max_step_pos != 0))
 545   2                      g_ref.pos[0] += c_mem.max_step_pos;
 546   2                  else {
 547   3                      if (((handle_value - g_ref.pos[0]) < c_mem.max_step_neg) && (c_mem.max_step_neg != 0))
 548   3                          g_ref.pos[0] += c_mem.max_step_neg;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 10  

 549   3                      else
 550   3                          g_ref.pos[0] = handle_value;
 551   3                  }
 552   2                  break;
 553   2      
 554   2              case INPUT_MODE_EMG_PROPORTIONAL:
 555   2                  if (err_emg_1 > 0)
 556   2                      g_ref.pos[0] = (err_emg_1 * g_mem.pos_lim_sup[0]) / (1024 - c_mem.emg_threshold[0]);
 557   2                  else
 558   2                      g_ref.pos[0] = 0;
 559   2                  break;
 560   2      
 561   2              case INPUT_MODE_EMG_INTEGRAL:
 562   2                  g_ref.pos[0] = g_refOld.pos[0];
 563   2                  if (err_emg_1 > 0) {
 564   3                      g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * (int)g_mem.emg_speed * 2) / (1024 - c_mem.em
             -g_threshold[0]);
 565   3                  }
 566   2                  if (err_emg_2 > 0) {
 567   3                      g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * (int)g_mem.emg_speed * 2) / (1024 - c_mem.em
             -g_threshold[1]);
 568   3                  }
 569   2                  break;
 570   2      
 571   2              case INPUT_MODE_EMG_FCFS:
 572   2                  g_ref.pos[0] = g_refOld.pos[0];
 573   2                  switch (current_emg) {
 574   3                      case 0:
 575   3                          // Look for the first EMG passing the threshold
 576   3                          if (err_emg_1 > 0) {
 577   4                              current_emg = 1;
 578   4                              break;
 579   4                          }
 580   3                          if (err_emg_2 > 0) {
 581   4                              current_emg = 2;
 582   4                              break;
 583   4                          }
 584   3                          break;
 585   3      
 586   3                      case 1:
 587   3                          // EMG 1 is first
 588   3                          if (err_emg_1 < 0) {
 589   4                              current_emg = 0;
 590   4                              break;
 591   4                          }
 592   3                          g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * g_mem.emg_speed * 2) / (1024 - c_mem.emg
             -_threshold[0]);
 593   3                          break;
 594   3      
 595   3                      case 2:
 596   3                          // EMG 2 is first
 597   3                          if (err_emg_2 < 0) {
 598   4                              current_emg = 0;
 599   4                              break;
 600   4                          }
 601   3                          g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * g_mem.emg_speed * 2) / (1024 - c_mem.emg
             -_threshold[1]);
 602   3                          break;
 603   3      
 604   3                      default:
 605   3                          break;
 606   3                  }
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 11  

 607   2      
 608   2                  break;
 609   2      
 610   2              case INPUT_MODE_EMG_FCFS_ADV:
 611   2                  g_ref.pos[0] = g_refOld.pos[0];
 612   2                  switch (current_emg) {
 613   3                      // Look for the first EMG passing the threshold
 614   3                      case 0:
 615   3                          if (err_emg_1 > 0) {
 616   4                              current_emg = 1;
 617   4                              break;
 618   4                          }
 619   3                          if (err_emg_2 > 0) {
 620   4                              current_emg = 2;
 621   4                              break;
 622   4                          }
 623   3                          break;
 624   3      
 625   3                      // EMG 1 is first
 626   3                      case 1:
 627   3                          // If both signals are under threshold go back to status 0
 628   3                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 629   4                              current_emg = 0;
 630   4                              break;
 631   4                          }
 632   3                          // but if the current signal come back over threshold, continue using it
 633   3                          if (err_emg_1 > 0) 
 634   3                              g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * g_mem.emg_speed << 2) / (1024 - c_me
             -m.emg_threshold[0]);
 635   3                          
 636   3                          break;
 637   3      
 638   3                      // EMG 2 is first
 639   3                      case 2:
 640   3                          // If both signals are under threshold go back to status 0
 641   3                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 642   4                              current_emg = 0;
 643   4                              break;
 644   4                          }
 645   3                          // but if the current signal come back over threshold, continue using it
 646   3                          if (err_emg_2 > 0) {
 647   4                              g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * c_mem.emg_speed << 2) / (1024 - c_me
             -m.emg_threshold[1]);
 648   4                          }
 649   3                          break;
 650   3      
 651   3                      default:
 652   3                          break;
 653   3                  }
 654   2      
 655   2              default:
 656   2                  break;
 657   2          }
 658   1      
 659   1          // Position limit saturation
 660   1          if (c_mem.pos_lim_flag) {
 661   2              if (g_ref.pos[0] < c_mem.pos_lim_inf[0]) 
 662   2                  g_ref.pos[0] = c_mem.pos_lim_inf[0];
 663   2              if (g_ref.pos[0] > c_mem.pos_lim_sup[0]) 
 664   2                  g_ref.pos[0] = c_mem.pos_lim_sup[0];
 665   2          }
 666   1          
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 12  

 667   1          if (c_mem.rest_position_flag == TRUE) {
 668   2              if (rest_enabled == 1){
 669   3                  // Change position reference to drive motor to rest position smoothly
 670   3                  g_ref.pos[0] = rest_pos_curr_ref;
 671   3              }
 672   2              
 673   2              if (forced_open == 1) {
 674   3                  // Open the SoftHand as EMG PROPORTIONAL input mode 
 675   3                  if (err_emg_2 > 0)
 676   3                      g_ref.pos[0] = g_mem.rest_pos - (err_emg_2 * g_mem.rest_pos) / (1024 - c_mem.emg_threshold
             -[1]);
 677   3                  else {
 678   4                      g_ref.pos[0] = g_mem.rest_pos;
 679   4                      forced_open = 0;
 680   4                  }
 681   3              }
 682   2          }
 683   1      
 684   1          switch(c_mem.control_mode) {
 685   2              // ======================= CURRENT AND POSITION CONTROL =======================
 686   2              case CURR_AND_POS_CONTROL:
 687   2                  pos_error = g_ref.pos[0] - g_meas.pos[0];
 688   2      
 689   2                  pos_error_sum += pos_error;
 690   2      
 691   2                  // error_sum saturation
 692   2                  if (pos_error_sum > POS_INTEGRAL_SAT_LIMIT)
 693   2                      pos_error_sum = POS_INTEGRAL_SAT_LIMIT;
 694   2                  else {
 695   3                      if (pos_error_sum < -POS_INTEGRAL_SAT_LIMIT) 
 696   3                          pos_error_sum = -POS_INTEGRAL_SAT_LIMIT;
 697   3                  }
 698   2                  
 699   2                  // ------ position PID control ------
 700   2      
 701   2                  i_ref = 0;
 702   2                  
 703   2                  // Proportional
 704   2                  if (k_p_dl != 0)
 705   2                      i_ref += (int32)(k_p_dl * pos_error) >> 16;
 706   2      
 707   2                  // Integral
 708   2                  if (k_i_dl != 0)
 709   2                      i_ref += (int32)(k_i_dl * pos_error_sum) >> 16;
 710   2      
 711   2                  // Derivative
 712   2                  if (k_d_dl != 0)
 713   2                      i_ref += (int32)(k_d_dl * (pos_error - prev_pos_err)) >> 16;
 714   2                              
 715   2                  // Update previous position
 716   2                  prev_pos_err = pos_error;
 717   2      
 718   2                  // motor direction depends on i_ref
 719   2                  if (i_ref >= 0)
 720   2                      motor_dir = TRUE;
 721   2                  else
 722   2                      motor_dir = FALSE;
 723   2      
 724   2                  // saturate max current
 725   2                  if (i_ref > c_mem.current_limit)
 726   2                      i_ref = c_mem.current_limit;
 727   2                  else {
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 13  

 728   3                      if (i_ref < -c_mem.current_limit)
 729   3                          i_ref = -c_mem.current_limit;
 730   3                      }
 731   2      
 732   2                  // current error and curr error sum
 733   2                  curr_error = i_ref - g_meas.curr[0];
 734   2                  curr_error_sum += curr_error;
 735   2                  
 736   2                  if (curr_error_sum > CURR_INTEGRAL_SAT_LIMIT)
 737   2                      curr_error_sum = CURR_INTEGRAL_SAT_LIMIT;
 738   2                  else {
 739   3                      if (curr_error_sum < -CURR_INTEGRAL_SAT_LIMIT)
 740   3                          curr_error_sum = -CURR_INTEGRAL_SAT_LIMIT;
 741   3                  }
 742   2      
 743   2                  // ----- current PID control -----
 744   2      
 745   2                  pwm_input = 0;
 746   2      
 747   2                  // Proportional
 748   2                  if (k_p_c_dl != 0)
 749   2                      pwm_input += (int32)(k_p_c_dl * curr_error) >> 16;
 750   2      
 751   2                  // Integral
 752   2                  if (k_i_c_dl != 0)
 753   2                      pwm_input += (int32)(k_i_c_dl * curr_error_sum) >> 16;
 754   2      
 755   2                  // Derivative
 756   2                  if (k_d_c_dl != 0)
 757   2                      pwm_input += (int32)(k_d_c_dl * (curr_error - prev_curr_err)) >> 16;
 758   2      
 759   2                  // pwm_input saturation
 760   2                  if (pwm_input < -PWM_MAX_VALUE) 
 761   2                      pwm_input = -PWM_MAX_VALUE;
 762   2                  else {
 763   3                      if (pwm_input > PWM_MAX_VALUE)
 764   3                          pwm_input = PWM_MAX_VALUE;
 765   3                  }
 766   2      
 767   2                  // Update previous current
 768   2                  prev_curr_err = curr_error;
 769   2      
 770   2              break;
 771   2      
 772   2              // ============================== POSITION CONTROL =====================
 773   2              case CONTROL_ANGLE:
 774   2                  pos_error = g_ref.pos[0] - g_meas.pos[0];
 775   2      
 776   2                  pos_error_sum += pos_error;
 777   2      
 778   2                  // anti-windup (for integral control)
 779   2                  if (pos_error_sum > ANTI_WINDUP)
 780   2                      pos_error_sum = ANTI_WINDUP;
 781   2                  else {
 782   3                                      if (pos_error_sum < -ANTI_WINDUP)
 783   3                              pos_error_sum = -ANTI_WINDUP;
 784   3                  }
 785   2      
 786   2                  // Proportional
 787   2                  if (k_p != 0) 
 788   2                      pwm_input = (int32)(k_p * pos_error) >> 16;
 789   2                  
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 14  

 790   2      
 791   2                  // Integral
 792   2                  if (k_i != 0) 
 793   2                      pwm_input += (int32)(k_i * pos_error_sum) >> 16;
 794   2                  
 795   2      
 796   2                  // Derivative
 797   2                  if (k_d != 0) 
 798   2                      pwm_input += (int32)(k_d * (pos_error - prev_pos_err)) >> 16;
 799   2                  
 800   2      
 801   2                  // Update measure
 802   2                  prev_pos_err = pos_error;
 803   2      
 804   2                  if (pwm_input > 0)
 805   2                      motor_dir = TRUE;
 806   2                  else
 807   2                      motor_dir = FALSE;
 808   2      
 809   2              break;
 810   2      
 811   2              // ========================== CURRENT CONTROL ==========================
 812   2              case CONTROL_CURRENT:
 813   2                  if(g_ref.onoff && tension_valid) {
 814   3                      
 815   3                      i_ref = g_ref.curr[0];
 816   3      
 817   3                      if (i_ref > c_mem.current_limit) 
 818   3                          i_ref = c_mem.current_limit;
 819   3                      else {
 820   4                          if (i_ref < -c_mem.current_limit)
 821   4                              i_ref = -c_mem.current_limit;
 822   4                      }
 823   3                      
 824   3                      // current error
 825   3                      curr_error = i_ref - g_meas.curr[0];            
 826   3                      curr_error_sum += curr_error;
 827   3                      
 828   3                      if (curr_error_sum > CURR_INTEGRAL_SAT_LIMIT)
 829   3                          curr_error_sum = CURR_INTEGRAL_SAT_LIMIT;
 830   3                      else {
 831   4                          if (curr_error_sum < -CURR_INTEGRAL_SAT_LIMIT) 
 832   4                              curr_error_sum = -CURR_INTEGRAL_SAT_LIMIT;
 833   4                      }
 834   3      
 835   3                      pwm_input = 0;
 836   3      
 837   3                      // Proportional
 838   3                      if (k_p_c != 0)
 839   3                          pwm_input += (int32)(k_p_c * curr_error) >> 16;
 840   3      
 841   3                      // Integral
 842   3                      if (k_i_c != 0)
 843   3                          pwm_input += (int32)(k_i_c * curr_error_sum) >> 16;
 844   3      
 845   3                      // Derivative
 846   3                      if (k_d_c != 0)
 847   3                          pwm_input += (int32)(k_d_c * (curr_error - prev_curr_err)) >> 16;
 848   3                      
 849   3                      prev_curr_err = curr_error;
 850   3                      
 851   3                      if (pwm_input >= 0) 
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 15  

 852   3                          motor_dir = TRUE;
 853   3                      else
 854   3                          motor_dir = FALSE;
 855   3                  }
 856   2              break;
 857   2              
 858   2              // ================= DIRECT PWM CONTROL ================================
 859   2              case CONTROL_PWM:
 860   2      
 861   2                  pwm_input = g_ref.pwm[0];
 862   2      
 863   2                  if (pwm_input > 0) 
 864   2                      motor_dir = TRUE;
 865   2                  else 
 866   2                      motor_dir = FALSE;
 867   2                  
 868   2      
 869   2                  // pwm_input saturation
 870   2                  if (pwm_input < -PWM_MAX_VALUE) 
 871   2                      pwm_input = -PWM_MAX_VALUE;
 872   2                  else {
 873   3                                      if (pwm_input > PWM_MAX_VALUE) 
 874   3                              pwm_input = PWM_MAX_VALUE;
 875   3                      }
 876   2      
 877   2              break;
 878   2          }
 879   1      
 880   1          ////////////////////////////////////////////////////////////////////////////
 881   1      
 882   1          if(pwm_input >  PWM_MAX_VALUE) 
 883   1              pwm_input =  PWM_MAX_VALUE;
 884   1          if(pwm_input < -PWM_MAX_VALUE) 
 885   1              pwm_input = -PWM_MAX_VALUE;
 886   1      
 887   1      
 888   1          if (c_mem.control_mode != CONTROL_PWM) 
 889   1              pwm_input = (((pwm_input << 10) / PWM_MAX_VALUE) * dev_pwm_limit) >> 10;
 890   1          
 891   1      
 892   1          pwm_sign = SIGN(pwm_input);
 893   1      
 894   1          if (motor_dir)
 895   1              MOTOR_DIR_Write(0x01);
 896   1          else
 897   1              MOTOR_DIR_Write(0x00);
 898   1      
 899   1          PWM_MOTORS_WriteCompare1(abs(pwm_input));
 900   1      }
 901          
 902          //==============================================================================
 903          //                                                               ENCODER READING
 904          //==============================================================================
 905          
 906          void encoder_reading(const uint8 idx) {
 907   1      
 908   1          uint8 CYDATA index = idx;
 909   1          
 910   1          uint8 jj;
 911   1          
 912   1          uint32 data_encoder;
 913   1          int32 value_encoder;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 16  

 914   1          int32 speed_encoder;
 915   1          //int32 accel_encoder;
 916   1          int32 aux;
 917   1          int32 init_rot = 0;
 918   1      
 919   1          static int32 last_value_encoder[NUM_OF_SENSORS];
 920   1      
 921   1          static uint8 error[NUM_OF_SENSORS];
 922   1          
 923   1          static CYBIT only_first_time = TRUE;
 924   1      
 925   1          static uint8 one_time_execute = 0;
 926   1          static CYBIT pos_reconstruct = FALSE;
 927   1      
 928   1          static int32 v_value[NUM_OF_SENSORS];   //last value for velocity
 929   1          static int32 vv_value[NUM_OF_SENSORS];  //last last value for velocity
 930   1          static int32 vvv_value[NUM_OF_SENSORS];  //last last last value for velocity
 931   1          
 932   1          //static int32 a_value[NUM_OF_SENSORS];   //last value for acceleration
 933   1          //static int32 aa_value[NUM_OF_SENSORS];  //last last value for acceleration
 934   1          //static int32 aaa_value[NUM_OF_SENSORS];  //last last last value for acceleration
 935   1      
 936   1          if (index >= NUM_OF_SENSORS)
 937   1              return;
 938   1          
 939   1          if (reset_last_value_flag) {
 940   2              for (jj = NUM_OF_SENSORS; jj--;) 
 941   2                  last_value_encoder[jj] = 0;
 942   2              
 943   2              reset_last_value_flag = 0;
 944   2          }
 945   1      
 946   1          //======================================================     reading sensors
 947   1              // Shift 1 right to erase Dummy bit of chain
 948   1          if (index == 0)
 949   1                  data_encoder = (SHIFTREG_ENC_1_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 950   1          else {
 951   2              if (index == 1)
 952   2                  data_encoder = (SHIFTREG_ENC_2_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 953   2              else // index == 2
 954   2                  data_encoder = (SHIFTREG_ENC_3_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 955   2          }
 956   1             
 957   1      
 958   1          if (check_enc_data(&data_encoder)) {
 959   2      
 960   2              value_encoder = (int16) (((data_encoder & 0x3FFC0) - 0x20000) >> 2 ) + g_mem.m_off[index];
 961   2                                                          // reset last 6 bit 
 962   2                                                          // -> |:|:|id|dim|CMD|CHK|(data---
 963   2                                                          // subtract half of max value
 964   2                                                          // and shift to have 16 bit val
 965   2      
 966   2              // Initialize last_value_encoder
 967   2              if (only_first_time) {
 968   3                  last_value_encoder[index] = value_encoder;
 969   3                  if (index == 2)
 970   3                      only_first_time = 0;
 971   3              }
 972   2      
 973   2              // Take care of rotations
 974   2              aux = value_encoder - last_value_encoder[index];
 975   2      
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 17  

 976   2              // ====================== 1 TURN ======================
 977   2              // -32768                    0                    32767 -32768                   0                
             -     32767
 978   2              // |-------------------------|-------------------------|-------------------------|----------------
             ----------|
 979   2              //              |                         |      |           |      |                         |
 980   2              //           -16384                     16383    |           |   -16384                     16383
 981   2              //                                               |           |
 982   2              //                                           24575           -24576
 983   2              //                                               |___________|
 984   2              //                                                   49152
 985   2      
 986   2              // if we are in the right interval, take care of rotation
 987   2              // and update the variable only if the difference between
 988   2              // one measure and another is less than 1/4 of turn
 989   2      
 990   2              // Considering we are sampling at 1kHz, this means that our shaft needs
 991   2              // to go slower than 1/4 turn every ms -> 1 turn every 4ms
 992   2              // equal to 250 turn/s -> 15000 RPM
 993   2      
 994   2              if (aux > 49152)
 995   2                  g_meas.rot[index]--;
 996   2              else{ 
 997   3                  if (aux < -49152)
 998   3                      g_meas.rot[index]++;
 999   3                  else{
1000   4                      if (abs(aux) > 16384) { // if two measure are too far
1001   5                          error[index]++;
1002   5                          if (error[index] < 10)
1003   5                              // Discard
1004   5                              return;
1005   5                      }
1006   4                  }
1007   3              }
1008   2      
1009   2              error[index] = 0;
1010   2      
1011   2              last_value_encoder[index] = value_encoder;
1012   2      
1013   2              value_encoder += (int32)g_meas.rot[index] << 16;
1014   2      
1015   2              if (c_mem.m_mult[index] != 1.0) {
1016   3                  value_encoder *= c_mem.m_mult[index];
1017   3              }
1018   2      
1019   2              g_meas.pos[index] = value_encoder;
1020   2          }
1021   1          
1022   1          switch(index) {
1023   2              case 0:
1024   2                  speed_encoder = (int16)filter_vel_1((11*value_encoder - 18* v_value[0] + 9 * vv_value[0] -2 * 
             -vvv_value[0]));
1025   2              break;
1026   2       
1027   2              case 1:
1028   2                  speed_encoder = (int16)filter_vel_2((11*value_encoder - 18* v_value[1] + 9 * vv_value[1] -2 * 
             -vvv_value[1]));
1029   2              break;
1030   2          
1031   2              case 2:
1032   2                  speed_encoder = (int16)filter_vel_3((11*value_encoder - 18* v_value[2] + 9 * vv_value[2] -2 * 
             -vvv_value[2]));
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 18  

1033   2              break;
1034   2          }
1035   1          //Update current speed
1036   1          speed_encoder = speed_encoder / (6*cycle_time);
1037   1          g_meas.vel[index] = speed_encoder;
1038   1          
1039   1          /*
1040   1          //Encoder rotational acceleration calculation
1041   1          switch(index) {
1042   1              case 0:
1043   1                  accel_encoder = (int16)filter_acc_1((11*speed_encoder - 18* a_value[0] + 9 * aa_value[0] -2* a
             -aa_value[0] ));
1044   1                  break;
1045   1              
1046   1              case 1:
1047   1                  accel_encoder = (int16)filter_acc_2((11*speed_encoder - 18* a_value[1] + 9 * aa_value[1] -2* a
             -aa_value[1] ));
1048   1                  break;
1049   1              
1050   1              case 2:
1051   1                  accel_encoder = (int16)filter_acc_3((11*speed_encoder - 18* a_value[2] + 9 * aa_value[2] -2* a
             -aa_value[2] ));
1052   1                  break;
1053   1          }
1054   1          //Update current acceleration
1055   1          g_meas.acc[index] = accel_encoder / (6*cycle_time);
1056   1          */
1057   1      
1058   1          // update old velocity and acceleration values
1059   1          vvv_value[index] = vv_value[index];
1060   1          vv_value[index] = v_value[index];
1061   1          v_value[index] = value_encoder;
1062   1      
1063   1          /*
1064   1          aaa_value[index] = aa_value[index];
1065   1          aa_value[index] = a_value[index];
1066   1          a_value[index] = speed_encoder;
1067   1          */
1068   1      
1069   1      
1070   1          // wait at least 3 * max_num_of_error (10) + 5 = 35 cycles to reconstruct the right turn
1071   1          if (pos_reconstruct == FALSE){
1072   2              if (one_time_execute < 34) 
1073   2                  one_time_execute++;
1074   2              else {
1075   3                  //Double encoder translation
1076   3                  if (c_mem.double_encoder_on_off){
1077   4      
1078   4                      init_rot = calc_turns_fcn(g_meas.pos[0],g_meas.pos[1]);
1079   4                      
1080   4                      if (c_mem.m_mult[0] < 0)
1081   4                          init_rot = -init_rot;
1082   4                      
1083   4                      g_meas.rot[0] = (int8)init_rot;
1084   4      
1085   4                  }
1086   3      
1087   3                  if (c_mem.m_mult != 1.0)
1088   3                      g_meas.pos[0] /= c_mem.m_mult[0];
1089   3                  
1090   3                  g_meas.pos[0] += (int32)(init_rot << 16);
1091   3                  
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 19  

1092   3                  if (c_mem.m_mult != 1.0)
1093   3                      g_meas.pos[0] *= c_mem.m_mult[0];
1094   3                          
1095   3                  // If necessary activate motors
1096   3                  g_refNew.pos[0] = g_meas.pos[0];
1097   3      
1098   3                  MOTOR_ON_OFF_Write(g_ref.onoff);
1099   3                  
1100   3                  pos_reconstruct = TRUE;
1101   3              }
1102   2          }
1103   1      }
1104          
1105          //==============================================================================
1106          //                                                           ANALOG MEASUREMENTS
1107          //==============================================================================
1108          
1109          void analog_read_end() {
1110   1      
1111   1          /* =========================================================================
1112   1          /   Ideal formulation to calculate tension and current
1113   1          /
1114   1          /   tension = ((read_value_mV - offset) * 101) / gain -> [mV]
1115   1          /   current = ((read_value_mV - offset) * 375) / (gain * resistor) -> [mA]
1116   1          /
1117   1          /   Definition:
1118   1          /   read_value_mV = counts_read / 0.819 -> conversion from counts to mV
1119   1          /   offset = 2000 -> hardware amplifier bias in mV
1120   1          /   gain = 8.086 -> amplifier gain
1121   1          /   resistor = 18 -> resistor of voltage divider in KOhm 
1122   1          /
1123   1          /   Real formulation: tradeoff in good performance and accurancy, ADC_buf[] 
1124   1          /   and offset unit of measurment is counts, instead dev_tension and
1125   1          /   g_meas.curr[] are converted in properly unit.
1126   1          /  =========================================================================
1127   1          */
1128   1      
1129   1          int32 CYDATA i_aux;                                        
1130   1          
1131   1          static uint16 emg_counter_1 = 0;
1132   1          static uint16 emg_counter_2 = 0;
1133   1              static uint8 first_tension_valid = TRUE;
1134   1          static int32 pow_tension = 12000;       //12000 mV (12 V)
1135   1          static uint8 count = 0;
1136   1          static uint32 count2 = 0;
1137   1      
1138   1      
1139   1          // Wait for conversion end
1140   1          
1141   1          while(!ADC_STATUS_Read()){
1142   2              if (interrupt_flag){
1143   3                  interrupt_flag = FALSE;
1144   3                  interrupt_manager();
1145   3              }
1146   2          }
1147   1          
1148   1          // Convert tension read
1149   1          dev_tension = ((int32)(ADC_buf[0] - 1638) * 1952) >> 7;
1150   1          
1151   1          if (interrupt_flag){
1152   2              interrupt_flag = FALSE;
1153   2              interrupt_manager();
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 20  

1154   2          }
1155   1              if (first_tension_valid && tension_valid) {
1156   2              count = count + 1;
1157   2              
1158   2              if (count == 1000){
1159   3                  if (dev_tension < 9000) {   // 8 V case
1160   4                      pow_tension = 8000;
1161   4                  }
1162   3                  else {      // 12 V - 24 V cases
1163   4                      if (dev_tension < 13000) {
1164   5                          pow_tension = 12000;
1165   5                      }
1166   4                      else
1167   4                          pow_tension = 24000;
1168   4                  }
1169   3      
1170   3                  first_tension_valid = FALSE;
1171   3              }
1172   2          }
1173   1      
1174   1          // Until there is no valid input tension repeat this measurement
1175   1          
1176   1          if (dev_tension > 7000) {       //at least > 7.36 V (92% of 8 V) that is minimum charge of smallest ba
             -ttery
1177   2              // Set tension valid bit to TRUE
1178   2      
1179   2              if (count2 == 1000){
1180   3                  tension_valid = TRUE;   
1181   3              }
1182   2              else {                      // wait for battery voltage stabilization
1183   3                  count2 = count2 + 1;
1184   3                  dev_tension_f = filter_voltage(dev_tension);
1185   3              }
1186   2      
1187   2              if(g_mem.activate_pwm_rescaling)        //pwm rescaling is activated
1188   2                  pwm_limit_search();                 //only for 12V motors
1189   2      
1190   2              // Filter and Set currents
1191   2              g_meas.curr[0] = filter_i1((int16) (((int32)(ADC_buf[1] - 1638) * 25771) >> 13) * pwm_sign);
1192   2              
1193   2                      // Calculate current estimation and put it in the second part of the current measurement array;
1194   2                      g_meas.curr[1] = (int16) filter_curr_diff(((int32) g_meas.curr[0]) - curr_estim(g_meas.pos[0] >> g_mem.r
             -es[0], g_meas.vel[0] >> g_mem.res[0], g_ref.pos[0] >> g_mem.res[0]));
1195   2      
1196   2              // Check Interrupt 
1197   2          
1198   2              if (interrupt_flag){
1199   3                  interrupt_flag = FALSE;
1200   3                  interrupt_manager();
1201   3              }
1202   2      
1203   2              // if calibration is not needed go to "normal execution"
1204   2              if (!g_mem.emg_calibration_flag){
1205   3                  emg_1_status = NORMAL; // normal execution
1206   3                  emg_2_status = NORMAL; // normal execution
1207   3              }
1208   2      
1209   2              // EMG 1 calibration state machine
1210   2              
1211   2              // Calibration state machine
1212   2              switch(emg_1_status) {
1213   3                  case NORMAL: // normal execution
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 21  

1214   3                      i_aux = (int32)ADC_buf[2 + g_mem.switch_emg];
1215   3                      if (i_aux < 0) 
1216   3                          i_aux = 0;
1217   3                      i_aux = filter_ch1(i_aux);
1218   3                      i_aux = (i_aux << 10) / g_mem.emg_max_value[0];
1219   3          
1220   3                      if (interrupt_flag){
1221   4                          interrupt_flag = FALSE;
1222   4                          interrupt_manager();
1223   4                      }
1224   3                      //Saturation
1225   3                      if (i_aux < 0)
1226   3                          i_aux = 0;
1227   3                      else
1228   3                          if (i_aux > 1024) 
1229   3                              i_aux = 1024;
1230   3                      
1231   3                      g_meas.emg[0] = i_aux;
1232   3          
1233   3                      if (interrupt_flag){
1234   4                          interrupt_flag = FALSE;
1235   4                          interrupt_manager();
1236   4                      }
1237   3                      
1238   3                      break;
1239   3      
1240   3                  case RESET: // reset variables
1241   3                      emg_counter_1 = 0;
1242   3                      g_mem.emg_max_value[0] = 0;
1243   3                      emg_1_status = DISCARD; // goto next status
1244   3                      
1245   3                      break;
1246   3      
1247   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1248   3                      emg_counter_1++;
1249   3                      if (emg_counter_1 == EMG_SAMPLE_TO_DISCARD) {
1250   4                          emg_counter_1 = 0;          // reset counter
1251   4                          
1252   4                          LED_CTRL_Write(1);
1253   4                          LED_BLINK_EN_Write(0);
1254   4                              
1255   4                          if (interrupt_flag){
1256   5                              interrupt_flag = FALSE;
1257   5                              interrupt_manager();
1258   5                          }
1259   4                          
1260   4                          emg_1_status = SUM_AND_MEAN;           // sum and mean status
1261   4                      }
1262   3                      break;
1263   3      
1264   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1265   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1266   3                      emg_counter_1++;
1267   3                      if (ADC_buf[2 + g_mem.switch_emg] < 0) 
1268   3                          ADC_buf[2 + g_mem.switch_emg] = 0;
1269   3                      g_mem.emg_max_value[0] += filter_ch1((int32)ADC_buf[2 + g_mem.switch_emg]);
1270   3                      
1271   3                      if (interrupt_flag){
1272   4                          interrupt_flag = FALSE;
1273   4                          interrupt_manager();
1274   4                      }
1275   3                      
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 22  

1276   3                      if (emg_counter_1 == SAMPLES_FOR_EMG_MEAN) {
1277   4                          g_mem.emg_max_value[0] = g_mem.emg_max_value[0] / SAMPLES_FOR_EMG_MEAN; // calc mean
1278   4          
1279   4                          if (interrupt_flag){
1280   5                              interrupt_flag = FALSE;
1281   5                              interrupt_manager();
1282   5                          }                    
1283   4                          
1284   4                          LED_CTRL_Write(0);
1285   4                          LED_BLINK_EN_Write(0);
1286   4                          
1287   4                          emg_counter_1 = 0;          // reset counter
1288   4      
1289   4                          emg_1_status = NORMAL;           // goto normal execution
1290   4                      }
1291   3                      break;
1292   3      
1293   3                  default:
1294   3                      break;
1295   3              }
1296   2          
1297   2              if (interrupt_flag){
1298   3                  interrupt_flag = FALSE;
1299   3                  interrupt_manager();
1300   3              }
1301   2              // EMG 2 calibration state machine
1302   2              switch(emg_2_status) {
1303   3                  case NORMAL: // normal execution
1304   3                      i_aux = (int32)ADC_buf[3 - g_mem.switch_emg];
1305   3                      if (i_aux < 0)
1306   3                          i_aux = 0;
1307   3                      i_aux = filter_ch2(i_aux);
1308   3                      i_aux = (i_aux << 10) / g_mem.emg_max_value[1];
1309   3          
1310   3                      if (interrupt_flag){
1311   4                          interrupt_flag = FALSE;
1312   4                          interrupt_manager();
1313   4                      }
1314   3                      
1315   3                      if (i_aux < 0) 
1316   3                          i_aux = 0;
1317   3                      else
1318   3                          if (i_aux > 1024)
1319   3                              i_aux = 1024;
1320   3                      
1321   3                      g_meas.emg[1] = i_aux;
1322   3      
1323   3                      break;
1324   3      
1325   3                  case RESET: // reset variables
1326   3                      emg_counter_2 = 0;
1327   3                      g_mem.emg_max_value[1] = 0;
1328   3          
1329   3                      if (interrupt_flag){
1330   4                          interrupt_flag = FALSE;
1331   4                          interrupt_manager();
1332   4                      }
1333   3                      
1334   3                      emg_2_status = WAIT; // wait for EMG 1 calibration
1335   3                      break;
1336   3      
1337   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 23  

1338   3                      emg_counter_2++;
1339   3                      if (emg_counter_2 == EMG_SAMPLE_TO_DISCARD) {
1340   4                          emg_counter_2 = 0;          // reset counter
1341   4                          
1342   4                          LED_CTRL_Write(1);
1343   4                          LED_BLINK_EN_Write(0);
1344   4          
1345   4                          if (interrupt_flag){
1346   5                              interrupt_flag = FALSE;
1347   5                              interrupt_manager();
1348   5                          }
1349   4                          
1350   4                          emg_2_status = SUM_AND_MEAN;           // sum and mean status
1351   4                      }
1352   3                      break;
1353   3      
1354   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1355   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1356   3                      emg_counter_2++;
1357   3                      if (ADC_buf[3 - g_mem.switch_emg] < 0)
1358   3                          ADC_buf[3 - g_mem.switch_emg] = 0;
1359   3                      g_mem.emg_max_value[1] += filter_ch2((int32)ADC_buf[3 - g_mem.switch_emg]);
1360   3          
1361   3                      if (interrupt_flag){
1362   4                          interrupt_flag = FALSE;
1363   4                          interrupt_manager();
1364   4                      }
1365   3                      
1366   3                      if (emg_counter_2 == SAMPLES_FOR_EMG_MEAN) {
1367   4                          g_mem.emg_max_value[1] = g_mem.emg_max_value[1] / SAMPLES_FOR_EMG_MEAN; // calc mean
1368   4                          
1369   4                          LED_CTRL_Write(0);
1370   4                          LED_BLINK_EN_Write(0);
1371   4                          
1372   4                          emg_counter_2 = 0;          // reset counter
1373   4                      
1374   4                          if (interrupt_flag){
1375   5                              interrupt_flag = FALSE;
1376   5                              interrupt_manager();
1377   5                          }
1378   4                          
1379   4                          emg_2_status = WAIT_EoC;           // goto end of calibration wait
1380   4                      }
1381   3                      break;
1382   3      
1383   3                  case WAIT: // wait for EMG calibration to be done
1384   3                      if (emg_1_status == NORMAL)
1385   3                          emg_2_status = DISCARD;           // goto discard sample
1386   3                      break;
1387   3      
1388   3                  case WAIT_EoC:  // wait for end of calibration procedure (only for LED visibility reasons)
1389   3                      emg_counter_2++;
1390   3                      if (emg_counter_2 == EMG_SAMPLE_TO_DISCARD) {
1391   4                          emg_counter_2 = 0;          // reset counter
1392   4      
1393   4                          if (interrupt_flag){
1394   5                              interrupt_flag = FALSE;
1395   5                              interrupt_manager();
1396   5                          }
1397   4                          
1398   4                          // if EMG control mode active, activate motors accordingly with startup value
1399   4                          if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 24  

1400   4                              (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1401   4                              (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1402   4                              (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1403   5                              if (c_mem.control_mode == CONTROL_ANGLE) {
1404   6                                  g_ref.pos[0] = g_meas.pos[0];
1405   6                                  g_ref.pos[1] = g_meas.pos[1];
1406   6                              }
1407   5                              g_ref.onoff = c_mem.activ;
1408   5                              MOTOR_ON_OFF_Write(g_ref.onoff);
1409   5                          }
1410   4                              
1411   4                          emg_2_status = NORMAL;           // goto normal execution
1412   4                      }
1413   3                      break;
1414   3                      
1415   3                  default:
1416   3                      break;
1417   3              }
1418   2                  
1419   2              if (interrupt_flag){
1420   3                  interrupt_flag = FALSE;
1421   3                  interrupt_manager();
1422   3              }
1423   2          }
1424   1          else {
1425   2      
1426   2              emg_1_status = RESET; 
1427   2              emg_2_status = RESET;
1428   2      
1429   2              tension_valid = FALSE;
1430   2                      //fixed
1431   2              LED_CTRL_Write(1);
1432   2              //PWM Blink Enable
1433   2              LED_BLINK_EN_Write(0);
1434   2                  
1435   2              if (interrupt_flag){
1436   3                  interrupt_flag = FALSE;
1437   3                  interrupt_manager();
1438   3              }
1439   2              
1440   2              if (c_mem.emg_calibration_flag) {
1441   3                  if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
1442   3                      (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1443   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1444   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1445   4                      g_ref.onoff = 0x00;
1446   4                      MOTOR_ON_OFF_Write(g_ref.onoff);
1447   4                  }
1448   3              }
1449   2      
1450   2              // Reset current
1451   2              g_meas.curr[0] = 0;
1452   2      
1453   2              // Reset emg
1454   2              g_meas.emg[0] = 0;
1455   2              g_meas.emg[1] = 0;
1456   2      
1457   2          }
1458   1              // The board LED blinks if attached battery is not fully charged
1459   1          if (!first_tension_valid && tension_valid == TRUE && emg_1_status == NORMAL && emg_2_status == NORMAL)
             -{
1460   2              dev_tension_f = filter_voltage(dev_tension);
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 25  

1461   2              if (dev_tension_f > 0.92 * pow_tension){        // Sometimes pow_tension is not well computed when
             - using power supply
1462   3                  //fixed
1463   3                  LED_CTRL_Write(1);
1464   3                  
1465   3                  //PWM Blink Enable
1466   3                  LED_BLINK_EN_Write(0);
1467   3              }
1468   2              else {
1469   3                  // blink
1470   3                  LED_CTRL_Write(0);
1471   3                  
1472   3                  //PWM Blink Enable
1473   3                  LED_BLINK_EN_Write(1);
1474   3                  
1475   3                  // Disable motors because of not fully charged battery
1476   3                  g_refNew.onoff = 0x00;
1477   3                  MOTOR_ON_OFF_Write(g_refNew.onoff); // Deactivate motors
1478   3              }
1479   2          }
1480   1              
1481   1          if (interrupt_flag){
1482   2              interrupt_flag = FALSE;
1483   2              interrupt_manager();
1484   2          }
1485   1      }
1486          
1487          //==============================================================================
1488          //                                                           OVERCURRENT CONTROL
1489          //==============================================================================
1490          
1491          void overcurrent_control() {
1492   1          if (c_mem.current_limit != 0) {
1493   2              // if the current is over the limit
1494   2              if (g_meas.curr[0] > c_mem.current_limit) {
1495   3                  //decrese pwm_limit
1496   3                  dev_pwm_limit--;
1497   3              // if the current is in the safe zone
1498   3              } else if (g_meas.curr[0] < (c_mem.current_limit - CURRENT_HYSTERESIS)) {
1499   3                  //increase pwm_limit
1500   3                  dev_pwm_limit++;
1501   3              }
1502   2      
1503   2              // Bound pwm_limit
1504   2              if (dev_pwm_limit < 0) 
1505   2                  dev_pwm_limit = 0;
1506   2              else 
1507   2                  if (dev_pwm_limit > dev_pwm_sat) 
1508   2                      dev_pwm_limit = dev_pwm_sat;
1509   2          }
1510   1      }
1511          
1512          //==============================================================================
1513          //                                                              PWM_LIMIT_SEARCH
1514          //==============================================================================
1515          
1516           void pwm_limit_search() {
1517   1        
1518   1          uint8 CYDATA index;
1519   1          uint16 CYDATA max_tension = 25500;
1520   1          uint16 CYDATA min_tension = 11500;
1521   1           
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 26  

1522   1          if (dev_tension > max_tension) {
1523   2                dev_pwm_sat = 0;
1524   2          } else if (dev_tension < min_tension) {
1525   2                dev_pwm_sat = 100;
1526   2          } else {
1527   2              index = (uint8)((dev_tension - min_tension) >> 9);
1528   2              dev_pwm_sat = pwm_preload_values[index];
1529   2          }
1530   1      }
1531          
1532          
1533          //==============================================================================
1534          //                                                         CYCLES COUNTER UPDATE
1535          //==============================================================================
1536          
1537          void cycles_counter_update() {
1538   1          static uint8 pos_cycle_status = STATE_INACTIVE;
1539   1          static uint8 emg_cycle_status[2] = {STATE_INACTIVE, STATE_INACTIVE};
1540   1          static uint8 rest_cycle_status = STATE_INACTIVE;
1541   1          static int32 bin_threshold = 250;
1542   1          static int32 thr_pos, max_pos;
1543   1          uint8 i, bin_st, bin_max;
1544   1          int32 curr_pos;
1545   1          int32 step;
1546   1          static uint32 timer_value_s, timer_value_e;
1547   1          
1548   1          curr_pos = (int32)(g_meas.pos[0] >> g_mem.res[0]);
1549   1          
1550   1          // State machine - Evaluate position counter update
1551   1          switch (pos_cycle_status){
1552   2              case STATE_INACTIVE:
1553   2                  if (pwm_sign == 1){
1554   3                      thr_pos = curr_pos; 
1555   3                      g_mem.wire_disp = g_mem.wire_disp + abs(max_pos - thr_pos);     //sum opening track
1556   3                      pos_cycle_status = STATE_ACTIVE;
1557   3                  }
1558   2                  break;
1559   2              case STATE_ACTIVE:
1560   2                  if (pwm_sign == -1){
1561   3                      max_pos = curr_pos;
1562   3                      g_mem.wire_disp = g_mem.wire_disp + abs(max_pos - thr_pos);     //sum closure track
1563   3                      pos_cycle_status = COUNTER_INC;
1564   3                  }
1565   2                  break;
1566   2              case COUNTER_INC:
1567   2                  if (abs(max_pos - thr_pos) > bin_threshold){
1568   3                      //update position histogram
1569   3                      step = ((int32)(g_mem.pos_lim_sup[0] >> g_mem.res[0]) / 10);
1570   3                      bin_st  = (uint8)(thr_pos/step);
1571   3                      bin_max = (uint8)(max_pos/step);
1572   3                      for (i=bin_st; i<= bin_max; i++){
1573   4                          //position_hist counts how many times the SoftHand stays in bin while closing
1574   4                          g_mem.position_hist[i] = g_mem.position_hist[i] + 1;
1575   4                      }
1576   3                      
1577   3                      //update current histogram
1578   3                      step = ((int32)(g_mem.current_limit) / 4);
1579   3                      if (g_meas.curr[0] > g_mem.current_limit)
1580   3                          g_mem.current_hist[3] = g_mem.current_hist[3] + 1; 
1581   3                      else
1582   3                          g_mem.current_hist[(uint8)(g_meas.curr[0]/step)] = g_mem.current_hist[(uint8)(g_meas.c
             -urr[0]/step)] + 1;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 27  

1583   3                  }
1584   2                  pos_cycle_status = STATE_INACTIVE;
1585   2                  break;
1586   2          }
1587   1          
1588   1          // State machine - Evaluate EMG counter update
1589   1          for (i=0; i<2 && emg_1_status == NORMAL && emg_2_status == NORMAL; i++){
1590   2              switch (emg_cycle_status[i]){
1591   3                  case STATE_INACTIVE:
1592   3                      if (g_meas.emg[i] > g_mem.emg_threshold[i]){
1593   4                          emg_cycle_status[i] = STATE_ACTIVE;
1594   4                      }
1595   3                      break;
1596   3                  case STATE_ACTIVE:
1597   3                      if (g_meas.emg[i] < 10){
1598   4                          emg_cycle_status[i] = COUNTER_INC;
1599   4                      }
1600   3                      break;
1601   3                  case COUNTER_INC:
1602   3                      g_mem.emg_counter[i] = g_mem.emg_counter[i] + 1;
1603   3                      emg_cycle_status[i] = STATE_INACTIVE;
1604   3                      break;
1605   3              }
1606   2          }
1607   1          
1608   1          // State machine - Evaluate rest counter update
1609   1          switch (rest_cycle_status){
1610   2              case STATE_INACTIVE:
1611   2                  if (rest_enabled){
1612   3                      timer_value_s = (uint32)CYCLES_TIMER_ReadCounter();
1613   3                      rest_cycle_status = STATE_ACTIVE;
1614   3                  }
1615   2                  break;
1616   2              case STATE_ACTIVE:
1617   2                  if (!rest_enabled){
1618   3                      timer_value_e = (uint32)CYCLES_TIMER_ReadCounter();
1619   3                      if (timer_value_s < timer_value_e) {
1620   4                          timer_value_s = timer_value_s + (uint32)1200;
1621   4                      }
1622   3                      rest_cycle_status = COUNTER_INC;
1623   3                  }
1624   2                  break;
1625   2              case COUNTER_INC: 
1626   2                  g_mem.total_time_rest = g_mem.total_time_rest + (uint32)((timer_value_s - timer_value_e)/10);
1627   2                  g_mem.rest_counter = g_mem.rest_counter + 1;
1628   2                  rest_cycle_status = STATE_INACTIVE;
1629   2                  break;
1630   2          }
1631   1                  
1632   1          // This function writes rows [row_start, row_end] on EEPROM
1633   1          save_cycles_eeprom();
1634   1      }
1635          
1636          //==============================================================================
1637          //                                                            SAVE CYCLES EEPROM
1638          //==============================================================================
1639          
1640          void save_cycles_eeprom() {
1641   1      
1642   1          cystatus status;
1643   1          static uint8 row_number;
1644   1          uint8 row_start = 11;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 28  

1645   1          uint8* addr_start   = &g_mem.emg_counter[0];    //Data at beginning of the row 11
1646   1          uint8* addr_start_c = &c_mem.emg_counter[0];
1647   1          uint8 row_end   = row_start + EEPROM_COUNTERS_ROWS - 1;
1648   1          static uint8* m_addr = NULL;
1649   1      
1650   1          // This part of code writes rows [row_start, row_end] on EEPROM    
1651   1          switch(cycles_status) {
1652   2              case PREPARE_DATA:
1653   2                  // Store data in c_mem structure to have consistent counters
1654   2                  memcpy( addr_start_c, addr_start, EEPROM_BYTES_ROW*EEPROM_COUNTERS_ROWS );            
1655   2                  m_addr = addr_start;
1656   2                  row_number = row_start;
1657   2                  cycles_status = WRITE_CYCLES;
1658   2                  break;
1659   2                  
1660   2              case WRITE_CYCLES:
1661   2                  EEPROM_UpdateTemperature();     //Check temperature of chip before writing
1662   2                  status = EEPROM_StartWrite((uint8*) m_addr, row_number);           
1663   2                  if(status == CYRET_STARTED || status == CYRET_SUCCESS) {
1664   3                      cycles_status = WAIT_QUERY;
1665   3                      can_write = FALSE;
1666   3                  }
1667   2                  break;
1668   2                  
1669   2              case WAIT_QUERY:
1670   2                  status = EEPROM_Query();
1671   2                  if(status == CYRET_SUCCESS) {
1672   3                      if (row_number < row_end) {
1673   4                          m_addr = m_addr + EEPROM_BYTES_ROW;
1674   4                          row_number = row_number + 1;
1675   4                          cycles_status = WRITE_CYCLES;
1676   4                      }
1677   3                      else {
1678   4                          cycles_status = WRITE_END;
1679   4                      }
1680   3                  }
1681   2                  break;
1682   2                 
1683   2              case WRITE_END:
1684   2                  can_write = TRUE;            
1685   2                  cycles_status = NONE;
1686   2                  
1687   2                  // Restore data saved in c_mem structure
1688   2                  memcpy( addr_start, addr_start_c, EEPROM_BYTES_ROW*EEPROM_COUNTERS_ROWS );
1689   2                  break;
1690   2                  
1691   2              case NONE:
1692   2                  break;
1693   2          }
1694   1      }
1695          /* [] END OF FILE */
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 29  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION ISR_WATCHDOG_Handler (BEGIN)
                                           ; SOURCE LINE # 133
                                           ; SOURCE LINE # 137
0000 D200        E     SETB    watchdog_flag
                                           ; SOURCE LINE # 139
0002 32                RETI    
             ; FUNCTION ISR_WATCHDOG_Handler (END)

             ; FUNCTION ISR_RS485_RX_ExInterrupt (BEGIN)
                                           ; SOURCE LINE # 145
                                           ; SOURCE LINE # 149
0000 D200        E     SETB    interrupt_flag
                                           ; SOURCE LINE # 151
0002 32                RETI    
             ; FUNCTION ISR_RS485_RX_ExInterrupt (END)

             ; FUNCTION ISR_CYCLES_Handler (BEGIN)
0000 C0E0              PUSH    ACC
0002 C083              PUSH    DPH
0004 C082              PUSH    DPL
0006 C085              PUSH    DPH1
0008 C084              PUSH    DPL1
000A C086              PUSH    DPS
000C 758600            MOV     DPS,#00H
000F C000        E     PUSH    ?C?XPAGE1SFR
0011 750000      E     MOV     ?C?XPAGE1SFR,#?C?XPAGE1RST
0014 C0D0              PUSH    PSW
0016 75D000            MOV     PSW,#00H
0019 C007              PUSH    AR7
                                           ; SOURCE LINE # 156
                                           ; SOURCE LINE # 160
001B D200        E     SETB    cycles_interrupt_flag
                                           ; SOURCE LINE # 162
001D 906568            MOV     DPTR,#06568H
0020 E0                MOVX    A,@DPTR
0021 FF                MOV     R7,A
                                           ; SOURCE LINE # 164
0022 D007              POP     AR7
0024 D0D0              POP     PSW
0026 D000        E     POP     ?C?XPAGE1SFR
0028 D086              POP     DPS
002A D084              POP     DPL1
002C D085              POP     DPH1
002E D082              POP     DPL
0030 D083              POP     DPH
0032 D0E0              POP     ACC
0034 32                RETI    
             ; FUNCTION ISR_CYCLES_Handler (END)

             ; FUNCTION interrupt_manager (BEGIN)
                                           ; SOURCE LINE # 181
                                           ; SOURCE LINE # 197
0000 E4                CLR     A
0001 F500        R     MOV     package_count,A
0003         ?C0004:
                                           ; SOURCE LINE # 203
0003 120000      E     LCALL   UART_RS485_GetRxBufferSize
0006 EF                MOV     A,R7
0007 7003              JNZ     $ + 5H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 30  

0009 020000      R     LJMP    ?C0027
000C E500        R     MOV     A,package_count
000E C3                CLR     C
000F 9406              SUBB    A,#06H
0011 4003              JC      $ + 5H
0013 020000      R     LJMP    ?C0027
                                           ; SOURCE LINE # 207
0016 120000      E     LCALL   UART_RS485_GetChar
0019 8F00        R     MOV     rx_data,R7
                                           ; SOURCE LINE # 209
001B E500        R     MOV     A,state
001D 14                DEC     A
001E 6049              JZ      ?C0011
0020 14                DEC     A
0021 6060              JZ      ?C0015
0023 14                DEC     A
0024 7003              JNZ     $ + 5H
0026 020000      R     LJMP    ?C0022
0029 14                DEC     A
002A 7003              JNZ     $ + 5H
002C 020000      R     LJMP    ?C0025
002F 2404              ADD     A,#04H
0031 70D0              JNZ     ?C0004
                                           ; SOURCE LINE # 211
0033         ?C0007:
                                           ; SOURCE LINE # 213
0033 850000      R     MOV     rx_queue,rx_queue+01H
                                           ; SOURCE LINE # 214
0036 850000      R     MOV     rx_queue+01H,rx_queue+02H
                                           ; SOURCE LINE # 215
0039 850000      R     MOV     rx_queue+02H,rx_data
                                           ; SOURCE LINE # 218
003C E500        R     MOV     A,rx_queue+01H
003E B43A11            CJNE    A,#03AH,?C0008
0041 E500        R     MOV     A,rx_queue+02H
0043 B43A0C            CJNE    A,#03AH,?C0008
                                           ; SOURCE LINE # 219
0046 E4                CLR     A
0047 F500        R     MOV     rx_queue,A
                                           ; SOURCE LINE # 220
0049 F500        R     MOV     rx_queue+01H,A
                                           ; SOURCE LINE # 221
004B F500        R     MOV     rx_queue+02H,A
                                           ; SOURCE LINE # 222
004D 750001      R     MOV     state,#01H
                                           ; SOURCE LINE # 223
0050 80B1              SJMP    ?C0004
0052         ?C0008:
                                           ; SOURCE LINE # 224
0052 E500        R     MOV     A,rx_queue
0054 B43FAC            CJNE    A,#03FH,?C0004
0057 E500        R     MOV     A,rx_queue+01H
0059 B40DA7            CJNE    A,#0DH,?C0004
005C E500        R     MOV     A,rx_queue+02H
005E 640A              XRL     A,#0AH
0060 70A1              JNZ     ?C0004
                                           ; SOURCE LINE # 227
0062 FF                MOV     R7,A
0063 FE                MOV     R6,A
0064 120000      E     LCALL   _infoGet
                                           ; SOURCE LINE # 228
0067 809A              SJMP    ?C0004
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 31  

                                           ; SOURCE LINE # 231
0069         ?C0011:
                                           ; SOURCE LINE # 234
0069 900000      E     MOV     DPTR,#c_mem+01H
006C E0                MOVX    A,@DPTR
006D 6500        R     XRL     A,rx_data
006F 6004              JZ      ?C0013
0071 E500        R     MOV     A,rx_data
0073 7004              JNZ     ?C0012
0075         ?C0013:
                                           ; SOURCE LINE # 235
0075 C200        R     CLR     rx_data_type
0077 8002              SJMP    ?C0014
0079         ?C0012:
                                           ; SOURCE LINE # 237
0079 D200        R     SETB    rx_data_type
007B         ?C0014:
                                           ; SOURCE LINE # 239
007B E4                CLR     A
007C F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 240
007E 750002      R     MOV     state,#02H
                                           ; SOURCE LINE # 241
0081 8080              SJMP    ?C0004
                                           ; SOURCE LINE # 244
0083         ?C0015:
                                           ; SOURCE LINE # 247
0083 850000      R     MOV     data_packet_length,rx_data
                                           ; SOURCE LINE # 249
0086 E500        R     MOV     A,data_packet_length
0088 D3                SETB    C
0089 9401              SUBB    A,#01H
008B 5008              JNC     ?C0016
                                           ; SOURCE LINE # 250
008D E4                CLR     A
008E F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 251
0090 F500        R     MOV     state,A
                                           ; SOURCE LINE # 252
0092 020000      R     LJMP    ?C0004
0095         ?C0016:
0095 E500        R     MOV     A,data_packet_length
0097 D3                SETB    C
0098 9480              SUBB    A,#080H
009A 4008              JC      ?C0018
                                           ; SOURCE LINE # 253
009C E4                CLR     A
009D F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 254
009F F500        R     MOV     state,A
                                           ; SOURCE LINE # 255
00A1 020000      R     LJMP    ?C0004
00A4         ?C0018:
                                           ; SOURCE LINE # 256
00A4 E4                CLR     A
00A5 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 258
00A7 200006            JB      rx_data_type,?C0020
                                           ; SOURCE LINE # 259
00AA 750003      R     MOV     state,#03H
00AD 020000      R     LJMP    ?C0004
00B0         ?C0020:
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 32  

                                           ; SOURCE LINE # 261
00B0 750004      R     MOV     state,#04H
                                           ; SOURCE LINE # 262
                                           ; SOURCE LINE # 263
00B3 020000      R     LJMP    ?C0004
                                           ; SOURCE LINE # 266
00B6         ?C0022:
                                           ; SOURCE LINE # 268
00B6 7400        R     MOV     A,#LOW data_packet_buffer
00B8 2500        R     ADD     A,data_packet_index
00BA F582              MOV     DPL,A
00BC E4                CLR     A
00BD 3400        R     ADDC    A,#HIGH data_packet_buffer
00BF F583              MOV     DPH,A
00C1 E500        R     MOV     A,rx_data
00C3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 269
00C4 0500        R     INC     data_packet_index
                                           ; SOURCE LINE # 272
00C6 E500        R     MOV     A,data_packet_index
00C8 C3                CLR     C
00C9 9500        R     SUBB    A,data_packet_length
00CB 5003              JNC     $ + 5H
00CD 020000      R     LJMP    ?C0004
                                           ; SOURCE LINE # 274
00D0 200025            JB      rx_data_type,?C0024
                                           ; SOURCE LINE # 276
00D3 AF00        R     MOV     R7,data_packet_length
00D5 7E00              MOV     R6,#00H
00D7 7800        E     MOV     R0,#LOW g_rx
00D9 7C00        E     MOV     R4,#HIGH g_rx
00DB 7D01              MOV     R5,#01H
00DD 7B01              MOV     R3,#01H
00DF 7A00        R     MOV     R2,#HIGH data_packet_buffer
00E1 7900        R     MOV     R1,#LOW data_packet_buffer
00E3 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 277
00E6 900000      E     MOV     DPTR,#g_rx+080H
00E9 E4                CLR     A
00EA F0                MOVX    @DPTR,A
00EB A3                INC     DPTR
00EC E500        R     MOV     A,data_packet_length
00EE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 278
00EF 900000      E     MOV     DPTR,#g_rx+084H
00F2 7401              MOV     A,#01H
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 279
00F5 120000      E     LCALL   commProcess
                                           ; SOURCE LINE # 280
00F8         ?C0024:
                                           ; SOURCE LINE # 282
00F8 E4                CLR     A
00F9 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 283
00FB F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 284
00FD F500        R     MOV     state,A
                                           ; SOURCE LINE # 285
00FF 0500        R     INC     package_count
                                           ; SOURCE LINE # 287
                                           ; SOURCE LINE # 288
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 33  

0101 020000      R     LJMP    ?C0004
                                           ; SOURCE LINE # 291
0104         ?C0025:
                                           ; SOURCE LINE # 292
0104 1500        R     DEC     data_packet_length
0106 E500        R     MOV     A,data_packet_length
0108 6003              JZ      $ + 5H
010A 020000      R     LJMP    ?C0004
                                           ; SOURCE LINE # 293
010D F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 294
010F F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 295
0111 7F01              MOV     R7,#01H
0113 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 296
0116 E4                CLR     A
0117 FF                MOV     R7,A
0118 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 297
011B E4                CLR     A
011C F500        R     MOV     state,A
                                           ; SOURCE LINE # 298
011E 0500        R     INC     package_count
                                           ; SOURCE LINE # 299
                                           ; SOURCE LINE # 300
0120 020000      R     LJMP    ?C0004
                                           ; SOURCE LINE # 301
                                           ; SOURCE LINE # 302
0123 020000      R     LJMP    ?C0004
                                           ; SOURCE LINE # 303
0126         ?C0027:
0126 22                RET     
             ; FUNCTION interrupt_manager (END)

             ; FUNCTION function_scheduler (BEGIN)
                                           ; SOURCE LINE # 312
                                           ; SOURCE LINE # 315
0000 C200        R     CLR     write_cycles
                                           ; SOURCE LINE # 316
0002 120000      E     LCALL   MY_TIMER_ReadCounter
0005 900000      E     MOV     DPTR,#timer_value0
0008 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 320
000B 7F01              MOV     R7,#01H
000D 120000      E     LCALL   _ADC_SOC_Write
                                           ; SOURCE LINE # 324
0010 300007            JNB     interrupt_flag,?C0028
                                           ; SOURCE LINE # 325
0013 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 326
0015 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 327
0018 D200        R     SETB    write_cycles
                                           ; SOURCE LINE # 328
001A         ?C0028:
                                           ; SOURCE LINE # 332
001A E4                CLR     A
001B FF                MOV     R7,A
001C 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 336
001F 300007            JNB     interrupt_flag,?C0029
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 34  

                                           ; SOURCE LINE # 337
0022 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 338
0024 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 339
0027 D200        R     SETB    write_cycles
                                           ; SOURCE LINE # 340
0029         ?C0029:
                                           ; SOURCE LINE # 342
0029 7F01              MOV     R7,#01H
002B 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 346
002E 300007            JNB     interrupt_flag,?C0030
                                           ; SOURCE LINE # 347
0031 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 348
0033 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 349
0036 D200        R     SETB    write_cycles
                                           ; SOURCE LINE # 350
0038         ?C0030:
                                           ; SOURCE LINE # 352
0038 7F02              MOV     R7,#02H
003A 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 356
003D 300007            JNB     interrupt_flag,?C0031
                                           ; SOURCE LINE # 357
0040 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 358
0042 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 359
0045 D200        R     SETB    write_cycles
                                           ; SOURCE LINE # 360
0047         ?C0031:
                                           ; SOURCE LINE # 364
0047 120000      R     LCALL   motor_control
                                           ; SOURCE LINE # 368
004A 300007            JNB     interrupt_flag,?C0032
                                           ; SOURCE LINE # 369
004D C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 370
004F 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 371
0052 D200        R     SETB    write_cycles
                                           ; SOURCE LINE # 372
0054         ?C0032:
                                           ; SOURCE LINE # 376
0054 120000      R     LCALL   analog_read_end
                                           ; SOURCE LINE # 378
0057 300007            JNB     interrupt_flag,?C0033
                                           ; SOURCE LINE # 379
005A C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 380
005C 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 381
005F D200        R     SETB    write_cycles
                                           ; SOURCE LINE # 382
0061         ?C0033:
                                           ; SOURCE LINE # 386
0061 120000      R     LCALL   overcurrent_control
                                           ; SOURCE LINE # 390
0064 300007            JNB     interrupt_flag,?C0034
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 35  

                                           ; SOURCE LINE # 391
0067 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 392
0069 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 393
006C D200        R     SETB    write_cycles
                                           ; SOURCE LINE # 394
006E         ?C0034:
                                           ; SOURCE LINE # 399
006E 900000      E     MOV     DPTR,#calib
0071 E0                MOVX    A,@DPTR
0072 B40124            CJNE    A,#01H,?C0035
                                           ; SOURCE LINE # 400
0075 900000      R     MOV     DPTR,#counter_calibration
0078 E0                MOVX    A,@DPTR
0079 7004              JNZ     ?C0305
007B A3                INC     DPTR
007C E0                MOVX    A,@DPTR
007D 640A              XRL     A,#0AH
007F         ?C0305:
007F 700A              JNZ     ?C0036
                                           ; SOURCE LINE # 401
0081 120000      E     LCALL   calibration
                                           ; SOURCE LINE # 402
0084 E4                CLR     A
0085 900000      R     MOV     DPTR,#counter_calibration
0088 F0                MOVX    @DPTR,A
0089 A3                INC     DPTR
008A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 403
008B         ?C0036:
                                           ; SOURCE LINE # 404
008B 900000      R     MOV     DPTR,#counter_calibration+01H
008E E0                MOVX    A,@DPTR
008F 04                INC     A
0090 F0                MOVX    @DPTR,A
0091 7006              JNZ     ?C0306
0093 900000      R     MOV     DPTR,#counter_calibration
0096 E0                MOVX    A,@DPTR
0097 04                INC     A
0098 F0                MOVX    @DPTR,A
0099         ?C0306:
                                           ; SOURCE LINE # 405
0099         ?C0035:
                                           ; SOURCE LINE # 409
0099 300007            JNB     interrupt_flag,?C0037
                                           ; SOURCE LINE # 410
009C C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 411
009E 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 412
00A1 D200        R     SETB    write_cycles
                                           ; SOURCE LINE # 413
00A3         ?C0037:
                                           ; SOURCE LINE # 418
00A3 900000      E     MOV     DPTR,#c_mem+0AAH
00A6 E0                MOVX    A,@DPTR
00A7 B4012E            CJNE    A,#01H,?C0038
                                           ; SOURCE LINE # 419
00AA 900000      R     MOV     DPTR,#counter_calibration
00AD E0                MOVX    A,@DPTR
00AE 7004              JNZ     ?C0307
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 36  

00B0 A3                INC     DPTR
00B1 E0                MOVX    A,@DPTR
00B2 640A              XRL     A,#0AH
00B4         ?C0307:
00B4 700A              JNZ     ?C0039
                                           ; SOURCE LINE # 420
00B6 120000      E     LCALL   check_rest_position
                                           ; SOURCE LINE # 421
00B9 E4                CLR     A
00BA 900000      R     MOV     DPTR,#counter_calibration
00BD F0                MOVX    @DPTR,A
00BE A3                INC     DPTR
00BF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 422
00C0         ?C0039:
                                           ; SOURCE LINE # 423
00C0 900000      R     MOV     DPTR,#counter_calibration+01H
00C3 E0                MOVX    A,@DPTR
00C4 04                INC     A
00C5 F0                MOVX    @DPTR,A
00C6 7006              JNZ     ?C0308
00C8 900000      R     MOV     DPTR,#counter_calibration
00CB E0                MOVX    A,@DPTR
00CC 04                INC     A
00CD F0                MOVX    @DPTR,A
00CE         ?C0308:
                                           ; SOURCE LINE # 426
00CE 300007            JNB     interrupt_flag,?C0038
                                           ; SOURCE LINE # 427
00D1 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 428
00D3 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 429
00D6 D200        R     SETB    write_cycles
                                           ; SOURCE LINE # 430
                                           ; SOURCE LINE # 431
00D8         ?C0038:
                                           ; SOURCE LINE # 435
00D8 120000      R     LCALL   cycles_counter_update
                                           ; SOURCE LINE # 439
00DB 300027            JNB     cycles_interrupt_flag,?C0041
                                           ; SOURCE LINE # 440
00DE C200        E     CLR     cycles_interrupt_flag
                                           ; SOURCE LINE # 444
00E0 300022            JNB     can_write,?C0041
                                           ; SOURCE LINE # 445
00E3 E4                CLR     A
00E4 F500        E     MOV     cycles_status,A
                                           ; SOURCE LINE # 448
00E6 900000      E     MOV     DPTR,#g_mem+0F8H
00E9 E0                MOVX    A,@DPTR
00EA FC                MOV     R4,A
00EB A3                INC     DPTR
00EC E0                MOVX    A,@DPTR
00ED FD                MOV     R5,A
00EE A3                INC     DPTR
00EF E0                MOVX    A,@DPTR
00F0 FE                MOV     R6,A
00F1 A3                INC     DPTR
00F2 E0                MOVX    A,@DPTR
00F3 2478              ADD     A,#078H
00F5 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 37  

00F6 E4                CLR     A
00F7 3E                ADDC    A,R6
00F8 FE                MOV     R6,A
00F9 E4                CLR     A
00FA 3D                ADDC    A,R5
00FB FD                MOV     R5,A
00FC E4                CLR     A
00FD 3C                ADDC    A,R4
00FE FC                MOV     R4,A
00FF 900000      E     MOV     DPTR,#g_mem+0F8H
0102 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 449
                                           ; SOURCE LINE # 450
0105         ?C0041:
                                           ; SOURCE LINE # 454
0105 300005            JNB     interrupt_flag,?C0043
                                           ; SOURCE LINE # 455
0108 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 456
010A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 457
010D         ?C0043:
                                           ; SOURCE LINE # 462
010D 7800        E     MOV     R0,#LOW g_measOld
010F 7C00        E     MOV     R4,#HIGH g_measOld
0111 7D01              MOV     R5,#01H
0113 7B01              MOV     R3,#01H
0115 7A00        E     MOV     R2,#HIGH g_meas
0117 7900        E     MOV     R1,#LOW g_meas
0119 7E00              MOV     R6,#00H
011B 7F37              MOV     R7,#037H
011D 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 463
0120 7800        E     MOV     R0,#LOW g_refOld
0122 7C00        E     MOV     R4,#HIGH g_refOld
0124 7D01              MOV     R5,#01H
0126 7B01              MOV     R3,#01H
0128 7A00        E     MOV     R2,#HIGH g_ref
012A 7900        E     MOV     R1,#LOW g_ref
012C 7E00              MOV     R6,#00H
012E 7F19              MOV     R7,#019H
0130 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 466
0133 7800        E     MOV     R0,#LOW g_ref
0135 7C00        E     MOV     R4,#HIGH g_ref
0137 7D01              MOV     R5,#01H
0139 7B01              MOV     R3,#01H
013B 7A00        E     MOV     R2,#HIGH g_refNew
013D 7900        E     MOV     R1,#LOW g_refNew
013F 7E00              MOV     R6,#00H
0141 7F19              MOV     R7,#019H
0143 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 468
0146 300007            JNB     interrupt_flag,?C0044
                                           ; SOURCE LINE # 469
0149 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 470
014B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 471
014E D200        R     SETB    write_cycles
                                           ; SOURCE LINE # 472
0150         ?C0044:
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 38  

                                           ; SOURCE LINE # 474
0150 120000      E     LCALL   MY_TIMER_ReadCounter
0153 900000      E     MOV     DPTR,#timer_value
0156 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 475
0159 900000      E     MOV     DPTR,#timer_value
015C E0                MOVX    A,@DPTR
015D F8                MOV     R0,A
015E A3                INC     DPTR
015F E0                MOVX    A,@DPTR
0160 F9                MOV     R1,A
0161 A3                INC     DPTR
0162 E0                MOVX    A,@DPTR
0163 FA                MOV     R2,A
0164 A3                INC     DPTR
0165 E0                MOVX    A,@DPTR
0166 FB                MOV     R3,A
0167 900000      E     MOV     DPTR,#timer_value0
016A E0                MOVX    A,@DPTR
016B FC                MOV     R4,A
016C A3                INC     DPTR
016D E0                MOVX    A,@DPTR
016E FD                MOV     R5,A
016F A3                INC     DPTR
0170 E0                MOVX    A,@DPTR
0171 FE                MOV     R6,A
0172 A3                INC     DPTR
0173 E0                MOVX    A,@DPTR
0174 C3                CLR     C
0175 9B                SUBB    A,R3
0176 FF                MOV     R7,A
0177 EE                MOV     A,R6
0178 9A                SUBB    A,R2
0179 FE                MOV     R6,A
017A ED                MOV     A,R5
017B 99                SUBB    A,R1
017C FD                MOV     R5,A
017D EC                MOV     A,R4
017E 98                SUBB    A,R0
017F FC                MOV     R4,A
0180 E4                CLR     A
0181 120000      E     LCALL   ?C?FCASTL
0184 7B00              MOV     R3,#00H
0186 7A24              MOV     R2,#024H
0188 7974              MOV     R1,#074H
018A 7849              MOV     R0,#049H
018C 120000      E     LCALL   ?C?FPDIV
018F 900000      E     MOV     DPTR,#cycle_time
0192 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 476
0195 7F40              MOV     R7,#040H
0197 7E4B              MOV     R6,#04BH
0199 7D4C              MOV     R5,#04CH
019B 7C00              MOV     R4,#00H
019D 120000      E     LCALL   _MY_TIMER_WriteCounter
                                           ; SOURCE LINE # 478
01A0 22                RET     
             ; FUNCTION function_scheduler (END)

             ; FUNCTION motor_control (BEGIN)
                                           ; SOURCE LINE # 484
                                           ; SOURCE LINE # 486
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 39  

0000 E4                CLR     A
0001 F500        R     MOV     pwm_input+03H,A
0003 F500        R     MOV     pwm_input+02H,A
0005 F500        R     MOV     pwm_input+01H,A
0007 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 496
0009 900000      E     MOV     DPTR,#c_mem+02H
000C E0                MOVX    A,@DPTR
000D FC                MOV     R4,A
000E A3                INC     DPTR
000F E0                MOVX    A,@DPTR
0010 FD                MOV     R5,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 FE                MOV     R6,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 F500        R     MOV     k_p+03H,A
0018 8E00        R     MOV     k_p+02H,R6
001A 8D00        R     MOV     k_p+01H,R5
001C 8C00        R     MOV     k_p,R4
                                           ; SOURCE LINE # 497
001E A3                INC     DPTR
001F E0                MOVX    A,@DPTR
0020 FC                MOV     R4,A
0021 A3                INC     DPTR
0022 E0                MOVX    A,@DPTR
0023 FD                MOV     R5,A
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 FE                MOV     R6,A
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 F500        R     MOV     k_i+03H,A
002B 8E00        R     MOV     k_i+02H,R6
002D 8D00        R     MOV     k_i+01H,R5
002F 8C00        R     MOV     k_i,R4
                                           ; SOURCE LINE # 498
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 FC                MOV     R4,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 FD                MOV     R5,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FE                MOV     R6,A
003A A3                INC     DPTR
003B E0                MOVX    A,@DPTR
003C F500        R     MOV     k_d+03H,A
003E 8E00        R     MOV     k_d+02H,R6
0040 8D00        R     MOV     k_d+01H,R5
0042 8C00        R     MOV     k_d,R4
                                           ; SOURCE LINE # 500
0044 A3                INC     DPTR
0045 E0                MOVX    A,@DPTR
0046 FC                MOV     R4,A
0047 A3                INC     DPTR
0048 E0                MOVX    A,@DPTR
0049 FD                MOV     R5,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 40  

004C FE                MOV     R6,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F F500        R     MOV     k_p_c+03H,A
0051 8E00        R     MOV     k_p_c+02H,R6
0053 8D00        R     MOV     k_p_c+01H,R5
0055 8C00        R     MOV     k_p_c,R4
                                           ; SOURCE LINE # 501
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FC                MOV     R4,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
005C FD                MOV     R5,A
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F FE                MOV     R6,A
0060 A3                INC     DPTR
0061 E0                MOVX    A,@DPTR
0062 F500        R     MOV     k_i_c+03H,A
0064 8E00        R     MOV     k_i_c+02H,R6
0066 8D00        R     MOV     k_i_c+01H,R5
0068 8C00        R     MOV     k_i_c,R4
                                           ; SOURCE LINE # 502
006A A3                INC     DPTR
006B E0                MOVX    A,@DPTR
006C FC                MOV     R4,A
006D A3                INC     DPTR
006E E0                MOVX    A,@DPTR
006F FD                MOV     R5,A
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 FE                MOV     R6,A
0073 A3                INC     DPTR
0074 E0                MOVX    A,@DPTR
0075 F500        R     MOV     k_d_c+03H,A
0077 8E00        R     MOV     k_d_c+02H,R6
0079 8D00        R     MOV     k_d_c+01H,R5
007B 8C00        R     MOV     k_d_c,R4
                                           ; SOURCE LINE # 504
007D A3                INC     DPTR
007E E0                MOVX    A,@DPTR
007F FC                MOV     R4,A
0080 A3                INC     DPTR
0081 E0                MOVX    A,@DPTR
0082 FD                MOV     R5,A
0083 A3                INC     DPTR
0084 E0                MOVX    A,@DPTR
0085 FE                MOV     R6,A
0086 A3                INC     DPTR
0087 E0                MOVX    A,@DPTR
0088 F500        R     MOV     k_p_dl+03H,A
008A 8E00        R     MOV     k_p_dl+02H,R6
008C 8D00        R     MOV     k_p_dl+01H,R5
008E 8C00        R     MOV     k_p_dl,R4
                                           ; SOURCE LINE # 505
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FC                MOV     R4,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 41  

0096 A3                INC     DPTR
0097 E0                MOVX    A,@DPTR
0098 FE                MOV     R6,A
0099 A3                INC     DPTR
009A E0                MOVX    A,@DPTR
009B F500        R     MOV     k_i_dl+03H,A
009D 8E00        R     MOV     k_i_dl+02H,R6
009F 8D00        R     MOV     k_i_dl+01H,R5
00A1 8C00        R     MOV     k_i_dl,R4
                                           ; SOURCE LINE # 506
00A3 A3                INC     DPTR
00A4 E0                MOVX    A,@DPTR
00A5 FC                MOV     R4,A
00A6 A3                INC     DPTR
00A7 E0                MOVX    A,@DPTR
00A8 FD                MOV     R5,A
00A9 A3                INC     DPTR
00AA E0                MOVX    A,@DPTR
00AB FE                MOV     R6,A
00AC A3                INC     DPTR
00AD E0                MOVX    A,@DPTR
00AE F500        R     MOV     k_d_dl+03H,A
00B0 8E00        R     MOV     k_d_dl+02H,R6
00B2 8D00        R     MOV     k_d_dl+01H,R5
00B4 8C00        R     MOV     k_d_dl,R4
                                           ; SOURCE LINE # 508
00B6 A3                INC     DPTR
00B7 E0                MOVX    A,@DPTR
00B8 FC                MOV     R4,A
00B9 A3                INC     DPTR
00BA E0                MOVX    A,@DPTR
00BB FD                MOV     R5,A
00BC A3                INC     DPTR
00BD E0                MOVX    A,@DPTR
00BE FE                MOV     R6,A
00BF A3                INC     DPTR
00C0 E0                MOVX    A,@DPTR
00C1 F500        R     MOV     k_p_c_dl+03H,A
00C3 8E00        R     MOV     k_p_c_dl+02H,R6
00C5 8D00        R     MOV     k_p_c_dl+01H,R5
00C7 8C00        R     MOV     k_p_c_dl,R4
                                           ; SOURCE LINE # 509
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB FC                MOV     R4,A
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE FD                MOV     R5,A
00CF A3                INC     DPTR
00D0 E0                MOVX    A,@DPTR
00D1 FE                MOV     R6,A
00D2 A3                INC     DPTR
00D3 E0                MOVX    A,@DPTR
00D4 F500        R     MOV     k_i_c_dl+03H,A
00D6 8E00        R     MOV     k_i_c_dl+02H,R6
00D8 8D00        R     MOV     k_i_c_dl+01H,R5
00DA 8C00        R     MOV     k_i_c_dl,R4
                                           ; SOURCE LINE # 510
00DC A3                INC     DPTR
00DD E0                MOVX    A,@DPTR
00DE FC                MOV     R4,A
00DF A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 42  

00E0 E0                MOVX    A,@DPTR
00E1 FD                MOV     R5,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 FE                MOV     R6,A
00E5 A3                INC     DPTR
00E6 E0                MOVX    A,@DPTR
00E7 F500        R     MOV     k_d_c_dl+03H,A
00E9 8E00        R     MOV     k_d_c_dl+02H,R6
00EB 8D00        R     MOV     k_d_c_dl+01H,R5
00ED 8C00        R     MOV     k_d_c_dl,R4
                                           ; SOURCE LINE # 527
00EF 900000      E     MOV     DPTR,#c_mem+06BH
00F2 E0                MOVX    A,@DPTR
00F3 FE                MOV     R6,A
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6 FF                MOV     R7,A
00F7 FB                MOV     R3,A
00F8 AA06              MOV     R2,AR6
00FA E4                CLR     A
00FB 900000      E     MOV     DPTR,#g_meas+017H
00FE E0                MOVX    A,@DPTR
00FF FC                MOV     R4,A
0100 A3                INC     DPTR
0101 E0                MOVX    A,@DPTR
0102 FD                MOV     R5,A
0103 A3                INC     DPTR
0104 E0                MOVX    A,@DPTR
0105 FE                MOV     R6,A
0106 A3                INC     DPTR
0107 E0                MOVX    A,@DPTR
0108 C3                CLR     C
0109 9B                SUBB    A,R3
010A F500        R     MOV     err_emg_1+03H,A
010C EE                MOV     A,R6
010D 9A                SUBB    A,R2
010E F500        R     MOV     err_emg_1+02H,A
0110 ED                MOV     A,R5
0111 9400              SUBB    A,#00H
0113 F500        R     MOV     err_emg_1+01H,A
0115 EC                MOV     A,R4
0116 9400              SUBB    A,#00H
0118 F500        R     MOV     err_emg_1,A
                                           ; SOURCE LINE # 528
011A 900000      E     MOV     DPTR,#c_mem+06DH
011D E0                MOVX    A,@DPTR
011E FE                MOV     R6,A
011F A3                INC     DPTR
0120 E0                MOVX    A,@DPTR
0121 FF                MOV     R7,A
0122 FB                MOV     R3,A
0123 AA06              MOV     R2,AR6
0125 E4                CLR     A
0126 900000      E     MOV     DPTR,#g_meas+01BH
0129 E0                MOVX    A,@DPTR
012A FC                MOV     R4,A
012B A3                INC     DPTR
012C E0                MOVX    A,@DPTR
012D FD                MOV     R5,A
012E A3                INC     DPTR
012F E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 43  

0130 FE                MOV     R6,A
0131 A3                INC     DPTR
0132 E0                MOVX    A,@DPTR
0133 C3                CLR     C
0134 9B                SUBB    A,R3
0135 F500        R     MOV     err_emg_2+03H,A
0137 EE                MOV     A,R6
0138 9A                SUBB    A,R2
0139 F500        R     MOV     err_emg_2+02H,A
013B ED                MOV     A,R5
013C 9400              SUBB    A,#00H
013E F500        R     MOV     err_emg_2+01H,A
0140 EC                MOV     A,R4
0141 9400              SUBB    A,#00H
0143 F500        R     MOV     err_emg_2,A
                                           ; SOURCE LINE # 531
0145 900000      E     MOV     DPTR,#c_mem+033H
0148 E0                MOVX    A,@DPTR
0149 24FE              ADD     A,#0FEH
014B 7003              JNZ     $ + 5H
014D 020000      R     LJMP    ?C0054
0150 14                DEC     A
0151 7003              JNZ     $ + 5H
0153 020000      R     LJMP    ?C0057
0156 14                DEC     A
0157 7003              JNZ     $ + 5H
0159 020000      R     LJMP    ?C0060
015C 14                DEC     A
015D 7003              JNZ     $ + 5H
015F 020000      R     LJMP    ?C0070
0162 2404              ADD     A,#04H
0164 6003              JZ      $ + 5H
0166 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 533
0169         ?C0047:
                                           ; SOURCE LINE # 537
0169 900000      E     MOV     DPTR,#c_mem+079H
016C E0                MOVX    A,@DPTR
016D 6024              JZ      ?C0048
                                           ; SOURCE LINE # 538
016F A3                INC     DPTR
0170 E0                MOVX    A,@DPTR
0171 FF                MOV     R7,A
0172 33                RLC     A
0173 95E0              SUBB    A,ACC
0175 FE                MOV     R6,A
0176 FD                MOV     R5,A
0177 FC                MOV     R4,A
0178 900000      E     MOV     DPTR,#g_meas+08H
017B E0                MOVX    A,@DPTR
017C F8                MOV     R0,A
017D A3                INC     DPTR
017E E0                MOVX    A,@DPTR
017F F9                MOV     R1,A
0180 A3                INC     DPTR
0181 E0                MOVX    A,@DPTR
0182 FA                MOV     R2,A
0183 A3                INC     DPTR
0184 E0                MOVX    A,@DPTR
0185 FB                MOV     R3,A
0186 120000      E     LCALL   ?C?LMUL
0189 8F00        R     MOV     handle_value+03H,R7
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 44  

018B 8E00        R     MOV     handle_value+02H,R6
018D 8D00        R     MOV     handle_value+01H,R5
018F 8C00        R     MOV     handle_value,R4
0191 8024              SJMP    ?C0049
0193         ?C0048:
                                           ; SOURCE LINE # 540
0193 900000      E     MOV     DPTR,#c_mem+07AH
0196 E0                MOVX    A,@DPTR
0197 FF                MOV     R7,A
0198 33                RLC     A
0199 95E0              SUBB    A,ACC
019B FE                MOV     R6,A
019C FD                MOV     R5,A
019D FC                MOV     R4,A
019E 900000      E     MOV     DPTR,#g_meas+04H
01A1 E0                MOVX    A,@DPTR
01A2 F8                MOV     R0,A
01A3 A3                INC     DPTR
01A4 E0                MOVX    A,@DPTR
01A5 F9                MOV     R1,A
01A6 A3                INC     DPTR
01A7 E0                MOVX    A,@DPTR
01A8 FA                MOV     R2,A
01A9 A3                INC     DPTR
01AA E0                MOVX    A,@DPTR
01AB FB                MOV     R3,A
01AC 120000      E     LCALL   ?C?LMUL
01AF 8F00        R     MOV     handle_value+03H,R7
01B1 8E00        R     MOV     handle_value+02H,R6
01B3 8D00        R     MOV     handle_value+01H,R5
01B5 8C00        R     MOV     handle_value,R4
01B7         ?C0049:
                                           ; SOURCE LINE # 544
01B7 900000      E     MOV     DPTR,#g_ref
01BA E0                MOVX    A,@DPTR
01BB F8                MOV     R0,A
01BC A3                INC     DPTR
01BD E0                MOVX    A,@DPTR
01BE F9                MOV     R1,A
01BF A3                INC     DPTR
01C0 E0                MOVX    A,@DPTR
01C1 FA                MOV     R2,A
01C2 A3                INC     DPTR
01C3 E0                MOVX    A,@DPTR
01C4 FB                MOV     R3,A
01C5 C3                CLR     C
01C6 E500        R     MOV     A,handle_value+03H
01C8 9B                SUBB    A,R3
01C9 FF                MOV     R7,A
01CA E500        R     MOV     A,handle_value+02H
01CC 9A                SUBB    A,R2
01CD FE                MOV     R6,A
01CE E500        R     MOV     A,handle_value+01H
01D0 99                SUBB    A,R1
01D1 FD                MOV     R5,A
01D2 E500        R     MOV     A,handle_value
01D4 98                SUBB    A,R0
01D5 FC                MOV     R4,A
01D6 900000      E     MOV     DPTR,#c_mem+061H
01D9 E0                MOVX    A,@DPTR
01DA F8                MOV     R0,A
01DB A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 45  

01DC E0                MOVX    A,@DPTR
01DD F9                MOV     R1,A
01DE A3                INC     DPTR
01DF E0                MOVX    A,@DPTR
01E0 FA                MOV     R2,A
01E1 A3                INC     DPTR
01E2 E0                MOVX    A,@DPTR
01E3 FB                MOV     R3,A
01E4 C3                CLR     C
01E5 120000      E     LCALL   ?C?SLCMP
01E8 5044              JNC     ?C0050
01EA E4                CLR     A
01EB FF                MOV     R7,A
01EC FE                MOV     R6,A
01ED FD                MOV     R5,A
01EE FC                MOV     R4,A
01EF 900000      E     MOV     DPTR,#c_mem+061H
01F2 E0                MOVX    A,@DPTR
01F3 F8                MOV     R0,A
01F4 A3                INC     DPTR
01F5 E0                MOVX    A,@DPTR
01F6 A3                INC     DPTR
01F7 E0                MOVX    A,@DPTR
01F8 A3                INC     DPTR
01F9 E0                MOVX    A,@DPTR
01FA C3                CLR     C
01FB 120000      E     LCALL   ?C?SLCMP
01FE 602E              JZ      ?C0050
                                           ; SOURCE LINE # 545
0200 900000      E     MOV     DPTR,#g_ref
0203 E0                MOVX    A,@DPTR
0204 FC                MOV     R4,A
0205 A3                INC     DPTR
0206 E0                MOVX    A,@DPTR
0207 FD                MOV     R5,A
0208 A3                INC     DPTR
0209 E0                MOVX    A,@DPTR
020A FE                MOV     R6,A
020B A3                INC     DPTR
020C E0                MOVX    A,@DPTR
020D FF                MOV     R7,A
020E 900000      E     MOV     DPTR,#c_mem+061H
0211 E0                MOVX    A,@DPTR
0212 F8                MOV     R0,A
0213 A3                INC     DPTR
0214 E0                MOVX    A,@DPTR
0215 A3                INC     DPTR
0216 E0                MOVX    A,@DPTR
0217 A3                INC     DPTR
0218 E0                MOVX    A,@DPTR
0219 EF                MOV     A,R7
021A 2B                ADD     A,R3
021B FF                MOV     R7,A
021C EE                MOV     A,R6
021D 3A                ADDC    A,R2
021E FE                MOV     R6,A
021F ED                MOV     A,R5
0220 39                ADDC    A,R1
0221 FD                MOV     R5,A
0222 EC                MOV     A,R4
0223 38                ADDC    A,R0
0224 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 46  

0225 900000      E     MOV     DPTR,#g_ref
0228 120000      E     LCALL   ?C?LSTXDATA
022B 020000      R     LJMP    ?C0046
022E         ?C0050:
                                           ; SOURCE LINE # 546
                                           ; SOURCE LINE # 547
022E 900000      E     MOV     DPTR,#g_ref
0231 E0                MOVX    A,@DPTR
0232 F8                MOV     R0,A
0233 A3                INC     DPTR
0234 E0                MOVX    A,@DPTR
0235 F9                MOV     R1,A
0236 A3                INC     DPTR
0237 E0                MOVX    A,@DPTR
0238 FA                MOV     R2,A
0239 A3                INC     DPTR
023A E0                MOVX    A,@DPTR
023B FB                MOV     R3,A
023C C3                CLR     C
023D E500        R     MOV     A,handle_value+03H
023F 9B                SUBB    A,R3
0240 FF                MOV     R7,A
0241 E500        R     MOV     A,handle_value+02H
0243 9A                SUBB    A,R2
0244 FE                MOV     R6,A
0245 E500        R     MOV     A,handle_value+01H
0247 99                SUBB    A,R1
0248 FD                MOV     R5,A
0249 E500        R     MOV     A,handle_value
024B 98                SUBB    A,R0
024C FC                MOV     R4,A
024D 900000      E     MOV     DPTR,#c_mem+065H
0250 E0                MOVX    A,@DPTR
0251 F8                MOV     R0,A
0252 A3                INC     DPTR
0253 E0                MOVX    A,@DPTR
0254 F9                MOV     R1,A
0255 A3                INC     DPTR
0256 E0                MOVX    A,@DPTR
0257 FA                MOV     R2,A
0258 A3                INC     DPTR
0259 E0                MOVX    A,@DPTR
025A FB                MOV     R3,A
025B D3                SETB    C
025C 120000      E     LCALL   ?C?SLCMP
025F 4043              JC      ?C0052
0261 E4                CLR     A
0262 FF                MOV     R7,A
0263 FE                MOV     R6,A
0264 FD                MOV     R5,A
0265 FC                MOV     R4,A
0266 900000      E     MOV     DPTR,#c_mem+065H
0269 E0                MOVX    A,@DPTR
026A F8                MOV     R0,A
026B A3                INC     DPTR
026C E0                MOVX    A,@DPTR
026D A3                INC     DPTR
026E E0                MOVX    A,@DPTR
026F A3                INC     DPTR
0270 E0                MOVX    A,@DPTR
0271 120000      E     LCALL   ?C?SLCMP
0274 602E              JZ      ?C0052
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 47  

                                           ; SOURCE LINE # 548
0276 900000      E     MOV     DPTR,#g_ref
0279 E0                MOVX    A,@DPTR
027A FC                MOV     R4,A
027B A3                INC     DPTR
027C E0                MOVX    A,@DPTR
027D FD                MOV     R5,A
027E A3                INC     DPTR
027F E0                MOVX    A,@DPTR
0280 FE                MOV     R6,A
0281 A3                INC     DPTR
0282 E0                MOVX    A,@DPTR
0283 FF                MOV     R7,A
0284 900000      E     MOV     DPTR,#c_mem+065H
0287 E0                MOVX    A,@DPTR
0288 F8                MOV     R0,A
0289 A3                INC     DPTR
028A E0                MOVX    A,@DPTR
028B A3                INC     DPTR
028C E0                MOVX    A,@DPTR
028D A3                INC     DPTR
028E E0                MOVX    A,@DPTR
028F EF                MOV     A,R7
0290 2B                ADD     A,R3
0291 FF                MOV     R7,A
0292 EE                MOV     A,R6
0293 3A                ADDC    A,R2
0294 FE                MOV     R6,A
0295 ED                MOV     A,R5
0296 39                ADDC    A,R1
0297 FD                MOV     R5,A
0298 EC                MOV     A,R4
0299 38                ADDC    A,R0
029A FC                MOV     R4,A
029B 900000      E     MOV     DPTR,#g_ref
029E 120000      E     LCALL   ?C?LSTXDATA
02A1 020000      R     LJMP    ?C0046
02A4         ?C0052:
                                           ; SOURCE LINE # 550
02A4 AF00        R     MOV     R7,handle_value+03H
02A6 AE00        R     MOV     R6,handle_value+02H
02A8 AD00        R     MOV     R5,handle_value+01H
02AA AC00        R     MOV     R4,handle_value
02AC 900000      E     MOV     DPTR,#g_ref
02AF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 551
                                           ; SOURCE LINE # 552
02B2 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 554
02B5         ?C0054:
                                           ; SOURCE LINE # 555
02B5 E4                CLR     A
02B6 FF                MOV     R7,A
02B7 FE                MOV     R6,A
02B8 FD                MOV     R5,A
02B9 FC                MOV     R4,A
02BA AB00        R     MOV     R3,err_emg_1+03H
02BC AA00        R     MOV     R2,err_emg_1+02H
02BE A900        R     MOV     R1,err_emg_1+01H
02C0 A800        R     MOV     R0,err_emg_1
02C2 D3                SETB    C
02C3 120000      E     LCALL   ?C?SLCMP
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 48  

02C6 403D              JC      ?C0055
                                           ; SOURCE LINE # 556
02C8 900000      E     MOV     DPTR,#g_mem+059H
02CB E0                MOVX    A,@DPTR
02CC FC                MOV     R4,A
02CD A3                INC     DPTR
02CE E0                MOVX    A,@DPTR
02CF FD                MOV     R5,A
02D0 A3                INC     DPTR
02D1 E0                MOVX    A,@DPTR
02D2 FE                MOV     R6,A
02D3 A3                INC     DPTR
02D4 E0                MOVX    A,@DPTR
02D5 FF                MOV     R7,A
02D6 A800        R     MOV     R0,err_emg_1
02D8 120000      E     LCALL   ?C?LMUL
02DB C006              PUSH    AR6
02DD C007              PUSH    AR7
02DF 900000      E     MOV     DPTR,#c_mem+06BH
02E2 E0                MOVX    A,@DPTR
02E3 FE                MOV     R6,A
02E4 A3                INC     DPTR
02E5 E0                MOVX    A,@DPTR
02E6 FF                MOV     R7,A
02E7 C3                CLR     C
02E8 E4                CLR     A
02E9 9F                SUBB    A,R7
02EA FF                MOV     R7,A
02EB 7404              MOV     A,#04H
02ED 9E                SUBB    A,R6
02EE FE                MOV     R6,A
02EF AB07              MOV     R3,AR7
02F1 FA                MOV     R2,A
02F2 E4                CLR     A
02F3 F9                MOV     R1,A
02F4 F8                MOV     R0,A
02F5 D007              POP     AR7
02F7 D006              POP     AR6
02F9 120000      E     LCALL   ?C?SLDIV
02FC 900000      E     MOV     DPTR,#g_ref
02FF 120000      E     LCALL   ?C?LSTXDATA
0302 020000      R     LJMP    ?C0046
0305         ?C0055:
                                           ; SOURCE LINE # 558
0305 E4                CLR     A
0306 FF                MOV     R7,A
0307 FE                MOV     R6,A
0308 FD                MOV     R5,A
0309 FC                MOV     R4,A
030A 900000      E     MOV     DPTR,#g_ref
030D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 559
0310 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 561
0313         ?C0057:
                                           ; SOURCE LINE # 562
0313 900000      E     MOV     DPTR,#g_refOld
0316 E0                MOVX    A,@DPTR
0317 FC                MOV     R4,A
0318 A3                INC     DPTR
0319 E0                MOVX    A,@DPTR
031A FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 49  

031B A3                INC     DPTR
031C E0                MOVX    A,@DPTR
031D FE                MOV     R6,A
031E A3                INC     DPTR
031F E0                MOVX    A,@DPTR
0320 FF                MOV     R7,A
0321 900000      E     MOV     DPTR,#g_ref
0324 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 563
0327 E4                CLR     A
0328 FF                MOV     R7,A
0329 FE                MOV     R6,A
032A FD                MOV     R5,A
032B FC                MOV     R4,A
032C AB00        R     MOV     R3,err_emg_1+03H
032E AA00        R     MOV     R2,err_emg_1+02H
0330 A900        R     MOV     R1,err_emg_1+01H
0332 A800        R     MOV     R0,err_emg_1
0334 D3                SETB    C
0335 120000      E     LCALL   ?C?SLCMP
0338 4056              JC      ?C0058
                                           ; SOURCE LINE # 564
033A 900000      E     MOV     DPTR,#g_mem+078H
033D E0                MOVX    A,@DPTR
033E FF                MOV     R7,A
033F E4                CLR     A
0340 FC                MOV     R4,A
0341 FD                MOV     R5,A
0342 FE                MOV     R6,A
0343 A800        R     MOV     R0,err_emg_1
0345 120000      E     LCALL   ?C?LMUL
0348 E4                CLR     A
0349 7B02              MOV     R3,#02H
034B FA                MOV     R2,A
034C F9                MOV     R1,A
034D F8                MOV     R0,A
034E 120000      E     LCALL   ?C?LMUL
0351 C006              PUSH    AR6
0353 C007              PUSH    AR7
0355 900000      E     MOV     DPTR,#c_mem+06BH
0358 E0                MOVX    A,@DPTR
0359 FE                MOV     R6,A
035A A3                INC     DPTR
035B E0                MOVX    A,@DPTR
035C FF                MOV     R7,A
035D C3                CLR     C
035E E4                CLR     A
035F 9F                SUBB    A,R7
0360 FF                MOV     R7,A
0361 7404              MOV     A,#04H
0363 9E                SUBB    A,R6
0364 FE                MOV     R6,A
0365 AB07              MOV     R3,AR7
0367 FA                MOV     R2,A
0368 E4                CLR     A
0369 F9                MOV     R1,A
036A F8                MOV     R0,A
036B D007              POP     AR7
036D D006              POP     AR6
036F 120000      E     LCALL   ?C?SLDIV
0372 900000      E     MOV     DPTR,#g_refOld
0375 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 50  

0376 F8                MOV     R0,A
0377 A3                INC     DPTR
0378 E0                MOVX    A,@DPTR
0379 F9                MOV     R1,A
037A A3                INC     DPTR
037B E0                MOVX    A,@DPTR
037C FA                MOV     R2,A
037D A3                INC     DPTR
037E E0                MOVX    A,@DPTR
037F 2F                ADD     A,R7
0380 FF                MOV     R7,A
0381 EA                MOV     A,R2
0382 3E                ADDC    A,R6
0383 FE                MOV     R6,A
0384 E9                MOV     A,R1
0385 3D                ADDC    A,R5
0386 FD                MOV     R5,A
0387 E8                MOV     A,R0
0388 3C                ADDC    A,R4
0389 FC                MOV     R4,A
038A 900000      E     MOV     DPTR,#g_ref
038D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 565
0390         ?C0058:
                                           ; SOURCE LINE # 566
0390 E4                CLR     A
0391 FF                MOV     R7,A
0392 FE                MOV     R6,A
0393 FD                MOV     R5,A
0394 FC                MOV     R4,A
0395 AB00        R     MOV     R3,err_emg_2+03H
0397 AA00        R     MOV     R2,err_emg_2+02H
0399 A900        R     MOV     R1,err_emg_2+01H
039B A800        R     MOV     R0,err_emg_2
039D D3                SETB    C
039E 120000      E     LCALL   ?C?SLCMP
03A1 5003              JNC     $ + 5H
03A3 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 567
03A6 900000      E     MOV     DPTR,#g_mem+078H
03A9 E0                MOVX    A,@DPTR
03AA FF                MOV     R7,A
03AB E4                CLR     A
03AC FC                MOV     R4,A
03AD FD                MOV     R5,A
03AE FE                MOV     R6,A
03AF A800        R     MOV     R0,err_emg_2
03B1 120000      E     LCALL   ?C?LMUL
03B4 E4                CLR     A
03B5 7B02              MOV     R3,#02H
03B7 FA                MOV     R2,A
03B8 F9                MOV     R1,A
03B9 F8                MOV     R0,A
03BA 120000      E     LCALL   ?C?LMUL
03BD C006              PUSH    AR6
03BF C007              PUSH    AR7
03C1 900000      E     MOV     DPTR,#c_mem+06DH
03C4 E0                MOVX    A,@DPTR
03C5 FE                MOV     R6,A
03C6 A3                INC     DPTR
03C7 E0                MOVX    A,@DPTR
03C8 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 51  

03C9 C3                CLR     C
03CA E4                CLR     A
03CB 9F                SUBB    A,R7
03CC FF                MOV     R7,A
03CD 7404              MOV     A,#04H
03CF 9E                SUBB    A,R6
03D0 FE                MOV     R6,A
03D1 AB07              MOV     R3,AR7
03D3 FA                MOV     R2,A
03D4 E4                CLR     A
03D5 F9                MOV     R1,A
03D6 F8                MOV     R0,A
03D7 D007              POP     AR7
03D9 D006              POP     AR6
03DB 120000      E     LCALL   ?C?SLDIV
03DE A804              MOV     R0,AR4
03E0 A905              MOV     R1,AR5
03E2 AA06              MOV     R2,AR6
03E4 AB07              MOV     R3,AR7
03E6 900000      E     MOV     DPTR,#g_refOld
03E9 E0                MOVX    A,@DPTR
03EA FC                MOV     R4,A
03EB A3                INC     DPTR
03EC E0                MOVX    A,@DPTR
03ED FD                MOV     R5,A
03EE A3                INC     DPTR
03EF E0                MOVX    A,@DPTR
03F0 FE                MOV     R6,A
03F1 A3                INC     DPTR
03F2 E0                MOVX    A,@DPTR
03F3 C3                CLR     C
03F4 9B                SUBB    A,R3
03F5 FF                MOV     R7,A
03F6 EE                MOV     A,R6
03F7 9A                SUBB    A,R2
03F8 FE                MOV     R6,A
03F9 ED                MOV     A,R5
03FA 99                SUBB    A,R1
03FB FD                MOV     R5,A
03FC EC                MOV     A,R4
03FD 98                SUBB    A,R0
03FE FC                MOV     R4,A
03FF 900000      E     MOV     DPTR,#g_ref
0402 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 568
                                           ; SOURCE LINE # 569
0405 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 571
0408         ?C0060:
                                           ; SOURCE LINE # 572
0408 900000      E     MOV     DPTR,#g_refOld
040B E0                MOVX    A,@DPTR
040C FC                MOV     R4,A
040D A3                INC     DPTR
040E E0                MOVX    A,@DPTR
040F FD                MOV     R5,A
0410 A3                INC     DPTR
0411 E0                MOVX    A,@DPTR
0412 FE                MOV     R6,A
0413 A3                INC     DPTR
0414 E0                MOVX    A,@DPTR
0415 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 52  

0416 900000      E     MOV     DPTR,#g_ref
0419 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 573
041C 900000      R     MOV     DPTR,#current_emg
041F E0                MOVX    A,@DPTR
0420 14                DEC     A
0421 6048              JZ      ?C0065
0423 14                DEC     A
0424 7003              JNZ     $ + 5H
0426 020000      R     LJMP    ?C0067
0429 2402              ADD     A,#02H
042B 6003              JZ      $ + 5H
042D 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 574
0430         ?C0062:
                                           ; SOURCE LINE # 576
0430 E4                CLR     A
0431 FF                MOV     R7,A
0432 FE                MOV     R6,A
0433 FD                MOV     R5,A
0434 FC                MOV     R4,A
0435 AB00        R     MOV     R3,err_emg_1+03H
0437 AA00        R     MOV     R2,err_emg_1+02H
0439 A900        R     MOV     R1,err_emg_1+01H
043B A800        R     MOV     R0,err_emg_1
043D D3                SETB    C
043E 120000      E     LCALL   ?C?SLCMP
0441 4009              JC      ?C0063
                                           ; SOURCE LINE # 577
0443 900000      R     MOV     DPTR,#current_emg
0446 7401              MOV     A,#01H
0448 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 578
0449 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 579
044C         ?C0063:
                                           ; SOURCE LINE # 580
044C E4                CLR     A
044D FF                MOV     R7,A
044E FE                MOV     R6,A
044F FD                MOV     R5,A
0450 FC                MOV     R4,A
0451 AB00        R     MOV     R3,err_emg_2+03H
0453 AA00        R     MOV     R2,err_emg_2+02H
0455 A900        R     MOV     R1,err_emg_2+01H
0457 A800        R     MOV     R0,err_emg_2
0459 D3                SETB    C
045A 120000      E     LCALL   ?C?SLCMP
045D 5003              JNC     $ + 5H
045F 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 581
0462 900000      R     MOV     DPTR,#current_emg
0465 7402              MOV     A,#02H
0467 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 582
0468 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 583
                                           ; SOURCE LINE # 584
                                           ; SOURCE LINE # 586
046B         ?C0065:
                                           ; SOURCE LINE # 588
046B E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 53  

046C FF                MOV     R7,A
046D FE                MOV     R6,A
046E FD                MOV     R5,A
046F FC                MOV     R4,A
0470 AB00        R     MOV     R3,err_emg_1+03H
0472 AA00        R     MOV     R2,err_emg_1+02H
0474 A900        R     MOV     R1,err_emg_1+01H
0476 A800        R     MOV     R0,err_emg_1
0478 C3                CLR     C
0479 120000      E     LCALL   ?C?SLCMP
047C 5008              JNC     ?C0066
                                           ; SOURCE LINE # 589
047E E4                CLR     A
047F 900000      R     MOV     DPTR,#current_emg
0482 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 590
0483 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 591
0486         ?C0066:
                                           ; SOURCE LINE # 592
0486 900000      E     MOV     DPTR,#g_mem+078H
0489 E0                MOVX    A,@DPTR
048A FF                MOV     R7,A
048B E4                CLR     A
048C FC                MOV     R4,A
048D FD                MOV     R5,A
048E FE                MOV     R6,A
048F AB00        R     MOV     R3,err_emg_1+03H
0491 AA00        R     MOV     R2,err_emg_1+02H
0493 A900        R     MOV     R1,err_emg_1+01H
0495 A800        R     MOV     R0,err_emg_1
0497 120000      E     LCALL   ?C?LMUL
049A E4                CLR     A
049B 7B02              MOV     R3,#02H
049D FA                MOV     R2,A
049E F9                MOV     R1,A
049F F8                MOV     R0,A
04A0 120000      E     LCALL   ?C?LMUL
04A3 C006              PUSH    AR6
04A5 C007              PUSH    AR7
04A7 900000      E     MOV     DPTR,#c_mem+06BH
04AA E0                MOVX    A,@DPTR
04AB FE                MOV     R6,A
04AC A3                INC     DPTR
04AD E0                MOVX    A,@DPTR
04AE FF                MOV     R7,A
04AF C3                CLR     C
04B0 E4                CLR     A
04B1 9F                SUBB    A,R7
04B2 FF                MOV     R7,A
04B3 7404              MOV     A,#04H
04B5 9E                SUBB    A,R6
04B6 FE                MOV     R6,A
04B7 AB07              MOV     R3,AR7
04B9 FA                MOV     R2,A
04BA E4                CLR     A
04BB F9                MOV     R1,A
04BC F8                MOV     R0,A
04BD D007              POP     AR7
04BF D006              POP     AR6
04C1 120000      E     LCALL   ?C?SLDIV
04C4 900000      E     MOV     DPTR,#g_refOld
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 54  

04C7 E0                MOVX    A,@DPTR
04C8 F8                MOV     R0,A
04C9 A3                INC     DPTR
04CA E0                MOVX    A,@DPTR
04CB F9                MOV     R1,A
04CC A3                INC     DPTR
04CD E0                MOVX    A,@DPTR
04CE FA                MOV     R2,A
04CF A3                INC     DPTR
04D0 E0                MOVX    A,@DPTR
04D1 2F                ADD     A,R7
04D2 FF                MOV     R7,A
04D3 EA                MOV     A,R2
04D4 3E                ADDC    A,R6
04D5 FE                MOV     R6,A
04D6 E9                MOV     A,R1
04D7 3D                ADDC    A,R5
04D8 FD                MOV     R5,A
04D9 E8                MOV     A,R0
04DA 3C                ADDC    A,R4
04DB FC                MOV     R4,A
04DC 900000      E     MOV     DPTR,#g_ref
04DF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 593
04E2 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 595
04E5         ?C0067:
                                           ; SOURCE LINE # 597
04E5 E4                CLR     A
04E6 FF                MOV     R7,A
04E7 FE                MOV     R6,A
04E8 FD                MOV     R5,A
04E9 FC                MOV     R4,A
04EA AB00        R     MOV     R3,err_emg_2+03H
04EC AA00        R     MOV     R2,err_emg_2+02H
04EE A900        R     MOV     R1,err_emg_2+01H
04F0 A800        R     MOV     R0,err_emg_2
04F2 C3                CLR     C
04F3 120000      E     LCALL   ?C?SLCMP
04F6 5008              JNC     ?C0068
                                           ; SOURCE LINE # 598
04F8 E4                CLR     A
04F9 900000      R     MOV     DPTR,#current_emg
04FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 599
04FD 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 600
0500         ?C0068:
                                           ; SOURCE LINE # 601
0500 900000      E     MOV     DPTR,#g_mem+078H
0503 E0                MOVX    A,@DPTR
0504 FF                MOV     R7,A
0505 E4                CLR     A
0506 FC                MOV     R4,A
0507 FD                MOV     R5,A
0508 FE                MOV     R6,A
0509 AB00        R     MOV     R3,err_emg_2+03H
050B AA00        R     MOV     R2,err_emg_2+02H
050D A900        R     MOV     R1,err_emg_2+01H
050F A800        R     MOV     R0,err_emg_2
0511 120000      E     LCALL   ?C?LMUL
0514 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 55  

0515 7B02              MOV     R3,#02H
0517 FA                MOV     R2,A
0518 F9                MOV     R1,A
0519 F8                MOV     R0,A
051A 120000      E     LCALL   ?C?LMUL
051D C006              PUSH    AR6
051F C007              PUSH    AR7
0521 900000      E     MOV     DPTR,#c_mem+06DH
0524 E0                MOVX    A,@DPTR
0525 FE                MOV     R6,A
0526 A3                INC     DPTR
0527 E0                MOVX    A,@DPTR
0528 FF                MOV     R7,A
0529 C3                CLR     C
052A E4                CLR     A
052B 9F                SUBB    A,R7
052C FF                MOV     R7,A
052D 7404              MOV     A,#04H
052F 9E                SUBB    A,R6
0530 FE                MOV     R6,A
0531 AB07              MOV     R3,AR7
0533 FA                MOV     R2,A
0534 E4                CLR     A
0535 F9                MOV     R1,A
0536 F8                MOV     R0,A
0537 D007              POP     AR7
0539 D006              POP     AR6
053B 120000      E     LCALL   ?C?SLDIV
053E A804              MOV     R0,AR4
0540 A905              MOV     R1,AR5
0542 AA06              MOV     R2,AR6
0544 AB07              MOV     R3,AR7
0546 900000      E     MOV     DPTR,#g_refOld
0549 E0                MOVX    A,@DPTR
054A FC                MOV     R4,A
054B A3                INC     DPTR
054C E0                MOVX    A,@DPTR
054D FD                MOV     R5,A
054E A3                INC     DPTR
054F E0                MOVX    A,@DPTR
0550 FE                MOV     R6,A
0551 A3                INC     DPTR
0552 E0                MOVX    A,@DPTR
0553 C3                CLR     C
0554 9B                SUBB    A,R3
0555 FF                MOV     R7,A
0556 EE                MOV     A,R6
0557 9A                SUBB    A,R2
0558 FE                MOV     R6,A
0559 ED                MOV     A,R5
055A 99                SUBB    A,R1
055B FD                MOV     R5,A
055C EC                MOV     A,R4
055D 98                SUBB    A,R0
055E FC                MOV     R4,A
055F 900000      E     MOV     DPTR,#g_ref
0562 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 602
0565 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 604
                                           ; SOURCE LINE # 605
                                           ; SOURCE LINE # 606
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 56  

                                           ; SOURCE LINE # 608
0568 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 610
056B         ?C0070:
                                           ; SOURCE LINE # 611
056B 900000      E     MOV     DPTR,#g_refOld
056E E0                MOVX    A,@DPTR
056F FC                MOV     R4,A
0570 A3                INC     DPTR
0571 E0                MOVX    A,@DPTR
0572 FD                MOV     R5,A
0573 A3                INC     DPTR
0574 E0                MOVX    A,@DPTR
0575 FE                MOV     R6,A
0576 A3                INC     DPTR
0577 E0                MOVX    A,@DPTR
0578 FF                MOV     R7,A
0579 900000      E     MOV     DPTR,#g_ref
057C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 612
057F 900000      R     MOV     DPTR,#current_emg
0582 E0                MOVX    A,@DPTR
0583 14                DEC     A
0584 6048              JZ      ?C0075
0586 14                DEC     A
0587 7003              JNZ     $ + 5H
0589 020000      R     LJMP    ?C0078
058C 2402              ADD     A,#02H
058E 6003              JZ      $ + 5H
0590 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 614
0593         ?C0072:
                                           ; SOURCE LINE # 615
0593 E4                CLR     A
0594 FF                MOV     R7,A
0595 FE                MOV     R6,A
0596 FD                MOV     R5,A
0597 FC                MOV     R4,A
0598 AB00        R     MOV     R3,err_emg_1+03H
059A AA00        R     MOV     R2,err_emg_1+02H
059C A900        R     MOV     R1,err_emg_1+01H
059E A800        R     MOV     R0,err_emg_1
05A0 D3                SETB    C
05A1 120000      E     LCALL   ?C?SLCMP
05A4 4009              JC      ?C0073
                                           ; SOURCE LINE # 616
05A6 900000      R     MOV     DPTR,#current_emg
05A9 7401              MOV     A,#01H
05AB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 617
05AC 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 618
05AF         ?C0073:
                                           ; SOURCE LINE # 619
05AF E4                CLR     A
05B0 FF                MOV     R7,A
05B1 FE                MOV     R6,A
05B2 FD                MOV     R5,A
05B3 FC                MOV     R4,A
05B4 AB00        R     MOV     R3,err_emg_2+03H
05B6 AA00        R     MOV     R2,err_emg_2+02H
05B8 A900        R     MOV     R1,err_emg_2+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 57  

05BA A800        R     MOV     R0,err_emg_2
05BC D3                SETB    C
05BD 120000      E     LCALL   ?C?SLCMP
05C0 5003              JNC     $ + 5H
05C2 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 620
05C5 900000      R     MOV     DPTR,#current_emg
05C8 7402              MOV     A,#02H
05CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 621
05CB 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 622
                                           ; SOURCE LINE # 623
                                           ; SOURCE LINE # 626
05CE         ?C0075:
                                           ; SOURCE LINE # 628
05CE E4                CLR     A
05CF FF                MOV     R7,A
05D0 FE                MOV     R6,A
05D1 FD                MOV     R5,A
05D2 FC                MOV     R4,A
05D3 AB00        R     MOV     R3,err_emg_1+03H
05D5 AA00        R     MOV     R2,err_emg_1+02H
05D7 A900        R     MOV     R1,err_emg_1+01H
05D9 A800        R     MOV     R0,err_emg_1
05DB C3                CLR     C
05DC 120000      E     LCALL   ?C?SLCMP
05DF 501B              JNC     ?C0076
05E1 E4                CLR     A
05E2 FF                MOV     R7,A
05E3 FE                MOV     R6,A
05E4 FD                MOV     R5,A
05E5 FC                MOV     R4,A
05E6 AB00        R     MOV     R3,err_emg_2+03H
05E8 AA00        R     MOV     R2,err_emg_2+02H
05EA A900        R     MOV     R1,err_emg_2+01H
05EC A800        R     MOV     R0,err_emg_2
05EE C3                CLR     C
05EF 120000      E     LCALL   ?C?SLCMP
05F2 5008              JNC     ?C0076
                                           ; SOURCE LINE # 629
05F4 E4                CLR     A
05F5 900000      R     MOV     DPTR,#current_emg
05F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 630
05F9 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 631
05FC         ?C0076:
                                           ; SOURCE LINE # 633
05FC E4                CLR     A
05FD FF                MOV     R7,A
05FE FE                MOV     R6,A
05FF FD                MOV     R5,A
0600 FC                MOV     R4,A
0601 AB00        R     MOV     R3,err_emg_1+03H
0603 AA00        R     MOV     R2,err_emg_1+02H
0605 A900        R     MOV     R1,err_emg_1+01H
0607 A800        R     MOV     R0,err_emg_1
0609 D3                SETB    C
060A 120000      E     LCALL   ?C?SLCMP
060D 5003              JNC     $ + 5H
060F 020000      R     LJMP    ?C0046
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 58  

                                           ; SOURCE LINE # 634
0612 900000      E     MOV     DPTR,#g_mem+078H
0615 E0                MOVX    A,@DPTR
0616 FF                MOV     R7,A
0617 E4                CLR     A
0618 FC                MOV     R4,A
0619 FD                MOV     R5,A
061A FE                MOV     R6,A
061B A800        R     MOV     R0,err_emg_1
061D 120000      E     LCALL   ?C?LMUL
0620 7802              MOV     R0,#02H
0622 120000      E     LCALL   ?C?LSHL
0625 C006              PUSH    AR6
0627 C007              PUSH    AR7
0629 900000      E     MOV     DPTR,#c_mem+06BH
062C E0                MOVX    A,@DPTR
062D FE                MOV     R6,A
062E A3                INC     DPTR
062F E0                MOVX    A,@DPTR
0630 FF                MOV     R7,A
0631 C3                CLR     C
0632 E4                CLR     A
0633 9F                SUBB    A,R7
0634 FF                MOV     R7,A
0635 7404              MOV     A,#04H
0637 9E                SUBB    A,R6
0638 FE                MOV     R6,A
0639 AB07              MOV     R3,AR7
063B FA                MOV     R2,A
063C E4                CLR     A
063D F9                MOV     R1,A
063E F8                MOV     R0,A
063F D007              POP     AR7
0641 D006              POP     AR6
0643 120000      E     LCALL   ?C?SLDIV
0646 900000      E     MOV     DPTR,#g_refOld
0649 E0                MOVX    A,@DPTR
064A F8                MOV     R0,A
064B A3                INC     DPTR
064C E0                MOVX    A,@DPTR
064D F9                MOV     R1,A
064E A3                INC     DPTR
064F E0                MOVX    A,@DPTR
0650 FA                MOV     R2,A
0651 A3                INC     DPTR
0652 E0                MOVX    A,@DPTR
0653 2F                ADD     A,R7
0654 FF                MOV     R7,A
0655 EA                MOV     A,R2
0656 3E                ADDC    A,R6
0657 FE                MOV     R6,A
0658 E9                MOV     A,R1
0659 3D                ADDC    A,R5
065A FD                MOV     R5,A
065B E8                MOV     A,R0
065C 3C                ADDC    A,R4
065D FC                MOV     R4,A
065E 900000      E     MOV     DPTR,#g_ref
0661 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 636
0664 020000      R     LJMP    ?C0046
                                           ; SOURCE LINE # 639
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 59  

0667         ?C0078:
                                           ; SOURCE LINE # 641
0667 E4                CLR     A
0668 FF                MOV     R7,A
0669 FE                MOV     R6,A
066A FD                MOV     R5,A
066B FC                MOV     R4,A
066C AB00        R     MOV     R3,err_emg_1+03H
066E AA00        R     MOV     R2,err_emg_1+02H
0670 A900        R     MOV     R1,err_emg_1+01H
0672 A800        R     MOV     R0,err_emg_1
0674 C3                CLR     C
0675 120000      E     LCALL   ?C?SLCMP
0678 501A              JNC     ?C0079
067A E4                CLR     A
067B FF                MOV     R7,A
067C FE                MOV     R6,A
067D FD                MOV     R5,A
067E FC                MOV     R4,A
067F AB00        R     MOV     R3,err_emg_2+03H
0681 AA00        R     MOV     R2,err_emg_2+02H
0683 A900        R     MOV     R1,err_emg_2+01H
0685 A800        R     MOV     R0,err_emg_2
0687 C3                CLR     C
0688 120000      E     LCALL   ?C?SLCMP
068B 5007              JNC     ?C0079
                                           ; SOURCE LINE # 642
068D E4                CLR     A
068E 900000      R     MOV     DPTR,#current_emg
0691 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 643
0692 806E              SJMP    ?C0046
                                           ; SOURCE LINE # 644
0694         ?C0079:
                                           ; SOURCE LINE # 646
0694 E4                CLR     A
0695 FF                MOV     R7,A
0696 FE                MOV     R6,A
0697 FD                MOV     R5,A
0698 FC                MOV     R4,A
0699 AB00        R     MOV     R3,err_emg_2+03H
069B AA00        R     MOV     R2,err_emg_2+02H
069D A900        R     MOV     R1,err_emg_2+01H
069F A800        R     MOV     R0,err_emg_2
06A1 D3                SETB    C
06A2 120000      E     LCALL   ?C?SLCMP
06A5 405B              JC      ?C0046
                                           ; SOURCE LINE # 647
06A7 900000      E     MOV     DPTR,#c_mem+078H
06AA E0                MOVX    A,@DPTR
06AB FF                MOV     R7,A
06AC E4                CLR     A
06AD FC                MOV     R4,A
06AE FD                MOV     R5,A
06AF FE                MOV     R6,A
06B0 A800        R     MOV     R0,err_emg_2
06B2 120000      E     LCALL   ?C?LMUL
06B5 7802              MOV     R0,#02H
06B7 120000      E     LCALL   ?C?LSHL
06BA C006              PUSH    AR6
06BC C007              PUSH    AR7
06BE 900000      E     MOV     DPTR,#c_mem+06DH
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 60  

06C1 E0                MOVX    A,@DPTR
06C2 FE                MOV     R6,A
06C3 A3                INC     DPTR
06C4 E0                MOVX    A,@DPTR
06C5 FF                MOV     R7,A
06C6 C3                CLR     C
06C7 E4                CLR     A
06C8 9F                SUBB    A,R7
06C9 FF                MOV     R7,A
06CA 7404              MOV     A,#04H
06CC 9E                SUBB    A,R6
06CD FE                MOV     R6,A
06CE AB07              MOV     R3,AR7
06D0 FA                MOV     R2,A
06D1 E4                CLR     A
06D2 F9                MOV     R1,A
06D3 F8                MOV     R0,A
06D4 D007              POP     AR7
06D6 D006              POP     AR6
06D8 120000      E     LCALL   ?C?SLDIV
06DB A804              MOV     R0,AR4
06DD A905              MOV     R1,AR5
06DF AA06              MOV     R2,AR6
06E1 AB07              MOV     R3,AR7
06E3 900000      E     MOV     DPTR,#g_refOld
06E6 E0                MOVX    A,@DPTR
06E7 FC                MOV     R4,A
06E8 A3                INC     DPTR
06E9 E0                MOVX    A,@DPTR
06EA FD                MOV     R5,A
06EB A3                INC     DPTR
06EC E0                MOVX    A,@DPTR
06ED FE                MOV     R6,A
06EE A3                INC     DPTR
06EF E0                MOVX    A,@DPTR
06F0 C3                CLR     C
06F1 9B                SUBB    A,R3
06F2 FF                MOV     R7,A
06F3 EE                MOV     A,R6
06F4 9A                SUBB    A,R2
06F5 FE                MOV     R6,A
06F6 ED                MOV     A,R5
06F7 99                SUBB    A,R1
06F8 FD                MOV     R5,A
06F9 EC                MOV     A,R4
06FA 98                SUBB    A,R0
06FB FC                MOV     R4,A
06FC 900000      E     MOV     DPTR,#g_ref
06FF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 648
                                           ; SOURCE LINE # 649
                                           ; SOURCE LINE # 651
                                           ; SOURCE LINE # 652
                                           ; SOURCE LINE # 653
                                           ; SOURCE LINE # 655
                                           ; SOURCE LINE # 656
                                           ; SOURCE LINE # 657
0702         ?C0046:
                                           ; SOURCE LINE # 660
0702 900000      E     MOV     DPTR,#c_mem+050H
0705 E0                MOVX    A,@DPTR
0706 606A              JZ      ?C0083
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 61  

                                           ; SOURCE LINE # 661
0708 A3                INC     DPTR
0709 E0                MOVX    A,@DPTR
070A FC                MOV     R4,A
070B A3                INC     DPTR
070C E0                MOVX    A,@DPTR
070D FD                MOV     R5,A
070E A3                INC     DPTR
070F E0                MOVX    A,@DPTR
0710 FE                MOV     R6,A
0711 A3                INC     DPTR
0712 E0                MOVX    A,@DPTR
0713 FF                MOV     R7,A
0714 900000      E     MOV     DPTR,#g_ref
0717 E0                MOVX    A,@DPTR
0718 F8                MOV     R0,A
0719 A3                INC     DPTR
071A E0                MOVX    A,@DPTR
071B F9                MOV     R1,A
071C A3                INC     DPTR
071D E0                MOVX    A,@DPTR
071E FA                MOV     R2,A
071F A3                INC     DPTR
0720 E0                MOVX    A,@DPTR
0721 FB                MOV     R3,A
0722 C3                CLR     C
0723 120000      E     LCALL   ?C?SLCMP
0726 5014              JNC     ?C0084
                                           ; SOURCE LINE # 662
0728 900000      E     MOV     DPTR,#c_mem+051H
072B E0                MOVX    A,@DPTR
072C FC                MOV     R4,A
072D A3                INC     DPTR
072E E0                MOVX    A,@DPTR
072F FD                MOV     R5,A
0730 A3                INC     DPTR
0731 E0                MOVX    A,@DPTR
0732 FE                MOV     R6,A
0733 A3                INC     DPTR
0734 E0                MOVX    A,@DPTR
0735 FF                MOV     R7,A
0736 900000      E     MOV     DPTR,#g_ref
0739 120000      E     LCALL   ?C?LSTXDATA
073C         ?C0084:
                                           ; SOURCE LINE # 663
073C 900000      E     MOV     DPTR,#c_mem+059H
073F E0                MOVX    A,@DPTR
0740 FC                MOV     R4,A
0741 A3                INC     DPTR
0742 E0                MOVX    A,@DPTR
0743 FD                MOV     R5,A
0744 A3                INC     DPTR
0745 E0                MOVX    A,@DPTR
0746 FE                MOV     R6,A
0747 A3                INC     DPTR
0748 E0                MOVX    A,@DPTR
0749 FF                MOV     R7,A
074A 900000      E     MOV     DPTR,#g_ref
074D E0                MOVX    A,@DPTR
074E F8                MOV     R0,A
074F A3                INC     DPTR
0750 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 62  

0751 F9                MOV     R1,A
0752 A3                INC     DPTR
0753 E0                MOVX    A,@DPTR
0754 FA                MOV     R2,A
0755 A3                INC     DPTR
0756 E0                MOVX    A,@DPTR
0757 FB                MOV     R3,A
0758 D3                SETB    C
0759 120000      E     LCALL   ?C?SLCMP
075C 4014              JC      ?C0083
                                           ; SOURCE LINE # 664
075E 900000      E     MOV     DPTR,#c_mem+059H
0761 E0                MOVX    A,@DPTR
0762 FC                MOV     R4,A
0763 A3                INC     DPTR
0764 E0                MOVX    A,@DPTR
0765 FD                MOV     R5,A
0766 A3                INC     DPTR
0767 E0                MOVX    A,@DPTR
0768 FE                MOV     R6,A
0769 A3                INC     DPTR
076A E0                MOVX    A,@DPTR
076B FF                MOV     R7,A
076C 900000      E     MOV     DPTR,#g_ref
076F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 665
0772         ?C0083:
                                           ; SOURCE LINE # 667
0772 900000      E     MOV     DPTR,#c_mem+0AAH
0775 E0                MOVX    A,@DPTR
0776 6401              XRL     A,#01H
0778 6003              JZ      $ + 5H
077A 020000      R     LJMP    ?C0086
                                           ; SOURCE LINE # 668
077D 900000      E     MOV     DPTR,#rest_enabled
0780 E0                MOVX    A,@DPTR
0781 B40114            CJNE    A,#01H,?C0087
                                           ; SOURCE LINE # 670
0784 900000      E     MOV     DPTR,#rest_pos_curr_ref
0787 E0                MOVX    A,@DPTR
0788 FC                MOV     R4,A
0789 A3                INC     DPTR
078A E0                MOVX    A,@DPTR
078B FD                MOV     R5,A
078C A3                INC     DPTR
078D E0                MOVX    A,@DPTR
078E FE                MOV     R6,A
078F A3                INC     DPTR
0790 E0                MOVX    A,@DPTR
0791 FF                MOV     R7,A
0792 900000      E     MOV     DPTR,#g_ref
0795 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 671
0798         ?C0087:
                                           ; SOURCE LINE # 673
0798 900000      E     MOV     DPTR,#forced_open
079B E0                MOVX    A,@DPTR
079C 6401              XRL     A,#01H
079E 6003              JZ      $ + 5H
07A0 020000      R     LJMP    ?C0086
                                           ; SOURCE LINE # 675
07A3 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 63  

07A4 FE                MOV     R6,A
07A5 FD                MOV     R5,A
07A6 FC                MOV     R4,A
07A7 AB00        R     MOV     R3,err_emg_2+03H
07A9 AA00        R     MOV     R2,err_emg_2+02H
07AB A900        R     MOV     R1,err_emg_2+01H
07AD A800        R     MOV     R0,err_emg_2
07AF D3                SETB    C
07B0 120000      E     LCALL   ?C?SLCMP
07B3 405D              JC      ?C0089
                                           ; SOURCE LINE # 676
07B5 900000      E     MOV     DPTR,#g_mem+096H
07B8 E0                MOVX    A,@DPTR
07B9 FC                MOV     R4,A
07BA A3                INC     DPTR
07BB E0                MOVX    A,@DPTR
07BC FD                MOV     R5,A
07BD A3                INC     DPTR
07BE E0                MOVX    A,@DPTR
07BF FE                MOV     R6,A
07C0 A3                INC     DPTR
07C1 E0                MOVX    A,@DPTR
07C2 FF                MOV     R7,A
07C3 A800        R     MOV     R0,err_emg_2
07C5 120000      E     LCALL   ?C?LMUL
07C8 C006              PUSH    AR6
07CA C007              PUSH    AR7
07CC 900000      E     MOV     DPTR,#c_mem+06DH
07CF E0                MOVX    A,@DPTR
07D0 FE                MOV     R6,A
07D1 A3                INC     DPTR
07D2 E0                MOVX    A,@DPTR
07D3 FF                MOV     R7,A
07D4 C3                CLR     C
07D5 E4                CLR     A
07D6 9F                SUBB    A,R7
07D7 FF                MOV     R7,A
07D8 7404              MOV     A,#04H
07DA 9E                SUBB    A,R6
07DB FE                MOV     R6,A
07DC AB07              MOV     R3,AR7
07DE FA                MOV     R2,A
07DF E4                CLR     A
07E0 F9                MOV     R1,A
07E1 F8                MOV     R0,A
07E2 D007              POP     AR7
07E4 D006              POP     AR6
07E6 120000      E     LCALL   ?C?SLDIV
07E9 A804              MOV     R0,AR4
07EB A905              MOV     R1,AR5
07ED AA06              MOV     R2,AR6
07EF AB07              MOV     R3,AR7
07F1 900000      E     MOV     DPTR,#g_mem+096H
07F4 E0                MOVX    A,@DPTR
07F5 FC                MOV     R4,A
07F6 A3                INC     DPTR
07F7 E0                MOVX    A,@DPTR
07F8 FD                MOV     R5,A
07F9 A3                INC     DPTR
07FA E0                MOVX    A,@DPTR
07FB FE                MOV     R6,A
07FC A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 64  

07FD E0                MOVX    A,@DPTR
07FE C3                CLR     C
07FF 9B                SUBB    A,R3
0800 FF                MOV     R7,A
0801 EE                MOV     A,R6
0802 9A                SUBB    A,R2
0803 FE                MOV     R6,A
0804 ED                MOV     A,R5
0805 99                SUBB    A,R1
0806 FD                MOV     R5,A
0807 EC                MOV     A,R4
0808 98                SUBB    A,R0
0809 FC                MOV     R4,A
080A 900000      E     MOV     DPTR,#g_ref
080D 120000      E     LCALL   ?C?LSTXDATA
0810 8019              SJMP    ?C0086
0812         ?C0089:
                                           ; SOURCE LINE # 677
                                           ; SOURCE LINE # 678
0812 900000      E     MOV     DPTR,#g_mem+096H
0815 E0                MOVX    A,@DPTR
0816 FC                MOV     R4,A
0817 A3                INC     DPTR
0818 E0                MOVX    A,@DPTR
0819 FD                MOV     R5,A
081A A3                INC     DPTR
081B E0                MOVX    A,@DPTR
081C FE                MOV     R6,A
081D A3                INC     DPTR
081E E0                MOVX    A,@DPTR
081F FF                MOV     R7,A
0820 900000      E     MOV     DPTR,#g_ref
0823 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 679
0826 E4                CLR     A
0827 900000      E     MOV     DPTR,#forced_open
082A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 680
                                           ; SOURCE LINE # 681
                                           ; SOURCE LINE # 682
082B         ?C0086:
                                           ; SOURCE LINE # 684
082B 900000      E     MOV     DPTR,#c_mem+034H
082E E0                MOVX    A,@DPTR
082F 7003              JNZ     $ + 5H
0831 020000      R     LJMP    ?C0113
0834 14                DEC     A
0835 7003              JNZ     $ + 5H
0837 020000      R     LJMP    ?C0135
083A 14                DEC     A
083B 7003              JNZ     $ + 5H
083D 020000      R     LJMP    ?C0122
0840 14                DEC     A
0841 6003              JZ      $ + 5H
0843 020000      R     LJMP    ?C0091
                                           ; SOURCE LINE # 686
0846         ?C0092:
                                           ; SOURCE LINE # 687
0846 900000      E     MOV     DPTR,#g_meas
0849 E0                MOVX    A,@DPTR
084A F8                MOV     R0,A
084B A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 65  

084C E0                MOVX    A,@DPTR
084D F9                MOV     R1,A
084E A3                INC     DPTR
084F E0                MOVX    A,@DPTR
0850 FA                MOV     R2,A
0851 A3                INC     DPTR
0852 E0                MOVX    A,@DPTR
0853 FB                MOV     R3,A
0854 900000      E     MOV     DPTR,#g_ref
0857 E0                MOVX    A,@DPTR
0858 FC                MOV     R4,A
0859 A3                INC     DPTR
085A E0                MOVX    A,@DPTR
085B FD                MOV     R5,A
085C A3                INC     DPTR
085D E0                MOVX    A,@DPTR
085E FE                MOV     R6,A
085F A3                INC     DPTR
0860 E0                MOVX    A,@DPTR
0861 C3                CLR     C
0862 9B                SUBB    A,R3
0863 F500        R     MOV     pos_error+03H,A
0865 EE                MOV     A,R6
0866 9A                SUBB    A,R2
0867 F500        R     MOV     pos_error+02H,A
0869 ED                MOV     A,R5
086A 99                SUBB    A,R1
086B F500        R     MOV     pos_error+01H,A
086D EC                MOV     A,R4
086E 98                SUBB    A,R0
086F F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 689
0871 900000      R     MOV     DPTR,#pos_error_sum
0874 E0                MOVX    A,@DPTR
0875 FC                MOV     R4,A
0876 A3                INC     DPTR
0877 E0                MOVX    A,@DPTR
0878 FD                MOV     R5,A
0879 A3                INC     DPTR
087A E0                MOVX    A,@DPTR
087B FE                MOV     R6,A
087C A3                INC     DPTR
087D E0                MOVX    A,@DPTR
087E 2500        R     ADD     A,pos_error+03H
0880 FF                MOV     R7,A
0881 EE                MOV     A,R6
0882 3500        R     ADDC    A,pos_error+02H
0884 FE                MOV     R6,A
0885 ED                MOV     A,R5
0886 3500        R     ADDC    A,pos_error+01H
0888 FD                MOV     R5,A
0889 EC                MOV     A,R4
088A 3500        R     ADDC    A,pos_error
088C FC                MOV     R4,A
088D 900000      R     MOV     DPTR,#pos_error_sum
0890 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 692
0893 7F80              MOV     R7,#080H
0895 7EF0              MOV     R6,#0F0H
0897 7DFA              MOV     R5,#0FAH
0899 7C02              MOV     R4,#02H
089B 900000      R     MOV     DPTR,#pos_error_sum
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 66  

089E E0                MOVX    A,@DPTR
089F F8                MOV     R0,A
08A0 A3                INC     DPTR
08A1 E0                MOVX    A,@DPTR
08A2 F9                MOV     R1,A
08A3 A3                INC     DPTR
08A4 E0                MOVX    A,@DPTR
08A5 FA                MOV     R2,A
08A6 A3                INC     DPTR
08A7 E0                MOVX    A,@DPTR
08A8 FB                MOV     R3,A
08A9 D3                SETB    C
08AA 120000      E     LCALL   ?C?SLCMP
08AD 4010              JC      ?C0093
                                           ; SOURCE LINE # 693
08AF 7F80              MOV     R7,#080H
08B1 7EF0              MOV     R6,#0F0H
08B3 7DFA              MOV     R5,#0FAH
08B5 7C02              MOV     R4,#02H
08B7 900000      R     MOV     DPTR,#pos_error_sum
08BA 120000      E     LCALL   ?C?LSTXDATA
08BD 802A              SJMP    ?C0094
08BF         ?C0093:
                                           ; SOURCE LINE # 694
                                           ; SOURCE LINE # 695
08BF 7F80              MOV     R7,#080H
08C1 7E0F              MOV     R6,#0FH
08C3 7D05              MOV     R5,#05H
08C5 7CFD              MOV     R4,#0FDH
08C7 900000      R     MOV     DPTR,#pos_error_sum
08CA E0                MOVX    A,@DPTR
08CB F8                MOV     R0,A
08CC A3                INC     DPTR
08CD E0                MOVX    A,@DPTR
08CE F9                MOV     R1,A
08CF A3                INC     DPTR
08D0 E0                MOVX    A,@DPTR
08D1 FA                MOV     R2,A
08D2 A3                INC     DPTR
08D3 E0                MOVX    A,@DPTR
08D4 FB                MOV     R3,A
08D5 C3                CLR     C
08D6 120000      E     LCALL   ?C?SLCMP
08D9 500E              JNC     ?C0094
                                           ; SOURCE LINE # 696
08DB 7F80              MOV     R7,#080H
08DD 7E0F              MOV     R6,#0FH
08DF 7D05              MOV     R5,#05H
08E1 7CFD              MOV     R4,#0FDH
08E3 900000      R     MOV     DPTR,#pos_error_sum
08E6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 697
08E9         ?C0094:
                                           ; SOURCE LINE # 701
08E9 E4                CLR     A
08EA F500        R     MOV     i_ref+03H,A
08EC F500        R     MOV     i_ref+02H,A
08EE F500        R     MOV     i_ref+01H,A
08F0 F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 704
08F2 FF                MOV     R7,A
08F3 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 67  

08F4 FD                MOV     R5,A
08F5 FC                MOV     R4,A
08F6 AB00        R     MOV     R3,k_p_dl+03H
08F8 AA00        R     MOV     R2,k_p_dl+02H
08FA A900        R     MOV     R1,k_p_dl+01H
08FC A800        R     MOV     R0,k_p_dl
08FE C3                CLR     C
08FF 120000      E     LCALL   ?C?SLCMP
0902 6026              JZ      ?C0096
                                           ; SOURCE LINE # 705
0904 AF00        R     MOV     R7,pos_error+03H
0906 AE00        R     MOV     R6,pos_error+02H
0908 AD00        R     MOV     R5,pos_error+01H
090A AC00        R     MOV     R4,pos_error
090C A800        R     MOV     R0,k_p_dl
090E 120000      E     LCALL   ?C?LMUL
0911 7810              MOV     R0,#010H
0913 120000      E     LCALL   ?C?SLSHR
0916 E500        R     MOV     A,i_ref+03H
0918 2F                ADD     A,R7
0919 F500        R     MOV     i_ref+03H,A
091B E500        R     MOV     A,i_ref+02H
091D 3E                ADDC    A,R6
091E F500        R     MOV     i_ref+02H,A
0920 E500        R     MOV     A,i_ref+01H
0922 3D                ADDC    A,R5
0923 F500        R     MOV     i_ref+01H,A
0925 E500        R     MOV     A,i_ref
0927 3C                ADDC    A,R4
0928 F500        R     MOV     i_ref,A
092A         ?C0096:
                                           ; SOURCE LINE # 708
092A E4                CLR     A
092B FF                MOV     R7,A
092C FE                MOV     R6,A
092D FD                MOV     R5,A
092E FC                MOV     R4,A
092F AB00        R     MOV     R3,k_i_dl+03H
0931 AA00        R     MOV     R2,k_i_dl+02H
0933 A900        R     MOV     R1,k_i_dl+01H
0935 A800        R     MOV     R0,k_i_dl
0937 C3                CLR     C
0938 120000      E     LCALL   ?C?SLCMP
093B 602C              JZ      ?C0097
                                           ; SOURCE LINE # 709
093D 900000      R     MOV     DPTR,#pos_error_sum
0940 E0                MOVX    A,@DPTR
0941 FC                MOV     R4,A
0942 A3                INC     DPTR
0943 E0                MOVX    A,@DPTR
0944 FD                MOV     R5,A
0945 A3                INC     DPTR
0946 E0                MOVX    A,@DPTR
0947 FE                MOV     R6,A
0948 A3                INC     DPTR
0949 E0                MOVX    A,@DPTR
094A FF                MOV     R7,A
094B A800        R     MOV     R0,k_i_dl
094D 120000      E     LCALL   ?C?LMUL
0950 7810              MOV     R0,#010H
0952 120000      E     LCALL   ?C?SLSHR
0955 E500        R     MOV     A,i_ref+03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 68  

0957 2F                ADD     A,R7
0958 F500        R     MOV     i_ref+03H,A
095A E500        R     MOV     A,i_ref+02H
095C 3E                ADDC    A,R6
095D F500        R     MOV     i_ref+02H,A
095F E500        R     MOV     A,i_ref+01H
0961 3D                ADDC    A,R5
0962 F500        R     MOV     i_ref+01H,A
0964 E500        R     MOV     A,i_ref
0966 3C                ADDC    A,R4
0967 F500        R     MOV     i_ref,A
0969         ?C0097:
                                           ; SOURCE LINE # 712
0969 E4                CLR     A
096A FF                MOV     R7,A
096B FE                MOV     R6,A
096C FD                MOV     R5,A
096D FC                MOV     R4,A
096E AB00        R     MOV     R3,k_d_dl+03H
0970 AA00        R     MOV     R2,k_d_dl+02H
0972 A900        R     MOV     R1,k_d_dl+01H
0974 A800        R     MOV     R0,k_d_dl
0976 C3                CLR     C
0977 120000      E     LCALL   ?C?SLCMP
097A 6043              JZ      ?C0098
                                           ; SOURCE LINE # 713
097C 900000      R     MOV     DPTR,#prev_pos_err
097F E0                MOVX    A,@DPTR
0980 F8                MOV     R0,A
0981 A3                INC     DPTR
0982 E0                MOVX    A,@DPTR
0983 F9                MOV     R1,A
0984 A3                INC     DPTR
0985 E0                MOVX    A,@DPTR
0986 FA                MOV     R2,A
0987 A3                INC     DPTR
0988 E0                MOVX    A,@DPTR
0989 FB                MOV     R3,A
098A C3                CLR     C
098B E500        R     MOV     A,pos_error+03H
098D 9B                SUBB    A,R3
098E FF                MOV     R7,A
098F E500        R     MOV     A,pos_error+02H
0991 9A                SUBB    A,R2
0992 FE                MOV     R6,A
0993 E500        R     MOV     A,pos_error+01H
0995 99                SUBB    A,R1
0996 FD                MOV     R5,A
0997 E500        R     MOV     A,pos_error
0999 98                SUBB    A,R0
099A FC                MOV     R4,A
099B AB00        R     MOV     R3,k_d_dl+03H
099D AA00        R     MOV     R2,k_d_dl+02H
099F A900        R     MOV     R1,k_d_dl+01H
09A1 A800        R     MOV     R0,k_d_dl
09A3 120000      E     LCALL   ?C?LMUL
09A6 7810              MOV     R0,#010H
09A8 120000      E     LCALL   ?C?SLSHR
09AB E500        R     MOV     A,i_ref+03H
09AD 2F                ADD     A,R7
09AE F500        R     MOV     i_ref+03H,A
09B0 E500        R     MOV     A,i_ref+02H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 69  

09B2 3E                ADDC    A,R6
09B3 F500        R     MOV     i_ref+02H,A
09B5 E500        R     MOV     A,i_ref+01H
09B7 3D                ADDC    A,R5
09B8 F500        R     MOV     i_ref+01H,A
09BA E500        R     MOV     A,i_ref
09BC 3C                ADDC    A,R4
09BD F500        R     MOV     i_ref,A
09BF         ?C0098:
                                           ; SOURCE LINE # 716
09BF AF00        R     MOV     R7,pos_error+03H
09C1 AE00        R     MOV     R6,pos_error+02H
09C3 AD00        R     MOV     R5,pos_error+01H
09C5 AC00        R     MOV     R4,pos_error
09C7 900000      R     MOV     DPTR,#prev_pos_err
09CA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 719
09CD E4                CLR     A
09CE FF                MOV     R7,A
09CF FE                MOV     R6,A
09D0 FD                MOV     R5,A
09D1 FC                MOV     R4,A
09D2 AB00        R     MOV     R3,i_ref+03H
09D4 AA00        R     MOV     R2,i_ref+02H
09D6 A900        R     MOV     R1,i_ref+01H
09D8 A800        R     MOV     R0,i_ref
09DA C3                CLR     C
09DB 120000      E     LCALL   ?C?SLCMP
09DE 4004              JC      ?C0099
                                           ; SOURCE LINE # 720
09E0 D200        R     SETB    motor_dir
09E2 8002              SJMP    ?C0100
09E4         ?C0099:
                                           ; SOURCE LINE # 722
09E4 C200        R     CLR     motor_dir
09E6         ?C0100:
                                           ; SOURCE LINE # 725
09E6 900000      E     MOV     DPTR,#c_mem+069H
09E9 E0                MOVX    A,@DPTR
09EA FE                MOV     R6,A
09EB A3                INC     DPTR
09EC E0                MOVX    A,@DPTR
09ED FF                MOV     R7,A
09EE EE                MOV     A,R6
09EF 33                RLC     A
09F0 95E0              SUBB    A,ACC
09F2 FD                MOV     R5,A
09F3 FC                MOV     R4,A
09F4 AB00        R     MOV     R3,i_ref+03H
09F6 AA00        R     MOV     R2,i_ref+02H
09F8 A900        R     MOV     R1,i_ref+01H
09FA A800        R     MOV     R0,i_ref
09FC D3                SETB    C
09FD 120000      E     LCALL   ?C?SLCMP
0A00 4016              JC      ?C0101
                                           ; SOURCE LINE # 726
0A02 900000      E     MOV     DPTR,#c_mem+069H
0A05 E0                MOVX    A,@DPTR
0A06 FE                MOV     R6,A
0A07 A3                INC     DPTR
0A08 E0                MOVX    A,@DPTR
0A09 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 70  

0A0A EE                MOV     A,R6
0A0B 33                RLC     A
0A0C 95E0              SUBB    A,ACC
0A0E 8F00        R     MOV     i_ref+03H,R7
0A10 8E00        R     MOV     i_ref+02H,R6
0A12 F500        R     MOV     i_ref+01H,A
0A14 F500        R     MOV     i_ref,A
0A16 803C              SJMP    ?C0102
0A18         ?C0101:
                                           ; SOURCE LINE # 727
                                           ; SOURCE LINE # 728
0A18 900000      E     MOV     DPTR,#c_mem+069H
0A1B E0                MOVX    A,@DPTR
0A1C FE                MOV     R6,A
0A1D A3                INC     DPTR
0A1E E0                MOVX    A,@DPTR
0A1F FF                MOV     R7,A
0A20 C3                CLR     C
0A21 E4                CLR     A
0A22 9F                SUBB    A,R7
0A23 FF                MOV     R7,A
0A24 E4                CLR     A
0A25 9E                SUBB    A,R6
0A26 FE                MOV     R6,A
0A27 33                RLC     A
0A28 95E0              SUBB    A,ACC
0A2A FD                MOV     R5,A
0A2B FC                MOV     R4,A
0A2C AB00        R     MOV     R3,i_ref+03H
0A2E AA00        R     MOV     R2,i_ref+02H
0A30 A900        R     MOV     R1,i_ref+01H
0A32 A800        R     MOV     R0,i_ref
0A34 C3                CLR     C
0A35 120000      E     LCALL   ?C?SLCMP
0A38 501A              JNC     ?C0102
                                           ; SOURCE LINE # 729
0A3A 900000      E     MOV     DPTR,#c_mem+069H
0A3D E0                MOVX    A,@DPTR
0A3E FE                MOV     R6,A
0A3F A3                INC     DPTR
0A40 E0                MOVX    A,@DPTR
0A41 FF                MOV     R7,A
0A42 C3                CLR     C
0A43 E4                CLR     A
0A44 9F                SUBB    A,R7
0A45 FF                MOV     R7,A
0A46 E4                CLR     A
0A47 9E                SUBB    A,R6
0A48 FE                MOV     R6,A
0A49 33                RLC     A
0A4A 95E0              SUBB    A,ACC
0A4C 8F00        R     MOV     i_ref+03H,R7
0A4E 8E00        R     MOV     i_ref+02H,R6
0A50 F500        R     MOV     i_ref+01H,A
0A52 F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 730
0A54         ?C0102:
                                           ; SOURCE LINE # 733
0A54 900000      E     MOV     DPTR,#g_meas+0CH
0A57 E0                MOVX    A,@DPTR
0A58 F8                MOV     R0,A
0A59 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 71  

0A5A E0                MOVX    A,@DPTR
0A5B F9                MOV     R1,A
0A5C A3                INC     DPTR
0A5D E0                MOVX    A,@DPTR
0A5E FA                MOV     R2,A
0A5F A3                INC     DPTR
0A60 E0                MOVX    A,@DPTR
0A61 FB                MOV     R3,A
0A62 C3                CLR     C
0A63 E500        R     MOV     A,i_ref+03H
0A65 9B                SUBB    A,R3
0A66 F500        R     MOV     curr_error+03H,A
0A68 E500        R     MOV     A,i_ref+02H
0A6A 9A                SUBB    A,R2
0A6B F500        R     MOV     curr_error+02H,A
0A6D E500        R     MOV     A,i_ref+01H
0A6F 99                SUBB    A,R1
0A70 F500        R     MOV     curr_error+01H,A
0A72 E500        R     MOV     A,i_ref
0A74 98                SUBB    A,R0
0A75 F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 734
0A77 900000      R     MOV     DPTR,#curr_error_sum
0A7A E0                MOVX    A,@DPTR
0A7B FC                MOV     R4,A
0A7C A3                INC     DPTR
0A7D E0                MOVX    A,@DPTR
0A7E FD                MOV     R5,A
0A7F A3                INC     DPTR
0A80 E0                MOVX    A,@DPTR
0A81 FE                MOV     R6,A
0A82 A3                INC     DPTR
0A83 E0                MOVX    A,@DPTR
0A84 2500        R     ADD     A,curr_error+03H
0A86 FF                MOV     R7,A
0A87 EE                MOV     A,R6
0A88 3500        R     ADDC    A,curr_error+02H
0A8A FE                MOV     R6,A
0A8B ED                MOV     A,R5
0A8C 3500        R     ADDC    A,curr_error+01H
0A8E FD                MOV     R5,A
0A8F EC                MOV     A,R4
0A90 3500        R     ADDC    A,curr_error
0A92 FC                MOV     R4,A
0A93 900000      R     MOV     DPTR,#curr_error_sum
0A96 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 736
0A99 7FA0              MOV     R7,#0A0H
0A9B 7E86              MOV     R6,#086H
0A9D 7D01              MOV     R5,#01H
0A9F 7C00              MOV     R4,#00H
0AA1 900000      R     MOV     DPTR,#curr_error_sum
0AA4 E0                MOVX    A,@DPTR
0AA5 F8                MOV     R0,A
0AA6 A3                INC     DPTR
0AA7 E0                MOVX    A,@DPTR
0AA8 F9                MOV     R1,A
0AA9 A3                INC     DPTR
0AAA E0                MOVX    A,@DPTR
0AAB FA                MOV     R2,A
0AAC A3                INC     DPTR
0AAD E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 72  

0AAE FB                MOV     R3,A
0AAF D3                SETB    C
0AB0 120000      E     LCALL   ?C?SLCMP
0AB3 4010              JC      ?C0104
                                           ; SOURCE LINE # 737
0AB5 7FA0              MOV     R7,#0A0H
0AB7 7E86              MOV     R6,#086H
0AB9 7D01              MOV     R5,#01H
0ABB 7C00              MOV     R4,#00H
0ABD 900000      R     MOV     DPTR,#curr_error_sum
0AC0 120000      E     LCALL   ?C?LSTXDATA
0AC3 802A              SJMP    ?C0105
0AC5         ?C0104:
                                           ; SOURCE LINE # 738
                                           ; SOURCE LINE # 739
0AC5 7F60              MOV     R7,#060H
0AC7 7E79              MOV     R6,#079H
0AC9 7DFE              MOV     R5,#0FEH
0ACB 7CFF              MOV     R4,#0FFH
0ACD 900000      R     MOV     DPTR,#curr_error_sum
0AD0 E0                MOVX    A,@DPTR
0AD1 F8                MOV     R0,A
0AD2 A3                INC     DPTR
0AD3 E0                MOVX    A,@DPTR
0AD4 F9                MOV     R1,A
0AD5 A3                INC     DPTR
0AD6 E0                MOVX    A,@DPTR
0AD7 FA                MOV     R2,A
0AD8 A3                INC     DPTR
0AD9 E0                MOVX    A,@DPTR
0ADA FB                MOV     R3,A
0ADB C3                CLR     C
0ADC 120000      E     LCALL   ?C?SLCMP
0ADF 500E              JNC     ?C0105
                                           ; SOURCE LINE # 740
0AE1 7F60              MOV     R7,#060H
0AE3 7E79              MOV     R6,#079H
0AE5 7DFE              MOV     R5,#0FEH
0AE7 7CFF              MOV     R4,#0FFH
0AE9 900000      R     MOV     DPTR,#curr_error_sum
0AEC 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 741
0AEF         ?C0105:
                                           ; SOURCE LINE # 745
0AEF E4                CLR     A
0AF0 F500        R     MOV     pwm_input+03H,A
0AF2 F500        R     MOV     pwm_input+02H,A
0AF4 F500        R     MOV     pwm_input+01H,A
0AF6 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 748
0AF8 FF                MOV     R7,A
0AF9 FE                MOV     R6,A
0AFA FD                MOV     R5,A
0AFB FC                MOV     R4,A
0AFC AB00        R     MOV     R3,k_p_c_dl+03H
0AFE AA00        R     MOV     R2,k_p_c_dl+02H
0B00 A900        R     MOV     R1,k_p_c_dl+01H
0B02 A800        R     MOV     R0,k_p_c_dl
0B04 C3                CLR     C
0B05 120000      E     LCALL   ?C?SLCMP
0B08 6026              JZ      ?C0107
                                           ; SOURCE LINE # 749
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 73  

0B0A AF00        R     MOV     R7,curr_error+03H
0B0C AE00        R     MOV     R6,curr_error+02H
0B0E AD00        R     MOV     R5,curr_error+01H
0B10 AC00        R     MOV     R4,curr_error
0B12 A800        R     MOV     R0,k_p_c_dl
0B14 120000      E     LCALL   ?C?LMUL
0B17 7810              MOV     R0,#010H
0B19 120000      E     LCALL   ?C?SLSHR
0B1C E500        R     MOV     A,pwm_input+03H
0B1E 2F                ADD     A,R7
0B1F F500        R     MOV     pwm_input+03H,A
0B21 E500        R     MOV     A,pwm_input+02H
0B23 3E                ADDC    A,R6
0B24 F500        R     MOV     pwm_input+02H,A
0B26 E500        R     MOV     A,pwm_input+01H
0B28 3D                ADDC    A,R5
0B29 F500        R     MOV     pwm_input+01H,A
0B2B E500        R     MOV     A,pwm_input
0B2D 3C                ADDC    A,R4
0B2E F500        R     MOV     pwm_input,A
0B30         ?C0107:
                                           ; SOURCE LINE # 752
0B30 E4                CLR     A
0B31 FF                MOV     R7,A
0B32 FE                MOV     R6,A
0B33 FD                MOV     R5,A
0B34 FC                MOV     R4,A
0B35 AB00        R     MOV     R3,k_i_c_dl+03H
0B37 AA00        R     MOV     R2,k_i_c_dl+02H
0B39 A900        R     MOV     R1,k_i_c_dl+01H
0B3B A800        R     MOV     R0,k_i_c_dl
0B3D C3                CLR     C
0B3E 120000      E     LCALL   ?C?SLCMP
0B41 602C              JZ      ?C0108
                                           ; SOURCE LINE # 753
0B43 900000      R     MOV     DPTR,#curr_error_sum
0B46 E0                MOVX    A,@DPTR
0B47 FC                MOV     R4,A
0B48 A3                INC     DPTR
0B49 E0                MOVX    A,@DPTR
0B4A FD                MOV     R5,A
0B4B A3                INC     DPTR
0B4C E0                MOVX    A,@DPTR
0B4D FE                MOV     R6,A
0B4E A3                INC     DPTR
0B4F E0                MOVX    A,@DPTR
0B50 FF                MOV     R7,A
0B51 A800        R     MOV     R0,k_i_c_dl
0B53 120000      E     LCALL   ?C?LMUL
0B56 7810              MOV     R0,#010H
0B58 120000      E     LCALL   ?C?SLSHR
0B5B E500        R     MOV     A,pwm_input+03H
0B5D 2F                ADD     A,R7
0B5E F500        R     MOV     pwm_input+03H,A
0B60 E500        R     MOV     A,pwm_input+02H
0B62 3E                ADDC    A,R6
0B63 F500        R     MOV     pwm_input+02H,A
0B65 E500        R     MOV     A,pwm_input+01H
0B67 3D                ADDC    A,R5
0B68 F500        R     MOV     pwm_input+01H,A
0B6A E500        R     MOV     A,pwm_input
0B6C 3C                ADDC    A,R4
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 74  

0B6D F500        R     MOV     pwm_input,A
0B6F         ?C0108:
                                           ; SOURCE LINE # 756
0B6F E4                CLR     A
0B70 FF                MOV     R7,A
0B71 FE                MOV     R6,A
0B72 FD                MOV     R5,A
0B73 FC                MOV     R4,A
0B74 AB00        R     MOV     R3,k_d_c_dl+03H
0B76 AA00        R     MOV     R2,k_d_c_dl+02H
0B78 A900        R     MOV     R1,k_d_c_dl+01H
0B7A A800        R     MOV     R0,k_d_c_dl
0B7C C3                CLR     C
0B7D 120000      E     LCALL   ?C?SLCMP
0B80 6043              JZ      ?C0109
                                           ; SOURCE LINE # 757
0B82 900000      R     MOV     DPTR,#prev_curr_err
0B85 E0                MOVX    A,@DPTR
0B86 F8                MOV     R0,A
0B87 A3                INC     DPTR
0B88 E0                MOVX    A,@DPTR
0B89 F9                MOV     R1,A
0B8A A3                INC     DPTR
0B8B E0                MOVX    A,@DPTR
0B8C FA                MOV     R2,A
0B8D A3                INC     DPTR
0B8E E0                MOVX    A,@DPTR
0B8F FB                MOV     R3,A
0B90 C3                CLR     C
0B91 E500        R     MOV     A,curr_error+03H
0B93 9B                SUBB    A,R3
0B94 FF                MOV     R7,A
0B95 E500        R     MOV     A,curr_error+02H
0B97 9A                SUBB    A,R2
0B98 FE                MOV     R6,A
0B99 E500        R     MOV     A,curr_error+01H
0B9B 99                SUBB    A,R1
0B9C FD                MOV     R5,A
0B9D E500        R     MOV     A,curr_error
0B9F 98                SUBB    A,R0
0BA0 FC                MOV     R4,A
0BA1 AB00        R     MOV     R3,k_d_c_dl+03H
0BA3 AA00        R     MOV     R2,k_d_c_dl+02H
0BA5 A900        R     MOV     R1,k_d_c_dl+01H
0BA7 A800        R     MOV     R0,k_d_c_dl
0BA9 120000      E     LCALL   ?C?LMUL
0BAC 7810              MOV     R0,#010H
0BAE 120000      E     LCALL   ?C?SLSHR
0BB1 E500        R     MOV     A,pwm_input+03H
0BB3 2F                ADD     A,R7
0BB4 F500        R     MOV     pwm_input+03H,A
0BB6 E500        R     MOV     A,pwm_input+02H
0BB8 3E                ADDC    A,R6
0BB9 F500        R     MOV     pwm_input+02H,A
0BBB E500        R     MOV     A,pwm_input+01H
0BBD 3D                ADDC    A,R5
0BBE F500        R     MOV     pwm_input+01H,A
0BC0 E500        R     MOV     A,pwm_input
0BC2 3C                ADDC    A,R4
0BC3 F500        R     MOV     pwm_input,A
0BC5         ?C0109:
                                           ; SOURCE LINE # 760
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 75  

0BC5 74FF              MOV     A,#0FFH
0BC7 7F9C              MOV     R7,#09CH
0BC9 FE                MOV     R6,A
0BCA FD                MOV     R5,A
0BCB FC                MOV     R4,A
0BCC AB00        R     MOV     R3,pwm_input+03H
0BCE AA00        R     MOV     R2,pwm_input+02H
0BD0 A900        R     MOV     R1,pwm_input+01H
0BD2 A800        R     MOV     R0,pwm_input
0BD4 C3                CLR     C
0BD5 120000      E     LCALL   ?C?SLCMP
0BD8 500D              JNC     ?C0110
                                           ; SOURCE LINE # 761
0BDA 74FF              MOV     A,#0FFH
0BDC 75009C      R     MOV     pwm_input+03H,#09CH
0BDF F500        R     MOV     pwm_input+02H,A
0BE1 F500        R     MOV     pwm_input+01H,A
0BE3 F500        R     MOV     pwm_input,A
0BE5 801E              SJMP    ?C0111
0BE7         ?C0110:
                                           ; SOURCE LINE # 762
                                           ; SOURCE LINE # 763
0BE7 E4                CLR     A
0BE8 7F64              MOV     R7,#064H
0BEA FE                MOV     R6,A
0BEB FD                MOV     R5,A
0BEC FC                MOV     R4,A
0BED AB00        R     MOV     R3,pwm_input+03H
0BEF AA00        R     MOV     R2,pwm_input+02H
0BF1 A900        R     MOV     R1,pwm_input+01H
0BF3 A800        R     MOV     R0,pwm_input
0BF5 D3                SETB    C
0BF6 120000      E     LCALL   ?C?SLCMP
0BF9 400A              JC      ?C0111
                                           ; SOURCE LINE # 764
0BFB E4                CLR     A
0BFC 750064      R     MOV     pwm_input+03H,#064H
0BFF F500        R     MOV     pwm_input+02H,A
0C01 F500        R     MOV     pwm_input+01H,A
0C03 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 765
0C05         ?C0111:
                                           ; SOURCE LINE # 768
0C05 AF00        R     MOV     R7,curr_error+03H
0C07 AE00        R     MOV     R6,curr_error+02H
0C09 AD00        R     MOV     R5,curr_error+01H
0C0B AC00        R     MOV     R4,curr_error
0C0D 900000      R     MOV     DPTR,#prev_curr_err
0C10 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 770
0C13 020000      R     LJMP    ?C0091
                                           ; SOURCE LINE # 773
0C16         ?C0113:
                                           ; SOURCE LINE # 774
0C16 900000      E     MOV     DPTR,#g_meas
0C19 E0                MOVX    A,@DPTR
0C1A F8                MOV     R0,A
0C1B A3                INC     DPTR
0C1C E0                MOVX    A,@DPTR
0C1D F9                MOV     R1,A
0C1E A3                INC     DPTR
0C1F E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 76  

0C20 FA                MOV     R2,A
0C21 A3                INC     DPTR
0C22 E0                MOVX    A,@DPTR
0C23 FB                MOV     R3,A
0C24 900000      E     MOV     DPTR,#g_ref
0C27 E0                MOVX    A,@DPTR
0C28 FC                MOV     R4,A
0C29 A3                INC     DPTR
0C2A E0                MOVX    A,@DPTR
0C2B FD                MOV     R5,A
0C2C A3                INC     DPTR
0C2D E0                MOVX    A,@DPTR
0C2E FE                MOV     R6,A
0C2F A3                INC     DPTR
0C30 E0                MOVX    A,@DPTR
0C31 C3                CLR     C
0C32 9B                SUBB    A,R3
0C33 F500        R     MOV     pos_error+03H,A
0C35 EE                MOV     A,R6
0C36 9A                SUBB    A,R2
0C37 F500        R     MOV     pos_error+02H,A
0C39 ED                MOV     A,R5
0C3A 99                SUBB    A,R1
0C3B F500        R     MOV     pos_error+01H,A
0C3D EC                MOV     A,R4
0C3E 98                SUBB    A,R0
0C3F F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 776
0C41 900000      R     MOV     DPTR,#pos_error_sum
0C44 E0                MOVX    A,@DPTR
0C45 FC                MOV     R4,A
0C46 A3                INC     DPTR
0C47 E0                MOVX    A,@DPTR
0C48 FD                MOV     R5,A
0C49 A3                INC     DPTR
0C4A E0                MOVX    A,@DPTR
0C4B FE                MOV     R6,A
0C4C A3                INC     DPTR
0C4D E0                MOVX    A,@DPTR
0C4E 2500        R     ADD     A,pos_error+03H
0C50 FF                MOV     R7,A
0C51 EE                MOV     A,R6
0C52 3500        R     ADDC    A,pos_error+02H
0C54 FE                MOV     R6,A
0C55 ED                MOV     A,R5
0C56 3500        R     ADDC    A,pos_error+01H
0C58 FD                MOV     R5,A
0C59 EC                MOV     A,R4
0C5A 3500        R     ADDC    A,pos_error
0C5C FC                MOV     R4,A
0C5D 900000      R     MOV     DPTR,#pos_error_sum
0C60 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 779
0C63 E4                CLR     A
0C64 7FE8              MOV     R7,#0E8H
0C66 7E03              MOV     R6,#03H
0C68 FD                MOV     R5,A
0C69 FC                MOV     R4,A
0C6A 900000      R     MOV     DPTR,#pos_error_sum
0C6D E0                MOVX    A,@DPTR
0C6E F8                MOV     R0,A
0C6F A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 77  

0C70 E0                MOVX    A,@DPTR
0C71 F9                MOV     R1,A
0C72 A3                INC     DPTR
0C73 E0                MOVX    A,@DPTR
0C74 FA                MOV     R2,A
0C75 A3                INC     DPTR
0C76 E0                MOVX    A,@DPTR
0C77 FB                MOV     R3,A
0C78 D3                SETB    C
0C79 120000      E     LCALL   ?C?SLCMP
0C7C 400F              JC      ?C0114
                                           ; SOURCE LINE # 780
0C7E E4                CLR     A
0C7F 7FE8              MOV     R7,#0E8H
0C81 7E03              MOV     R6,#03H
0C83 FD                MOV     R5,A
0C84 FC                MOV     R4,A
0C85 900000      R     MOV     DPTR,#pos_error_sum
0C88 120000      E     LCALL   ?C?LSTXDATA
0C8B 802A              SJMP    ?C0115
0C8D         ?C0114:
                                           ; SOURCE LINE # 781
                                           ; SOURCE LINE # 782
0C8D 7F18              MOV     R7,#018H
0C8F 7EFC              MOV     R6,#0FCH
0C91 7DFF              MOV     R5,#0FFH
0C93 7CFF              MOV     R4,#0FFH
0C95 900000      R     MOV     DPTR,#pos_error_sum
0C98 E0                MOVX    A,@DPTR
0C99 F8                MOV     R0,A
0C9A A3                INC     DPTR
0C9B E0                MOVX    A,@DPTR
0C9C F9                MOV     R1,A
0C9D A3                INC     DPTR
0C9E E0                MOVX    A,@DPTR
0C9F FA                MOV     R2,A
0CA0 A3                INC     DPTR
0CA1 E0                MOVX    A,@DPTR
0CA2 FB                MOV     R3,A
0CA3 C3                CLR     C
0CA4 120000      E     LCALL   ?C?SLCMP
0CA7 500E              JNC     ?C0115
                                           ; SOURCE LINE # 783
0CA9 7F18              MOV     R7,#018H
0CAB 7EFC              MOV     R6,#0FCH
0CAD 7DFF              MOV     R5,#0FFH
0CAF 7CFF              MOV     R4,#0FFH
0CB1 900000      R     MOV     DPTR,#pos_error_sum
0CB4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 784
0CB7         ?C0115:
                                           ; SOURCE LINE # 787
0CB7 E4                CLR     A
0CB8 FF                MOV     R7,A
0CB9 FE                MOV     R6,A
0CBA FD                MOV     R5,A
0CBB FC                MOV     R4,A
0CBC AB00        R     MOV     R3,k_p+03H
0CBE AA00        R     MOV     R2,k_p+02H
0CC0 A900        R     MOV     R1,k_p+01H
0CC2 A800        R     MOV     R0,k_p
0CC4 C3                CLR     C
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 78  

0CC5 120000      E     LCALL   ?C?SLCMP
0CC8 601A              JZ      ?C0117
                                           ; SOURCE LINE # 788
0CCA AF00        R     MOV     R7,pos_error+03H
0CCC AE00        R     MOV     R6,pos_error+02H
0CCE AD00        R     MOV     R5,pos_error+01H
0CD0 AC00        R     MOV     R4,pos_error
0CD2 A800        R     MOV     R0,k_p
0CD4 120000      E     LCALL   ?C?LMUL
0CD7 7810              MOV     R0,#010H
0CD9 120000      E     LCALL   ?C?SLSHR
0CDC 8F00        R     MOV     pwm_input+03H,R7
0CDE 8E00        R     MOV     pwm_input+02H,R6
0CE0 8D00        R     MOV     pwm_input+01H,R5
0CE2 8C00        R     MOV     pwm_input,R4
0CE4         ?C0117:
                                           ; SOURCE LINE # 792
0CE4 E4                CLR     A
0CE5 FF                MOV     R7,A
0CE6 FE                MOV     R6,A
0CE7 FD                MOV     R5,A
0CE8 FC                MOV     R4,A
0CE9 AB00        R     MOV     R3,k_i+03H
0CEB AA00        R     MOV     R2,k_i+02H
0CED A900        R     MOV     R1,k_i+01H
0CEF A800        R     MOV     R0,k_i
0CF1 C3                CLR     C
0CF2 120000      E     LCALL   ?C?SLCMP
0CF5 602C              JZ      ?C0118
                                           ; SOURCE LINE # 793
0CF7 900000      R     MOV     DPTR,#pos_error_sum
0CFA E0                MOVX    A,@DPTR
0CFB FC                MOV     R4,A
0CFC A3                INC     DPTR
0CFD E0                MOVX    A,@DPTR
0CFE FD                MOV     R5,A
0CFF A3                INC     DPTR
0D00 E0                MOVX    A,@DPTR
0D01 FE                MOV     R6,A
0D02 A3                INC     DPTR
0D03 E0                MOVX    A,@DPTR
0D04 FF                MOV     R7,A
0D05 A800        R     MOV     R0,k_i
0D07 120000      E     LCALL   ?C?LMUL
0D0A 7810              MOV     R0,#010H
0D0C 120000      E     LCALL   ?C?SLSHR
0D0F E500        R     MOV     A,pwm_input+03H
0D11 2F                ADD     A,R7
0D12 F500        R     MOV     pwm_input+03H,A
0D14 E500        R     MOV     A,pwm_input+02H
0D16 3E                ADDC    A,R6
0D17 F500        R     MOV     pwm_input+02H,A
0D19 E500        R     MOV     A,pwm_input+01H
0D1B 3D                ADDC    A,R5
0D1C F500        R     MOV     pwm_input+01H,A
0D1E E500        R     MOV     A,pwm_input
0D20 3C                ADDC    A,R4
0D21 F500        R     MOV     pwm_input,A
0D23         ?C0118:
                                           ; SOURCE LINE # 797
0D23 E4                CLR     A
0D24 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 79  

0D25 FE                MOV     R6,A
0D26 FD                MOV     R5,A
0D27 FC                MOV     R4,A
0D28 AB00        R     MOV     R3,k_d+03H
0D2A AA00        R     MOV     R2,k_d+02H
0D2C A900        R     MOV     R1,k_d+01H
0D2E A800        R     MOV     R0,k_d
0D30 C3                CLR     C
0D31 120000      E     LCALL   ?C?SLCMP
0D34 6043              JZ      ?C0119
                                           ; SOURCE LINE # 798
0D36 900000      R     MOV     DPTR,#prev_pos_err
0D39 E0                MOVX    A,@DPTR
0D3A F8                MOV     R0,A
0D3B A3                INC     DPTR
0D3C E0                MOVX    A,@DPTR
0D3D F9                MOV     R1,A
0D3E A3                INC     DPTR
0D3F E0                MOVX    A,@DPTR
0D40 FA                MOV     R2,A
0D41 A3                INC     DPTR
0D42 E0                MOVX    A,@DPTR
0D43 FB                MOV     R3,A
0D44 C3                CLR     C
0D45 E500        R     MOV     A,pos_error+03H
0D47 9B                SUBB    A,R3
0D48 FF                MOV     R7,A
0D49 E500        R     MOV     A,pos_error+02H
0D4B 9A                SUBB    A,R2
0D4C FE                MOV     R6,A
0D4D E500        R     MOV     A,pos_error+01H
0D4F 99                SUBB    A,R1
0D50 FD                MOV     R5,A
0D51 E500        R     MOV     A,pos_error
0D53 98                SUBB    A,R0
0D54 FC                MOV     R4,A
0D55 AB00        R     MOV     R3,k_d+03H
0D57 AA00        R     MOV     R2,k_d+02H
0D59 A900        R     MOV     R1,k_d+01H
0D5B A800        R     MOV     R0,k_d
0D5D 120000      E     LCALL   ?C?LMUL
0D60 7810              MOV     R0,#010H
0D62 120000      E     LCALL   ?C?SLSHR
0D65 E500        R     MOV     A,pwm_input+03H
0D67 2F                ADD     A,R7
0D68 F500        R     MOV     pwm_input+03H,A
0D6A E500        R     MOV     A,pwm_input+02H
0D6C 3E                ADDC    A,R6
0D6D F500        R     MOV     pwm_input+02H,A
0D6F E500        R     MOV     A,pwm_input+01H
0D71 3D                ADDC    A,R5
0D72 F500        R     MOV     pwm_input+01H,A
0D74 E500        R     MOV     A,pwm_input
0D76 3C                ADDC    A,R4
0D77 F500        R     MOV     pwm_input,A
0D79         ?C0119:
                                           ; SOURCE LINE # 802
0D79 AF00        R     MOV     R7,pos_error+03H
0D7B AE00        R     MOV     R6,pos_error+02H
0D7D AD00        R     MOV     R5,pos_error+01H
0D7F AC00        R     MOV     R4,pos_error
0D81 900000      R     MOV     DPTR,#prev_pos_err
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 80  

0D84 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 804
0D87 E4                CLR     A
0D88 FF                MOV     R7,A
0D89 FE                MOV     R6,A
0D8A FD                MOV     R5,A
0D8B FC                MOV     R4,A
0D8C AB00        R     MOV     R3,pwm_input+03H
0D8E AA00        R     MOV     R2,pwm_input+02H
0D90 A900        R     MOV     R1,pwm_input+01H
0D92 A800        R     MOV     R0,pwm_input
0D94 D3                SETB    C
0D95 120000      E     LCALL   ?C?SLCMP
0D98 4005              JC      ?C0120
                                           ; SOURCE LINE # 805
0D9A D200        R     SETB    motor_dir
0D9C 020000      R     LJMP    ?C0091
0D9F         ?C0120:
                                           ; SOURCE LINE # 807
0D9F C200        R     CLR     motor_dir
                                           ; SOURCE LINE # 809
0DA1 020000      R     LJMP    ?C0091
                                           ; SOURCE LINE # 812
0DA4         ?C0122:
                                           ; SOURCE LINE # 813
0DA4 900000      E     MOV     DPTR,#g_ref+018H
0DA7 E0                MOVX    A,@DPTR
0DA8 7003              JNZ     $ + 5H
0DAA 020000      R     LJMP    ?C0091
0DAD 200003      E     JB      tension_valid,$ + 6H
0DB0 020000      R     LJMP    ?C0091
                                           ; SOURCE LINE # 815
0DB3 900000      E     MOV     DPTR,#g_ref+08H
0DB6 E0                MOVX    A,@DPTR
0DB7 FC                MOV     R4,A
0DB8 A3                INC     DPTR
0DB9 E0                MOVX    A,@DPTR
0DBA FD                MOV     R5,A
0DBB A3                INC     DPTR
0DBC E0                MOVX    A,@DPTR
0DBD FE                MOV     R6,A
0DBE A3                INC     DPTR
0DBF E0                MOVX    A,@DPTR
0DC0 F500        R     MOV     i_ref+03H,A
0DC2 8E00        R     MOV     i_ref+02H,R6
0DC4 8D00        R     MOV     i_ref+01H,R5
0DC6 8C00        R     MOV     i_ref,R4
                                           ; SOURCE LINE # 817
0DC8 900000      E     MOV     DPTR,#c_mem+069H
0DCB E0                MOVX    A,@DPTR
0DCC FE                MOV     R6,A
0DCD A3                INC     DPTR
0DCE E0                MOVX    A,@DPTR
0DCF FF                MOV     R7,A
0DD0 EE                MOV     A,R6
0DD1 33                RLC     A
0DD2 95E0              SUBB    A,ACC
0DD4 FD                MOV     R5,A
0DD5 FC                MOV     R4,A
0DD6 AB00        R     MOV     R3,i_ref+03H
0DD8 AA00        R     MOV     R2,i_ref+02H
0DDA A900        R     MOV     R1,i_ref+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 81  

0DDC A800        R     MOV     R0,i_ref
0DDE D3                SETB    C
0DDF 120000      E     LCALL   ?C?SLCMP
0DE2 4016              JC      ?C0124
                                           ; SOURCE LINE # 818
0DE4 900000      E     MOV     DPTR,#c_mem+069H
0DE7 E0                MOVX    A,@DPTR
0DE8 FE                MOV     R6,A
0DE9 A3                INC     DPTR
0DEA E0                MOVX    A,@DPTR
0DEB FF                MOV     R7,A
0DEC EE                MOV     A,R6
0DED 33                RLC     A
0DEE 95E0              SUBB    A,ACC
0DF0 8F00        R     MOV     i_ref+03H,R7
0DF2 8E00        R     MOV     i_ref+02H,R6
0DF4 F500        R     MOV     i_ref+01H,A
0DF6 F500        R     MOV     i_ref,A
0DF8 803C              SJMP    ?C0125
0DFA         ?C0124:
                                           ; SOURCE LINE # 819
                                           ; SOURCE LINE # 820
0DFA 900000      E     MOV     DPTR,#c_mem+069H
0DFD E0                MOVX    A,@DPTR
0DFE FE                MOV     R6,A
0DFF A3                INC     DPTR
0E00 E0                MOVX    A,@DPTR
0E01 FF                MOV     R7,A
0E02 C3                CLR     C
0E03 E4                CLR     A
0E04 9F                SUBB    A,R7
0E05 FF                MOV     R7,A
0E06 E4                CLR     A
0E07 9E                SUBB    A,R6
0E08 FE                MOV     R6,A
0E09 33                RLC     A
0E0A 95E0              SUBB    A,ACC
0E0C FD                MOV     R5,A
0E0D FC                MOV     R4,A
0E0E AB00        R     MOV     R3,i_ref+03H
0E10 AA00        R     MOV     R2,i_ref+02H
0E12 A900        R     MOV     R1,i_ref+01H
0E14 A800        R     MOV     R0,i_ref
0E16 C3                CLR     C
0E17 120000      E     LCALL   ?C?SLCMP
0E1A 501A              JNC     ?C0125
                                           ; SOURCE LINE # 821
0E1C 900000      E     MOV     DPTR,#c_mem+069H
0E1F E0                MOVX    A,@DPTR
0E20 FE                MOV     R6,A
0E21 A3                INC     DPTR
0E22 E0                MOVX    A,@DPTR
0E23 FF                MOV     R7,A
0E24 C3                CLR     C
0E25 E4                CLR     A
0E26 9F                SUBB    A,R7
0E27 FF                MOV     R7,A
0E28 E4                CLR     A
0E29 9E                SUBB    A,R6
0E2A FE                MOV     R6,A
0E2B 33                RLC     A
0E2C 95E0              SUBB    A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 82  

0E2E 8F00        R     MOV     i_ref+03H,R7
0E30 8E00        R     MOV     i_ref+02H,R6
0E32 F500        R     MOV     i_ref+01H,A
0E34 F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 822
0E36         ?C0125:
                                           ; SOURCE LINE # 825
0E36 900000      E     MOV     DPTR,#g_meas+0CH
0E39 E0                MOVX    A,@DPTR
0E3A F8                MOV     R0,A
0E3B A3                INC     DPTR
0E3C E0                MOVX    A,@DPTR
0E3D F9                MOV     R1,A
0E3E A3                INC     DPTR
0E3F E0                MOVX    A,@DPTR
0E40 FA                MOV     R2,A
0E41 A3                INC     DPTR
0E42 E0                MOVX    A,@DPTR
0E43 FB                MOV     R3,A
0E44 C3                CLR     C
0E45 E500        R     MOV     A,i_ref+03H
0E47 9B                SUBB    A,R3
0E48 F500        R     MOV     curr_error+03H,A
0E4A E500        R     MOV     A,i_ref+02H
0E4C 9A                SUBB    A,R2
0E4D F500        R     MOV     curr_error+02H,A
0E4F E500        R     MOV     A,i_ref+01H
0E51 99                SUBB    A,R1
0E52 F500        R     MOV     curr_error+01H,A
0E54 E500        R     MOV     A,i_ref
0E56 98                SUBB    A,R0
0E57 F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 826
0E59 900000      R     MOV     DPTR,#curr_error_sum
0E5C E0                MOVX    A,@DPTR
0E5D FC                MOV     R4,A
0E5E A3                INC     DPTR
0E5F E0                MOVX    A,@DPTR
0E60 FD                MOV     R5,A
0E61 A3                INC     DPTR
0E62 E0                MOVX    A,@DPTR
0E63 FE                MOV     R6,A
0E64 A3                INC     DPTR
0E65 E0                MOVX    A,@DPTR
0E66 2500        R     ADD     A,curr_error+03H
0E68 FF                MOV     R7,A
0E69 EE                MOV     A,R6
0E6A 3500        R     ADDC    A,curr_error+02H
0E6C FE                MOV     R6,A
0E6D ED                MOV     A,R5
0E6E 3500        R     ADDC    A,curr_error+01H
0E70 FD                MOV     R5,A
0E71 EC                MOV     A,R4
0E72 3500        R     ADDC    A,curr_error
0E74 FC                MOV     R4,A
0E75 900000      R     MOV     DPTR,#curr_error_sum
0E78 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 828
0E7B 7FA0              MOV     R7,#0A0H
0E7D 7E86              MOV     R6,#086H
0E7F 7D01              MOV     R5,#01H
0E81 7C00              MOV     R4,#00H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 83  

0E83 900000      R     MOV     DPTR,#curr_error_sum
0E86 E0                MOVX    A,@DPTR
0E87 F8                MOV     R0,A
0E88 A3                INC     DPTR
0E89 E0                MOVX    A,@DPTR
0E8A F9                MOV     R1,A
0E8B A3                INC     DPTR
0E8C E0                MOVX    A,@DPTR
0E8D FA                MOV     R2,A
0E8E A3                INC     DPTR
0E8F E0                MOVX    A,@DPTR
0E90 FB                MOV     R3,A
0E91 D3                SETB    C
0E92 120000      E     LCALL   ?C?SLCMP
0E95 4010              JC      ?C0127
                                           ; SOURCE LINE # 829
0E97 7FA0              MOV     R7,#0A0H
0E99 7E86              MOV     R6,#086H
0E9B 7D01              MOV     R5,#01H
0E9D 7C00              MOV     R4,#00H
0E9F 900000      R     MOV     DPTR,#curr_error_sum
0EA2 120000      E     LCALL   ?C?LSTXDATA
0EA5 802A              SJMP    ?C0128
0EA7         ?C0127:
                                           ; SOURCE LINE # 830
                                           ; SOURCE LINE # 831
0EA7 7F60              MOV     R7,#060H
0EA9 7E79              MOV     R6,#079H
0EAB 7DFE              MOV     R5,#0FEH
0EAD 7CFF              MOV     R4,#0FFH
0EAF 900000      R     MOV     DPTR,#curr_error_sum
0EB2 E0                MOVX    A,@DPTR
0EB3 F8                MOV     R0,A
0EB4 A3                INC     DPTR
0EB5 E0                MOVX    A,@DPTR
0EB6 F9                MOV     R1,A
0EB7 A3                INC     DPTR
0EB8 E0                MOVX    A,@DPTR
0EB9 FA                MOV     R2,A
0EBA A3                INC     DPTR
0EBB E0                MOVX    A,@DPTR
0EBC FB                MOV     R3,A
0EBD C3                CLR     C
0EBE 120000      E     LCALL   ?C?SLCMP
0EC1 500E              JNC     ?C0128
                                           ; SOURCE LINE # 832
0EC3 7F60              MOV     R7,#060H
0EC5 7E79              MOV     R6,#079H
0EC7 7DFE              MOV     R5,#0FEH
0EC9 7CFF              MOV     R4,#0FFH
0ECB 900000      R     MOV     DPTR,#curr_error_sum
0ECE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 833
0ED1         ?C0128:
                                           ; SOURCE LINE # 835
0ED1 E4                CLR     A
0ED2 F500        R     MOV     pwm_input+03H,A
0ED4 F500        R     MOV     pwm_input+02H,A
0ED6 F500        R     MOV     pwm_input+01H,A
0ED8 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 838
0EDA FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 84  

0EDB FE                MOV     R6,A
0EDC FD                MOV     R5,A
0EDD FC                MOV     R4,A
0EDE AB00        R     MOV     R3,k_p_c+03H
0EE0 AA00        R     MOV     R2,k_p_c+02H
0EE2 A900        R     MOV     R1,k_p_c+01H
0EE4 A800        R     MOV     R0,k_p_c
0EE6 C3                CLR     C
0EE7 120000      E     LCALL   ?C?SLCMP
0EEA 6026              JZ      ?C0130
                                           ; SOURCE LINE # 839
0EEC AF00        R     MOV     R7,curr_error+03H
0EEE AE00        R     MOV     R6,curr_error+02H
0EF0 AD00        R     MOV     R5,curr_error+01H
0EF2 AC00        R     MOV     R4,curr_error
0EF4 A800        R     MOV     R0,k_p_c
0EF6 120000      E     LCALL   ?C?LMUL
0EF9 7810              MOV     R0,#010H
0EFB 120000      E     LCALL   ?C?SLSHR
0EFE E500        R     MOV     A,pwm_input+03H
0F00 2F                ADD     A,R7
0F01 F500        R     MOV     pwm_input+03H,A
0F03 E500        R     MOV     A,pwm_input+02H
0F05 3E                ADDC    A,R6
0F06 F500        R     MOV     pwm_input+02H,A
0F08 E500        R     MOV     A,pwm_input+01H
0F0A 3D                ADDC    A,R5
0F0B F500        R     MOV     pwm_input+01H,A
0F0D E500        R     MOV     A,pwm_input
0F0F 3C                ADDC    A,R4
0F10 F500        R     MOV     pwm_input,A
0F12         ?C0130:
                                           ; SOURCE LINE # 842
0F12 E4                CLR     A
0F13 FF                MOV     R7,A
0F14 FE                MOV     R6,A
0F15 FD                MOV     R5,A
0F16 FC                MOV     R4,A
0F17 AB00        R     MOV     R3,k_i_c+03H
0F19 AA00        R     MOV     R2,k_i_c+02H
0F1B A900        R     MOV     R1,k_i_c+01H
0F1D A800        R     MOV     R0,k_i_c
0F1F C3                CLR     C
0F20 120000      E     LCALL   ?C?SLCMP
0F23 602C              JZ      ?C0131
                                           ; SOURCE LINE # 843
0F25 900000      R     MOV     DPTR,#curr_error_sum
0F28 E0                MOVX    A,@DPTR
0F29 FC                MOV     R4,A
0F2A A3                INC     DPTR
0F2B E0                MOVX    A,@DPTR
0F2C FD                MOV     R5,A
0F2D A3                INC     DPTR
0F2E E0                MOVX    A,@DPTR
0F2F FE                MOV     R6,A
0F30 A3                INC     DPTR
0F31 E0                MOVX    A,@DPTR
0F32 FF                MOV     R7,A
0F33 A800        R     MOV     R0,k_i_c
0F35 120000      E     LCALL   ?C?LMUL
0F38 7810              MOV     R0,#010H
0F3A 120000      E     LCALL   ?C?SLSHR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 85  

0F3D E500        R     MOV     A,pwm_input+03H
0F3F 2F                ADD     A,R7
0F40 F500        R     MOV     pwm_input+03H,A
0F42 E500        R     MOV     A,pwm_input+02H
0F44 3E                ADDC    A,R6
0F45 F500        R     MOV     pwm_input+02H,A
0F47 E500        R     MOV     A,pwm_input+01H
0F49 3D                ADDC    A,R5
0F4A F500        R     MOV     pwm_input+01H,A
0F4C E500        R     MOV     A,pwm_input
0F4E 3C                ADDC    A,R4
0F4F F500        R     MOV     pwm_input,A
0F51         ?C0131:
                                           ; SOURCE LINE # 846
0F51 E4                CLR     A
0F52 FF                MOV     R7,A
0F53 FE                MOV     R6,A
0F54 FD                MOV     R5,A
0F55 FC                MOV     R4,A
0F56 AB00        R     MOV     R3,k_d_c+03H
0F58 AA00        R     MOV     R2,k_d_c+02H
0F5A A900        R     MOV     R1,k_d_c+01H
0F5C A800        R     MOV     R0,k_d_c
0F5E C3                CLR     C
0F5F 120000      E     LCALL   ?C?SLCMP
0F62 6043              JZ      ?C0132
                                           ; SOURCE LINE # 847
0F64 900000      R     MOV     DPTR,#prev_curr_err
0F67 E0                MOVX    A,@DPTR
0F68 F8                MOV     R0,A
0F69 A3                INC     DPTR
0F6A E0                MOVX    A,@DPTR
0F6B F9                MOV     R1,A
0F6C A3                INC     DPTR
0F6D E0                MOVX    A,@DPTR
0F6E FA                MOV     R2,A
0F6F A3                INC     DPTR
0F70 E0                MOVX    A,@DPTR
0F71 FB                MOV     R3,A
0F72 C3                CLR     C
0F73 E500        R     MOV     A,curr_error+03H
0F75 9B                SUBB    A,R3
0F76 FF                MOV     R7,A
0F77 E500        R     MOV     A,curr_error+02H
0F79 9A                SUBB    A,R2
0F7A FE                MOV     R6,A
0F7B E500        R     MOV     A,curr_error+01H
0F7D 99                SUBB    A,R1
0F7E FD                MOV     R5,A
0F7F E500        R     MOV     A,curr_error
0F81 98                SUBB    A,R0
0F82 FC                MOV     R4,A
0F83 AB00        R     MOV     R3,k_d_c+03H
0F85 AA00        R     MOV     R2,k_d_c+02H
0F87 A900        R     MOV     R1,k_d_c+01H
0F89 A800        R     MOV     R0,k_d_c
0F8B 120000      E     LCALL   ?C?LMUL
0F8E 7810              MOV     R0,#010H
0F90 120000      E     LCALL   ?C?SLSHR
0F93 E500        R     MOV     A,pwm_input+03H
0F95 2F                ADD     A,R7
0F96 F500        R     MOV     pwm_input+03H,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 86  

0F98 E500        R     MOV     A,pwm_input+02H
0F9A 3E                ADDC    A,R6
0F9B F500        R     MOV     pwm_input+02H,A
0F9D E500        R     MOV     A,pwm_input+01H
0F9F 3D                ADDC    A,R5
0FA0 F500        R     MOV     pwm_input+01H,A
0FA2 E500        R     MOV     A,pwm_input
0FA4 3C                ADDC    A,R4
0FA5 F500        R     MOV     pwm_input,A
0FA7         ?C0132:
                                           ; SOURCE LINE # 849
0FA7 AF00        R     MOV     R7,curr_error+03H
0FA9 AE00        R     MOV     R6,curr_error+02H
0FAB AD00        R     MOV     R5,curr_error+01H
0FAD AC00        R     MOV     R4,curr_error
0FAF 900000      R     MOV     DPTR,#prev_curr_err
0FB2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 851
0FB5 E4                CLR     A
0FB6 FF                MOV     R7,A
0FB7 FE                MOV     R6,A
0FB8 FD                MOV     R5,A
0FB9 FC                MOV     R4,A
0FBA AB00        R     MOV     R3,pwm_input+03H
0FBC AA00        R     MOV     R2,pwm_input+02H
0FBE A900        R     MOV     R1,pwm_input+01H
0FC0 A800        R     MOV     R0,pwm_input
0FC2 C3                CLR     C
0FC3 120000      E     LCALL   ?C?SLCMP
0FC6 4004              JC      ?C0133
                                           ; SOURCE LINE # 852
0FC8 D200        R     SETB    motor_dir
0FCA 8072              SJMP    ?C0091
0FCC         ?C0133:
                                           ; SOURCE LINE # 854
0FCC C200        R     CLR     motor_dir
                                           ; SOURCE LINE # 855
                                           ; SOURCE LINE # 856
0FCE 806E              SJMP    ?C0091
                                           ; SOURCE LINE # 859
0FD0         ?C0135:
                                           ; SOURCE LINE # 861
0FD0 900000      E     MOV     DPTR,#g_ref+010H
0FD3 E0                MOVX    A,@DPTR
0FD4 FC                MOV     R4,A
0FD5 A3                INC     DPTR
0FD6 E0                MOVX    A,@DPTR
0FD7 FD                MOV     R5,A
0FD8 A3                INC     DPTR
0FD9 E0                MOVX    A,@DPTR
0FDA FE                MOV     R6,A
0FDB A3                INC     DPTR
0FDC E0                MOVX    A,@DPTR
0FDD F500        R     MOV     pwm_input+03H,A
0FDF 8E00        R     MOV     pwm_input+02H,R6
0FE1 8D00        R     MOV     pwm_input+01H,R5
0FE3 8C00        R     MOV     pwm_input,R4
                                           ; SOURCE LINE # 863
0FE5 E4                CLR     A
0FE6 FF                MOV     R7,A
0FE7 FE                MOV     R6,A
0FE8 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 87  

0FE9 FC                MOV     R4,A
0FEA AB00        R     MOV     R3,pwm_input+03H
0FEC AA00        R     MOV     R2,pwm_input+02H
0FEE A900        R     MOV     R1,pwm_input+01H
0FF0 A800        R     MOV     R0,pwm_input
0FF2 D3                SETB    C
0FF3 120000      E     LCALL   ?C?SLCMP
0FF6 4004              JC      ?C0136
                                           ; SOURCE LINE # 864
0FF8 D200        R     SETB    motor_dir
0FFA 8002              SJMP    ?C0137
0FFC         ?C0136:
                                           ; SOURCE LINE # 866
0FFC C200        R     CLR     motor_dir
0FFE         ?C0137:
                                           ; SOURCE LINE # 870
0FFE 74FF              MOV     A,#0FFH
1000 7F9C              MOV     R7,#09CH
1002 FE                MOV     R6,A
1003 FD                MOV     R5,A
1004 FC                MOV     R4,A
1005 AB00        R     MOV     R3,pwm_input+03H
1007 AA00        R     MOV     R2,pwm_input+02H
1009 A900        R     MOV     R1,pwm_input+01H
100B A800        R     MOV     R0,pwm_input
100D C3                CLR     C
100E 120000      E     LCALL   ?C?SLCMP
1011 500D              JNC     ?C0138
                                           ; SOURCE LINE # 871
1013 74FF              MOV     A,#0FFH
1015 75009C      R     MOV     pwm_input+03H,#09CH
1018 F500        R     MOV     pwm_input+02H,A
101A F500        R     MOV     pwm_input+01H,A
101C F500        R     MOV     pwm_input,A
101E 801E              SJMP    ?C0091
1020         ?C0138:
                                           ; SOURCE LINE # 872
                                           ; SOURCE LINE # 873
1020 E4                CLR     A
1021 7F64              MOV     R7,#064H
1023 FE                MOV     R6,A
1024 FD                MOV     R5,A
1025 FC                MOV     R4,A
1026 AB00        R     MOV     R3,pwm_input+03H
1028 AA00        R     MOV     R2,pwm_input+02H
102A A900        R     MOV     R1,pwm_input+01H
102C A800        R     MOV     R0,pwm_input
102E D3                SETB    C
102F 120000      E     LCALL   ?C?SLCMP
1032 400A              JC      ?C0091
                                           ; SOURCE LINE # 874
1034 E4                CLR     A
1035 750064      R     MOV     pwm_input+03H,#064H
1038 F500        R     MOV     pwm_input+02H,A
103A F500        R     MOV     pwm_input+01H,A
103C F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 875
                                           ; SOURCE LINE # 877
                                           ; SOURCE LINE # 878
103E         ?C0091:
                                           ; SOURCE LINE # 882
103E E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 88  

103F 7F64              MOV     R7,#064H
1041 FE                MOV     R6,A
1042 FD                MOV     R5,A
1043 FC                MOV     R4,A
1044 AB00        R     MOV     R3,pwm_input+03H
1046 AA00        R     MOV     R2,pwm_input+02H
1048 A900        R     MOV     R1,pwm_input+01H
104A A800        R     MOV     R0,pwm_input
104C D3                SETB    C
104D 120000      E     LCALL   ?C?SLCMP
1050 400A              JC      ?C0141
                                           ; SOURCE LINE # 883
1052 E4                CLR     A
1053 750064      R     MOV     pwm_input+03H,#064H
1056 F500        R     MOV     pwm_input+02H,A
1058 F500        R     MOV     pwm_input+01H,A
105A F500        R     MOV     pwm_input,A
105C         ?C0141:
                                           ; SOURCE LINE # 884
105C 74FF              MOV     A,#0FFH
105E 7F9C              MOV     R7,#09CH
1060 FE                MOV     R6,A
1061 FD                MOV     R5,A
1062 FC                MOV     R4,A
1063 AB00        R     MOV     R3,pwm_input+03H
1065 AA00        R     MOV     R2,pwm_input+02H
1067 A900        R     MOV     R1,pwm_input+01H
1069 A800        R     MOV     R0,pwm_input
106B C3                CLR     C
106C 120000      E     LCALL   ?C?SLCMP
106F 500B              JNC     ?C0142
                                           ; SOURCE LINE # 885
1071 74FF              MOV     A,#0FFH
1073 75009C      R     MOV     pwm_input+03H,#09CH
1076 F500        R     MOV     pwm_input+02H,A
1078 F500        R     MOV     pwm_input+01H,A
107A F500        R     MOV     pwm_input,A
107C         ?C0142:
                                           ; SOURCE LINE # 888
107C 900000      E     MOV     DPTR,#c_mem+034H
107F E0                MOVX    A,@DPTR
1080 6401              XRL     A,#01H
1082 6037              JZ      ?C0143
                                           ; SOURCE LINE # 889
1084 AF00        R     MOV     R7,pwm_input+03H
1086 AE00        R     MOV     R6,pwm_input+02H
1088 AD00        R     MOV     R5,pwm_input+01H
108A AC00        R     MOV     R4,pwm_input
108C 780A              MOV     R0,#0AH
108E 120000      E     LCALL   ?C?LSHL
1091 E4                CLR     A
1092 7B64              MOV     R3,#064H
1094 FA                MOV     R2,A
1095 F9                MOV     R1,A
1096 F8                MOV     R0,A
1097 120000      E     LCALL   ?C?SLDIV
109A A804              MOV     R0,AR4
109C A905              MOV     R1,AR5
109E AA06              MOV     R2,AR6
10A0 AB07              MOV     R3,AR7
10A2 900000      E     MOV     DPTR,#dev_pwm_limit
10A5 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 89  

10A6 FF                MOV     R7,A
10A7 E4                CLR     A
10A8 FC                MOV     R4,A
10A9 FD                MOV     R5,A
10AA FE                MOV     R6,A
10AB 120000      E     LCALL   ?C?LMUL
10AE 780A              MOV     R0,#0AH
10B0 120000      E     LCALL   ?C?SLSHR
10B3 8F00        R     MOV     pwm_input+03H,R7
10B5 8E00        R     MOV     pwm_input+02H,R6
10B7 8D00        R     MOV     pwm_input+01H,R5
10B9 8C00        R     MOV     pwm_input,R4
10BB         ?C0143:
                                           ; SOURCE LINE # 892
10BB E4                CLR     A
10BC FF                MOV     R7,A
10BD FE                MOV     R6,A
10BE FD                MOV     R5,A
10BF FC                MOV     R4,A
10C0 AB00        R     MOV     R3,pwm_input+03H
10C2 AA00        R     MOV     R2,pwm_input+02H
10C4 A900        R     MOV     R1,pwm_input+01H
10C6 A800        R     MOV     R0,pwm_input
10C8 C3                CLR     C
10C9 120000      E     LCALL   ?C?SLCMP
10CC 4004              JC      ?C0144
10CE 7F01              MOV     R7,#01H
10D0 8002              SJMP    ?C0145
10D2         ?C0144:
10D2 7FFF              MOV     R7,#0FFH
10D4         ?C0145:
10D4 900000      E     MOV     DPTR,#pwm_sign
10D7 EF                MOV     A,R7
10D8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 894
10D9 300007            JNB     motor_dir,?C0146
                                           ; SOURCE LINE # 895
10DC 7F01              MOV     R7,#01H
10DE 120000      E     LCALL   _MOTOR_DIR_Write
10E1 8005              SJMP    ?C0147
10E3         ?C0146:
                                           ; SOURCE LINE # 897
10E3 E4                CLR     A
10E4 FF                MOV     R7,A
10E5 120000      E     LCALL   _MOTOR_DIR_Write
10E8         ?C0147:
                                           ; SOURCE LINE # 899
10E8 AE00        R     MOV     R6,pwm_input+02H
10EA AF00        R     MOV     R7,pwm_input+03H
10EC 120000      E     LCALL   _abs
10EF 120000      E     LCALL   _PWM_MOTORS_WriteCompare1
                                           ; SOURCE LINE # 900
10F2 22                RET     
             ; FUNCTION motor_control (END)

             ; FUNCTION _encoder_reading (BEGIN)
                                           ; SOURCE LINE # 906
;---- Variable 'idx' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 908
0000 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 917
0002 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 90  

0003 FF                MOV     R7,A
0004 FE                MOV     R6,A
0005 FD                MOV     R5,A
0006 FC                MOV     R4,A
0007 900000      R     MOV     DPTR,#init_rot
000A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 936
000D E500        R     MOV     A,index
000F C3                CLR     C
0010 9403              SUBB    A,#03H
0012 4003              JC      $ + 5H
0014 020000      R     LJMP    ?C0150
0017         ?C0149:
                                           ; SOURCE LINE # 939
0017 300022            JNB     reset_last_value_flag,?C0151
                                           ; SOURCE LINE # 940
;---- Variable 'jj' assigned to Register 'R3' ----
001A 7B03              MOV     R3,#03H
001C         ?C0152:
001C AF03              MOV     R7,AR3
001E 1B                DEC     R3
001F EF                MOV     A,R7
0020 6018              JZ      ?C0153
                                           ; SOURCE LINE # 941
0022 E4                CLR     A
0023 FF                MOV     R7,A
0024 FE                MOV     R6,A
0025 FD                MOV     R5,A
0026 FC                MOV     R4,A
0027 EB                MOV     A,R3
0028 25E0              ADD     A,ACC
002A 25E0              ADD     A,ACC
002C 2400        R     ADD     A,#LOW last_value_encoder
002E F582              MOV     DPL,A
0030 E4                CLR     A
0031 3400        R     ADDC    A,#HIGH last_value_encoder
0033 F583              MOV     DPH,A
0035 120000      E     LCALL   ?C?LSTXDATA
0038 80E2              SJMP    ?C0152
003A         ?C0153:
                                           ; SOURCE LINE # 943
003A C200        E     CLR     reset_last_value_flag
                                           ; SOURCE LINE # 944
003C         ?C0151:
                                           ; SOURCE LINE # 948
003C E500        R     MOV     A,index
003E 7018              JNZ     ?C0154
                                           ; SOURCE LINE # 949
0040 120000      E     LCALL   SHIFTREG_ENC_1_ReadData
0043 7801              MOV     R0,#01H
0045 120000      E     LCALL   ?C?ULSHR
0048 EF                MOV     A,R7
0049 EE                MOV     A,R6
004A ED                MOV     A,R5
004B 5403              ANL     A,#03H
004D FD                MOV     R5,A
004E E4                CLR     A
004F FC                MOV     R4,A
0050 900000      R     MOV     DPTR,#data_encoder
0053 120000      E     LCALL   ?C?LSTXDATA
0056 8033              SJMP    ?C0155
0058         ?C0154:
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 91  

                                           ; SOURCE LINE # 950
                                           ; SOURCE LINE # 951
0058 E500        R     MOV     A,index
005A B40118            CJNE    A,#01H,?C0156
                                           ; SOURCE LINE # 952
005D 120000      E     LCALL   SHIFTREG_ENC_2_ReadData
0060 7801              MOV     R0,#01H
0062 120000      E     LCALL   ?C?ULSHR
0065 EF                MOV     A,R7
0066 EE                MOV     A,R6
0067 ED                MOV     A,R5
0068 5403              ANL     A,#03H
006A FD                MOV     R5,A
006B E4                CLR     A
006C FC                MOV     R4,A
006D 900000      R     MOV     DPTR,#data_encoder
0070 120000      E     LCALL   ?C?LSTXDATA
0073 8016              SJMP    ?C0155
0075         ?C0156:
                                           ; SOURCE LINE # 954
0075 120000      E     LCALL   SHIFTREG_ENC_3_ReadData
0078 7801              MOV     R0,#01H
007A 120000      E     LCALL   ?C?ULSHR
007D EF                MOV     A,R7
007E EE                MOV     A,R6
007F ED                MOV     A,R5
0080 5403              ANL     A,#03H
0082 FD                MOV     R5,A
0083 E4                CLR     A
0084 FC                MOV     R4,A
0085 900000      R     MOV     DPTR,#data_encoder
0088 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 955
008B         ?C0155:
                                           ; SOURCE LINE # 958
008B 7B01              MOV     R3,#01H
008D 7A00        R     MOV     R2,#HIGH data_encoder
008F 7900        R     MOV     R1,#LOW data_encoder
0091 120000      E     LCALL   _check_enc_data
0094 4003              JC      $ + 5H
0096 020000      R     LJMP    ?C0158
                                           ; SOURCE LINE # 960
0099 900000      R     MOV     DPTR,#data_encoder
009C E0                MOVX    A,@DPTR
009D FC                MOV     R4,A
009E A3                INC     DPTR
009F E0                MOVX    A,@DPTR
00A0 FD                MOV     R5,A
00A1 A3                INC     DPTR
00A2 E0                MOVX    A,@DPTR
00A3 FE                MOV     R6,A
00A4 A3                INC     DPTR
00A5 E0                MOVX    A,@DPTR
00A6 54C0              ANL     A,#0C0H
00A8 FF                MOV     R7,A
00A9 EE                MOV     A,R6
00AA ED                MOV     A,R5
00AB 5403              ANL     A,#03H
00AD FD                MOV     R5,A
00AE E4                CLR     A
00AF 2F                ADD     A,R7
00B0 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 92  

00B1 E4                CLR     A
00B2 3E                ADDC    A,R6
00B3 FE                MOV     R6,A
00B4 ED                MOV     A,R5
00B5 34FE              ADDC    A,#0FEH
00B7 FD                MOV     R5,A
00B8 E4                CLR     A
00B9 34FF              ADDC    A,#0FFH
00BB FC                MOV     R4,A
00BC 7802              MOV     R0,#02H
00BE 120000      E     LCALL   ?C?ULSHR
00C1 EE                MOV     A,R6
00C2 33                RLC     A
00C3 95E0              SUBB    A,ACC
00C5 FD                MOV     R5,A
00C6 FC                MOV     R4,A
00C7 E500        R     MOV     A,index
00C9 25E0              ADD     A,ACC
00CB 25E0              ADD     A,ACC
00CD 2400        E     ADD     A,#LOW g_mem+038H
00CF F582              MOV     DPL,A
00D1 E4                CLR     A
00D2 3400        E     ADDC    A,#HIGH g_mem+038H
00D4 F583              MOV     DPH,A
00D6 E0                MOVX    A,@DPTR
00D7 F8                MOV     R0,A
00D8 A3                INC     DPTR
00D9 E0                MOVX    A,@DPTR
00DA F9                MOV     R1,A
00DB A3                INC     DPTR
00DC E0                MOVX    A,@DPTR
00DD FA                MOV     R2,A
00DE A3                INC     DPTR
00DF E0                MOVX    A,@DPTR
00E0 2F                ADD     A,R7
00E1 FF                MOV     R7,A
00E2 EA                MOV     A,R2
00E3 3E                ADDC    A,R6
00E4 FE                MOV     R6,A
00E5 E9                MOV     A,R1
00E6 3D                ADDC    A,R5
00E7 FD                MOV     R5,A
00E8 E8                MOV     A,R0
00E9 3C                ADDC    A,R4
00EA FC                MOV     R4,A
00EB 900000      R     MOV     DPTR,#value_encoder
00EE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 967
00F1 300027            JNB     only_first_time,?C0159
                                           ; SOURCE LINE # 968
00F4 900000      R     MOV     DPTR,#value_encoder
00F7 E0                MOVX    A,@DPTR
00F8 FC                MOV     R4,A
00F9 A3                INC     DPTR
00FA E0                MOVX    A,@DPTR
00FB FD                MOV     R5,A
00FC A3                INC     DPTR
00FD E0                MOVX    A,@DPTR
00FE FE                MOV     R6,A
00FF A3                INC     DPTR
0100 E0                MOVX    A,@DPTR
0101 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 93  

0102 E500        R     MOV     A,index
0104 25E0              ADD     A,ACC
0106 25E0              ADD     A,ACC
0108 2400        R     ADD     A,#LOW last_value_encoder
010A F582              MOV     DPL,A
010C E4                CLR     A
010D 3400        R     ADDC    A,#HIGH last_value_encoder
010F F583              MOV     DPH,A
0111 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 969
0114 E500        R     MOV     A,index
0116 B40202            CJNE    A,#02H,?C0159
                                           ; SOURCE LINE # 970
0119 C200        R     CLR     only_first_time
                                           ; SOURCE LINE # 971
011B         ?C0159:
                                           ; SOURCE LINE # 974
011B E500        R     MOV     A,index
011D 25E0              ADD     A,ACC
011F 25E0              ADD     A,ACC
0121 2400        R     ADD     A,#LOW last_value_encoder
0123 F582              MOV     DPL,A
0125 E4                CLR     A
0126 3400        R     ADDC    A,#HIGH last_value_encoder
0128 F583              MOV     DPH,A
012A E0                MOVX    A,@DPTR
012B F8                MOV     R0,A
012C A3                INC     DPTR
012D E0                MOVX    A,@DPTR
012E F9                MOV     R1,A
012F A3                INC     DPTR
0130 E0                MOVX    A,@DPTR
0131 FA                MOV     R2,A
0132 A3                INC     DPTR
0133 E0                MOVX    A,@DPTR
0134 FB                MOV     R3,A
0135 900000      R     MOV     DPTR,#value_encoder
0138 E0                MOVX    A,@DPTR
0139 FC                MOV     R4,A
013A A3                INC     DPTR
013B E0                MOVX    A,@DPTR
013C FD                MOV     R5,A
013D A3                INC     DPTR
013E E0                MOVX    A,@DPTR
013F FE                MOV     R6,A
0140 A3                INC     DPTR
0141 E0                MOVX    A,@DPTR
0142 C3                CLR     C
0143 9B                SUBB    A,R3
0144 FF                MOV     R7,A
0145 EE                MOV     A,R6
0146 9A                SUBB    A,R2
0147 FE                MOV     R6,A
0148 ED                MOV     A,R5
0149 99                SUBB    A,R1
014A FD                MOV     R5,A
014B EC                MOV     A,R4
014C 98                SUBB    A,R0
014D FC                MOV     R4,A
014E 900000      R     MOV     DPTR,#aux
0151 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 994
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 94  

0154 E4                CLR     A
0155 FF                MOV     R7,A
0156 7EC0              MOV     R6,#0C0H
0158 FD                MOV     R5,A
0159 FC                MOV     R4,A
015A 900000      R     MOV     DPTR,#aux
015D E0                MOVX    A,@DPTR
015E F8                MOV     R0,A
015F A3                INC     DPTR
0160 E0                MOVX    A,@DPTR
0161 F9                MOV     R1,A
0162 A3                INC     DPTR
0163 E0                MOVX    A,@DPTR
0164 FA                MOV     R2,A
0165 A3                INC     DPTR
0166 E0                MOVX    A,@DPTR
0167 FB                MOV     R3,A
0168 D3                SETB    C
0169 120000      E     LCALL   ?C?SLCMP
016C 4010              JC      ?C0161
                                           ; SOURCE LINE # 995
016E 7400        E     MOV     A,#LOW g_meas+014H
0170 2500        R     ADD     A,index
0172 F582              MOV     DPL,A
0174 E4                CLR     A
0175 3400        E     ADDC    A,#HIGH g_meas+014H
0177 F583              MOV     DPH,A
0179 E0                MOVX    A,@DPTR
017A 14                DEC     A
017B F0                MOVX    @DPTR,A
017C 8068              SJMP    ?C0162
017E         ?C0161:
                                           ; SOURCE LINE # 996
                                           ; SOURCE LINE # 997
017E 7F00              MOV     R7,#00H
0180 7E40              MOV     R6,#040H
0182 7DFF              MOV     R5,#0FFH
0184 7CFF              MOV     R4,#0FFH
0186 900000      R     MOV     DPTR,#aux
0189 E0                MOVX    A,@DPTR
018A F8                MOV     R0,A
018B A3                INC     DPTR
018C E0                MOVX    A,@DPTR
018D F9                MOV     R1,A
018E A3                INC     DPTR
018F E0                MOVX    A,@DPTR
0190 FA                MOV     R2,A
0191 A3                INC     DPTR
0192 E0                MOVX    A,@DPTR
0193 FB                MOV     R3,A
0194 C3                CLR     C
0195 120000      E     LCALL   ?C?SLCMP
0198 5010              JNC     ?C0163
                                           ; SOURCE LINE # 998
019A 7400        E     MOV     A,#LOW g_meas+014H
019C 2500        R     ADD     A,index
019E F582              MOV     DPL,A
01A0 E4                CLR     A
01A1 3400        E     ADDC    A,#HIGH g_meas+014H
01A3 F583              MOV     DPH,A
01A5 E0                MOVX    A,@DPTR
01A6 04                INC     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 95  

01A7 F0                MOVX    @DPTR,A
01A8 803C              SJMP    ?C0162
01AA         ?C0163:
                                           ; SOURCE LINE # 999
                                           ; SOURCE LINE # 1000
01AA 900000      R     MOV     DPTR,#aux
01AD E0                MOVX    A,@DPTR
01AE A3                INC     DPTR
01AF E0                MOVX    A,@DPTR
01B0 A3                INC     DPTR
01B1 E0                MOVX    A,@DPTR
01B2 FE                MOV     R6,A
01B3 A3                INC     DPTR
01B4 E0                MOVX    A,@DPTR
01B5 FF                MOV     R7,A
01B6 120000      E     LCALL   _abs
01B9 D3                SETB    C
01BA EF                MOV     A,R7
01BB 9400              SUBB    A,#00H
01BD EE                MOV     A,R6
01BE 6480              XRL     A,#080H
01C0 94C0              SUBB    A,#0C0H
01C2 4022              JC      ?C0162
                                           ; SOURCE LINE # 1001
01C4 7400        R     MOV     A,#LOW error
01C6 2500        R     ADD     A,index
01C8 F582              MOV     DPL,A
01CA E4                CLR     A
01CB 3400        R     ADDC    A,#HIGH error
01CD F583              MOV     DPH,A
01CF E0                MOVX    A,@DPTR
01D0 04                INC     A
01D1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1002
01D2 7400        R     MOV     A,#LOW error
01D4 2500        R     ADD     A,index
01D6 F582              MOV     DPL,A
01D8 E4                CLR     A
01D9 3400        R     ADDC    A,#HIGH error
01DB F583              MOV     DPH,A
01DD E0                MOVX    A,@DPTR
01DE C3                CLR     C
01DF 940A              SUBB    A,#0AH
01E1 5003              JNC     $ + 5H
01E3 020000      R     LJMP    ?C0150
01E6         ?C0166:
                                           ; SOURCE LINE # 1005
                                           ; SOURCE LINE # 1006
                                           ; SOURCE LINE # 1007
01E6         ?C0162:
                                           ; SOURCE LINE # 1009
01E6 7400        R     MOV     A,#LOW error
01E8 2500        R     ADD     A,index
01EA F582              MOV     DPL,A
01EC E4                CLR     A
01ED 3400        R     ADDC    A,#HIGH error
01EF F583              MOV     DPH,A
01F1 E4                CLR     A
01F2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1011
01F3 900000      R     MOV     DPTR,#value_encoder
01F6 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 96  

01F7 FC                MOV     R4,A
01F8 A3                INC     DPTR
01F9 E0                MOVX    A,@DPTR
01FA FD                MOV     R5,A
01FB A3                INC     DPTR
01FC E0                MOVX    A,@DPTR
01FD FE                MOV     R6,A
01FE A3                INC     DPTR
01FF E0                MOVX    A,@DPTR
0200 FF                MOV     R7,A
0201 E500        R     MOV     A,index
0203 25E0              ADD     A,ACC
0205 25E0              ADD     A,ACC
0207 2400        R     ADD     A,#LOW last_value_encoder
0209 F582              MOV     DPL,A
020B E4                CLR     A
020C 3400        R     ADDC    A,#HIGH last_value_encoder
020E F583              MOV     DPH,A
0210 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1013
0213 900000      R     MOV     DPTR,#value_encoder
0216 E0                MOVX    A,@DPTR
0217 F8                MOV     R0,A
0218 A3                INC     DPTR
0219 E0                MOVX    A,@DPTR
021A F9                MOV     R1,A
021B A3                INC     DPTR
021C E0                MOVX    A,@DPTR
021D FA                MOV     R2,A
021E A3                INC     DPTR
021F E0                MOVX    A,@DPTR
0220 FB                MOV     R3,A
0221 C000              PUSH    AR0
0223 7400        E     MOV     A,#LOW g_meas+014H
0225 2500        R     ADD     A,index
0227 F582              MOV     DPL,A
0229 E4                CLR     A
022A 3400        E     ADDC    A,#HIGH g_meas+014H
022C F583              MOV     DPH,A
022E E0                MOVX    A,@DPTR
022F FF                MOV     R7,A
0230 33                RLC     A
0231 95E0              SUBB    A,ACC
0233 FE                MOV     R6,A
0234 FD                MOV     R5,A
0235 FC                MOV     R4,A
0236 7810              MOV     R0,#010H
0238 120000      E     LCALL   ?C?LSHL
023B D000              POP     AR0
023D EB                MOV     A,R3
023E 2F                ADD     A,R7
023F FF                MOV     R7,A
0240 EA                MOV     A,R2
0241 3E                ADDC    A,R6
0242 FE                MOV     R6,A
0243 E9                MOV     A,R1
0244 3D                ADDC    A,R5
0245 FD                MOV     R5,A
0246 E8                MOV     A,R0
0247 3C                ADDC    A,R4
0248 FC                MOV     R4,A
0249 900000      R     MOV     DPTR,#value_encoder
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 97  

024C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1015
024F E500        R     MOV     A,index
0251 25E0              ADD     A,ACC
0253 25E0              ADD     A,ACC
0255 2400        E     ADD     A,#LOW c_mem+044H
0257 F582              MOV     DPL,A
0259 E4                CLR     A
025A 3400        E     ADDC    A,#HIGH c_mem+044H
025C F583              MOV     DPH,A
025E E0                MOVX    A,@DPTR
025F FC                MOV     R4,A
0260 A3                INC     DPTR
0261 E0                MOVX    A,@DPTR
0262 FD                MOV     R5,A
0263 A3                INC     DPTR
0264 E0                MOVX    A,@DPTR
0265 FE                MOV     R6,A
0266 A3                INC     DPTR
0267 E0                MOVX    A,@DPTR
0268 FF                MOV     R7,A
0269 E4                CLR     A
026A FB                MOV     R3,A
026B FA                MOV     R2,A
026C 7980              MOV     R1,#080H
026E 783F              MOV     R0,#03FH
0270 120000      E     LCALL   ?C?FPCMP3
0273 6038              JZ      ?C0167
                                           ; SOURCE LINE # 1016
0275 900000      R     MOV     DPTR,#value_encoder
0278 E0                MOVX    A,@DPTR
0279 FC                MOV     R4,A
027A A3                INC     DPTR
027B E0                MOVX    A,@DPTR
027C FD                MOV     R5,A
027D A3                INC     DPTR
027E E0                MOVX    A,@DPTR
027F FE                MOV     R6,A
0280 A3                INC     DPTR
0281 E0                MOVX    A,@DPTR
0282 FF                MOV     R7,A
0283 EC                MOV     A,R4
0284 120000      E     LCALL   ?C?FCASTL
0287 E500        R     MOV     A,index
0289 25E0              ADD     A,ACC
028B 25E0              ADD     A,ACC
028D 2400        E     ADD     A,#LOW c_mem+044H
028F F582              MOV     DPL,A
0291 E4                CLR     A
0292 3400        E     ADDC    A,#HIGH c_mem+044H
0294 F583              MOV     DPH,A
0296 E0                MOVX    A,@DPTR
0297 F8                MOV     R0,A
0298 A3                INC     DPTR
0299 E0                MOVX    A,@DPTR
029A F9                MOV     R1,A
029B A3                INC     DPTR
029C E0                MOVX    A,@DPTR
029D FA                MOV     R2,A
029E A3                INC     DPTR
029F E0                MOVX    A,@DPTR
02A0 FB                MOV     R3,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 98  

02A1 120000      E     LCALL   ?C?FPMUL
02A4 120000      E     LCALL   ?C?CASTF
02A7 900000      R     MOV     DPTR,#value_encoder
02AA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1017
02AD         ?C0167:
                                           ; SOURCE LINE # 1019
02AD 900000      R     MOV     DPTR,#value_encoder
02B0 E0                MOVX    A,@DPTR
02B1 FC                MOV     R4,A
02B2 A3                INC     DPTR
02B3 E0                MOVX    A,@DPTR
02B4 FD                MOV     R5,A
02B5 A3                INC     DPTR
02B6 E0                MOVX    A,@DPTR
02B7 FE                MOV     R6,A
02B8 A3                INC     DPTR
02B9 E0                MOVX    A,@DPTR
02BA FF                MOV     R7,A
02BB E500        R     MOV     A,index
02BD 25E0              ADD     A,ACC
02BF 25E0              ADD     A,ACC
02C1 2400        E     ADD     A,#LOW g_meas
02C3 F582              MOV     DPL,A
02C5 E4                CLR     A
02C6 3400        E     ADDC    A,#HIGH g_meas
02C8 F583              MOV     DPH,A
02CA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1020
02CD         ?C0158:
                                           ; SOURCE LINE # 1022
02CD E500        R     MOV     A,index
02CF 14                DEC     A
02D0 7003              JNZ     $ + 5H
02D2 020000      R     LJMP    ?C0170
02D5 14                DEC     A
02D6 7003              JNZ     $ + 5H
02D8 020000      R     LJMP    ?C0171
02DB 2402              ADD     A,#02H
02DD 6003              JZ      $ + 5H
02DF 020000      R     LJMP    ?C0168
                                           ; SOURCE LINE # 1023
02E2         ?C0169:
                                           ; SOURCE LINE # 1024
02E2 E4                CLR     A
02E3 7F12              MOV     R7,#012H
02E5 FE                MOV     R6,A
02E6 FD                MOV     R5,A
02E7 FC                MOV     R4,A
02E8 900000      R     MOV     DPTR,#v_value
02EB E0                MOVX    A,@DPTR
02EC F8                MOV     R0,A
02ED A3                INC     DPTR
02EE E0                MOVX    A,@DPTR
02EF F9                MOV     R1,A
02F0 A3                INC     DPTR
02F1 E0                MOVX    A,@DPTR
02F2 FA                MOV     R2,A
02F3 A3                INC     DPTR
02F4 E0                MOVX    A,@DPTR
02F5 FB                MOV     R3,A
02F6 120000      E     LCALL   ?C?LMUL
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 99  

02F9 C004              PUSH    AR4
02FB C005              PUSH    AR5
02FD C006              PUSH    AR6
02FF C007              PUSH    AR7
0301 E4                CLR     A
0302 7F0B              MOV     R7,#0BH
0304 FE                MOV     R6,A
0305 FD                MOV     R5,A
0306 FC                MOV     R4,A
0307 900000      R     MOV     DPTR,#value_encoder
030A E0                MOVX    A,@DPTR
030B F8                MOV     R0,A
030C A3                INC     DPTR
030D E0                MOVX    A,@DPTR
030E F9                MOV     R1,A
030F A3                INC     DPTR
0310 E0                MOVX    A,@DPTR
0311 FA                MOV     R2,A
0312 A3                INC     DPTR
0313 E0                MOVX    A,@DPTR
0314 FB                MOV     R3,A
0315 120000      E     LCALL   ?C?LMUL
0318 D003              POP     AR3
031A D002              POP     AR2
031C D001              POP     AR1
031E D000              POP     AR0
0320 C3                CLR     C
0321 EF                MOV     A,R7
0322 9B                SUBB    A,R3
0323 FF                MOV     R7,A
0324 EE                MOV     A,R6
0325 9A                SUBB    A,R2
0326 FE                MOV     R6,A
0327 ED                MOV     A,R5
0328 99                SUBB    A,R1
0329 FD                MOV     R5,A
032A EC                MOV     A,R4
032B 98                SUBB    A,R0
032C FC                MOV     R4,A
032D C004              PUSH    AR4
032F C005              PUSH    AR5
0331 C006              PUSH    AR6
0333 C007              PUSH    AR7
0335 E4                CLR     A
0336 7F09              MOV     R7,#09H
0338 FE                MOV     R6,A
0339 FD                MOV     R5,A
033A FC                MOV     R4,A
033B 900000      R     MOV     DPTR,#vv_value
033E E0                MOVX    A,@DPTR
033F F8                MOV     R0,A
0340 A3                INC     DPTR
0341 E0                MOVX    A,@DPTR
0342 F9                MOV     R1,A
0343 A3                INC     DPTR
0344 E0                MOVX    A,@DPTR
0345 FA                MOV     R2,A
0346 A3                INC     DPTR
0347 E0                MOVX    A,@DPTR
0348 FB                MOV     R3,A
0349 120000      E     LCALL   ?C?LMUL
034C D003              POP     AR3
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 100 

034E D002              POP     AR2
0350 D001              POP     AR1
0352 D000              POP     AR0
0354 EF                MOV     A,R7
0355 2B                ADD     A,R3
0356 FF                MOV     R7,A
0357 EE                MOV     A,R6
0358 3A                ADDC    A,R2
0359 FE                MOV     R6,A
035A ED                MOV     A,R5
035B 39                ADDC    A,R1
035C FD                MOV     R5,A
035D EC                MOV     A,R4
035E 38                ADDC    A,R0
035F FC                MOV     R4,A
0360 C004              PUSH    AR4
0362 C005              PUSH    AR5
0364 C006              PUSH    AR6
0366 C007              PUSH    AR7
0368 E4                CLR     A
0369 7F02              MOV     R7,#02H
036B FE                MOV     R6,A
036C FD                MOV     R5,A
036D FC                MOV     R4,A
036E 900000      R     MOV     DPTR,#vvv_value
0371 E0                MOVX    A,@DPTR
0372 F8                MOV     R0,A
0373 A3                INC     DPTR
0374 E0                MOVX    A,@DPTR
0375 F9                MOV     R1,A
0376 A3                INC     DPTR
0377 E0                MOVX    A,@DPTR
0378 FA                MOV     R2,A
0379 A3                INC     DPTR
037A E0                MOVX    A,@DPTR
037B FB                MOV     R3,A
037C 120000      E     LCALL   ?C?LMUL
037F A804              MOV     R0,AR4
0381 A905              MOV     R1,AR5
0383 AA06              MOV     R2,AR6
0385 AB07              MOV     R3,AR7
0387 D007              POP     AR7
0389 D006              POP     AR6
038B D005              POP     AR5
038D D004              POP     AR4
038F C3                CLR     C
0390 EF                MOV     A,R7
0391 9B                SUBB    A,R3
0392 FF                MOV     R7,A
0393 EE                MOV     A,R6
0394 9A                SUBB    A,R2
0395 FE                MOV     R6,A
0396 ED                MOV     A,R5
0397 99                SUBB    A,R1
0398 FD                MOV     R5,A
0399 EC                MOV     A,R4
039A 98                SUBB    A,R0
039B FC                MOV     R4,A
039C 120000      E     LCALL   _filter_vel_1
039F EE                MOV     A,R6
03A0 33                RLC     A
03A1 95E0              SUBB    A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 101 

03A3 FD                MOV     R5,A
03A4 FC                MOV     R4,A
03A5 900000      R     MOV     DPTR,#speed_encoder
03A8 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1025
03AB 020000      R     LJMP    ?C0168
                                           ; SOURCE LINE # 1027
03AE         ?C0170:
                                           ; SOURCE LINE # 1028
03AE E4                CLR     A
03AF 7F12              MOV     R7,#012H
03B1 FE                MOV     R6,A
03B2 FD                MOV     R5,A
03B3 FC                MOV     R4,A
03B4 900000      R     MOV     DPTR,#v_value+04H
03B7 E0                MOVX    A,@DPTR
03B8 F8                MOV     R0,A
03B9 A3                INC     DPTR
03BA E0                MOVX    A,@DPTR
03BB F9                MOV     R1,A
03BC A3                INC     DPTR
03BD E0                MOVX    A,@DPTR
03BE FA                MOV     R2,A
03BF A3                INC     DPTR
03C0 E0                MOVX    A,@DPTR
03C1 FB                MOV     R3,A
03C2 120000      E     LCALL   ?C?LMUL
03C5 C004              PUSH    AR4
03C7 C005              PUSH    AR5
03C9 C006              PUSH    AR6
03CB C007              PUSH    AR7
03CD E4                CLR     A
03CE 7F0B              MOV     R7,#0BH
03D0 FE                MOV     R6,A
03D1 FD                MOV     R5,A
03D2 FC                MOV     R4,A
03D3 900000      R     MOV     DPTR,#value_encoder
03D6 E0                MOVX    A,@DPTR
03D7 F8                MOV     R0,A
03D8 A3                INC     DPTR
03D9 E0                MOVX    A,@DPTR
03DA F9                MOV     R1,A
03DB A3                INC     DPTR
03DC E0                MOVX    A,@DPTR
03DD FA                MOV     R2,A
03DE A3                INC     DPTR
03DF E0                MOVX    A,@DPTR
03E0 FB                MOV     R3,A
03E1 120000      E     LCALL   ?C?LMUL
03E4 D003              POP     AR3
03E6 D002              POP     AR2
03E8 D001              POP     AR1
03EA D000              POP     AR0
03EC C3                CLR     C
03ED EF                MOV     A,R7
03EE 9B                SUBB    A,R3
03EF FF                MOV     R7,A
03F0 EE                MOV     A,R6
03F1 9A                SUBB    A,R2
03F2 FE                MOV     R6,A
03F3 ED                MOV     A,R5
03F4 99                SUBB    A,R1
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 102 

03F5 FD                MOV     R5,A
03F6 EC                MOV     A,R4
03F7 98                SUBB    A,R0
03F8 FC                MOV     R4,A
03F9 C004              PUSH    AR4
03FB C005              PUSH    AR5
03FD C006              PUSH    AR6
03FF C007              PUSH    AR7
0401 E4                CLR     A
0402 7F09              MOV     R7,#09H
0404 FE                MOV     R6,A
0405 FD                MOV     R5,A
0406 FC                MOV     R4,A
0407 900000      R     MOV     DPTR,#vv_value+04H
040A E0                MOVX    A,@DPTR
040B F8                MOV     R0,A
040C A3                INC     DPTR
040D E0                MOVX    A,@DPTR
040E F9                MOV     R1,A
040F A3                INC     DPTR
0410 E0                MOVX    A,@DPTR
0411 FA                MOV     R2,A
0412 A3                INC     DPTR
0413 E0                MOVX    A,@DPTR
0414 FB                MOV     R3,A
0415 120000      E     LCALL   ?C?LMUL
0418 D003              POP     AR3
041A D002              POP     AR2
041C D001              POP     AR1
041E D000              POP     AR0
0420 EF                MOV     A,R7
0421 2B                ADD     A,R3
0422 FF                MOV     R7,A
0423 EE                MOV     A,R6
0424 3A                ADDC    A,R2
0425 FE                MOV     R6,A
0426 ED                MOV     A,R5
0427 39                ADDC    A,R1
0428 FD                MOV     R5,A
0429 EC                MOV     A,R4
042A 38                ADDC    A,R0
042B FC                MOV     R4,A
042C C004              PUSH    AR4
042E C005              PUSH    AR5
0430 C006              PUSH    AR6
0432 C007              PUSH    AR7
0434 E4                CLR     A
0435 7F02              MOV     R7,#02H
0437 FE                MOV     R6,A
0438 FD                MOV     R5,A
0439 FC                MOV     R4,A
043A 900000      R     MOV     DPTR,#vvv_value+04H
043D E0                MOVX    A,@DPTR
043E F8                MOV     R0,A
043F A3                INC     DPTR
0440 E0                MOVX    A,@DPTR
0441 F9                MOV     R1,A
0442 A3                INC     DPTR
0443 E0                MOVX    A,@DPTR
0444 FA                MOV     R2,A
0445 A3                INC     DPTR
0446 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 103 

0447 FB                MOV     R3,A
0448 120000      E     LCALL   ?C?LMUL
044B A804              MOV     R0,AR4
044D A905              MOV     R1,AR5
044F AA06              MOV     R2,AR6
0451 AB07              MOV     R3,AR7
0453 D007              POP     AR7
0455 D006              POP     AR6
0457 D005              POP     AR5
0459 D004              POP     AR4
045B C3                CLR     C
045C EF                MOV     A,R7
045D 9B                SUBB    A,R3
045E FF                MOV     R7,A
045F EE                MOV     A,R6
0460 9A                SUBB    A,R2
0461 FE                MOV     R6,A
0462 ED                MOV     A,R5
0463 99                SUBB    A,R1
0464 FD                MOV     R5,A
0465 EC                MOV     A,R4
0466 98                SUBB    A,R0
0467 FC                MOV     R4,A
0468 120000      E     LCALL   _filter_vel_2
046B EE                MOV     A,R6
046C 33                RLC     A
046D 95E0              SUBB    A,ACC
046F FD                MOV     R5,A
0470 FC                MOV     R4,A
0471 900000      R     MOV     DPTR,#speed_encoder
0474 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1029
0477 020000      R     LJMP    ?C0168
                                           ; SOURCE LINE # 1031
047A         ?C0171:
                                           ; SOURCE LINE # 1032
047A E4                CLR     A
047B 7F12              MOV     R7,#012H
047D FE                MOV     R6,A
047E FD                MOV     R5,A
047F FC                MOV     R4,A
0480 900000      R     MOV     DPTR,#v_value+08H
0483 E0                MOVX    A,@DPTR
0484 F8                MOV     R0,A
0485 A3                INC     DPTR
0486 E0                MOVX    A,@DPTR
0487 F9                MOV     R1,A
0488 A3                INC     DPTR
0489 E0                MOVX    A,@DPTR
048A FA                MOV     R2,A
048B A3                INC     DPTR
048C E0                MOVX    A,@DPTR
048D FB                MOV     R3,A
048E 120000      E     LCALL   ?C?LMUL
0491 C004              PUSH    AR4
0493 C005              PUSH    AR5
0495 C006              PUSH    AR6
0497 C007              PUSH    AR7
0499 E4                CLR     A
049A 7F0B              MOV     R7,#0BH
049C FE                MOV     R6,A
049D FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 104 

049E FC                MOV     R4,A
049F 900000      R     MOV     DPTR,#value_encoder
04A2 E0                MOVX    A,@DPTR
04A3 F8                MOV     R0,A
04A4 A3                INC     DPTR
04A5 E0                MOVX    A,@DPTR
04A6 F9                MOV     R1,A
04A7 A3                INC     DPTR
04A8 E0                MOVX    A,@DPTR
04A9 FA                MOV     R2,A
04AA A3                INC     DPTR
04AB E0                MOVX    A,@DPTR
04AC FB                MOV     R3,A
04AD 120000      E     LCALL   ?C?LMUL
04B0 D003              POP     AR3
04B2 D002              POP     AR2
04B4 D001              POP     AR1
04B6 D000              POP     AR0
04B8 C3                CLR     C
04B9 EF                MOV     A,R7
04BA 9B                SUBB    A,R3
04BB FF                MOV     R7,A
04BC EE                MOV     A,R6
04BD 9A                SUBB    A,R2
04BE FE                MOV     R6,A
04BF ED                MOV     A,R5
04C0 99                SUBB    A,R1
04C1 FD                MOV     R5,A
04C2 EC                MOV     A,R4
04C3 98                SUBB    A,R0
04C4 FC                MOV     R4,A
04C5 C004              PUSH    AR4
04C7 C005              PUSH    AR5
04C9 C006              PUSH    AR6
04CB C007              PUSH    AR7
04CD E4                CLR     A
04CE 7F09              MOV     R7,#09H
04D0 FE                MOV     R6,A
04D1 FD                MOV     R5,A
04D2 FC                MOV     R4,A
04D3 900000      R     MOV     DPTR,#vv_value+08H
04D6 E0                MOVX    A,@DPTR
04D7 F8                MOV     R0,A
04D8 A3                INC     DPTR
04D9 E0                MOVX    A,@DPTR
04DA F9                MOV     R1,A
04DB A3                INC     DPTR
04DC E0                MOVX    A,@DPTR
04DD FA                MOV     R2,A
04DE A3                INC     DPTR
04DF E0                MOVX    A,@DPTR
04E0 FB                MOV     R3,A
04E1 120000      E     LCALL   ?C?LMUL
04E4 D003              POP     AR3
04E6 D002              POP     AR2
04E8 D001              POP     AR1
04EA D000              POP     AR0
04EC EF                MOV     A,R7
04ED 2B                ADD     A,R3
04EE FF                MOV     R7,A
04EF EE                MOV     A,R6
04F0 3A                ADDC    A,R2
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 105 

04F1 FE                MOV     R6,A
04F2 ED                MOV     A,R5
04F3 39                ADDC    A,R1
04F4 FD                MOV     R5,A
04F5 EC                MOV     A,R4
04F6 38                ADDC    A,R0
04F7 FC                MOV     R4,A
04F8 C004              PUSH    AR4
04FA C005              PUSH    AR5
04FC C006              PUSH    AR6
04FE C007              PUSH    AR7
0500 E4                CLR     A
0501 7F02              MOV     R7,#02H
0503 FE                MOV     R6,A
0504 FD                MOV     R5,A
0505 FC                MOV     R4,A
0506 900000      R     MOV     DPTR,#vvv_value+08H
0509 E0                MOVX    A,@DPTR
050A F8                MOV     R0,A
050B A3                INC     DPTR
050C E0                MOVX    A,@DPTR
050D F9                MOV     R1,A
050E A3                INC     DPTR
050F E0                MOVX    A,@DPTR
0510 FA                MOV     R2,A
0511 A3                INC     DPTR
0512 E0                MOVX    A,@DPTR
0513 FB                MOV     R3,A
0514 120000      E     LCALL   ?C?LMUL
0517 A804              MOV     R0,AR4
0519 A905              MOV     R1,AR5
051B AA06              MOV     R2,AR6
051D AB07              MOV     R3,AR7
051F D007              POP     AR7
0521 D006              POP     AR6
0523 D005              POP     AR5
0525 D004              POP     AR4
0527 C3                CLR     C
0528 EF                MOV     A,R7
0529 9B                SUBB    A,R3
052A FF                MOV     R7,A
052B EE                MOV     A,R6
052C 9A                SUBB    A,R2
052D FE                MOV     R6,A
052E ED                MOV     A,R5
052F 99                SUBB    A,R1
0530 FD                MOV     R5,A
0531 EC                MOV     A,R4
0532 98                SUBB    A,R0
0533 FC                MOV     R4,A
0534 120000      E     LCALL   _filter_vel_3
0537 EE                MOV     A,R6
0538 33                RLC     A
0539 95E0              SUBB    A,ACC
053B FD                MOV     R5,A
053C FC                MOV     R4,A
053D 900000      R     MOV     DPTR,#speed_encoder
0540 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1033
                                           ; SOURCE LINE # 1034
0543         ?C0168:
                                           ; SOURCE LINE # 1036
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 106 

0543 E4                CLR     A
0544 FF                MOV     R7,A
0545 FE                MOV     R6,A
0546 7DC0              MOV     R5,#0C0H
0548 7C40              MOV     R4,#040H
054A 900000      E     MOV     DPTR,#cycle_time
054D E0                MOVX    A,@DPTR
054E F8                MOV     R0,A
054F A3                INC     DPTR
0550 E0                MOVX    A,@DPTR
0551 F9                MOV     R1,A
0552 A3                INC     DPTR
0553 E0                MOVX    A,@DPTR
0554 FA                MOV     R2,A
0555 A3                INC     DPTR
0556 E0                MOVX    A,@DPTR
0557 FB                MOV     R3,A
0558 120000      E     LCALL   ?C?FPMUL
055B C004              PUSH    AR4
055D C005              PUSH    AR5
055F C006              PUSH    AR6
0561 C007              PUSH    AR7
0563 900000      R     MOV     DPTR,#speed_encoder
0566 E0                MOVX    A,@DPTR
0567 FC                MOV     R4,A
0568 A3                INC     DPTR
0569 E0                MOVX    A,@DPTR
056A FD                MOV     R5,A
056B A3                INC     DPTR
056C E0                MOVX    A,@DPTR
056D FE                MOV     R6,A
056E A3                INC     DPTR
056F E0                MOVX    A,@DPTR
0570 FF                MOV     R7,A
0571 EC                MOV     A,R4
0572 120000      E     LCALL   ?C?FCASTL
0575 D003              POP     AR3
0577 D002              POP     AR2
0579 D001              POP     AR1
057B D000              POP     AR0
057D 120000      E     LCALL   ?C?FPDIV
0580 120000      E     LCALL   ?C?CASTF
0583 900000      R     MOV     DPTR,#speed_encoder
0586 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1037
0589 900000      R     MOV     DPTR,#speed_encoder
058C E0                MOVX    A,@DPTR
058D FC                MOV     R4,A
058E A3                INC     DPTR
058F E0                MOVX    A,@DPTR
0590 FD                MOV     R5,A
0591 A3                INC     DPTR
0592 E0                MOVX    A,@DPTR
0593 FE                MOV     R6,A
0594 A3                INC     DPTR
0595 E0                MOVX    A,@DPTR
0596 FF                MOV     R7,A
0597 E500        R     MOV     A,index
0599 25E0              ADD     A,ACC
059B 25E0              ADD     A,ACC
059D 2400        E     ADD     A,#LOW g_meas+01FH
059F F582              MOV     DPL,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 107 

05A1 E4                CLR     A
05A2 3400        E     ADDC    A,#HIGH g_meas+01FH
05A4 F583              MOV     DPH,A
05A6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1059
05A9 E500        R     MOV     A,index
05AB 25E0              ADD     A,ACC
05AD 25E0              ADD     A,ACC
05AF 2400        R     ADD     A,#LOW vv_value
05B1 F582              MOV     DPL,A
05B3 E4                CLR     A
05B4 3400        R     ADDC    A,#HIGH vv_value
05B6 F583              MOV     DPH,A
05B8 E0                MOVX    A,@DPTR
05B9 FC                MOV     R4,A
05BA A3                INC     DPTR
05BB E0                MOVX    A,@DPTR
05BC FD                MOV     R5,A
05BD A3                INC     DPTR
05BE E0                MOVX    A,@DPTR
05BF FE                MOV     R6,A
05C0 A3                INC     DPTR
05C1 E0                MOVX    A,@DPTR
05C2 FF                MOV     R7,A
05C3 E500        R     MOV     A,index
05C5 25E0              ADD     A,ACC
05C7 25E0              ADD     A,ACC
05C9 2400        R     ADD     A,#LOW vvv_value
05CB F582              MOV     DPL,A
05CD E4                CLR     A
05CE 3400        R     ADDC    A,#HIGH vvv_value
05D0 F583              MOV     DPH,A
05D2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1060
05D5 E500        R     MOV     A,index
05D7 25E0              ADD     A,ACC
05D9 25E0              ADD     A,ACC
05DB 2400        R     ADD     A,#LOW v_value
05DD F582              MOV     DPL,A
05DF E4                CLR     A
05E0 3400        R     ADDC    A,#HIGH v_value
05E2 F583              MOV     DPH,A
05E4 E0                MOVX    A,@DPTR
05E5 FC                MOV     R4,A
05E6 A3                INC     DPTR
05E7 E0                MOVX    A,@DPTR
05E8 FD                MOV     R5,A
05E9 A3                INC     DPTR
05EA E0                MOVX    A,@DPTR
05EB FE                MOV     R6,A
05EC A3                INC     DPTR
05ED E0                MOVX    A,@DPTR
05EE FF                MOV     R7,A
05EF E500        R     MOV     A,index
05F1 25E0              ADD     A,ACC
05F3 25E0              ADD     A,ACC
05F5 2400        R     ADD     A,#LOW vv_value
05F7 F582              MOV     DPL,A
05F9 E4                CLR     A
05FA 3400        R     ADDC    A,#HIGH vv_value
05FC F583              MOV     DPH,A
05FE 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 108 

                                           ; SOURCE LINE # 1061
0601 900000      R     MOV     DPTR,#value_encoder
0604 E0                MOVX    A,@DPTR
0605 FC                MOV     R4,A
0606 A3                INC     DPTR
0607 E0                MOVX    A,@DPTR
0608 FD                MOV     R5,A
0609 A3                INC     DPTR
060A E0                MOVX    A,@DPTR
060B FE                MOV     R6,A
060C A3                INC     DPTR
060D E0                MOVX    A,@DPTR
060E FF                MOV     R7,A
060F E500        R     MOV     A,index
0611 25E0              ADD     A,ACC
0613 25E0              ADD     A,ACC
0615 2400        R     ADD     A,#LOW v_value
0617 F582              MOV     DPL,A
0619 E4                CLR     A
061A 3400        R     ADDC    A,#HIGH v_value
061C F583              MOV     DPH,A
061E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1071
0621 300003      R     JNB     pos_reconstruct,$ + 6H
0624 020000      R     LJMP    ?C0150
                                           ; SOURCE LINE # 1072
0627 900000      R     MOV     DPTR,#one_time_execute
062A E0                MOVX    A,@DPTR
062B C3                CLR     C
062C 9422              SUBB    A,#022H
062E 5004              JNC     ?C0173
                                           ; SOURCE LINE # 1073
0630 E0                MOVX    A,@DPTR
0631 04                INC     A
0632 F0                MOVX    @DPTR,A
0633 22                RET     
0634         ?C0173:
                                           ; SOURCE LINE # 1074
                                           ; SOURCE LINE # 1076
0634 900000      E     MOV     DPTR,#c_mem+079H
0637 E0                MOVX    A,@DPTR
0638 606E              JZ      ?C0175
                                           ; SOURCE LINE # 1078
063A 900000      E     MOV     DPTR,#g_meas+04H
063D E0                MOVX    A,@DPTR
063E FC                MOV     R4,A
063F A3                INC     DPTR
0640 E0                MOVX    A,@DPTR
0641 FD                MOV     R5,A
0642 A3                INC     DPTR
0643 E0                MOVX    A,@DPTR
0644 FE                MOV     R6,A
0645 A3                INC     DPTR
0646 E0                MOVX    A,@DPTR
0647 FF                MOV     R7,A
0648 900000      E     MOV     DPTR,#?_calc_turns_fcn?BYTE+04H
064B 120000      E     LCALL   ?C?LSTXDATA
064E 900000      E     MOV     DPTR,#g_meas
0651 E0                MOVX    A,@DPTR
0652 FC                MOV     R4,A
0653 A3                INC     DPTR
0654 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 109 

0655 FD                MOV     R5,A
0656 A3                INC     DPTR
0657 E0                MOVX    A,@DPTR
0658 FE                MOV     R6,A
0659 A3                INC     DPTR
065A E0                MOVX    A,@DPTR
065B FF                MOV     R7,A
065C 120000      E     LCALL   _calc_turns_fcn
065F EE                MOV     A,R6
0660 33                RLC     A
0661 95E0              SUBB    A,ACC
0663 FD                MOV     R5,A
0664 FC                MOV     R4,A
0665 900000      R     MOV     DPTR,#init_rot
0668 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1080
066B E4                CLR     A
066C FF                MOV     R7,A
066D FE                MOV     R6,A
066E FD                MOV     R5,A
066F FC                MOV     R4,A
0670 900000      E     MOV     DPTR,#c_mem+044H
0673 E0                MOVX    A,@DPTR
0674 F8                MOV     R0,A
0675 A3                INC     DPTR
0676 E0                MOVX    A,@DPTR
0677 F9                MOV     R1,A
0678 A3                INC     DPTR
0679 E0                MOVX    A,@DPTR
067A FA                MOV     R2,A
067B A3                INC     DPTR
067C E0                MOVX    A,@DPTR
067D FB                MOV     R3,A
067E 120000      E     LCALL   ?C?FPCMP3
0681 5017              JNC     ?C0176
                                           ; SOURCE LINE # 1081
0683 900000      R     MOV     DPTR,#init_rot
0686 E0                MOVX    A,@DPTR
0687 FC                MOV     R4,A
0688 A3                INC     DPTR
0689 E0                MOVX    A,@DPTR
068A FD                MOV     R5,A
068B A3                INC     DPTR
068C E0                MOVX    A,@DPTR
068D FE                MOV     R6,A
068E A3                INC     DPTR
068F E0                MOVX    A,@DPTR
0690 FF                MOV     R7,A
0691 120000      E     LCALL   ?C?LNEG
0694 900000      R     MOV     DPTR,#init_rot
0697 120000      E     LCALL   ?C?LSTXDATA
069A         ?C0176:
                                           ; SOURCE LINE # 1083
069A 900000      R     MOV     DPTR,#init_rot
069D E0                MOVX    A,@DPTR
069E A3                INC     DPTR
069F E0                MOVX    A,@DPTR
06A0 A3                INC     DPTR
06A1 E0                MOVX    A,@DPTR
06A2 A3                INC     DPTR
06A3 E0                MOVX    A,@DPTR
06A4 900000      E     MOV     DPTR,#g_meas+014H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 110 

06A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1085
06A8         ?C0175:
                                           ; SOURCE LINE # 1087
06A8 7400        E     MOV     A,#LOW c_mem+044H
06AA 6401              XRL     A,#01H
06AC 4400        E     ORL     A,#HIGH c_mem+044H
06AE 602C              JZ      ?C0177
                                           ; SOURCE LINE # 1088
06B0 900000      E     MOV     DPTR,#g_meas
06B3 E0                MOVX    A,@DPTR
06B4 FC                MOV     R4,A
06B5 A3                INC     DPTR
06B6 E0                MOVX    A,@DPTR
06B7 FD                MOV     R5,A
06B8 A3                INC     DPTR
06B9 E0                MOVX    A,@DPTR
06BA FE                MOV     R6,A
06BB A3                INC     DPTR
06BC E0                MOVX    A,@DPTR
06BD FF                MOV     R7,A
06BE EC                MOV     A,R4
06BF 120000      E     LCALL   ?C?FCASTL
06C2 900000      E     MOV     DPTR,#c_mem+044H
06C5 E0                MOVX    A,@DPTR
06C6 F8                MOV     R0,A
06C7 A3                INC     DPTR
06C8 E0                MOVX    A,@DPTR
06C9 F9                MOV     R1,A
06CA A3                INC     DPTR
06CB E0                MOVX    A,@DPTR
06CC FA                MOV     R2,A
06CD A3                INC     DPTR
06CE E0                MOVX    A,@DPTR
06CF FB                MOV     R3,A
06D0 120000      E     LCALL   ?C?FPDIV
06D3 120000      E     LCALL   ?C?CASTF
06D6 900000      E     MOV     DPTR,#g_meas
06D9 120000      E     LCALL   ?C?LSTXDATA
06DC         ?C0177:
                                           ; SOURCE LINE # 1090
06DC 900000      E     MOV     DPTR,#g_meas
06DF E0                MOVX    A,@DPTR
06E0 F8                MOV     R0,A
06E1 A3                INC     DPTR
06E2 E0                MOVX    A,@DPTR
06E3 F9                MOV     R1,A
06E4 A3                INC     DPTR
06E5 E0                MOVX    A,@DPTR
06E6 FA                MOV     R2,A
06E7 A3                INC     DPTR
06E8 E0                MOVX    A,@DPTR
06E9 FB                MOV     R3,A
06EA C000              PUSH    AR0
06EC 900000      R     MOV     DPTR,#init_rot
06EF E0                MOVX    A,@DPTR
06F0 FC                MOV     R4,A
06F1 A3                INC     DPTR
06F2 E0                MOVX    A,@DPTR
06F3 FD                MOV     R5,A
06F4 A3                INC     DPTR
06F5 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 111 

06F6 FE                MOV     R6,A
06F7 A3                INC     DPTR
06F8 E0                MOVX    A,@DPTR
06F9 FF                MOV     R7,A
06FA 7810              MOV     R0,#010H
06FC 120000      E     LCALL   ?C?LSHL
06FF D000              POP     AR0
0701 EB                MOV     A,R3
0702 2F                ADD     A,R7
0703 FF                MOV     R7,A
0704 EA                MOV     A,R2
0705 3E                ADDC    A,R6
0706 FE                MOV     R6,A
0707 E9                MOV     A,R1
0708 3D                ADDC    A,R5
0709 FD                MOV     R5,A
070A E8                MOV     A,R0
070B 3C                ADDC    A,R4
070C FC                MOV     R4,A
070D 900000      E     MOV     DPTR,#g_meas
0710 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1092
0713 7400        E     MOV     A,#LOW c_mem+044H
0715 6401              XRL     A,#01H
0717 4400        E     ORL     A,#HIGH c_mem+044H
0719 602C              JZ      ?C0178
                                           ; SOURCE LINE # 1093
071B 900000      E     MOV     DPTR,#g_meas
071E E0                MOVX    A,@DPTR
071F FC                MOV     R4,A
0720 A3                INC     DPTR
0721 E0                MOVX    A,@DPTR
0722 FD                MOV     R5,A
0723 A3                INC     DPTR
0724 E0                MOVX    A,@DPTR
0725 FE                MOV     R6,A
0726 A3                INC     DPTR
0727 E0                MOVX    A,@DPTR
0728 FF                MOV     R7,A
0729 EC                MOV     A,R4
072A 120000      E     LCALL   ?C?FCASTL
072D 900000      E     MOV     DPTR,#c_mem+044H
0730 E0                MOVX    A,@DPTR
0731 F8                MOV     R0,A
0732 A3                INC     DPTR
0733 E0                MOVX    A,@DPTR
0734 F9                MOV     R1,A
0735 A3                INC     DPTR
0736 E0                MOVX    A,@DPTR
0737 FA                MOV     R2,A
0738 A3                INC     DPTR
0739 E0                MOVX    A,@DPTR
073A FB                MOV     R3,A
073B 120000      E     LCALL   ?C?FPMUL
073E 120000      E     LCALL   ?C?CASTF
0741 900000      E     MOV     DPTR,#g_meas
0744 120000      E     LCALL   ?C?LSTXDATA
0747         ?C0178:
                                           ; SOURCE LINE # 1096
0747 900000      E     MOV     DPTR,#g_meas
074A E0                MOVX    A,@DPTR
074B FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 112 

074C A3                INC     DPTR
074D E0                MOVX    A,@DPTR
074E FD                MOV     R5,A
074F A3                INC     DPTR
0750 E0                MOVX    A,@DPTR
0751 FE                MOV     R6,A
0752 A3                INC     DPTR
0753 E0                MOVX    A,@DPTR
0754 FF                MOV     R7,A
0755 900000      E     MOV     DPTR,#g_refNew
0758 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1098
075B 900000      E     MOV     DPTR,#g_ref+018H
075E E0                MOVX    A,@DPTR
075F FF                MOV     R7,A
0760 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1100
0763 D200        R     SETB    pos_reconstruct
                                           ; SOURCE LINE # 1101
                                           ; SOURCE LINE # 1102
                                           ; SOURCE LINE # 1103
0765         ?C0150:
0765 22                RET     
             ; FUNCTION _encoder_reading (END)

             ; FUNCTION analog_read_end (BEGIN)
                                           ; SOURCE LINE # 1109
0000         ?C0179:
                                           ; SOURCE LINE # 1141
0000 120000      E     LCALL   ADC_STATUS_Read
0003 EF                MOV     A,R7
0004 700A              JNZ     ?C0180
                                           ; SOURCE LINE # 1142
0006 3000F7            JNB     interrupt_flag,?C0179
                                           ; SOURCE LINE # 1143
0009 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1144
000B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1145
                                           ; SOURCE LINE # 1146
000E 80F0              SJMP    ?C0179
0010         ?C0180:
                                           ; SOURCE LINE # 1149
0010 900000      E     MOV     DPTR,#ADC_buf+01H
0013 E0                MOVX    A,@DPTR
0014 249A              ADD     A,#09AH
0016 FF                MOV     R7,A
0017 900000      E     MOV     DPTR,#ADC_buf
001A E0                MOVX    A,@DPTR
001B 34F9              ADDC    A,#0F9H
001D FE                MOV     R6,A
001E 33                RLC     A
001F 95E0              SUBB    A,ACC
0021 FD                MOV     R5,A
0022 FC                MOV     R4,A
0023 E4                CLR     A
0024 7BA0              MOV     R3,#0A0H
0026 7A07              MOV     R2,#07H
0028 F9                MOV     R1,A
0029 F8                MOV     R0,A
002A 120000      E     LCALL   ?C?LMUL
002D 7807              MOV     R0,#07H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 113 

002F 120000      E     LCALL   ?C?SLSHR
0032 900000      E     MOV     DPTR,#dev_tension
0035 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1151
0038 300005            JNB     interrupt_flag,?C0182
                                           ; SOURCE LINE # 1152
003B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1153
003D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1154
0040         ?C0182:
                                           ; SOURCE LINE # 1155
0040 900000      R     MOV     DPTR,#first_tension_valid
0043 E0                MOVX    A,@DPTR
0044 6077              JZ      ?C0183
0046 300074            JNB     tension_valid,?C0183
                                           ; SOURCE LINE # 1156
0049 900000      R     MOV     DPTR,#count
004C E0                MOVX    A,@DPTR
004D 04                INC     A
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1158
004F E0                MOVX    A,@DPTR
0050 64E8              XRL     A,#0E8H
0052 7002              JNZ     ?C0309
0054 7403              MOV     A,#03H
0056         ?C0309:
0056 7065              JNZ     ?C0183
                                           ; SOURCE LINE # 1159
0058 7F28              MOV     R7,#028H
005A 7E23              MOV     R6,#023H
005C FD                MOV     R5,A
005D FC                MOV     R4,A
005E 900000      E     MOV     DPTR,#dev_tension
0061 E0                MOVX    A,@DPTR
0062 F8                MOV     R0,A
0063 A3                INC     DPTR
0064 E0                MOVX    A,@DPTR
0065 F9                MOV     R1,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FA                MOV     R2,A
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B FB                MOV     R3,A
006C C3                CLR     C
006D 120000      E     LCALL   ?C?SLCMP
0070 500F              JNC     ?C0185
                                           ; SOURCE LINE # 1160
0072 E4                CLR     A
0073 7F40              MOV     R7,#040H
0075 7E1F              MOV     R6,#01FH
0077 FD                MOV     R5,A
0078 FC                MOV     R4,A
0079 900000      R     MOV     DPTR,#pow_tension
007C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1161
007F 8037              SJMP    ?C0186
0081         ?C0185:
                                           ; SOURCE LINE # 1162
                                           ; SOURCE LINE # 1163
0081 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 114 

0082 7FC8              MOV     R7,#0C8H
0084 7E32              MOV     R6,#032H
0086 FD                MOV     R5,A
0087 FC                MOV     R4,A
0088 900000      E     MOV     DPTR,#dev_tension
008B E0                MOVX    A,@DPTR
008C F8                MOV     R0,A
008D A3                INC     DPTR
008E E0                MOVX    A,@DPTR
008F F9                MOV     R1,A
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FA                MOV     R2,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FB                MOV     R3,A
0096 C3                CLR     C
0097 120000      E     LCALL   ?C?SLCMP
009A 500F              JNC     ?C0187
                                           ; SOURCE LINE # 1164
009C E4                CLR     A
009D 7FE0              MOV     R7,#0E0H
009F 7E2E              MOV     R6,#02EH
00A1 FD                MOV     R5,A
00A2 FC                MOV     R4,A
00A3 900000      R     MOV     DPTR,#pow_tension
00A6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1165
00A9 800D              SJMP    ?C0186
00AB         ?C0187:
                                           ; SOURCE LINE # 1167
00AB E4                CLR     A
00AC 7FC0              MOV     R7,#0C0H
00AE 7E5D              MOV     R6,#05DH
00B0 FD                MOV     R5,A
00B1 FC                MOV     R4,A
00B2 900000      R     MOV     DPTR,#pow_tension
00B5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1168
00B8         ?C0186:
                                           ; SOURCE LINE # 1170
00B8 E4                CLR     A
00B9 900000      R     MOV     DPTR,#first_tension_valid
00BC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1171
                                           ; SOURCE LINE # 1172
00BD         ?C0183:
                                           ; SOURCE LINE # 1176
00BD E4                CLR     A
00BE 7F58              MOV     R7,#058H
00C0 7E1B              MOV     R6,#01BH
00C2 FD                MOV     R5,A
00C3 FC                MOV     R4,A
00C4 900000      E     MOV     DPTR,#dev_tension
00C7 E0                MOVX    A,@DPTR
00C8 F8                MOV     R0,A
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB F9                MOV     R1,A
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE FA                MOV     R2,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 115 

00CF A3                INC     DPTR
00D0 E0                MOVX    A,@DPTR
00D1 FB                MOV     R3,A
00D2 D3                SETB    C
00D3 120000      E     LCALL   ?C?SLCMP
00D6 5003              JNC     $ + 5H
00D8 020000      R     LJMP    ?C0189
                                           ; SOURCE LINE # 1179
00DB E4                CLR     A
00DC 7FE8              MOV     R7,#0E8H
00DE 7E03              MOV     R6,#03H
00E0 FD                MOV     R5,A
00E1 FC                MOV     R4,A
00E2 900000      R     MOV     DPTR,#count2
00E5 E0                MOVX    A,@DPTR
00E6 F8                MOV     R0,A
00E7 A3                INC     DPTR
00E8 E0                MOVX    A,@DPTR
00E9 F9                MOV     R1,A
00EA A3                INC     DPTR
00EB E0                MOVX    A,@DPTR
00EC FA                MOV     R2,A
00ED A3                INC     DPTR
00EE E0                MOVX    A,@DPTR
00EF FB                MOV     R3,A
00F0 120000      E     LCALL   ?C?ULCMP
00F3 7004              JNZ     ?C0190
                                           ; SOURCE LINE # 1180
00F5 D200        E     SETB    tension_valid
                                           ; SOURCE LINE # 1181
00F7 8036              SJMP    ?C0191
00F9         ?C0190:
                                           ; SOURCE LINE # 1182
                                           ; SOURCE LINE # 1183
00F9 900000      R     MOV     DPTR,#count2
00FC E0                MOVX    A,@DPTR
00FD FC                MOV     R4,A
00FE A3                INC     DPTR
00FF E0                MOVX    A,@DPTR
0100 FD                MOV     R5,A
0101 A3                INC     DPTR
0102 E0                MOVX    A,@DPTR
0103 FE                MOV     R6,A
0104 A3                INC     DPTR
0105 E0                MOVX    A,@DPTR
0106 2401              ADD     A,#01H
0108 FF                MOV     R7,A
0109 E4                CLR     A
010A 3E                ADDC    A,R6
010B FE                MOV     R6,A
010C E4                CLR     A
010D 3D                ADDC    A,R5
010E FD                MOV     R5,A
010F E4                CLR     A
0110 3C                ADDC    A,R4
0111 FC                MOV     R4,A
0112 900000      R     MOV     DPTR,#count2
0115 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1184
0118 900000      E     MOV     DPTR,#dev_tension
011B E0                MOVX    A,@DPTR
011C FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 116 

011D A3                INC     DPTR
011E E0                MOVX    A,@DPTR
011F FD                MOV     R5,A
0120 A3                INC     DPTR
0121 E0                MOVX    A,@DPTR
0122 FE                MOV     R6,A
0123 A3                INC     DPTR
0124 E0                MOVX    A,@DPTR
0125 FF                MOV     R7,A
0126 120000      E     LCALL   _filter_voltage
0129 900000      E     MOV     DPTR,#dev_tension_f
012C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1185
012F         ?C0191:
                                           ; SOURCE LINE # 1187
012F 900000      E     MOV     DPTR,#g_mem+07BH
0132 E0                MOVX    A,@DPTR
0133 6003              JZ      ?C0192
                                           ; SOURCE LINE # 1188
0135 120000      R     LCALL   pwm_limit_search
0138         ?C0192:
                                           ; SOURCE LINE # 1191
0138 900000      E     MOV     DPTR,#ADC_buf+03H
013B E0                MOVX    A,@DPTR
013C 249A              ADD     A,#09AH
013E FF                MOV     R7,A
013F 900000      E     MOV     DPTR,#ADC_buf+02H
0142 E0                MOVX    A,@DPTR
0143 34F9              ADDC    A,#0F9H
0145 FE                MOV     R6,A
0146 33                RLC     A
0147 95E0              SUBB    A,ACC
0149 FD                MOV     R5,A
014A FC                MOV     R4,A
014B E4                CLR     A
014C 7BAB              MOV     R3,#0ABH
014E 7A64              MOV     R2,#064H
0150 F9                MOV     R1,A
0151 F8                MOV     R0,A
0152 120000      E     LCALL   ?C?LMUL
0155 780D              MOV     R0,#0DH
0157 120000      E     LCALL   ?C?SLSHR
015A 900000      E     MOV     DPTR,#pwm_sign
015D E0                MOVX    A,@DPTR
015E FD                MOV     R5,A
015F 33                RLC     A
0160 95E0              SUBB    A,ACC
0162 FC                MOV     R4,A
0163 120000      E     LCALL   ?C?IMUL
0166 EE                MOV     A,R6
0167 33                RLC     A
0168 95E0              SUBB    A,ACC
016A FD                MOV     R5,A
016B FC                MOV     R4,A
016C 120000      E     LCALL   _filter_i1
016F 900000      E     MOV     DPTR,#g_meas+0CH
0172 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1194
0175 900000      E     MOV     DPTR,#g_meas
0178 E0                MOVX    A,@DPTR
0179 FC                MOV     R4,A
017A A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 117 

017B E0                MOVX    A,@DPTR
017C FD                MOV     R5,A
017D A3                INC     DPTR
017E E0                MOVX    A,@DPTR
017F FE                MOV     R6,A
0180 A3                INC     DPTR
0181 E0                MOVX    A,@DPTR
0182 FF                MOV     R7,A
0183 900000      E     MOV     DPTR,#g_mem+035H
0186 E0                MOVX    A,@DPTR
0187 F9                MOV     R1,A
0188 F8                MOV     R0,A
0189 120000      E     LCALL   ?C?SLSHR
018C C004              PUSH    AR4
018E C005              PUSH    AR5
0190 C006              PUSH    AR6
0192 C007              PUSH    AR7
0194 900000      E     MOV     DPTR,#g_meas+01FH
0197 E0                MOVX    A,@DPTR
0198 FC                MOV     R4,A
0199 A3                INC     DPTR
019A E0                MOVX    A,@DPTR
019B FD                MOV     R5,A
019C A3                INC     DPTR
019D E0                MOVX    A,@DPTR
019E FE                MOV     R6,A
019F A3                INC     DPTR
01A0 E0                MOVX    A,@DPTR
01A1 FF                MOV     R7,A
01A2 900000      E     MOV     DPTR,#g_mem+035H
01A5 E0                MOVX    A,@DPTR
01A6 F8                MOV     R0,A
01A7 120000      E     LCALL   ?C?SLSHR
01AA 900000      E     MOV     DPTR,#?_curr_estim?BYTE+04H
01AD 120000      E     LCALL   ?C?LSTXDATA
01B0 900000      E     MOV     DPTR,#g_ref
01B3 E0                MOVX    A,@DPTR
01B4 FC                MOV     R4,A
01B5 A3                INC     DPTR
01B6 E0                MOVX    A,@DPTR
01B7 FD                MOV     R5,A
01B8 A3                INC     DPTR
01B9 E0                MOVX    A,@DPTR
01BA FE                MOV     R6,A
01BB A3                INC     DPTR
01BC E0                MOVX    A,@DPTR
01BD FF                MOV     R7,A
01BE A801              MOV     R0,AR1
01C0 120000      E     LCALL   ?C?SLSHR
01C3 900000      E     MOV     DPTR,#?_curr_estim?BYTE+08H
01C6 120000      E     LCALL   ?C?LSTXDATA
01C9 D007              POP     AR7
01CB D006              POP     AR6
01CD D005              POP     AR5
01CF D004              POP     AR4
01D1 120000      E     LCALL   _curr_estim
01D4 A804              MOV     R0,AR4
01D6 A905              MOV     R1,AR5
01D8 AA06              MOV     R2,AR6
01DA AB07              MOV     R3,AR7
01DC 900000      E     MOV     DPTR,#g_meas+0CH
01DF E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 118 

01E0 FC                MOV     R4,A
01E1 A3                INC     DPTR
01E2 E0                MOVX    A,@DPTR
01E3 FD                MOV     R5,A
01E4 A3                INC     DPTR
01E5 E0                MOVX    A,@DPTR
01E6 FE                MOV     R6,A
01E7 A3                INC     DPTR
01E8 E0                MOVX    A,@DPTR
01E9 C3                CLR     C
01EA 9B                SUBB    A,R3
01EB FF                MOV     R7,A
01EC EE                MOV     A,R6
01ED 9A                SUBB    A,R2
01EE FE                MOV     R6,A
01EF ED                MOV     A,R5
01F0 99                SUBB    A,R1
01F1 FD                MOV     R5,A
01F2 EC                MOV     A,R4
01F3 98                SUBB    A,R0
01F4 FC                MOV     R4,A
01F5 120000      E     LCALL   _filter_curr_diff
01F8 EE                MOV     A,R6
01F9 33                RLC     A
01FA 95E0              SUBB    A,ACC
01FC FD                MOV     R5,A
01FD FC                MOV     R4,A
01FE 900000      E     MOV     DPTR,#g_meas+010H
0201 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1198
0204 300005            JNB     interrupt_flag,?C0193
                                           ; SOURCE LINE # 1199
0207 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1200
0209 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1201
020C         ?C0193:
                                           ; SOURCE LINE # 1204
020C 900000      E     MOV     DPTR,#g_mem+06FH
020F E0                MOVX    A,@DPTR
0210 7004              JNZ     ?C0194
                                           ; SOURCE LINE # 1205
0212 F500        E     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1206
0214 F500        E     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1207
0216         ?C0194:
                                           ; SOURCE LINE # 1212
0216 E500        E     MOV     A,emg_1_status
0218 14                DEC     A
0219 7003              JNZ     $ + 5H
021B 020000      R     LJMP    ?C0203
021E 14                DEC     A
021F 7003              JNZ     $ + 5H
0221 020000      R     LJMP    ?C0204
0224 14                DEC     A
0225 7003              JNZ     $ + 5H
0227 020000      R     LJMP    ?C0207
022A 2403              ADD     A,#03H
022C 6003              JZ      $ + 5H
022E 020000      R     LJMP    ?C0195
                                           ; SOURCE LINE # 1213
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 119 

0231         ?C0196:
                                           ; SOURCE LINE # 1214
0231 900000      E     MOV     DPTR,#g_mem+0A9H
0234 E0                MOVX    A,@DPTR
0235 25E0              ADD     A,ACC
0237 2400        E     ADD     A,#LOW ADC_buf+04H
0239 F582              MOV     DPL,A
023B E4                CLR     A
023C 3400        E     ADDC    A,#HIGH ADC_buf+04H
023E F583              MOV     DPH,A
0240 E0                MOVX    A,@DPTR
0241 FE                MOV     R6,A
0242 A3                INC     DPTR
0243 E0                MOVX    A,@DPTR
0244 FF                MOV     R7,A
0245 EE                MOV     A,R6
0246 33                RLC     A
0247 95E0              SUBB    A,ACC
0249 8F00        R     MOV     i_aux+03H,R7
024B 8E00        R     MOV     i_aux+02H,R6
024D F500        R     MOV     i_aux+01H,A
024F F500        R     MOV     i_aux,A
                                           ; SOURCE LINE # 1215
0251 E4                CLR     A
0252 FF                MOV     R7,A
0253 FE                MOV     R6,A
0254 FD                MOV     R5,A
0255 FC                MOV     R4,A
0256 AB00        R     MOV     R3,i_aux+03H
0258 AA00        R     MOV     R2,i_aux+02H
025A A900        R     MOV     R1,i_aux+01H
025C A800        R     MOV     R0,i_aux
025E C3                CLR     C
025F 120000      E     LCALL   ?C?SLCMP
0262 5009              JNC     ?C0197
                                           ; SOURCE LINE # 1216
0264 E4                CLR     A
0265 F500        R     MOV     i_aux+03H,A
0267 F500        R     MOV     i_aux+02H,A
0269 F500        R     MOV     i_aux+01H,A
026B F500        R     MOV     i_aux,A
026D         ?C0197:
                                           ; SOURCE LINE # 1217
026D AF00        R     MOV     R7,i_aux+03H
026F AE00        R     MOV     R6,i_aux+02H
0271 AD00        R     MOV     R5,i_aux+01H
0273 AC00        R     MOV     R4,i_aux
0275 120000      E     LCALL   _filter_ch1
0278 8F00        R     MOV     i_aux+03H,R7
027A 8E00        R     MOV     i_aux+02H,R6
027C 8D00        R     MOV     i_aux+01H,R5
027E 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1218
0280 780A              MOV     R0,#0AH
0282 120000      E     LCALL   ?C?LSHL
0285 900000      E     MOV     DPTR,#g_mem+070H
0288 E0                MOVX    A,@DPTR
0289 F8                MOV     R0,A
028A A3                INC     DPTR
028B E0                MOVX    A,@DPTR
028C F9                MOV     R1,A
028D A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 120 

028E E0                MOVX    A,@DPTR
028F FA                MOV     R2,A
0290 A3                INC     DPTR
0291 E0                MOVX    A,@DPTR
0292 FB                MOV     R3,A
0293 120000      E     LCALL   ?C?ULDIV
0296 8F00        R     MOV     i_aux+03H,R7
0298 8E00        R     MOV     i_aux+02H,R6
029A 8D00        R     MOV     i_aux+01H,R5
029C 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1220
029E 300005            JNB     interrupt_flag,?C0198
                                           ; SOURCE LINE # 1221
02A1 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1222
02A3 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1223
02A6         ?C0198:
                                           ; SOURCE LINE # 1225
02A6 E4                CLR     A
02A7 FF                MOV     R7,A
02A8 FE                MOV     R6,A
02A9 FD                MOV     R5,A
02AA FC                MOV     R4,A
02AB AB00        R     MOV     R3,i_aux+03H
02AD AA00        R     MOV     R2,i_aux+02H
02AF A900        R     MOV     R1,i_aux+01H
02B1 A800        R     MOV     R0,i_aux
02B3 C3                CLR     C
02B4 120000      E     LCALL   ?C?SLCMP
02B7 500B              JNC     ?C0199
                                           ; SOURCE LINE # 1226
02B9 E4                CLR     A
02BA F500        R     MOV     i_aux+03H,A
02BC F500        R     MOV     i_aux+02H,A
02BE F500        R     MOV     i_aux+01H,A
02C0 F500        R     MOV     i_aux,A
02C2 801E              SJMP    ?C0200
02C4         ?C0199:
                                           ; SOURCE LINE # 1228
02C4 E4                CLR     A
02C5 FF                MOV     R7,A
02C6 7E04              MOV     R6,#04H
02C8 FD                MOV     R5,A
02C9 FC                MOV     R4,A
02CA AB00        R     MOV     R3,i_aux+03H
02CC AA00        R     MOV     R2,i_aux+02H
02CE A900        R     MOV     R1,i_aux+01H
02D0 A800        R     MOV     R0,i_aux
02D2 D3                SETB    C
02D3 120000      E     LCALL   ?C?SLCMP
02D6 400A              JC      ?C0200
                                           ; SOURCE LINE # 1229
02D8 E4                CLR     A
02D9 F500        R     MOV     i_aux+03H,A
02DB 750004      R     MOV     i_aux+02H,#04H
02DE F500        R     MOV     i_aux+01H,A
02E0 F500        R     MOV     i_aux,A
02E2         ?C0200:
                                           ; SOURCE LINE # 1231
02E2 AF00        R     MOV     R7,i_aux+03H
02E4 AE00        R     MOV     R6,i_aux+02H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 121 

02E6 AD00        R     MOV     R5,i_aux+01H
02E8 AC00        R     MOV     R4,i_aux
02EA 900000      E     MOV     DPTR,#g_meas+017H
02ED 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1233
02F0 200003      E     JB      interrupt_flag,$ + 6H
02F3 020000      R     LJMP    ?C0195
                                           ; SOURCE LINE # 1234
02F6 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1235
02F8 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1236
                                           ; SOURCE LINE # 1238
02FB 020000      R     LJMP    ?C0195
                                           ; SOURCE LINE # 1240
02FE         ?C0203:
                                           ; SOURCE LINE # 1241
02FE E4                CLR     A
02FF 900000      R     MOV     DPTR,#emg_counter_1
0302 F0                MOVX    @DPTR,A
0303 A3                INC     DPTR
0304 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1242
0305 FF                MOV     R7,A
0306 FE                MOV     R6,A
0307 FD                MOV     R5,A
0308 FC                MOV     R4,A
0309 900000      E     MOV     DPTR,#g_mem+070H
030C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1243
030F 750002      E     MOV     emg_1_status,#02H
                                           ; SOURCE LINE # 1245
0312 020000      R     LJMP    ?C0195
                                           ; SOURCE LINE # 1247
0315         ?C0204:
                                           ; SOURCE LINE # 1248
0315 900000      R     MOV     DPTR,#emg_counter_1+01H
0318 E0                MOVX    A,@DPTR
0319 04                INC     A
031A F0                MOVX    @DPTR,A
031B 7006              JNZ     ?C0310
031D 900000      R     MOV     DPTR,#emg_counter_1
0320 E0                MOVX    A,@DPTR
0321 04                INC     A
0322 F0                MOVX    @DPTR,A
0323         ?C0310:
                                           ; SOURCE LINE # 1249
0323 900000      R     MOV     DPTR,#emg_counter_1
0326 E0                MOVX    A,@DPTR
0327 6401              XRL     A,#01H
0329 7004              JNZ     ?C0311
032B A3                INC     DPTR
032C E0                MOVX    A,@DPTR
032D 64F4              XRL     A,#0F4H
032F         ?C0311:
032F 6003              JZ      $ + 5H
0331 020000      R     LJMP    ?C0195
                                           ; SOURCE LINE # 1250
0334 900000      R     MOV     DPTR,#emg_counter_1
0337 F0                MOVX    @DPTR,A
0338 A3                INC     DPTR
0339 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 122 

                                           ; SOURCE LINE # 1252
033A 7F01              MOV     R7,#01H
033C 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1253
033F E4                CLR     A
0340 FF                MOV     R7,A
0341 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1255
0344 300005            JNB     interrupt_flag,?C0206
                                           ; SOURCE LINE # 1256
0347 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1257
0349 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1258
034C         ?C0206:
                                           ; SOURCE LINE # 1260
034C 750003      E     MOV     emg_1_status,#03H
                                           ; SOURCE LINE # 1261
                                           ; SOURCE LINE # 1262
034F 020000      R     LJMP    ?C0195
                                           ; SOURCE LINE # 1264
0352         ?C0207:
                                           ; SOURCE LINE # 1266
0352 900000      R     MOV     DPTR,#emg_counter_1+01H
0355 E0                MOVX    A,@DPTR
0356 04                INC     A
0357 F0                MOVX    @DPTR,A
0358 7006              JNZ     ?C0312
035A 900000      R     MOV     DPTR,#emg_counter_1
035D E0                MOVX    A,@DPTR
035E 04                INC     A
035F F0                MOVX    @DPTR,A
0360         ?C0312:
                                           ; SOURCE LINE # 1267
0360 900000      E     MOV     DPTR,#g_mem+0A9H
0363 E0                MOVX    A,@DPTR
0364 FF                MOV     R7,A
0365 25E0              ADD     A,ACC
0367 2400        E     ADD     A,#LOW ADC_buf+04H
0369 F582              MOV     DPL,A
036B E4                CLR     A
036C 3400        E     ADDC    A,#HIGH ADC_buf+04H
036E F583              MOV     DPH,A
0370 E0                MOVX    A,@DPTR
0371 FC                MOV     R4,A
0372 A3                INC     DPTR
0373 E0                MOVX    A,@DPTR
0374 C3                CLR     C
0375 EC                MOV     A,R4
0376 6480              XRL     A,#080H
0378 9480              SUBB    A,#080H
037A 5010              JNC     ?C0208
                                           ; SOURCE LINE # 1268
037C EF                MOV     A,R7
037D 25E0              ADD     A,ACC
037F 2400        E     ADD     A,#LOW ADC_buf+04H
0381 F582              MOV     DPL,A
0383 E4                CLR     A
0384 3400        E     ADDC    A,#HIGH ADC_buf+04H
0386 F583              MOV     DPH,A
0388 E4                CLR     A
0389 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 123 

038A A3                INC     DPTR
038B F0                MOVX    @DPTR,A
038C         ?C0208:
                                           ; SOURCE LINE # 1269
038C 900000      E     MOV     DPTR,#g_mem+070H
038F E0                MOVX    A,@DPTR
0390 F8                MOV     R0,A
0391 A3                INC     DPTR
0392 E0                MOVX    A,@DPTR
0393 F9                MOV     R1,A
0394 A3                INC     DPTR
0395 E0                MOVX    A,@DPTR
0396 FA                MOV     R2,A
0397 A3                INC     DPTR
0398 E0                MOVX    A,@DPTR
0399 FB                MOV     R3,A
039A C000              PUSH    AR0
039C C001              PUSH    AR1
039E C002              PUSH    AR2
03A0 C003              PUSH    AR3
03A2 900000      E     MOV     DPTR,#g_mem+0A9H
03A5 E0                MOVX    A,@DPTR
03A6 25E0              ADD     A,ACC
03A8 2400        E     ADD     A,#LOW ADC_buf+04H
03AA F582              MOV     DPL,A
03AC E4                CLR     A
03AD 3400        E     ADDC    A,#HIGH ADC_buf+04H
03AF F583              MOV     DPH,A
03B1 E0                MOVX    A,@DPTR
03B2 FE                MOV     R6,A
03B3 A3                INC     DPTR
03B4 E0                MOVX    A,@DPTR
03B5 FF                MOV     R7,A
03B6 EE                MOV     A,R6
03B7 33                RLC     A
03B8 95E0              SUBB    A,ACC
03BA FD                MOV     R5,A
03BB FC                MOV     R4,A
03BC 120000      E     LCALL   _filter_ch1
03BF D003              POP     AR3
03C1 D002              POP     AR2
03C3 D001              POP     AR1
03C5 D000              POP     AR0
03C7 EB                MOV     A,R3
03C8 2F                ADD     A,R7
03C9 FF                MOV     R7,A
03CA EA                MOV     A,R2
03CB 3E                ADDC    A,R6
03CC FE                MOV     R6,A
03CD E9                MOV     A,R1
03CE 3D                ADDC    A,R5
03CF FD                MOV     R5,A
03D0 E8                MOV     A,R0
03D1 3C                ADDC    A,R4
03D2 FC                MOV     R4,A
03D3 900000      E     MOV     DPTR,#g_mem+070H
03D6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1271
03D9 300005            JNB     interrupt_flag,?C0209
                                           ; SOURCE LINE # 1272
03DC C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1273
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 124 

03DE 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1274
03E1         ?C0209:
                                           ; SOURCE LINE # 1276
03E1 900000      R     MOV     DPTR,#emg_counter_1
03E4 E0                MOVX    A,@DPTR
03E5 6403              XRL     A,#03H
03E7 7004              JNZ     ?C0313
03E9 A3                INC     DPTR
03EA E0                MOVX    A,@DPTR
03EB 64E8              XRL     A,#0E8H
03ED         ?C0313:
03ED 7039              JNZ     ?C0195
                                           ; SOURCE LINE # 1277
03EF 900000      E     MOV     DPTR,#g_mem+070H
03F2 E0                MOVX    A,@DPTR
03F3 FC                MOV     R4,A
03F4 A3                INC     DPTR
03F5 E0                MOVX    A,@DPTR
03F6 FD                MOV     R5,A
03F7 A3                INC     DPTR
03F8 E0                MOVX    A,@DPTR
03F9 FE                MOV     R6,A
03FA A3                INC     DPTR
03FB E0                MOVX    A,@DPTR
03FC FF                MOV     R7,A
03FD E4                CLR     A
03FE 7BE8              MOV     R3,#0E8H
0400 7A03              MOV     R2,#03H
0402 F9                MOV     R1,A
0403 F8                MOV     R0,A
0404 120000      E     LCALL   ?C?ULDIV
0407 900000      E     MOV     DPTR,#g_mem+070H
040A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1279
040D 300005            JNB     interrupt_flag,?C0211
                                           ; SOURCE LINE # 1280
0410 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1281
0412 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1282
0415         ?C0211:
                                           ; SOURCE LINE # 1284
0415 E4                CLR     A
0416 FF                MOV     R7,A
0417 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1285
041A E4                CLR     A
041B FF                MOV     R7,A
041C 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1287
041F E4                CLR     A
0420 900000      R     MOV     DPTR,#emg_counter_1
0423 F0                MOVX    @DPTR,A
0424 A3                INC     DPTR
0425 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1289
0426 F500        E     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1290
                                           ; SOURCE LINE # 1291
                                           ; SOURCE LINE # 1293
                                           ; SOURCE LINE # 1294
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 125 

                                           ; SOURCE LINE # 1295
0428         ?C0195:
                                           ; SOURCE LINE # 1297
0428 300005            JNB     interrupt_flag,?C0213
                                           ; SOURCE LINE # 1298
042B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1299
042D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1300
0430         ?C0213:
                                           ; SOURCE LINE # 1302
0430 E500        E     MOV     A,emg_2_status
0432 14                DEC     A
0433 7003              JNZ     $ + 5H
0435 020000      R     LJMP    ?C0221
0438 14                DEC     A
0439 7003              JNZ     $ + 5H
043B 020000      R     LJMP    ?C0223
043E 14                DEC     A
043F 7003              JNZ     $ + 5H
0441 020000      R     LJMP    ?C0226
0444 14                DEC     A
0445 7003              JNZ     $ + 5H
0447 020000      R     LJMP    ?C0231
044A 14                DEC     A
044B 7003              JNZ     $ + 5H
044D 020000      R     LJMP    ?C0233
0450 2405              ADD     A,#05H
0452 6003              JZ      $ + 5H
0454 020000      R     LJMP    ?C0214
                                           ; SOURCE LINE # 1303
0457         ?C0215:
                                           ; SOURCE LINE # 1304
0457 900000      E     MOV     DPTR,#g_mem+0A9H
045A E0                MOVX    A,@DPTR
045B FF                MOV     R7,A
045C C3                CLR     C
045D 7403              MOV     A,#03H
045F 9F                SUBB    A,R7
0460 25E0              ADD     A,ACC
0462 2400        E     ADD     A,#LOW ADC_buf
0464 F582              MOV     DPL,A
0466 E4                CLR     A
0467 3400        E     ADDC    A,#HIGH ADC_buf
0469 F583              MOV     DPH,A
046B E0                MOVX    A,@DPTR
046C FE                MOV     R6,A
046D A3                INC     DPTR
046E E0                MOVX    A,@DPTR
046F FF                MOV     R7,A
0470 EE                MOV     A,R6
0471 33                RLC     A
0472 95E0              SUBB    A,ACC
0474 8F00        R     MOV     i_aux+03H,R7
0476 8E00        R     MOV     i_aux+02H,R6
0478 F500        R     MOV     i_aux+01H,A
047A F500        R     MOV     i_aux,A
                                           ; SOURCE LINE # 1305
047C E4                CLR     A
047D FF                MOV     R7,A
047E FE                MOV     R6,A
047F FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 126 

0480 FC                MOV     R4,A
0481 AB00        R     MOV     R3,i_aux+03H
0483 AA00        R     MOV     R2,i_aux+02H
0485 A900        R     MOV     R1,i_aux+01H
0487 A800        R     MOV     R0,i_aux
0489 C3                CLR     C
048A 120000      E     LCALL   ?C?SLCMP
048D 5009              JNC     ?C0216
                                           ; SOURCE LINE # 1306
048F E4                CLR     A
0490 F500        R     MOV     i_aux+03H,A
0492 F500        R     MOV     i_aux+02H,A
0494 F500        R     MOV     i_aux+01H,A
0496 F500        R     MOV     i_aux,A
0498         ?C0216:
                                           ; SOURCE LINE # 1307
0498 AF00        R     MOV     R7,i_aux+03H
049A AE00        R     MOV     R6,i_aux+02H
049C AD00        R     MOV     R5,i_aux+01H
049E AC00        R     MOV     R4,i_aux
04A0 120000      E     LCALL   _filter_ch2
04A3 8F00        R     MOV     i_aux+03H,R7
04A5 8E00        R     MOV     i_aux+02H,R6
04A7 8D00        R     MOV     i_aux+01H,R5
04A9 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1308
04AB 780A              MOV     R0,#0AH
04AD 120000      E     LCALL   ?C?LSHL
04B0 900000      E     MOV     DPTR,#g_mem+074H
04B3 E0                MOVX    A,@DPTR
04B4 F8                MOV     R0,A
04B5 A3                INC     DPTR
04B6 E0                MOVX    A,@DPTR
04B7 F9                MOV     R1,A
04B8 A3                INC     DPTR
04B9 E0                MOVX    A,@DPTR
04BA FA                MOV     R2,A
04BB A3                INC     DPTR
04BC E0                MOVX    A,@DPTR
04BD FB                MOV     R3,A
04BE 120000      E     LCALL   ?C?ULDIV
04C1 8F00        R     MOV     i_aux+03H,R7
04C3 8E00        R     MOV     i_aux+02H,R6
04C5 8D00        R     MOV     i_aux+01H,R5
04C7 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1310
04C9 300005            JNB     interrupt_flag,?C0217
                                           ; SOURCE LINE # 1311
04CC C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1312
04CE 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1313
04D1         ?C0217:
                                           ; SOURCE LINE # 1315
04D1 E4                CLR     A
04D2 FF                MOV     R7,A
04D3 FE                MOV     R6,A
04D4 FD                MOV     R5,A
04D5 FC                MOV     R4,A
04D6 AB00        R     MOV     R3,i_aux+03H
04D8 AA00        R     MOV     R2,i_aux+02H
04DA A900        R     MOV     R1,i_aux+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 127 

04DC A800        R     MOV     R0,i_aux
04DE C3                CLR     C
04DF 120000      E     LCALL   ?C?SLCMP
04E2 500B              JNC     ?C0218
                                           ; SOURCE LINE # 1316
04E4 E4                CLR     A
04E5 F500        R     MOV     i_aux+03H,A
04E7 F500        R     MOV     i_aux+02H,A
04E9 F500        R     MOV     i_aux+01H,A
04EB F500        R     MOV     i_aux,A
04ED 801E              SJMP    ?C0219
04EF         ?C0218:
                                           ; SOURCE LINE # 1318
04EF E4                CLR     A
04F0 FF                MOV     R7,A
04F1 7E04              MOV     R6,#04H
04F3 FD                MOV     R5,A
04F4 FC                MOV     R4,A
04F5 AB00        R     MOV     R3,i_aux+03H
04F7 AA00        R     MOV     R2,i_aux+02H
04F9 A900        R     MOV     R1,i_aux+01H
04FB A800        R     MOV     R0,i_aux
04FD D3                SETB    C
04FE 120000      E     LCALL   ?C?SLCMP
0501 400A              JC      ?C0219
                                           ; SOURCE LINE # 1319
0503 E4                CLR     A
0504 F500        R     MOV     i_aux+03H,A
0506 750004      R     MOV     i_aux+02H,#04H
0509 F500        R     MOV     i_aux+01H,A
050B F500        R     MOV     i_aux,A
050D         ?C0219:
                                           ; SOURCE LINE # 1321
050D AF00        R     MOV     R7,i_aux+03H
050F AE00        R     MOV     R6,i_aux+02H
0511 AD00        R     MOV     R5,i_aux+01H
0513 AC00        R     MOV     R4,i_aux
0515 900000      E     MOV     DPTR,#g_meas+01BH
0518 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1323
051B 020000      R     LJMP    ?C0214
                                           ; SOURCE LINE # 1325
051E         ?C0221:
                                           ; SOURCE LINE # 1326
051E E4                CLR     A
051F 900000      R     MOV     DPTR,#emg_counter_2
0522 F0                MOVX    @DPTR,A
0523 A3                INC     DPTR
0524 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1327
0525 FF                MOV     R7,A
0526 FE                MOV     R6,A
0527 FD                MOV     R5,A
0528 FC                MOV     R4,A
0529 900000      E     MOV     DPTR,#g_mem+074H
052C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1329
052F 300005            JNB     interrupt_flag,?C0222
                                           ; SOURCE LINE # 1330
0532 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1331
0534 120000      R     LCALL   interrupt_manager
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 128 

                                           ; SOURCE LINE # 1332
0537         ?C0222:
                                           ; SOURCE LINE # 1334
0537 750004      E     MOV     emg_2_status,#04H
                                           ; SOURCE LINE # 1335
053A 020000      R     LJMP    ?C0214
                                           ; SOURCE LINE # 1337
053D         ?C0223:
                                           ; SOURCE LINE # 1338
053D 900000      R     MOV     DPTR,#emg_counter_2+01H
0540 E0                MOVX    A,@DPTR
0541 04                INC     A
0542 F0                MOVX    @DPTR,A
0543 7006              JNZ     ?C0314
0545 900000      R     MOV     DPTR,#emg_counter_2
0548 E0                MOVX    A,@DPTR
0549 04                INC     A
054A F0                MOVX    @DPTR,A
054B         ?C0314:
                                           ; SOURCE LINE # 1339
054B 900000      R     MOV     DPTR,#emg_counter_2
054E E0                MOVX    A,@DPTR
054F 6401              XRL     A,#01H
0551 7004              JNZ     ?C0315
0553 A3                INC     DPTR
0554 E0                MOVX    A,@DPTR
0555 64F4              XRL     A,#0F4H
0557         ?C0315:
0557 6003              JZ      $ + 5H
0559 020000      R     LJMP    ?C0214
                                           ; SOURCE LINE # 1340
055C 900000      R     MOV     DPTR,#emg_counter_2
055F F0                MOVX    @DPTR,A
0560 A3                INC     DPTR
0561 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1342
0562 7F01              MOV     R7,#01H
0564 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1343
0567 E4                CLR     A
0568 FF                MOV     R7,A
0569 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1345
056C 300005            JNB     interrupt_flag,?C0225
                                           ; SOURCE LINE # 1346
056F C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1347
0571 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1348
0574         ?C0225:
                                           ; SOURCE LINE # 1350
0574 750003      E     MOV     emg_2_status,#03H
                                           ; SOURCE LINE # 1351
                                           ; SOURCE LINE # 1352
0577 020000      R     LJMP    ?C0214
                                           ; SOURCE LINE # 1354
057A         ?C0226:
                                           ; SOURCE LINE # 1356
057A 900000      R     MOV     DPTR,#emg_counter_2+01H
057D E0                MOVX    A,@DPTR
057E 04                INC     A
057F F0                MOVX    @DPTR,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 129 

0580 7006              JNZ     ?C0316
0582 900000      R     MOV     DPTR,#emg_counter_2
0585 E0                MOVX    A,@DPTR
0586 04                INC     A
0587 F0                MOVX    @DPTR,A
0588         ?C0316:
                                           ; SOURCE LINE # 1357
0588 900000      E     MOV     DPTR,#g_mem+0A9H
058B E0                MOVX    A,@DPTR
058C FF                MOV     R7,A
058D C3                CLR     C
058E 7403              MOV     A,#03H
0590 9F                SUBB    A,R7
0591 FF                MOV     R7,A
0592 25E0              ADD     A,ACC
0594 2400        E     ADD     A,#LOW ADC_buf
0596 F582              MOV     DPL,A
0598 E4                CLR     A
0599 3400        E     ADDC    A,#HIGH ADC_buf
059B F583              MOV     DPH,A
059D E0                MOVX    A,@DPTR
059E FC                MOV     R4,A
059F A3                INC     DPTR
05A0 E0                MOVX    A,@DPTR
05A1 C3                CLR     C
05A2 EC                MOV     A,R4
05A3 6480              XRL     A,#080H
05A5 9480              SUBB    A,#080H
05A7 5010              JNC     ?C0227
                                           ; SOURCE LINE # 1358
05A9 EF                MOV     A,R7
05AA 25E0              ADD     A,ACC
05AC 2400        E     ADD     A,#LOW ADC_buf
05AE F582              MOV     DPL,A
05B0 E4                CLR     A
05B1 3400        E     ADDC    A,#HIGH ADC_buf
05B3 F583              MOV     DPH,A
05B5 E4                CLR     A
05B6 F0                MOVX    @DPTR,A
05B7 A3                INC     DPTR
05B8 F0                MOVX    @DPTR,A
05B9         ?C0227:
                                           ; SOURCE LINE # 1359
05B9 900000      E     MOV     DPTR,#g_mem+074H
05BC E0                MOVX    A,@DPTR
05BD F8                MOV     R0,A
05BE A3                INC     DPTR
05BF E0                MOVX    A,@DPTR
05C0 F9                MOV     R1,A
05C1 A3                INC     DPTR
05C2 E0                MOVX    A,@DPTR
05C3 FA                MOV     R2,A
05C4 A3                INC     DPTR
05C5 E0                MOVX    A,@DPTR
05C6 FB                MOV     R3,A
05C7 C000              PUSH    AR0
05C9 C001              PUSH    AR1
05CB C002              PUSH    AR2
05CD C003              PUSH    AR3
05CF 900000      E     MOV     DPTR,#g_mem+0A9H
05D2 E0                MOVX    A,@DPTR
05D3 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 130 

05D4 C3                CLR     C
05D5 7403              MOV     A,#03H
05D7 9F                SUBB    A,R7
05D8 25E0              ADD     A,ACC
05DA 2400        E     ADD     A,#LOW ADC_buf
05DC F582              MOV     DPL,A
05DE E4                CLR     A
05DF 3400        E     ADDC    A,#HIGH ADC_buf
05E1 F583              MOV     DPH,A
05E3 E0                MOVX    A,@DPTR
05E4 FE                MOV     R6,A
05E5 A3                INC     DPTR
05E6 E0                MOVX    A,@DPTR
05E7 FF                MOV     R7,A
05E8 EE                MOV     A,R6
05E9 33                RLC     A
05EA 95E0              SUBB    A,ACC
05EC FD                MOV     R5,A
05ED FC                MOV     R4,A
05EE 120000      E     LCALL   _filter_ch2
05F1 D003              POP     AR3
05F3 D002              POP     AR2
05F5 D001              POP     AR1
05F7 D000              POP     AR0
05F9 EB                MOV     A,R3
05FA 2F                ADD     A,R7
05FB FF                MOV     R7,A
05FC EA                MOV     A,R2
05FD 3E                ADDC    A,R6
05FE FE                MOV     R6,A
05FF E9                MOV     A,R1
0600 3D                ADDC    A,R5
0601 FD                MOV     R5,A
0602 E8                MOV     A,R0
0603 3C                ADDC    A,R4
0604 FC                MOV     R4,A
0605 900000      E     MOV     DPTR,#g_mem+074H
0608 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1361
060B 300005            JNB     interrupt_flag,?C0228
                                           ; SOURCE LINE # 1362
060E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1363
0610 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1364
0613         ?C0228:
                                           ; SOURCE LINE # 1366
0613 900000      R     MOV     DPTR,#emg_counter_2
0616 E0                MOVX    A,@DPTR
0617 6403              XRL     A,#03H
0619 7004              JNZ     ?C0317
061B A3                INC     DPTR
061C E0                MOVX    A,@DPTR
061D 64E8              XRL     A,#0E8H
061F         ?C0317:
061F 6003              JZ      $ + 5H
0621 020000      R     LJMP    ?C0214
                                           ; SOURCE LINE # 1367
0624 900000      E     MOV     DPTR,#g_mem+074H
0627 E0                MOVX    A,@DPTR
0628 FC                MOV     R4,A
0629 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 131 

062A E0                MOVX    A,@DPTR
062B FD                MOV     R5,A
062C A3                INC     DPTR
062D E0                MOVX    A,@DPTR
062E FE                MOV     R6,A
062F A3                INC     DPTR
0630 E0                MOVX    A,@DPTR
0631 FF                MOV     R7,A
0632 E4                CLR     A
0633 7BE8              MOV     R3,#0E8H
0635 7A03              MOV     R2,#03H
0637 F9                MOV     R1,A
0638 F8                MOV     R0,A
0639 120000      E     LCALL   ?C?ULDIV
063C 900000      E     MOV     DPTR,#g_mem+074H
063F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1369
0642 E4                CLR     A
0643 FF                MOV     R7,A
0644 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1370
0647 E4                CLR     A
0648 FF                MOV     R7,A
0649 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1372
064C E4                CLR     A
064D 900000      R     MOV     DPTR,#emg_counter_2
0650 F0                MOVX    @DPTR,A
0651 A3                INC     DPTR
0652 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1374
0653 300005            JNB     interrupt_flag,?C0230
                                           ; SOURCE LINE # 1375
0656 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1376
0658 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1377
065B         ?C0230:
                                           ; SOURCE LINE # 1379
065B 750005      E     MOV     emg_2_status,#05H
                                           ; SOURCE LINE # 1380
                                           ; SOURCE LINE # 1381
065E 020000      R     LJMP    ?C0214
                                           ; SOURCE LINE # 1383
0661         ?C0231:
                                           ; SOURCE LINE # 1384
0661 E500        E     MOV     A,emg_1_status
0663 6003              JZ      $ + 5H
0665 020000      R     LJMP    ?C0214
                                           ; SOURCE LINE # 1385
0668 750002      E     MOV     emg_2_status,#02H
                                           ; SOURCE LINE # 1386
066B 807E              SJMP    ?C0214
                                           ; SOURCE LINE # 1388
066D         ?C0233:
                                           ; SOURCE LINE # 1389
066D 900000      R     MOV     DPTR,#emg_counter_2+01H
0670 E0                MOVX    A,@DPTR
0671 04                INC     A
0672 F0                MOVX    @DPTR,A
0673 7006              JNZ     ?C0318
0675 900000      R     MOV     DPTR,#emg_counter_2
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 132 

0678 E0                MOVX    A,@DPTR
0679 04                INC     A
067A F0                MOVX    @DPTR,A
067B         ?C0318:
                                           ; SOURCE LINE # 1390
067B 900000      R     MOV     DPTR,#emg_counter_2
067E E0                MOVX    A,@DPTR
067F 6401              XRL     A,#01H
0681 7004              JNZ     ?C0319
0683 A3                INC     DPTR
0684 E0                MOVX    A,@DPTR
0685 64F4              XRL     A,#0F4H
0687         ?C0319:
0687 7062              JNZ     ?C0214
                                           ; SOURCE LINE # 1391
0689 900000      R     MOV     DPTR,#emg_counter_2
068C F0                MOVX    @DPTR,A
068D A3                INC     DPTR
068E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1393
068F 300005            JNB     interrupt_flag,?C0235
                                           ; SOURCE LINE # 1394
0692 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1395
0694 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1396
0697         ?C0235:
                                           ; SOURCE LINE # 1399
0697 900000      E     MOV     DPTR,#c_mem+033H
069A E0                MOVX    A,@DPTR
069B FF                MOV     R7,A
069C 6402              XRL     A,#02H
069E 600E              JZ      ?C0237
06A0 EF                MOV     A,R7
06A1 6403              XRL     A,#03H
06A3 6009              JZ      ?C0237
06A5 EF                MOV     A,R7
06A6 6404              XRL     A,#04H
06A8 6004              JZ      ?C0237
06AA EF                MOV     A,R7
06AB B4053A            CJNE    A,#05H,?C0236
06AE         ?C0237:
                                           ; SOURCE LINE # 1402
                                           ; SOURCE LINE # 1403
06AE 900000      E     MOV     DPTR,#c_mem+034H
06B1 E0                MOVX    A,@DPTR
06B2 7028              JNZ     ?C0238
                                           ; SOURCE LINE # 1404
06B4 900000      E     MOV     DPTR,#g_meas
06B7 E0                MOVX    A,@DPTR
06B8 FC                MOV     R4,A
06B9 A3                INC     DPTR
06BA E0                MOVX    A,@DPTR
06BB FD                MOV     R5,A
06BC A3                INC     DPTR
06BD E0                MOVX    A,@DPTR
06BE FE                MOV     R6,A
06BF A3                INC     DPTR
06C0 E0                MOVX    A,@DPTR
06C1 FF                MOV     R7,A
06C2 900000      E     MOV     DPTR,#g_ref
06C5 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 133 

                                           ; SOURCE LINE # 1405
06C8 900000      E     MOV     DPTR,#g_meas+04H
06CB E0                MOVX    A,@DPTR
06CC FC                MOV     R4,A
06CD A3                INC     DPTR
06CE E0                MOVX    A,@DPTR
06CF FD                MOV     R5,A
06D0 A3                INC     DPTR
06D1 E0                MOVX    A,@DPTR
06D2 FE                MOV     R6,A
06D3 A3                INC     DPTR
06D4 E0                MOVX    A,@DPTR
06D5 FF                MOV     R7,A
06D6 900000      E     MOV     DPTR,#g_ref+04H
06D9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1406
06DC         ?C0238:
                                           ; SOURCE LINE # 1407
06DC 900000      E     MOV     DPTR,#c_mem+032H
06DF E0                MOVX    A,@DPTR
06E0 FF                MOV     R7,A
06E1 900000      E     MOV     DPTR,#g_ref+018H
06E4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1408
06E5 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1409
06E8         ?C0236:
                                           ; SOURCE LINE # 1411
06E8 E4                CLR     A
06E9 F500        E     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1412
                                           ; SOURCE LINE # 1413
                                           ; SOURCE LINE # 1415
                                           ; SOURCE LINE # 1416
                                           ; SOURCE LINE # 1417
06EB         ?C0214:
                                           ; SOURCE LINE # 1419
06EB 300068            JNB     interrupt_flag,?C0241
                                           ; SOURCE LINE # 1420
06EE C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1421
06F0 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1422
                                           ; SOURCE LINE # 1423
06F3 8061              SJMP    ?C0241
06F5         ?C0189:
                                           ; SOURCE LINE # 1424
                                           ; SOURCE LINE # 1426
06F5 750001      E     MOV     emg_1_status,#01H
                                           ; SOURCE LINE # 1427
06F8 750001      E     MOV     emg_2_status,#01H
                                           ; SOURCE LINE # 1429
06FB C200        E     CLR     tension_valid
                                           ; SOURCE LINE # 1431
06FD 7F01              MOV     R7,#01H
06FF 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1433
0702 E4                CLR     A
0703 FF                MOV     R7,A
0704 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1435
0707 300005            JNB     interrupt_flag,?C0242
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 134 

                                           ; SOURCE LINE # 1436
070A C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1437
070C 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1438
070F         ?C0242:
                                           ; SOURCE LINE # 1440
070F 900000      E     MOV     DPTR,#c_mem+06FH
0712 E0                MOVX    A,@DPTR
0713 6020              JZ      ?C0243
                                           ; SOURCE LINE # 1441
0715 900000      E     MOV     DPTR,#c_mem+033H
0718 E0                MOVX    A,@DPTR
0719 FF                MOV     R7,A
071A 6402              XRL     A,#02H
071C 600E              JZ      ?C0245
071E EF                MOV     A,R7
071F 6403              XRL     A,#03H
0721 6009              JZ      ?C0245
0723 EF                MOV     A,R7
0724 6404              XRL     A,#04H
0726 6004              JZ      ?C0245
0728 EF                MOV     A,R7
0729 B40509            CJNE    A,#05H,?C0243
072C         ?C0245:
                                           ; SOURCE LINE # 1444
                                           ; SOURCE LINE # 1445
072C E4                CLR     A
072D 900000      E     MOV     DPTR,#g_ref+018H
0730 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1446
0731 FF                MOV     R7,A
0732 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1447
                                           ; SOURCE LINE # 1448
0735         ?C0243:
                                           ; SOURCE LINE # 1451
0735 E4                CLR     A
0736 FF                MOV     R7,A
0737 FE                MOV     R6,A
0738 FD                MOV     R5,A
0739 FC                MOV     R4,A
073A 900000      E     MOV     DPTR,#g_meas+0CH
073D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1454
0740 E4                CLR     A
0741 FF                MOV     R7,A
0742 FE                MOV     R6,A
0743 FD                MOV     R5,A
0744 FC                MOV     R4,A
0745 900000      E     MOV     DPTR,#g_meas+017H
0748 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1455
074B E4                CLR     A
074C FF                MOV     R7,A
074D FE                MOV     R6,A
074E FD                MOV     R5,A
074F FC                MOV     R4,A
0750 900000      E     MOV     DPTR,#g_meas+01BH
0753 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1457
0756         ?C0241:
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 135 

                                           ; SOURCE LINE # 1459
0756 900000      R     MOV     DPTR,#first_tension_valid
0759 E0                MOVX    A,@DPTR
075A 6003              JZ      $ + 5H
075C 020000      R     LJMP    ?C0246
075F 200003      E     JB      tension_valid,$ + 6H
0762 020000      R     LJMP    ?C0246
0765 E500        E     MOV     A,emg_1_status
0767 6003              JZ      $ + 5H
0769 020000      R     LJMP    ?C0246
076C E500        E     MOV     A,emg_2_status
076E 6003              JZ      $ + 5H
0770 020000      R     LJMP    ?C0246
                                           ; SOURCE LINE # 1460
0773 900000      E     MOV     DPTR,#dev_tension
0776 E0                MOVX    A,@DPTR
0777 FC                MOV     R4,A
0778 A3                INC     DPTR
0779 E0                MOVX    A,@DPTR
077A FD                MOV     R5,A
077B A3                INC     DPTR
077C E0                MOVX    A,@DPTR
077D FE                MOV     R6,A
077E A3                INC     DPTR
077F E0                MOVX    A,@DPTR
0780 FF                MOV     R7,A
0781 120000      E     LCALL   _filter_voltage
0784 900000      E     MOV     DPTR,#dev_tension_f
0787 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1461
078A 900000      R     MOV     DPTR,#pow_tension
078D E0                MOVX    A,@DPTR
078E FC                MOV     R4,A
078F A3                INC     DPTR
0790 E0                MOVX    A,@DPTR
0791 FD                MOV     R5,A
0792 A3                INC     DPTR
0793 E0                MOVX    A,@DPTR
0794 FE                MOV     R6,A
0795 A3                INC     DPTR
0796 E0                MOVX    A,@DPTR
0797 FF                MOV     R7,A
0798 EC                MOV     A,R4
0799 120000      E     LCALL   ?C?FCASTL
079C 7B1F              MOV     R3,#01FH
079E 7A85              MOV     R2,#085H
07A0 796B              MOV     R1,#06BH
07A2 783F              MOV     R0,#03FH
07A4 120000      E     LCALL   ?C?FPMUL
07A7 C004              PUSH    AR4
07A9 C005              PUSH    AR5
07AB C006              PUSH    AR6
07AD C007              PUSH    AR7
07AF 900000      E     MOV     DPTR,#dev_tension_f
07B2 E0                MOVX    A,@DPTR
07B3 FC                MOV     R4,A
07B4 A3                INC     DPTR
07B5 E0                MOVX    A,@DPTR
07B6 FD                MOV     R5,A
07B7 A3                INC     DPTR
07B8 E0                MOVX    A,@DPTR
07B9 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 136 

07BA A3                INC     DPTR
07BB E0                MOVX    A,@DPTR
07BC FF                MOV     R7,A
07BD EC                MOV     A,R4
07BE 120000      E     LCALL   ?C?FCASTL
07C1 A804              MOV     R0,AR4
07C3 A905              MOV     R1,AR5
07C5 AA06              MOV     R2,AR6
07C7 AB07              MOV     R3,AR7
07C9 D007              POP     AR7
07CB D006              POP     AR6
07CD D005              POP     AR5
07CF D004              POP     AR4
07D1 120000      E     LCALL   ?C?FPCMP3
07D4 600E              JZ      ?C0247
07D6 400C              JC      ?C0247
                                           ; SOURCE LINE # 1463
07D8 7F01              MOV     R7,#01H
07DA 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1466
07DD E4                CLR     A
07DE FF                MOV     R7,A
07DF 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1467
07E2 8013              SJMP    ?C0246
07E4         ?C0247:
                                           ; SOURCE LINE # 1468
                                           ; SOURCE LINE # 1470
07E4 E4                CLR     A
07E5 FF                MOV     R7,A
07E6 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1473
07E9 7F01              MOV     R7,#01H
07EB 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1476
07EE E4                CLR     A
07EF 900000      E     MOV     DPTR,#g_refNew+018H
07F2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1477
07F3 FF                MOV     R7,A
07F4 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1478
                                           ; SOURCE LINE # 1479
07F7         ?C0246:
                                           ; SOURCE LINE # 1481
07F7 300005            JNB     interrupt_flag,?C0250
                                           ; SOURCE LINE # 1482
07FA C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1483
07FC 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1484
                                           ; SOURCE LINE # 1485
07FF         ?C0250:
07FF 22                RET     
             ; FUNCTION analog_read_end (END)

             ; FUNCTION overcurrent_control (BEGIN)
                                           ; SOURCE LINE # 1491
                                           ; SOURCE LINE # 1492
0000 900000      E     MOV     DPTR,#c_mem+069H
0003 E0                MOVX    A,@DPTR
0004 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 137 

0005 A3                INC     DPTR
0006 E0                MOVX    A,@DPTR
0007 FF                MOV     R7,A
0008 4E                ORL     A,R6
0009 606B              JZ      ?C0258
                                           ; SOURCE LINE # 1494
000B EE                MOV     A,R6
000C 33                RLC     A
000D 95E0              SUBB    A,ACC
000F FD                MOV     R5,A
0010 FC                MOV     R4,A
0011 900000      E     MOV     DPTR,#g_meas+0CH
0014 E0                MOVX    A,@DPTR
0015 F8                MOV     R0,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 F9                MOV     R1,A
0019 A3                INC     DPTR
001A E0                MOVX    A,@DPTR
001B FA                MOV     R2,A
001C A3                INC     DPTR
001D E0                MOVX    A,@DPTR
001E FB                MOV     R3,A
001F D3                SETB    C
0020 120000      E     LCALL   ?C?SLCMP
0023 4008              JC      ?C0252
                                           ; SOURCE LINE # 1496
0025 900000      E     MOV     DPTR,#dev_pwm_limit
0028 E0                MOVX    A,@DPTR
0029 14                DEC     A
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1498
002B 802D              SJMP    ?C0253
002D         ?C0252:
002D 900000      E     MOV     DPTR,#c_mem+06AH
0030 E0                MOVX    A,@DPTR
0031 24F6              ADD     A,#0F6H
0033 FF                MOV     R7,A
0034 900000      E     MOV     DPTR,#c_mem+069H
0037 E0                MOVX    A,@DPTR
0038 34FF              ADDC    A,#0FFH
003A FE                MOV     R6,A
003B 33                RLC     A
003C 95E0              SUBB    A,ACC
003E FD                MOV     R5,A
003F FC                MOV     R4,A
0040 900000      E     MOV     DPTR,#g_meas+0CH
0043 E0                MOVX    A,@DPTR
0044 F8                MOV     R0,A
0045 A3                INC     DPTR
0046 E0                MOVX    A,@DPTR
0047 F9                MOV     R1,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FA                MOV     R2,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D FB                MOV     R3,A
004E C3                CLR     C
004F 120000      E     LCALL   ?C?SLCMP
0052 5006              JNC     ?C0253
                                           ; SOURCE LINE # 1500
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 138 

0054 900000      E     MOV     DPTR,#dev_pwm_limit
0057 E0                MOVX    A,@DPTR
0058 04                INC     A
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1501
005A         ?C0253:
                                           ; SOURCE LINE # 1504
005A 900000      E     MOV     DPTR,#dev_pwm_limit
005D E0                MOVX    A,@DPTR
005E FF                MOV     R7,A
005F C3                CLR     C
0060 9400              SUBB    A,#00H
0062 5003              JNC     ?C0255
                                           ; SOURCE LINE # 1505
0064 E4                CLR     A
0065 F0                MOVX    @DPTR,A
0066 22                RET     
0067         ?C0255:
                                           ; SOURCE LINE # 1507
0067 900000      E     MOV     DPTR,#dev_pwm_sat
006A E0                MOVX    A,@DPTR
006B FE                MOV     R6,A
006C EF                MOV     A,R7
006D D3                SETB    C
006E 9E                SUBB    A,R6
006F 4005              JC      ?C0258
                                           ; SOURCE LINE # 1508
0071 900000      E     MOV     DPTR,#dev_pwm_limit
0074 EE                MOV     A,R6
0075 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1509
                                           ; SOURCE LINE # 1510
0076         ?C0258:
0076 22                RET     
             ; FUNCTION overcurrent_control (END)

             ; FUNCTION pwm_limit_search (BEGIN)
                                           ; SOURCE LINE # 1516
                                           ; SOURCE LINE # 1519
0000 750063      R     MOV     max_tension,#063H
0003 75009C      R     MOV     max_tension+01H,#09CH
                                           ; SOURCE LINE # 1520
0006 75002C      R     MOV     min_tension,#02CH
0009 7500EC      R     MOV     min_tension+01H,#0ECH
                                           ; SOURCE LINE # 1522
000C AE00        R     MOV     R6,max_tension
000E AF00        R     MOV     R7,max_tension+01H
0010 E4                CLR     A
0011 FC                MOV     R4,A
0012 FD                MOV     R5,A
0013 900000      E     MOV     DPTR,#dev_tension
0016 E0                MOVX    A,@DPTR
0017 F8                MOV     R0,A
0018 A3                INC     DPTR
0019 E0                MOVX    A,@DPTR
001A F9                MOV     R1,A
001B A3                INC     DPTR
001C E0                MOVX    A,@DPTR
001D FA                MOV     R2,A
001E A3                INC     DPTR
001F E0                MOVX    A,@DPTR
0020 FB                MOV     R3,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 139 

0021 D3                SETB    C
0022 120000      E     LCALL   ?C?SLCMP
0025 4006              JC      ?C0259
                                           ; SOURCE LINE # 1523
0027 E4                CLR     A
0028 900000      E     MOV     DPTR,#dev_pwm_sat
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1524
002C 22                RET     
002D         ?C0259:
002D AE00        R     MOV     R6,min_tension
002F AF00        R     MOV     R7,min_tension+01H
0031 E4                CLR     A
0032 FC                MOV     R4,A
0033 FD                MOV     R5,A
0034 900000      E     MOV     DPTR,#dev_tension
0037 E0                MOVX    A,@DPTR
0038 F8                MOV     R0,A
0039 A3                INC     DPTR
003A E0                MOVX    A,@DPTR
003B F9                MOV     R1,A
003C A3                INC     DPTR
003D E0                MOVX    A,@DPTR
003E FA                MOV     R2,A
003F A3                INC     DPTR
0040 E0                MOVX    A,@DPTR
0041 FB                MOV     R3,A
0042 C3                CLR     C
0043 120000      E     LCALL   ?C?SLCMP
0046 5007              JNC     ?C0261
                                           ; SOURCE LINE # 1525
0048 900000      E     MOV     DPTR,#dev_pwm_sat
004B 7464              MOV     A,#064H
004D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1526
004E 22                RET     
004F         ?C0261:
                                           ; SOURCE LINE # 1527
004F AE00        R     MOV     R6,min_tension
0051 AF00        R     MOV     R7,min_tension+01H
0053 AB07              MOV     R3,AR7
0055 AA06              MOV     R2,AR6
0057 E4                CLR     A
0058 900000      E     MOV     DPTR,#dev_tension
005B E0                MOVX    A,@DPTR
005C FC                MOV     R4,A
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F FD                MOV     R5,A
0060 A3                INC     DPTR
0061 E0                MOVX    A,@DPTR
0062 FE                MOV     R6,A
0063 A3                INC     DPTR
0064 E0                MOVX    A,@DPTR
0065 C3                CLR     C
0066 9B                SUBB    A,R3
0067 FF                MOV     R7,A
0068 EE                MOV     A,R6
0069 9A                SUBB    A,R2
006A FE                MOV     R6,A
006B ED                MOV     A,R5
006C 9400              SUBB    A,#00H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 140 

006E FD                MOV     R5,A
006F EC                MOV     A,R4
0070 9400              SUBB    A,#00H
0072 FC                MOV     R4,A
0073 7809              MOV     R0,#09H
0075 120000      E     LCALL   ?C?SLSHR
0078 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 1528
007A 7400        R     MOV     A,#LOW pwm_preload_values
007C 2F                ADD     A,R7
007D F582              MOV     DPL,A
007F E4                CLR     A
0080 3400        R     ADDC    A,#HIGH pwm_preload_values
0082 F583              MOV     DPH,A
0084 E0                MOVX    A,@DPTR
0085 900000      E     MOV     DPTR,#dev_pwm_sat
0088 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1529
                                           ; SOURCE LINE # 1530
0089         ?C0263:
0089 22                RET     
             ; FUNCTION pwm_limit_search (END)

             ; FUNCTION cycles_counter_update (BEGIN)
                                           ; SOURCE LINE # 1537
                                           ; SOURCE LINE # 1548
0000 900000      E     MOV     DPTR,#g_meas
0003 E0                MOVX    A,@DPTR
0004 FC                MOV     R4,A
0005 A3                INC     DPTR
0006 E0                MOVX    A,@DPTR
0007 FD                MOV     R5,A
0008 A3                INC     DPTR
0009 E0                MOVX    A,@DPTR
000A FE                MOV     R6,A
000B A3                INC     DPTR
000C E0                MOVX    A,@DPTR
000D FF                MOV     R7,A
000E 900000      E     MOV     DPTR,#g_mem+035H
0011 E0                MOVX    A,@DPTR
0012 F9                MOV     R1,A
0013 F8                MOV     R0,A
0014 120000      E     LCALL   ?C?SLSHR
0017 900000      R     MOV     DPTR,#curr_pos
001A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1551
001D 900000      R     MOV     DPTR,#pos_cycle_status
0020 E0                MOVX    A,@DPTR
0021 14                DEC     A
0022 7003              JNZ     $ + 5H
0024 020000      R     LJMP    ?C0267
0027 14                DEC     A
0028 7003              JNZ     $ + 5H
002A 020000      R     LJMP    ?C0269
002D 2402              ADD     A,#02H
002F 6003              JZ      $ + 5H
0031 020000      R     LJMP    ?C0264
                                           ; SOURCE LINE # 1552
0034         ?C0265:
                                           ; SOURCE LINE # 1553
0034 900000      E     MOV     DPTR,#pwm_sign
0037 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 141 

0038 6401              XRL     A,#01H
003A 6003              JZ      $ + 5H
003C 020000      R     LJMP    ?C0264
                                           ; SOURCE LINE # 1554
003F 900000      R     MOV     DPTR,#curr_pos
0042 E0                MOVX    A,@DPTR
0043 FC                MOV     R4,A
0044 A3                INC     DPTR
0045 E0                MOVX    A,@DPTR
0046 FD                MOV     R5,A
0047 A3                INC     DPTR
0048 E0                MOVX    A,@DPTR
0049 FE                MOV     R6,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C FF                MOV     R7,A
004D 900000      R     MOV     DPTR,#thr_pos
0050 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1555
0053 900000      E     MOV     DPTR,#g_mem+0F4H
0056 E0                MOVX    A,@DPTR
0057 F8                MOV     R0,A
0058 A3                INC     DPTR
0059 E0                MOVX    A,@DPTR
005A F9                MOV     R1,A
005B A3                INC     DPTR
005C E0                MOVX    A,@DPTR
005D FA                MOV     R2,A
005E A3                INC     DPTR
005F E0                MOVX    A,@DPTR
0060 FB                MOV     R3,A
0061 C000              PUSH    AR0
0063 C001              PUSH    AR1
0065 C002              PUSH    AR2
0067 C003              PUSH    AR3
0069 900000      R     MOV     DPTR,#thr_pos
006C E0                MOVX    A,@DPTR
006D A3                INC     DPTR
006E E0                MOVX    A,@DPTR
006F A3                INC     DPTR
0070 E0                MOVX    A,@DPTR
0071 FE                MOV     R6,A
0072 A3                INC     DPTR
0073 E0                MOVX    A,@DPTR
0074 FB                MOV     R3,A
0075 AA06              MOV     R2,AR6
0077 A3                INC     DPTR
0078 E0                MOVX    A,@DPTR
0079 A3                INC     DPTR
007A E0                MOVX    A,@DPTR
007B A3                INC     DPTR
007C E0                MOVX    A,@DPTR
007D FE                MOV     R6,A
007E A3                INC     DPTR
007F E0                MOVX    A,@DPTR
0080 C3                CLR     C
0081 9B                SUBB    A,R3
0082 FF                MOV     R7,A
0083 EE                MOV     A,R6
0084 9A                SUBB    A,R2
0085 FE                MOV     R6,A
0086 120000      E     LCALL   _abs
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 142 

0089 EE                MOV     A,R6
008A 33                RLC     A
008B 95E0              SUBB    A,ACC
008D FD                MOV     R5,A
008E FC                MOV     R4,A
008F D003              POP     AR3
0091 D002              POP     AR2
0093 D001              POP     AR1
0095 D000              POP     AR0
0097 EB                MOV     A,R3
0098 2F                ADD     A,R7
0099 FF                MOV     R7,A
009A EA                MOV     A,R2
009B 3E                ADDC    A,R6
009C FE                MOV     R6,A
009D E9                MOV     A,R1
009E 3D                ADDC    A,R5
009F FD                MOV     R5,A
00A0 E8                MOV     A,R0
00A1 3C                ADDC    A,R4
00A2 FC                MOV     R4,A
00A3 900000      E     MOV     DPTR,#g_mem+0F4H
00A6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1556
00A9 900000      R     MOV     DPTR,#pos_cycle_status
00AC 7401              MOV     A,#01H
00AE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1557
                                           ; SOURCE LINE # 1558
00AF 020000      R     LJMP    ?C0264
                                           ; SOURCE LINE # 1559
00B2         ?C0267:
                                           ; SOURCE LINE # 1560
00B2 900000      E     MOV     DPTR,#pwm_sign
00B5 E0                MOVX    A,@DPTR
00B6 F4                CPL     A
00B7 6003              JZ      $ + 5H
00B9 020000      R     LJMP    ?C0264
                                           ; SOURCE LINE # 1561
00BC 900000      R     MOV     DPTR,#curr_pos
00BF E0                MOVX    A,@DPTR
00C0 FC                MOV     R4,A
00C1 A3                INC     DPTR
00C2 E0                MOVX    A,@DPTR
00C3 FD                MOV     R5,A
00C4 A3                INC     DPTR
00C5 E0                MOVX    A,@DPTR
00C6 FE                MOV     R6,A
00C7 A3                INC     DPTR
00C8 E0                MOVX    A,@DPTR
00C9 FF                MOV     R7,A
00CA 900000      R     MOV     DPTR,#max_pos
00CD 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1562
00D0 900000      E     MOV     DPTR,#g_mem+0F4H
00D3 E0                MOVX    A,@DPTR
00D4 F8                MOV     R0,A
00D5 A3                INC     DPTR
00D6 E0                MOVX    A,@DPTR
00D7 F9                MOV     R1,A
00D8 A3                INC     DPTR
00D9 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 143 

00DA FA                MOV     R2,A
00DB A3                INC     DPTR
00DC E0                MOVX    A,@DPTR
00DD FB                MOV     R3,A
00DE C000              PUSH    AR0
00E0 C001              PUSH    AR1
00E2 C002              PUSH    AR2
00E4 C003              PUSH    AR3
00E6 900000      R     MOV     DPTR,#thr_pos
00E9 E0                MOVX    A,@DPTR
00EA A3                INC     DPTR
00EB E0                MOVX    A,@DPTR
00EC A3                INC     DPTR
00ED E0                MOVX    A,@DPTR
00EE FE                MOV     R6,A
00EF A3                INC     DPTR
00F0 E0                MOVX    A,@DPTR
00F1 FB                MOV     R3,A
00F2 AA06              MOV     R2,AR6
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6 A3                INC     DPTR
00F7 E0                MOVX    A,@DPTR
00F8 A3                INC     DPTR
00F9 E0                MOVX    A,@DPTR
00FA FE                MOV     R6,A
00FB A3                INC     DPTR
00FC E0                MOVX    A,@DPTR
00FD C3                CLR     C
00FE 9B                SUBB    A,R3
00FF FF                MOV     R7,A
0100 EE                MOV     A,R6
0101 9A                SUBB    A,R2
0102 FE                MOV     R6,A
0103 120000      E     LCALL   _abs
0106 EE                MOV     A,R6
0107 33                RLC     A
0108 95E0              SUBB    A,ACC
010A FD                MOV     R5,A
010B FC                MOV     R4,A
010C D003              POP     AR3
010E D002              POP     AR2
0110 D001              POP     AR1
0112 D000              POP     AR0
0114 EB                MOV     A,R3
0115 2F                ADD     A,R7
0116 FF                MOV     R7,A
0117 EA                MOV     A,R2
0118 3E                ADDC    A,R6
0119 FE                MOV     R6,A
011A E9                MOV     A,R1
011B 3D                ADDC    A,R5
011C FD                MOV     R5,A
011D E8                MOV     A,R0
011E 3C                ADDC    A,R4
011F FC                MOV     R4,A
0120 900000      E     MOV     DPTR,#g_mem+0F4H
0123 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1563
0126 900000      R     MOV     DPTR,#pos_cycle_status
0129 7402              MOV     A,#02H
012B F0                MOVX    @DPTR,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 144 

                                           ; SOURCE LINE # 1564
                                           ; SOURCE LINE # 1565
012C 020000      R     LJMP    ?C0264
                                           ; SOURCE LINE # 1566
012F         ?C0269:
                                           ; SOURCE LINE # 1567
012F 900000      R     MOV     DPTR,#thr_pos
0132 E0                MOVX    A,@DPTR
0133 A3                INC     DPTR
0134 E0                MOVX    A,@DPTR
0135 A3                INC     DPTR
0136 E0                MOVX    A,@DPTR
0137 FE                MOV     R6,A
0138 A3                INC     DPTR
0139 E0                MOVX    A,@DPTR
013A FB                MOV     R3,A
013B AA06              MOV     R2,AR6
013D A3                INC     DPTR
013E E0                MOVX    A,@DPTR
013F A3                INC     DPTR
0140 E0                MOVX    A,@DPTR
0141 A3                INC     DPTR
0142 E0                MOVX    A,@DPTR
0143 FE                MOV     R6,A
0144 A3                INC     DPTR
0145 E0                MOVX    A,@DPTR
0146 C3                CLR     C
0147 9B                SUBB    A,R3
0148 FF                MOV     R7,A
0149 EE                MOV     A,R6
014A 9A                SUBB    A,R2
014B FE                MOV     R6,A
014C 120000      E     LCALL   _abs
014F EE                MOV     A,R6
0150 33                RLC     A
0151 95E0              SUBB    A,ACC
0153 FD                MOV     R5,A
0154 FC                MOV     R4,A
0155 900000      R     MOV     DPTR,#bin_threshold
0158 E0                MOVX    A,@DPTR
0159 F8                MOV     R0,A
015A A3                INC     DPTR
015B E0                MOVX    A,@DPTR
015C F9                MOV     R1,A
015D A3                INC     DPTR
015E E0                MOVX    A,@DPTR
015F FA                MOV     R2,A
0160 A3                INC     DPTR
0161 E0                MOVX    A,@DPTR
0162 FB                MOV     R3,A
0163 C3                CLR     C
0164 120000      E     LCALL   ?C?SLCMP
0167 4003              JC      $ + 5H
0169 020000      R     LJMP    ?C0270
                                           ; SOURCE LINE # 1569
016C 900000      E     MOV     DPTR,#g_mem+059H
016F E0                MOVX    A,@DPTR
0170 FC                MOV     R4,A
0171 A3                INC     DPTR
0172 E0                MOVX    A,@DPTR
0173 FD                MOV     R5,A
0174 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 145 

0175 E0                MOVX    A,@DPTR
0176 FE                MOV     R6,A
0177 A3                INC     DPTR
0178 E0                MOVX    A,@DPTR
0179 FF                MOV     R7,A
017A 900000      E     MOV     DPTR,#g_mem+035H
017D E0                MOVX    A,@DPTR
017E F9                MOV     R1,A
017F F8                MOV     R0,A
0180 120000      E     LCALL   ?C?SLSHR
0183 E4                CLR     A
0184 7B0A              MOV     R3,#0AH
0186 FA                MOV     R2,A
0187 F9                MOV     R1,A
0188 F8                MOV     R0,A
0189 120000      E     LCALL   ?C?SLDIV
018C 900000      R     MOV     DPTR,#step
018F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1570
0192 900000      R     MOV     DPTR,#step
0195 E0                MOVX    A,@DPTR
0196 F8                MOV     R0,A
0197 A3                INC     DPTR
0198 E0                MOVX    A,@DPTR
0199 F9                MOV     R1,A
019A A3                INC     DPTR
019B E0                MOVX    A,@DPTR
019C FA                MOV     R2,A
019D A3                INC     DPTR
019E E0                MOVX    A,@DPTR
019F FB                MOV     R3,A
01A0 900000      R     MOV     DPTR,#thr_pos
01A3 E0                MOVX    A,@DPTR
01A4 FC                MOV     R4,A
01A5 A3                INC     DPTR
01A6 E0                MOVX    A,@DPTR
01A7 FD                MOV     R5,A
01A8 A3                INC     DPTR
01A9 E0                MOVX    A,@DPTR
01AA FE                MOV     R6,A
01AB A3                INC     DPTR
01AC E0                MOVX    A,@DPTR
01AD FF                MOV     R7,A
01AE 120000      E     LCALL   ?C?SLDIV
01B1 900000      R     MOV     DPTR,#bin_st
01B4 EF                MOV     A,R7
01B5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1571
01B6 900000      R     MOV     DPTR,#step
01B9 E0                MOVX    A,@DPTR
01BA F8                MOV     R0,A
01BB A3                INC     DPTR
01BC E0                MOVX    A,@DPTR
01BD F9                MOV     R1,A
01BE A3                INC     DPTR
01BF E0                MOVX    A,@DPTR
01C0 FA                MOV     R2,A
01C1 A3                INC     DPTR
01C2 E0                MOVX    A,@DPTR
01C3 FB                MOV     R3,A
01C4 900000      R     MOV     DPTR,#max_pos
01C7 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 146 

01C8 FC                MOV     R4,A
01C9 A3                INC     DPTR
01CA E0                MOVX    A,@DPTR
01CB FD                MOV     R5,A
01CC A3                INC     DPTR
01CD E0                MOVX    A,@DPTR
01CE FE                MOV     R6,A
01CF A3                INC     DPTR
01D0 E0                MOVX    A,@DPTR
01D1 FF                MOV     R7,A
01D2 120000      E     LCALL   ?C?SLDIV
01D5 900000      R     MOV     DPTR,#bin_max
01D8 EF                MOV     A,R7
01D9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1572
01DA 900000      R     MOV     DPTR,#bin_st
01DD E0                MOVX    A,@DPTR
01DE 900000      R     MOV     DPTR,#i
01E1 F0                MOVX    @DPTR,A
01E2         ?C0271:
01E2 900000      R     MOV     DPTR,#bin_max
01E5 E0                MOVX    A,@DPTR
01E6 FF                MOV     R7,A
01E7 900000      R     MOV     DPTR,#i
01EA E0                MOVX    A,@DPTR
01EB FE                MOV     R6,A
01EC D3                SETB    C
01ED 9F                SUBB    A,R7
01EE 5037              JNC     ?C0272
                                           ; SOURCE LINE # 1574
01F0 EE                MOV     A,R6
01F1 25E0              ADD     A,ACC
01F3 25E0              ADD     A,ACC
01F5 2400        E     ADD     A,#LOW g_mem+0B8H
01F7 F582              MOV     DPL,A
01F9 E4                CLR     A
01FA 3400        E     ADDC    A,#HIGH g_mem+0B8H
01FC F583              MOV     DPH,A
01FE C083              PUSH    DPH
0200 C082              PUSH    DPL
0202 E0                MOVX    A,@DPTR
0203 FC                MOV     R4,A
0204 A3                INC     DPTR
0205 E0                MOVX    A,@DPTR
0206 FD                MOV     R5,A
0207 A3                INC     DPTR
0208 E0                MOVX    A,@DPTR
0209 FE                MOV     R6,A
020A A3                INC     DPTR
020B E0                MOVX    A,@DPTR
020C 2401              ADD     A,#01H
020E FF                MOV     R7,A
020F E4                CLR     A
0210 3E                ADDC    A,R6
0211 FE                MOV     R6,A
0212 E4                CLR     A
0213 3D                ADDC    A,R5
0214 FD                MOV     R5,A
0215 E4                CLR     A
0216 3C                ADDC    A,R4
0217 FC                MOV     R4,A
0218 D082              POP     DPL
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 147 

021A D083              POP     DPH
021C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1575
021F 900000      R     MOV     DPTR,#i
0222 E0                MOVX    A,@DPTR
0223 04                INC     A
0224 F0                MOVX    @DPTR,A
0225 80BB              SJMP    ?C0271
0227         ?C0272:
                                           ; SOURCE LINE # 1578
0227 900000      E     MOV     DPTR,#g_mem+069H
022A E0                MOVX    A,@DPTR
022B FE                MOV     R6,A
022C A3                INC     DPTR
022D E0                MOVX    A,@DPTR
022E FF                MOV     R7,A
022F EE                MOV     A,R6
0230 33                RLC     A
0231 95E0              SUBB    A,ACC
0233 FD                MOV     R5,A
0234 FC                MOV     R4,A
0235 E4                CLR     A
0236 7B04              MOV     R3,#04H
0238 FA                MOV     R2,A
0239 F9                MOV     R1,A
023A F8                MOV     R0,A
023B 120000      E     LCALL   ?C?SLDIV
023E 900000      R     MOV     DPTR,#step
0241 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1579
0244 900000      E     MOV     DPTR,#g_mem+069H
0247 E0                MOVX    A,@DPTR
0248 FE                MOV     R6,A
0249 A3                INC     DPTR
024A E0                MOVX    A,@DPTR
024B FF                MOV     R7,A
024C EE                MOV     A,R6
024D 33                RLC     A
024E 95E0              SUBB    A,ACC
0250 FD                MOV     R5,A
0251 FC                MOV     R4,A
0252 900000      E     MOV     DPTR,#g_meas+0CH
0255 E0                MOVX    A,@DPTR
0256 F8                MOV     R0,A
0257 A3                INC     DPTR
0258 E0                MOVX    A,@DPTR
0259 F9                MOV     R1,A
025A A3                INC     DPTR
025B E0                MOVX    A,@DPTR
025C FA                MOV     R2,A
025D A3                INC     DPTR
025E E0                MOVX    A,@DPTR
025F FB                MOV     R3,A
0260 D3                SETB    C
0261 120000      E     LCALL   ?C?SLCMP
0264 4021              JC      ?C0274
                                           ; SOURCE LINE # 1580
0266 900000      E     MOV     DPTR,#g_mem+0ECH
0269 E0                MOVX    A,@DPTR
026A FC                MOV     R4,A
026B A3                INC     DPTR
026C E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 148 

026D FD                MOV     R5,A
026E A3                INC     DPTR
026F E0                MOVX    A,@DPTR
0270 FE                MOV     R6,A
0271 A3                INC     DPTR
0272 E0                MOVX    A,@DPTR
0273 2401              ADD     A,#01H
0275 FF                MOV     R7,A
0276 E4                CLR     A
0277 3E                ADDC    A,R6
0278 FE                MOV     R6,A
0279 E4                CLR     A
027A 3D                ADDC    A,R5
027B FD                MOV     R5,A
027C E4                CLR     A
027D 3C                ADDC    A,R4
027E FC                MOV     R4,A
027F 900000      E     MOV     DPTR,#g_mem+0ECH
0282 120000      E     LCALL   ?C?LSTXDATA
0285 804E              SJMP    ?C0270
0287         ?C0274:
                                           ; SOURCE LINE # 1582
0287 900000      R     MOV     DPTR,#step
028A E0                MOVX    A,@DPTR
028B F8                MOV     R0,A
028C A3                INC     DPTR
028D E0                MOVX    A,@DPTR
028E F9                MOV     R1,A
028F A3                INC     DPTR
0290 E0                MOVX    A,@DPTR
0291 FA                MOV     R2,A
0292 A3                INC     DPTR
0293 E0                MOVX    A,@DPTR
0294 FB                MOV     R3,A
0295 900000      E     MOV     DPTR,#g_meas+0CH
0298 E0                MOVX    A,@DPTR
0299 FC                MOV     R4,A
029A A3                INC     DPTR
029B E0                MOVX    A,@DPTR
029C FD                MOV     R5,A
029D A3                INC     DPTR
029E E0                MOVX    A,@DPTR
029F FE                MOV     R6,A
02A0 A3                INC     DPTR
02A1 E0                MOVX    A,@DPTR
02A2 FF                MOV     R7,A
02A3 120000      E     LCALL   ?C?SLDIV
02A6 EF                MOV     A,R7
02A7 25E0              ADD     A,ACC
02A9 25E0              ADD     A,ACC
02AB 2400        E     ADD     A,#LOW g_mem+0E0H
02AD F582              MOV     DPL,A
02AF E4                CLR     A
02B0 3400        E     ADDC    A,#HIGH g_mem+0E0H
02B2 F583              MOV     DPH,A
02B4 C083              PUSH    DPH
02B6 C082              PUSH    DPL
02B8 E0                MOVX    A,@DPTR
02B9 FC                MOV     R4,A
02BA A3                INC     DPTR
02BB E0                MOVX    A,@DPTR
02BC FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 149 

02BD A3                INC     DPTR
02BE E0                MOVX    A,@DPTR
02BF FE                MOV     R6,A
02C0 A3                INC     DPTR
02C1 E0                MOVX    A,@DPTR
02C2 2401              ADD     A,#01H
02C4 FF                MOV     R7,A
02C5 E4                CLR     A
02C6 3E                ADDC    A,R6
02C7 FE                MOV     R6,A
02C8 E4                CLR     A
02C9 3D                ADDC    A,R5
02CA FD                MOV     R5,A
02CB E4                CLR     A
02CC 3C                ADDC    A,R4
02CD FC                MOV     R4,A
02CE D082              POP     DPL
02D0 D083              POP     DPH
02D2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1583
02D5         ?C0270:
                                           ; SOURCE LINE # 1584
02D5 E4                CLR     A
02D6 900000      R     MOV     DPTR,#pos_cycle_status
02D9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1585
                                           ; SOURCE LINE # 1586
02DA         ?C0264:
                                           ; SOURCE LINE # 1589
02DA E4                CLR     A
02DB 900000      R     MOV     DPTR,#i
02DE F0                MOVX    @DPTR,A
02DF         ?C0276:
02DF 900000      R     MOV     DPTR,#i
02E2 E0                MOVX    A,@DPTR
02E3 FF                MOV     R7,A
02E4 C3                CLR     C
02E5 9402              SUBB    A,#02H
02E7 4003              JC      $ + 5H
02E9 020000      R     LJMP    ?C0277
02EC E500        E     MOV     A,emg_1_status
02EE 6003              JZ      $ + 5H
02F0 020000      R     LJMP    ?C0277
02F3 E500        E     MOV     A,emg_2_status
02F5 6003              JZ      $ + 5H
02F7 020000      R     LJMP    ?C0277
                                           ; SOURCE LINE # 1590
02FA 7400        R     MOV     A,#LOW emg_cycle_status
02FC 2F                ADD     A,R7
02FD F582              MOV     DPL,A
02FF E4                CLR     A
0300 3400        R     ADDC    A,#HIGH emg_cycle_status
0302 F583              MOV     DPH,A
0304 E0                MOVX    A,@DPTR
0305 14                DEC     A
0306 6059              JZ      ?C0282
0308 14                DEC     A
0309 7003              JNZ     $ + 5H
030B 020000      R     LJMP    ?C0284
030E 2402              ADD     A,#02H
0310 6003              JZ      $ + 5H
0312 020000      R     LJMP    ?C0278
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 150 

                                           ; SOURCE LINE # 1591
0315         ?C0280:
                                           ; SOURCE LINE # 1592
0315 900000      R     MOV     DPTR,#i
0318 E0                MOVX    A,@DPTR
0319 FB                MOV     R3,A
031A 25E0              ADD     A,ACC
031C 2400        E     ADD     A,#LOW g_mem+06BH
031E F582              MOV     DPL,A
0320 E4                CLR     A
0321 3400        E     ADDC    A,#HIGH g_mem+06BH
0323 F583              MOV     DPH,A
0325 E0                MOVX    A,@DPTR
0326 FE                MOV     R6,A
0327 A3                INC     DPTR
0328 E0                MOVX    A,@DPTR
0329 FF                MOV     R7,A
032A E4                CLR     A
032B FC                MOV     R4,A
032C FD                MOV     R5,A
032D EB                MOV     A,R3
032E 25E0              ADD     A,ACC
0330 25E0              ADD     A,ACC
0332 2400        E     ADD     A,#LOW g_meas+017H
0334 F582              MOV     DPL,A
0336 E4                CLR     A
0337 3400        E     ADDC    A,#HIGH g_meas+017H
0339 F583              MOV     DPH,A
033B E0                MOVX    A,@DPTR
033C F8                MOV     R0,A
033D A3                INC     DPTR
033E E0                MOVX    A,@DPTR
033F F9                MOV     R1,A
0340 A3                INC     DPTR
0341 E0                MOVX    A,@DPTR
0342 FA                MOV     R2,A
0343 A3                INC     DPTR
0344 E0                MOVX    A,@DPTR
0345 FB                MOV     R3,A
0346 D3                SETB    C
0347 120000      E     LCALL   ?C?SLCMP
034A 5003              JNC     $ + 5H
034C 020000      R     LJMP    ?C0278
                                           ; SOURCE LINE # 1593
034F 900000      R     MOV     DPTR,#i
0352 E0                MOVX    A,@DPTR
0353 2400        R     ADD     A,#LOW emg_cycle_status
0355 F582              MOV     DPL,A
0357 E4                CLR     A
0358 3400        R     ADDC    A,#HIGH emg_cycle_status
035A F583              MOV     DPH,A
035C 7401              MOV     A,#01H
035E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1594
                                           ; SOURCE LINE # 1595
035F 807B              SJMP    ?C0278
                                           ; SOURCE LINE # 1596
0361         ?C0282:
                                           ; SOURCE LINE # 1597
0361 900000      R     MOV     DPTR,#i
0364 E0                MOVX    A,@DPTR
0365 25E0              ADD     A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 151 

0367 25E0              ADD     A,ACC
0369 2400        E     ADD     A,#LOW g_meas+017H
036B F582              MOV     DPL,A
036D E4                CLR     A
036E 3400        E     ADDC    A,#HIGH g_meas+017H
0370 F583              MOV     DPH,A
0372 E0                MOVX    A,@DPTR
0373 FC                MOV     R4,A
0374 A3                INC     DPTR
0375 E0                MOVX    A,@DPTR
0376 FD                MOV     R5,A
0377 A3                INC     DPTR
0378 E0                MOVX    A,@DPTR
0379 FE                MOV     R6,A
037A A3                INC     DPTR
037B E0                MOVX    A,@DPTR
037C FF                MOV     R7,A
037D E4                CLR     A
037E 7B0A              MOV     R3,#0AH
0380 FA                MOV     R2,A
0381 F9                MOV     R1,A
0382 F8                MOV     R0,A
0383 D3                SETB    C
0384 120000      E     LCALL   ?C?SLCMP
0387 4053              JC      ?C0278
                                           ; SOURCE LINE # 1598
0389 900000      R     MOV     DPTR,#i
038C E0                MOVX    A,@DPTR
038D 2400        R     ADD     A,#LOW emg_cycle_status
038F F582              MOV     DPL,A
0391 E4                CLR     A
0392 3400        R     ADDC    A,#HIGH emg_cycle_status
0394 F583              MOV     DPH,A
0396 7402              MOV     A,#02H
0398 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1599
                                           ; SOURCE LINE # 1600
0399 8041              SJMP    ?C0278
                                           ; SOURCE LINE # 1601
039B         ?C0284:
                                           ; SOURCE LINE # 1602
039B 900000      R     MOV     DPTR,#i
039E E0                MOVX    A,@DPTR
039F 25E0              ADD     A,ACC
03A1 25E0              ADD     A,ACC
03A3 2400        E     ADD     A,#LOW g_mem+0B0H
03A5 F582              MOV     DPL,A
03A7 E4                CLR     A
03A8 3400        E     ADDC    A,#HIGH g_mem+0B0H
03AA F583              MOV     DPH,A
03AC C083              PUSH    DPH
03AE C082              PUSH    DPL
03B0 E0                MOVX    A,@DPTR
03B1 FC                MOV     R4,A
03B2 A3                INC     DPTR
03B3 E0                MOVX    A,@DPTR
03B4 FD                MOV     R5,A
03B5 A3                INC     DPTR
03B6 E0                MOVX    A,@DPTR
03B7 FE                MOV     R6,A
03B8 A3                INC     DPTR
03B9 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 152 

03BA 2401              ADD     A,#01H
03BC FF                MOV     R7,A
03BD E4                CLR     A
03BE 3E                ADDC    A,R6
03BF FE                MOV     R6,A
03C0 E4                CLR     A
03C1 3D                ADDC    A,R5
03C2 FD                MOV     R5,A
03C3 E4                CLR     A
03C4 3C                ADDC    A,R4
03C5 FC                MOV     R4,A
03C6 D082              POP     DPL
03C8 D083              POP     DPH
03CA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1603
03CD 900000      R     MOV     DPTR,#i
03D0 E0                MOVX    A,@DPTR
03D1 2400        R     ADD     A,#LOW emg_cycle_status
03D3 F582              MOV     DPL,A
03D5 E4                CLR     A
03D6 3400        R     ADDC    A,#HIGH emg_cycle_status
03D8 F583              MOV     DPH,A
03DA E4                CLR     A
03DB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1604
                                           ; SOURCE LINE # 1605
                                           ; SOURCE LINE # 1606
03DC         ?C0278:
03DC 900000      R     MOV     DPTR,#i
03DF E0                MOVX    A,@DPTR
03E0 04                INC     A
03E1 F0                MOVX    @DPTR,A
03E2 020000      R     LJMP    ?C0276
03E5         ?C0277:
                                           ; SOURCE LINE # 1609
03E5 900000      R     MOV     DPTR,#rest_cycle_status
03E8 E0                MOVX    A,@DPTR
03E9 14                DEC     A
03EA 602B              JZ      ?C0288
03EC 14                DEC     A
03ED 7003              JNZ     $ + 5H
03EF 020000      R     LJMP    ?C0291
03F2 2402              ADD     A,#02H
03F4 6003              JZ      $ + 5H
03F6 020000      R     LJMP    ?C0285
                                           ; SOURCE LINE # 1610
03F9         ?C0286:
                                           ; SOURCE LINE # 1611
03F9 900000      E     MOV     DPTR,#rest_enabled
03FC E0                MOVX    A,@DPTR
03FD 7003              JNZ     $ + 5H
03FF 020000      R     LJMP    ?C0285
                                           ; SOURCE LINE # 1612
0402 120000      E     LCALL   CYCLES_TIMER_ReadCounter
0405 E4                CLR     A
0406 FC                MOV     R4,A
0407 FD                MOV     R5,A
0408 900000      R     MOV     DPTR,#timer_value_s
040B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1613
040E 900000      R     MOV     DPTR,#rest_cycle_status
0411 7401              MOV     A,#01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 153 

0413 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1614
                                           ; SOURCE LINE # 1615
0414 020000      R     LJMP    ?C0285
                                           ; SOURCE LINE # 1616
0417         ?C0288:
                                           ; SOURCE LINE # 1617
0417 900000      E     MOV     DPTR,#rest_enabled
041A E0                MOVX    A,@DPTR
041B 6003              JZ      $ + 5H
041D 020000      R     LJMP    ?C0285
                                           ; SOURCE LINE # 1618
0420 120000      E     LCALL   CYCLES_TIMER_ReadCounter
0423 E4                CLR     A
0424 FC                MOV     R4,A
0425 FD                MOV     R5,A
0426 900000      R     MOV     DPTR,#timer_value_e
0429 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1619
042C 900000      R     MOV     DPTR,#timer_value_e
042F E0                MOVX    A,@DPTR
0430 FC                MOV     R4,A
0431 A3                INC     DPTR
0432 E0                MOVX    A,@DPTR
0433 FD                MOV     R5,A
0434 A3                INC     DPTR
0435 E0                MOVX    A,@DPTR
0436 FE                MOV     R6,A
0437 A3                INC     DPTR
0438 E0                MOVX    A,@DPTR
0439 FF                MOV     R7,A
043A 900000      R     MOV     DPTR,#timer_value_s
043D E0                MOVX    A,@DPTR
043E F8                MOV     R0,A
043F A3                INC     DPTR
0440 E0                MOVX    A,@DPTR
0441 F9                MOV     R1,A
0442 A3                INC     DPTR
0443 E0                MOVX    A,@DPTR
0444 FA                MOV     R2,A
0445 A3                INC     DPTR
0446 E0                MOVX    A,@DPTR
0447 FB                MOV     R3,A
0448 C3                CLR     C
0449 120000      E     LCALL   ?C?ULCMP
044C 5020              JNC     ?C0290
                                           ; SOURCE LINE # 1620
044E 900000      R     MOV     DPTR,#timer_value_s
0451 E0                MOVX    A,@DPTR
0452 FC                MOV     R4,A
0453 A3                INC     DPTR
0454 E0                MOVX    A,@DPTR
0455 FD                MOV     R5,A
0456 A3                INC     DPTR
0457 E0                MOVX    A,@DPTR
0458 FE                MOV     R6,A
0459 A3                INC     DPTR
045A E0                MOVX    A,@DPTR
045B 24B0              ADD     A,#0B0H
045D FF                MOV     R7,A
045E EE                MOV     A,R6
045F 3404              ADDC    A,#04H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 154 

0461 FE                MOV     R6,A
0462 E4                CLR     A
0463 3D                ADDC    A,R5
0464 FD                MOV     R5,A
0465 E4                CLR     A
0466 3C                ADDC    A,R4
0467 FC                MOV     R4,A
0468 900000      R     MOV     DPTR,#timer_value_s
046B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1621
046E         ?C0290:
                                           ; SOURCE LINE # 1622
046E 900000      R     MOV     DPTR,#rest_cycle_status
0471 7402              MOV     A,#02H
0473 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1623
                                           ; SOURCE LINE # 1624
0474 020000      R     LJMP    ?C0285
                                           ; SOURCE LINE # 1625
0477         ?C0291:
                                           ; SOURCE LINE # 1626
0477 900000      E     MOV     DPTR,#g_mem+0FCH
047A E0                MOVX    A,@DPTR
047B F8                MOV     R0,A
047C A3                INC     DPTR
047D E0                MOVX    A,@DPTR
047E F9                MOV     R1,A
047F A3                INC     DPTR
0480 E0                MOVX    A,@DPTR
0481 FA                MOV     R2,A
0482 A3                INC     DPTR
0483 E0                MOVX    A,@DPTR
0484 FB                MOV     R3,A
0485 C000              PUSH    AR0
0487 C001              PUSH    AR1
0489 C002              PUSH    AR2
048B C003              PUSH    AR3
048D 900000      R     MOV     DPTR,#timer_value_e
0490 E0                MOVX    A,@DPTR
0491 F8                MOV     R0,A
0492 A3                INC     DPTR
0493 E0                MOVX    A,@DPTR
0494 F9                MOV     R1,A
0495 A3                INC     DPTR
0496 E0                MOVX    A,@DPTR
0497 FA                MOV     R2,A
0498 A3                INC     DPTR
0499 E0                MOVX    A,@DPTR
049A FB                MOV     R3,A
049B 900000      R     MOV     DPTR,#timer_value_s
049E E0                MOVX    A,@DPTR
049F FC                MOV     R4,A
04A0 A3                INC     DPTR
04A1 E0                MOVX    A,@DPTR
04A2 FD                MOV     R5,A
04A3 A3                INC     DPTR
04A4 E0                MOVX    A,@DPTR
04A5 FE                MOV     R6,A
04A6 A3                INC     DPTR
04A7 E0                MOVX    A,@DPTR
04A8 C3                CLR     C
04A9 9B                SUBB    A,R3
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 155 

04AA FF                MOV     R7,A
04AB EE                MOV     A,R6
04AC 9A                SUBB    A,R2
04AD FE                MOV     R6,A
04AE ED                MOV     A,R5
04AF 99                SUBB    A,R1
04B0 FD                MOV     R5,A
04B1 EC                MOV     A,R4
04B2 98                SUBB    A,R0
04B3 FC                MOV     R4,A
04B4 E4                CLR     A
04B5 7B0A              MOV     R3,#0AH
04B7 FA                MOV     R2,A
04B8 F9                MOV     R1,A
04B9 F8                MOV     R0,A
04BA 120000      E     LCALL   ?C?ULDIV
04BD D003              POP     AR3
04BF D002              POP     AR2
04C1 D001              POP     AR1
04C3 D000              POP     AR0
04C5 EB                MOV     A,R3
04C6 2F                ADD     A,R7
04C7 FF                MOV     R7,A
04C8 EA                MOV     A,R2
04C9 3E                ADDC    A,R6
04CA FE                MOV     R6,A
04CB E9                MOV     A,R1
04CC 3D                ADDC    A,R5
04CD FD                MOV     R5,A
04CE E8                MOV     A,R0
04CF 3C                ADDC    A,R4
04D0 FC                MOV     R4,A
04D1 900000      E     MOV     DPTR,#g_mem+0FCH
04D4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1627
04D7 900000      E     MOV     DPTR,#g_mem+0F0H
04DA E0                MOVX    A,@DPTR
04DB FC                MOV     R4,A
04DC A3                INC     DPTR
04DD E0                MOVX    A,@DPTR
04DE FD                MOV     R5,A
04DF A3                INC     DPTR
04E0 E0                MOVX    A,@DPTR
04E1 FE                MOV     R6,A
04E2 A3                INC     DPTR
04E3 E0                MOVX    A,@DPTR
04E4 2401              ADD     A,#01H
04E6 FF                MOV     R7,A
04E7 E4                CLR     A
04E8 3E                ADDC    A,R6
04E9 FE                MOV     R6,A
04EA E4                CLR     A
04EB 3D                ADDC    A,R5
04EC FD                MOV     R5,A
04ED E4                CLR     A
04EE 3C                ADDC    A,R4
04EF FC                MOV     R4,A
04F0 900000      E     MOV     DPTR,#g_mem+0F0H
04F3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1628
04F6 E4                CLR     A
04F7 900000      R     MOV     DPTR,#rest_cycle_status
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 156 

04FA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1629
                                           ; SOURCE LINE # 1630
04FB         ?C0285:
                                           ; SOURCE LINE # 1633
04FB 120000      R     LCALL   save_cycles_eeprom
                                           ; SOURCE LINE # 1634
04FE 22                RET     
             ; FUNCTION cycles_counter_update (END)

             ; FUNCTION save_cycles_eeprom (BEGIN)
                                           ; SOURCE LINE # 1640
                                           ; SOURCE LINE # 1644
0000 900000      R     MOV     DPTR,#row_start
0003 740B              MOV     A,#0BH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1645
0006 A3                INC     DPTR
0007 7401              MOV     A,#01H
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B 7400        E     MOV     A,#HIGH g_mem+0B0H
000D F0                MOVX    @DPTR,A
000E A3                INC     DPTR
000F 7400        E     MOV     A,#LOW g_mem+0B0H
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1646
0012 A3                INC     DPTR
0013 7401              MOV     A,#01H
0015 F0                MOVX    @DPTR,A
0016 A3                INC     DPTR
0017 7400        E     MOV     A,#HIGH c_mem+0B0H
0019 F0                MOVX    @DPTR,A
001A A3                INC     DPTR
001B 7400        E     MOV     A,#LOW c_mem+0B0H
001D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1647
001E 740B              MOV     A,#0BH
0020 2404              ADD     A,#04H
0022 A3                INC     DPTR
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1651
0024 E500        E     MOV     A,cycles_status
0026 14                DEC     A
0027 6052              JZ      ?C0295
0029 14                DEC     A
002A 6077              JZ      ?C0298
002C 14                DEC     A
002D 7003              JNZ     $ + 5H
002F 020000      R     LJMP    ?C0302
0032 2403              ADD     A,#03H
0034 6003              JZ      $ + 5H
0036 020000      R     LJMP    ?C0304
                                           ; SOURCE LINE # 1652
0039         ?C0294:
                                           ; SOURCE LINE # 1654
0039 900000      R     MOV     DPTR,#addr_start_c
003C E0                MOVX    A,@DPTR
003D FB                MOV     R3,A
003E A3                INC     DPTR
003F E0                MOVX    A,@DPTR
0040 FA                MOV     R2,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 157 

0041 A3                INC     DPTR
0042 E0                MOVX    A,@DPTR
0043 F8                MOV     R0,A
0044 AC02              MOV     R4,AR2
0046 AD03              MOV     R5,AR3
0048 900000      R     MOV     DPTR,#addr_start
004B E0                MOVX    A,@DPTR
004C FB                MOV     R3,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F FA                MOV     R2,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 F9                MOV     R1,A
0053 7E00              MOV     R6,#00H
0055 7F50              MOV     R7,#050H
0057 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 1655
005A 900000      R     MOV     DPTR,#addr_start
005D E0                MOVX    A,@DPTR
005E F9                MOV     R1,A
005F A3                INC     DPTR
0060 E0                MOVX    A,@DPTR
0061 FA                MOV     R2,A
0062 A3                INC     DPTR
0063 E0                MOVX    A,@DPTR
0064 900000      R     MOV     DPTR,#m_addr
0067 C9                XCH     A,R1
0068 F0                MOVX    @DPTR,A
0069 A3                INC     DPTR
006A EA                MOV     A,R2
006B F0                MOVX    @DPTR,A
006C A3                INC     DPTR
006D E9                MOV     A,R1
006E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1656
006F 900000      R     MOV     DPTR,#row_start
0072 E0                MOVX    A,@DPTR
0073 900000      R     MOV     DPTR,#row_number
0076 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1657
0077 750001      E     MOV     cycles_status,#01H
                                           ; SOURCE LINE # 1658
007A 22                RET     
                                           ; SOURCE LINE # 1660
007B         ?C0295:
                                           ; SOURCE LINE # 1661
007B 120000      E     LCALL   EEPROM_UpdateTemperature
                                           ; SOURCE LINE # 1662
007E 900000      R     MOV     DPTR,#m_addr
0081 E0                MOVX    A,@DPTR
0082 FB                MOV     R3,A
0083 A3                INC     DPTR
0084 E0                MOVX    A,@DPTR
0085 FA                MOV     R2,A
0086 A3                INC     DPTR
0087 E0                MOVX    A,@DPTR
0088 F9                MOV     R1,A
0089 900000      R     MOV     DPTR,#row_number
008C E0                MOVX    A,@DPTR
008D FD                MOV     R5,A
008E 120000      E     LCALL   _EEPROM_StartWrite
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 158 

0091 900000      R     MOV     DPTR,#status
0094 EF                MOV     A,R7
0095 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1663
0096 6407              XRL     A,#07H
0098 6003              JZ      ?C0297
009A E0                MOVX    A,@DPTR
009B 7059              JNZ     ?C0304
009D         ?C0297:
                                           ; SOURCE LINE # 1664
009D 750002      E     MOV     cycles_status,#02H
                                           ; SOURCE LINE # 1665
00A0 C200        E     CLR     can_write
                                           ; SOURCE LINE # 1666
                                           ; SOURCE LINE # 1667
00A2 22                RET     
                                           ; SOURCE LINE # 1669
00A3         ?C0298:
                                           ; SOURCE LINE # 1670
00A3 120000      E     LCALL   EEPROM_Query
00A6 900000      R     MOV     DPTR,#status
00A9 EF                MOV     A,R7
00AA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1671
00AB 7049              JNZ     ?C0304
                                           ; SOURCE LINE # 1672
00AD 900000      R     MOV     DPTR,#row_end
00B0 E0                MOVX    A,@DPTR
00B1 FF                MOV     R7,A
00B2 900000      R     MOV     DPTR,#row_number
00B5 E0                MOVX    A,@DPTR
00B6 C3                CLR     C
00B7 9F                SUBB    A,R7
00B8 5014              JNC     ?C0300
                                           ; SOURCE LINE # 1673
00BA 900000      R     MOV     DPTR,#m_addr+01H
00BD E4                CLR     A
00BE 75F010            MOV     B,#010H
00C1 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 1674
00C4 900000      R     MOV     DPTR,#row_number
00C7 E0                MOVX    A,@DPTR
00C8 04                INC     A
00C9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1675
00CA 750001      E     MOV     cycles_status,#01H
                                           ; SOURCE LINE # 1676
00CD 22                RET     
00CE         ?C0300:
                                           ; SOURCE LINE # 1677
                                           ; SOURCE LINE # 1678
00CE 750003      E     MOV     cycles_status,#03H
                                           ; SOURCE LINE # 1679
                                           ; SOURCE LINE # 1680
                                           ; SOURCE LINE # 1681
00D1 22                RET     
                                           ; SOURCE LINE # 1683
00D2         ?C0302:
                                           ; SOURCE LINE # 1684
00D2 D200        E     SETB    can_write
                                           ; SOURCE LINE # 1685
00D4 750004      E     MOV     cycles_status,#04H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2018 17:27:34 PAGE 159 

                                           ; SOURCE LINE # 1688
00D7 900000      R     MOV     DPTR,#addr_start
00DA E0                MOVX    A,@DPTR
00DB FB                MOV     R3,A
00DC A3                INC     DPTR
00DD E0                MOVX    A,@DPTR
00DE FA                MOV     R2,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 F8                MOV     R0,A
00E2 AC02              MOV     R4,AR2
00E4 AD03              MOV     R5,AR3
00E6 A3                INC     DPTR
00E7 E0                MOVX    A,@DPTR
00E8 FB                MOV     R3,A
00E9 A3                INC     DPTR
00EA E0                MOVX    A,@DPTR
00EB FA                MOV     R2,A
00EC A3                INC     DPTR
00ED E0                MOVX    A,@DPTR
00EE F9                MOV     R1,A
00EF 7E00              MOV     R6,#00H
00F1 7F50              MOV     R7,#050H
00F3 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 1689
                                           ; SOURCE LINE # 1691
                                           ; SOURCE LINE # 1692
                                           ; SOURCE LINE # 1693
                                           ; SOURCE LINE # 1694
00F6         ?C0304:
00F6 22                RET     
             ; FUNCTION save_cycles_eeprom (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  10835    ----
   CONSTANT SIZE    =     32    ----
   XDATA SIZE       =    270      40
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6      88
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3       2
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

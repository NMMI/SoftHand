C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE INTERRUPTIONS
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Release\interruptions.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.3\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\interruptions.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(NDEBUG) WL(2) PR(.\DP80
                    -51_Keil_951\Release/interruptions.lst) CD OT(8,SPEED) OJ(.\DP8051_Keil_951\Release\interruptions.obj)

line level    source

*** MESSAGE C286 IN LINE 0 OF (null): license limits optimization to level 5
   1          // ----------------------------------------------------------------------------
   2          // Copyright (C)  qbrobotics. All rights reserved.
   3          // www.qbrobotics.com
   4          // ----------------------------------------------------------------------------
   5          
   6          /**
   7          * \file         interruptions.c
   8          *
   9          * \brief        Interruption handling and firmware core functions
  10          * \date         June 06, 2016
  11          * \author       _qbrobotics_
  12          * \copyright    (C)  qbrobotics. All rights reserved.
  13          */
  14          
  15          
  16          //=================================================================     includes
  17          #include <interruptions.h>
  18          #include <command_processing.h>
  19          #include <globals.h>
  20          #include <utils.h>
  21          
  22          
  23          //==============================================================================
  24          //                                                            RS485 RX INTERRUPT
  25          //==============================================================================
  26          // Processing RS-485 data frame:
  27          //
  28          // - 0:     Waits for beggining characters
  29          // - 1:     Waits for ID;
  30          // - 2:     Data length;
  31          // - 3:     Receive all bytes;
  32          // - 4:     Wait for another device end of transmission;
  33          //
  34          //==============================================================================
  35          
  36          // PWM values needed to obtain 11.5 V given a certain input tension
  37          // Numbers are sperimentally calculated //[index] (millivolts)
  38          static const uint8 pwm_preload_values[29] = {100,    //0 (11500)
  39                                                        83,
  40                                                        78,
  41                                                        76,
  42                                                        74,
  43                                                        72,    //5 (14000)
  44                                                        70,
  45                                                        68,
  46                                                        67,
  47                                                        65,
  48                                                        64,    //10 (16500)
  49                                                        63,
  50                                                        62,
  51                                                        61,
  52                                                        60,
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 2   

  53                                                        59,    //15 (19000)
  54                                                        58,
  55                                                        57,
  56                                                        56,
  57                                                        56,
  58                                                        55,    //20 (21500)
  59                                                        54,
  60                                                        54,
  61                                                        53,
  62                                                        52,
  63                                                        52,    //25 (24000)
  64                                                        52,
  65                                                        51,
  66                                                        51};   //28 (25500)
  67          
  68          //==============================================================================
  69          //                                                            WATCHDOG INTERRUPT
  70          //==============================================================================
  71          
  72          CY_ISR(ISR_WATCHDOG_Handler){
  73   1      
  74   1          // Set WDT flag
  75   1          
  76   1          watchdog_flag = TRUE;
  77   1      
  78   1      }
  79          
  80          //==============================================================================
  81          //                                                            RS485 RX INTERRUPT
  82          //==============================================================================
  83          
  84          CY_ISR(ISR_RS485_RX_ExInterrupt) {
  85   1      
  86   1          // Set RS485 flag
  87   1          
  88   1          interrupt_flag = TRUE;
  89   1           
  90   1      }
  91          
  92          //==============================================================================
  93          //                                                             INTERRUPT MANAGER
  94          //==============================================================================
  95          // Manage interrupt from RS485 
  96          //==============================================================================
  97          // Processing RS-485 data frame:
  98          //
  99          // - WAIT_START:    Waits for beginning characters;
 100          // - WAIT_ID:       Waits for ID;
 101          // - WAIT_LENGTH:   Data length;
 102          // - RECEIVE:       Receive all bytes;
 103          // - UNLOAD:        Wait for another device end of transmission;
 104          //
 105          //==============================================================================
 106          
 107          void interrupt_manager(){
 108   1      
 109   1          
 110   1          //===========================================     local variables definition
 111   1      
 112   1          static uint8 CYDATA state = WAIT_START;                      // state
 113   1          
 114   1          //------------------------------------------------- local data packet
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 3   

 115   1          static uint8 CYDATA data_packet_index;
 116   1          static uint8 CYDATA data_packet_length;
 117   1          static uint8 data_packet_buffer[128];                     
 118   1          static uint8 CYDATA rx_queue[3];                    // last 2 bytes received
 119   1          //-------------------------------------------------
 120   1      
 121   1          uint8 CYDATA    rx_data;                            // RS485 UART rx data
 122   1          CYBIT           rx_data_type;                       // my id?
 123   1          uint8 CYDATA    package_count = 0;                     
 124   1      
 125   1          //======================================================     receive routine
 126   1          
 127   1          // Get data until buffer is not empty 
 128   1          
 129   1          while(UART_RS485_GetRxBufferSize() && (package_count < 6)){  
 130   2              // 6 stima di numero massimo di pacchetti che riesco a leggere senza bloccare l'esecuzione del fir
             -mware
 131   2              
 132   2              // Get next char
 133   2              rx_data = UART_RS485_GetChar();
 134   2              
 135   2              switch (state) {
 136   3                  //-----     wait for frame start     -------------------------------
 137   3                  case WAIT_START:
 138   3                  
 139   3                      rx_queue[0] = rx_queue[1];
 140   3                      rx_queue[1] = rx_queue[2];
 141   3                      rx_queue[2] = rx_data;
 142   3                      
 143   3                      // Check for header configuration package
 144   3                      if ((rx_queue[1] == 58) && (rx_queue[2] == 58)) {
 145   4                          rx_queue[0] = 0;
 146   4                          rx_queue[1] = 0;
 147   4                          rx_queue[2] = 0;
 148   4                          state       = WAIT_ID;                    
 149   4                      }else
 150   3                          if ((rx_queue[0] == 63) &&      //ASCII - ?
 151   3                              (rx_queue[1] == 13) &&      //ASCII - CR
 152   3                              (rx_queue[2] == 10))        //ASCII - LF)
 153   3                              infoGet(INFO_ALL);
 154   3                      break;
 155   3      
 156   3                  //-----     wait for id     ----------------------------------------
 157   3                  case  WAIT_ID:
 158   3      
 159   3                      // packet is for my ID or is broadcast
 160   3                      if (rx_data == c_mem.id || rx_data == 0)
 161   3                          rx_data_type = FALSE;
 162   3                      else                //packet is for others
 163   3                          rx_data_type = TRUE;
 164   3                      
 165   3                      data_packet_length = 0;
 166   3                      state = WAIT_LENGTH;
 167   3                      break;
 168   3      
 169   3                  //-----     wait for length     ------------------------------------
 170   3                  case  WAIT_LENGTH:
 171   3      
 172   3       
 173   3                      data_packet_length = rx_data;
 174   3                      // check validity of pack length
 175   3                      if (data_packet_length <= 1) {
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 4   

 176   4                          data_packet_length = 0;
 177   4                          state = WAIT_START;
 178   4                      } else if (data_packet_length > 128) {
 179   4                          data_packet_length = 0;
 180   4                          state = WAIT_START;
 181   4                      } else {
 182   4                          data_packet_index = 0;
 183   4                          
 184   4                          if(rx_data_type == FALSE)
 185   4                              state = RECEIVE;          // packet for me or broadcast
 186   4                          else
 187   4                              state = UNLOAD;           // packet for others
 188   4                      }
 189   3                      break;
 190   3      
 191   3                  //-----     receiving     -------------------------------------------
 192   3                  case RECEIVE:
 193   3      
 194   3                      data_packet_buffer[data_packet_index] = rx_data;
 195   3                      data_packet_index++;
 196   3                      
 197   3                      // check end of transmission
 198   3                      if (data_packet_index >= data_packet_length) {
 199   4                          // verify if frame ID corresponded to the device ID
 200   4                          if (rx_data_type == FALSE) {
 201   5                              // copying data from buffer to global packet
 202   5                              memcpy(g_rx.buffer, data_packet_buffer, data_packet_length);
 203   5                              g_rx.length = data_packet_length;
 204   5                              g_rx.ready  = 1;
 205   5                              commProcess();
 206   5                          }
 207   4                          
 208   4                          data_packet_index  = 0;
 209   4                          data_packet_length = 0;
 210   4                          state              = WAIT_START;
 211   4                          package_count++;
 212   4                      
 213   4                      }
 214   3                      break;
 215   3      
 216   3                  //-----     other device is receving     ---------------------------
 217   3                  case UNLOAD:
 218   3                      if (!(--data_packet_length)) {
 219   4                          data_packet_index  = 0;
 220   4                          data_packet_length = 0;
 221   4                          RS485_CTS_Write(1);
 222   4                          RS485_CTS_Write(0);
 223   4                          state              = WAIT_START;
 224   4                          package_count++;
 225   4                      }
 226   3                      break;
 227   3              }
 228   2          }
 229   1      }
 230          //==============================================================================
 231          //                                                            FUNCTION SCHEDULER
 232          //==============================================================================
 233          // Call all the function with the right frequency
 234          //==============================================================================
 235          // Base frequency 1000 Hz
 236          //==============================================================================
 237          
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 5   

 238          void function_scheduler(void) {
 239   1       
 240   1          static uint16 counter_calibration = DIV_INIT_VALUE;
 241   1      
 242   1          timer_value0 = (uint32)MY_TIMER_ReadCounter();
 243   1      
 244   1          // Start ADC Conversion, SOC = 1
 245   1      
 246   1          ADC_SOC_Write(0x01); 
 247   1          
 248   1          // Check Interrupt 
 249   1      
 250   1          if (interrupt_flag){
 251   2              interrupt_flag = FALSE;
 252   2              interrupt_manager();
 253   2          }
 254   1        
 255   1          //---------------------------------- Get Encoders
 256   1      
 257   1          encoder_reading(0); 
 258   1          
 259   1          // Check Interrupt     
 260   1          
 261   1          if (interrupt_flag){
 262   2              interrupt_flag = FALSE;
 263   2              interrupt_manager();
 264   2          }   
 265   1          
 266   1          encoder_reading(1);
 267   1          
 268   1          // Check Interrupt 
 269   1          
 270   1          if (interrupt_flag){
 271   2              interrupt_flag = FALSE;
 272   2              interrupt_manager();
 273   2          }
 274   1          
 275   1          encoder_reading(2);
 276   1          
 277   1          // Check Interrupt 
 278   1          
 279   1          if (interrupt_flag){
 280   2              interrupt_flag = FALSE;
 281   2              interrupt_manager();
 282   2          }
 283   1      
 284   1          //---------------------------------- Control Motor
 285   1         
 286   1          motor_control();
 287   1      
 288   1          // Check Interrupt 
 289   1      
 290   1          if (interrupt_flag){
 291   2              interrupt_flag = FALSE;
 292   2              interrupt_manager();
 293   2          }
 294   1      
 295   1          //---------------------------------- Read conversion buffer - LOCK function
 296   1      
 297   1          analog_read_end();
 298   1      
 299   1          if (interrupt_flag){
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 6   

 300   2              interrupt_flag = FALSE;
 301   2              interrupt_manager();
 302   2          }
 303   1      
 304   1          //---------------------------------- Control Overcurrent
 305   1      
 306   1          overcurrent_control();
 307   1          
 308   1          // Check Interrupt 
 309   1          
 310   1          if (interrupt_flag){
 311   2              interrupt_flag = FALSE;
 312   2              interrupt_manager();
 313   2          }
 314   1      
 315   1          //---------------------------------- Calibration 
 316   1      
 317   1          // Divider 10, freq = 500 Hz
 318   1          if (calib.enabled == TRUE) {
 319   2              if (counter_calibration == CALIBRATION_DIV) {
 320   3                  calibration();
 321   3                  counter_calibration = 0;
 322   3              }
 323   2              counter_calibration++;
 324   2          }
 325   1      
 326   1          // Check Interrupt 
 327   1          
 328   1          if (interrupt_flag){
 329   2              interrupt_flag = FALSE;
 330   2              interrupt_manager();
 331   2          }
 332   1         
 333   1          //---------------------------------- Update States
 334   1          
 335   1          // Load k-1 state
 336   1          memcpy( &g_measOld, &g_meas, sizeof(g_meas) );
 337   1          memcpy( &g_refOld, &g_ref, sizeof(g_ref) );
 338   1      
 339   1          // Load k+1 state
 340   1          memcpy( &g_ref, &g_refNew, sizeof(g_ref) );
 341   1      
 342   1          if (interrupt_flag){
 343   2              interrupt_flag = FALSE;
 344   2              interrupt_manager();
 345   2          }
 346   1      
 347   1          timer_value = (uint32)MY_TIMER_ReadCounter();
 348   1          cycle_time = (float)((timer_value0 - timer_value)/1000000.0);
 349   1          MY_TIMER_WriteCounter(5000000);
 350   1      
 351   1      }
 352          
 353          //==============================================================================
 354          //                                                                MOTORS CONTROL
 355          //==============================================================================
 356          
 357          void motor_control() {
 358   1      
 359   1          int32 CYDATA pwm_input = 0;
 360   1      
 361   1          int32 CYDATA pos_error;         // position error
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 7   

 362   1          int32 CYDATA curr_error;        // current error
 363   1      
 364   1          int32 CYDATA i_ref;             // current reference
 365   1          int32 CYDATA handle_value;
 366   1      
 367   1          int32 CYDATA err_emg_1, err_emg_2;
 368   1      
 369   1          int32 CYDATA k_p = c_mem.k_p;  
 370   1          int32 CYDATA k_i = c_mem.k_i; 
 371   1          int32 CYDATA k_d = c_mem.k_d; 
 372   1      
 373   1          int32 CYDATA k_p_c = c_mem.k_p_c;  
 374   1          int32 CYDATA k_i_c = c_mem.k_i_c; 
 375   1          int32 CYDATA k_d_c = c_mem.k_d_c;   
 376   1      
 377   1          int32 CYDATA k_p_dl = c_mem.k_p_dl;  
 378   1          int32 CYDATA k_i_dl = c_mem.k_i_dl; 
 379   1          int32 CYDATA k_d_dl = c_mem.k_d_dl;
 380   1          
 381   1          int32 CYDATA k_p_c_dl = c_mem.k_p_c_dl;  
 382   1          int32 CYDATA k_i_c_dl = c_mem.k_i_c_dl; 
 383   1          int32 CYDATA k_d_c_dl = c_mem.k_d_c_dl;   
 384   1      
 385   1          // Static Variables
 386   1      
 387   1          static int32 pos_error_sum;     // position error sum for integral
 388   1          static int32 curr_error_sum;    // current error sum for integral
 389   1          
 390   1          static int32 prev_pos_err;      // previous position error for deriv. control
 391   1          static int32 prev_curr_err;     // previous current error for deriv. control
 392   1      
 393   1          static CYBIT motor_dir = FALSE;
 394   1      
 395   1          static uint8 current_emg = 0;   // 0 NONE
 396   1                                          // 1 EMG 1
 397   1                                          // 2 EMG 2
 398   1                                          // wait for both to get down
 399   1      
 400   1          err_emg_1 = g_meas.emg[0] - c_mem.emg_threshold[0];
 401   1          err_emg_2 = g_meas.emg[1] - c_mem.emg_threshold[1];
 402   1      
 403   1          // =========================== POSITION INPUT ==============================
 404   1          switch(c_mem.input_mode) {
 405   2      
 406   2              case INPUT_MODE_ENCODER3:
 407   2      
 408   2                  // Calculate handle value based on position of handle in the
 409   2                  // sensor chain and multiplication factor between handle and motor position
 410   2                  if (c_mem.double_encoder_on_off) 
 411   2                      handle_value = g_meas.pos[2] * c_mem.motor_handle_ratio;
 412   2                  else
 413   2                      handle_value = g_meas.pos[1] * c_mem.motor_handle_ratio;
 414   2                  
 415   2      
 416   2                  // Read handle and use it as reference for the motor
 417   2                  if (((handle_value - g_ref.pos[0]) > c_mem.max_step_pos) && (c_mem.max_step_pos != 0))
 418   2                      g_ref.pos[0] += c_mem.max_step_pos;
 419   2                  else {
 420   3                      if (((handle_value - g_ref.pos[0]) < c_mem.max_step_neg) && (c_mem.max_step_neg != 0))
 421   3                          g_ref.pos[0] += c_mem.max_step_neg;
 422   3                      else
 423   3                          g_ref.pos[0] = handle_value;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 8   

 424   3                  }
 425   2                  
 426   2                  if (normally_closed_mode == 1)
 427   2                      g_ref.pos[0] = g_mem.pos_lim_sup[0] - g_ref.pos[0];
 428   2                  
 429   2                  break;
 430   2      
 431   2              case INPUT_MODE_EMG_PROPORTIONAL:
 432   2                  if (err_emg_1 > 0)
 433   2                      g_ref.pos[0] = (err_emg_1 * g_mem.pos_lim_sup[0]) / (1024 - c_mem.emg_threshold[0]);
 434   2                  else
 435   2                      g_ref.pos[0] = 0;
 436   2                  break;
 437   2      
 438   2              case INPUT_MODE_EMG_INTEGRAL:
 439   2                  g_ref.pos[0] = g_refOld.pos[0];
 440   2                  if (err_emg_1 > 0) {
 441   3                      g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * (int)g_mem.emg_speed * 2) / (1024 - c_mem.em
             -g_threshold[0]);
 442   3                  }
 443   2                  if (err_emg_2 > 0) {
 444   3                      g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * (int)g_mem.emg_speed * 2) / (1024 - c_mem.em
             -g_threshold[1]);
 445   3                  }
 446   2                  break;
 447   2      
 448   2              case INPUT_MODE_EMG_FCFS:
 449   2                  g_ref.pos[0] = g_refOld.pos[0];
 450   2                  switch (current_emg) {
 451   3                      case 0:
 452   3                          // Look for the first EMG passing the threshold
 453   3                          if (err_emg_1 > 0) {
 454   4                              current_emg = 1;
 455   4                              break;
 456   4                          }
 457   3                          if (err_emg_2 > 0) {
 458   4                              current_emg = 2;
 459   4                              break;
 460   4                          }
 461   3                          break;
 462   3      
 463   3                      case 1:
 464   3                          // EMG 1 is first
 465   3                          if (err_emg_1 < 0) {
 466   4                              current_emg = 0;
 467   4                              break;
 468   4                          }
 469   3                          g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * g_mem.emg_speed * 2) / (1024 - c_mem.emg
             -_threshold[0]);
 470   3                          break;
 471   3      
 472   3                      case 2:
 473   3                          // EMG 2 is first
 474   3                          if (err_emg_2 < 0) {
 475   4                              current_emg = 0;
 476   4                              break;
 477   4                          }
 478   3                          g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * g_mem.emg_speed * 2) / (1024 - c_mem.emg
             -_threshold[1]);
 479   3                          break;
 480   3      
 481   3                      default:
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 9   

 482   3                          break;
 483   3                  }
 484   2      
 485   2                  break;
 486   2      
 487   2              case INPUT_MODE_EMG_FCFS_ADV:
 488   2                  g_ref.pos[0] = g_refOld.pos[0];
 489   2                  switch (current_emg) {
 490   3                      // Look for the first EMG passing the threshold
 491   3                      case 0:
 492   3                          if (err_emg_1 > 0) {
 493   4                              current_emg = 1;
 494   4                              break;
 495   4                          }
 496   3                          if (err_emg_2 > 0) {
 497   4                              current_emg = 2;
 498   4                              break;
 499   4                          }
 500   3                          break;
 501   3      
 502   3                      // EMG 1 is first
 503   3                      case 1:
 504   3                          // If both signals are under threshold go back to status 0
 505   3                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 506   4                              current_emg = 0;
 507   4                              break;
 508   4                          }
 509   3                          // but if the current signal come back over threshold, continue using it
 510   3                          if (err_emg_1 > 0) 
 511   3                              g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * g_mem.emg_speed << 2) / (1024 - c_me
             -m.emg_threshold[0]);
 512   3                          
 513   3                          break;
 514   3      
 515   3                      // EMG 2 is first
 516   3                      case 2:
 517   3                          // If both signals are under threshold go back to status 0
 518   3                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 519   4                              current_emg = 0;
 520   4                              break;
 521   4                          }
 522   3                          // but if the current signal come back over threshold, continue using it
 523   3                          if (err_emg_2 > 0) {
 524   4                              g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * c_mem.emg_speed << 2) / (1024 - c_me
             -m.emg_threshold[1]);
 525   4                          }
 526   3                          break;
 527   3      
 528   3                      default:
 529   3                          break;
 530   3                  }
 531   2      
 532   2              default:
 533   2                  break;
 534   2          }
 535   1      
 536   1          // Position limit saturation
 537   1          if (c_mem.pos_lim_flag) {
 538   2              if (g_ref.pos[0] < c_mem.pos_lim_inf[0]) 
 539   2                  g_ref.pos[0] = c_mem.pos_lim_inf[0];
 540   2              if (g_ref.pos[0] > c_mem.pos_lim_sup[0]) 
 541   2                  g_ref.pos[0] = c_mem.pos_lim_sup[0];
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 10  

 542   2          }
 543   1      
 544   1          switch(c_mem.control_mode) {
 545   2              // ======================= CURRENT AND POSITION CONTROL =======================
 546   2              case CURR_AND_POS_CONTROL:
 547   2                  pos_error = g_ref.pos[0] - g_meas.pos[0];
 548   2      
 549   2                  pos_error_sum += pos_error;
 550   2      
 551   2                  // error_sum saturation
 552   2                  if (pos_error_sum > POS_INTEGRAL_SAT_LIMIT)
 553   2                      pos_error_sum = POS_INTEGRAL_SAT_LIMIT;
 554   2                  else {
 555   3                      if (pos_error_sum < -POS_INTEGRAL_SAT_LIMIT) 
 556   3                          pos_error_sum = -POS_INTEGRAL_SAT_LIMIT;
 557   3                  }
 558   2                  
 559   2                  // ------ position PID control ------
 560   2      
 561   2                  i_ref = 0;
 562   2                  
 563   2                  // Proportional
 564   2                  if (k_p_dl != 0)
 565   2                      i_ref += (int32)(k_p_dl * pos_error) >> 16;
 566   2      
 567   2                  // Integral
 568   2                  if (k_i_dl != 0)
 569   2                      i_ref += (int32)(k_i_dl * pos_error_sum) >> 16;
 570   2      
 571   2                  // Derivative
 572   2                  if (k_d_dl != 0)
 573   2                      i_ref += (int32)(k_d_dl * (pos_error - prev_pos_err)) >> 16;
 574   2                              
 575   2                  // Update previous position
 576   2                  prev_pos_err = pos_error;
 577   2      
 578   2                  // // current set through position reference
 579   2                  // i_ref = g_ref.pos[0] >> g_mem.res[0];
 580   2      
 581   2                  // motor direction depends on i_ref
 582   2                  if (i_ref >= 0)
 583   2                      motor_dir = TRUE;
 584   2                  else
 585   2                      motor_dir = FALSE;
 586   2      
 587   2                  // current ref must be positive
 588   2                  //i_ref = abs(i_ref);
 589   2      
 590   2                  // saturate max current
 591   2                  if (i_ref > c_mem.current_limit)
 592   2                      i_ref = c_mem.current_limit;
 593   2                  else {
 594   3                      if (i_ref < -c_mem.current_limit)
 595   3                          i_ref = -c_mem.current_limit;
 596   3                      }
 597   2      
 598   2                  // saturate min current
 599   2                  /*if (i_ref < MIN_CURR_SAT_LIMIT && i_ref > 0) {
 600   2                      i_ref = MIN_CURR_SAT_LIMIT;
 601   2                  }*/
 602   2      
 603   2                  // // write i_ref on meas curr 2 for DEBUG
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 11  

 604   2                  //g_meas.curr[1] = i_ref;
 605   2      
 606   2                  // current error and curr error sum
 607   2                  curr_error = i_ref - g_meas.curr[0];
 608   2                  curr_error_sum += curr_error;
 609   2                  
 610   2                  if (curr_error_sum > CURR_INTEGRAL_SAT_LIMIT)
 611   2                      curr_error_sum = CURR_INTEGRAL_SAT_LIMIT;
 612   2                  else {
 613   3                      if (curr_error_sum < -CURR_INTEGRAL_SAT_LIMIT)
 614   3                          curr_error_sum = -CURR_INTEGRAL_SAT_LIMIT;
 615   3                  }
 616   2      
 617   2                  // ----- current PID control -----
 618   2      
 619   2                  pwm_input = 0;
 620   2      
 621   2                  // Proportional
 622   2                  if (k_p_c_dl != 0)
 623   2                      pwm_input += (int32)(k_p_c_dl * curr_error) >> 16;
 624   2      
 625   2                  // Integral
 626   2                  if (k_i_c_dl != 0)
 627   2                      pwm_input += (int32)(k_i_c_dl * curr_error_sum) >> 16;
 628   2      
 629   2                  // Derivative
 630   2                  if (k_d_c_dl != 0)
 631   2                      pwm_input += (int32)(k_d_c_dl * (curr_error - prev_curr_err)) >> 16;
 632   2      
 633   2                  // pwm_input saturation
 634   2                  if (pwm_input < -PWM_MAX_VALUE) 
 635   2                      pwm_input = -PWM_MAX_VALUE;
 636   2                  else {
 637   3                      if (pwm_input > PWM_MAX_VALUE)
 638   3                          pwm_input = PWM_MAX_VALUE;
 639   3                  }
 640   2      
 641   2                  // Update previous current
 642   2                  prev_curr_err = curr_error;
 643   2      
 644   2              break;
 645   2      
 646   2              // ============================== POSITION CONTROL =====================
 647   2              case CONTROL_ANGLE:
 648   2                  pos_error = g_ref.pos[0] - g_meas.pos[0];
 649   2      
 650   2                  pos_error_sum += pos_error;
 651   2      
 652   2                  // anti-windup (for integral control)
 653   2                  if (pos_error_sum > ANTI_WINDUP)
 654   2                      pos_error_sum = ANTI_WINDUP;
 655   2                  else {
 656   3                                      if (pos_error_sum < -ANTI_WINDUP)
 657   3                              pos_error_sum = -ANTI_WINDUP;
 658   3                  }
 659   2      
 660   2                  // Proportional
 661   2                  if (k_p != 0) 
 662   2                      pwm_input = (int32)(k_p * pos_error) >> 16;
 663   2                  
 664   2      
 665   2                  // Integral
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 12  

 666   2                  if (k_i != 0) 
 667   2                      pwm_input += (int32)(k_i * pos_error_sum) >> 16;
 668   2                  
 669   2      
 670   2                  // Derivative
 671   2                  if (k_d != 0) 
 672   2                      pwm_input += (int32)(k_d * (pos_error - prev_pos_err)) >> 16;
 673   2                  
 674   2      
 675   2                  // Update measure
 676   2                  prev_pos_err = pos_error;
 677   2      
 678   2                  if (pwm_input > 0)
 679   2                      motor_dir = TRUE;
 680   2                  else
 681   2                      motor_dir = FALSE;
 682   2      
 683   2              break;
 684   2      
 685   2              // ========================== CURRENT CONTROL ==========================
 686   2              case CONTROL_CURRENT:
 687   2                  if(g_ref.onoff && tension_valid) {
 688   3                      
 689   3                      i_ref = g_ref.curr[0];
 690   3      
 691   3                      if (i_ref > c_mem.current_limit) 
 692   3                          i_ref = c_mem.current_limit;
 693   3                      else {
 694   4                          if (i_ref < -c_mem.current_limit)
 695   4                              i_ref = -c_mem.current_limit;
 696   4                      }
 697   3                      
 698   3                      // current error
 699   3                      curr_error = i_ref - g_meas.curr[0];            
 700   3                      curr_error_sum += curr_error;
 701   3                      
 702   3                      if (curr_error_sum > CURR_INTEGRAL_SAT_LIMIT)
 703   3                          curr_error_sum = CURR_INTEGRAL_SAT_LIMIT;
 704   3                      else {
 705   4                          if (curr_error_sum < -CURR_INTEGRAL_SAT_LIMIT) 
 706   4                              curr_error_sum = -CURR_INTEGRAL_SAT_LIMIT;
 707   4                      }
 708   3      
 709   3                      pwm_input = 0;
 710   3      
 711   3                      // Proportional
 712   3                      if (k_p_c != 0)
 713   3                          pwm_input += (int32)(k_p_c * curr_error) >> 16;
 714   3      
 715   3                      // Integral
 716   3                      if (k_i_c != 0)
 717   3                          pwm_input += (int32)(k_i_c * curr_error_sum) >> 16;
 718   3      
 719   3                      // Derivative
 720   3                      if (k_d_c != 0)
 721   3                          pwm_input += (int32)(k_d_c * (curr_error - prev_curr_err)) >> 16;
 722   3                      
 723   3                      prev_curr_err = curr_error;
 724   3                      
 725   3                      if (pwm_input >= 0) 
 726   3                          motor_dir = TRUE;
 727   3                      else
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 13  

 728   3                          motor_dir = FALSE;
 729   3                  }
 730   2              break;
 731   2              
 732   2              // ================= DIRECT PWM CONTROL ================================
 733   2              case CONTROL_PWM:
 734   2      
 735   2                  pwm_input = g_ref.pwm[0];
 736   2      
 737   2                  if (pwm_input > 0) 
 738   2                      motor_dir = TRUE;
 739   2                  else 
 740   2                      motor_dir = FALSE;
 741   2                  
 742   2      
 743   2                  // pwm_input saturation
 744   2                  if (pwm_input < -PWM_MAX_VALUE) 
 745   2                      pwm_input = -PWM_MAX_VALUE;
 746   2                  else {
 747   3                                      if (pwm_input > PWM_MAX_VALUE) 
 748   3                              pwm_input = PWM_MAX_VALUE;
 749   3                      }
 750   2      
 751   2              break;
 752   2          }
 753   1      
 754   1          ////////////////////////////////////////////////////////////////////////////
 755   1      
 756   1          if(pwm_input >  PWM_MAX_VALUE) 
 757   1              pwm_input =  PWM_MAX_VALUE;
 758   1          if(pwm_input < -PWM_MAX_VALUE) 
 759   1              pwm_input = -PWM_MAX_VALUE;
 760   1      
 761   1      
 762   1          if (c_mem.control_mode != CONTROL_PWM) 
 763   1              pwm_input = (((pwm_input << 10) / PWM_MAX_VALUE) * dev_pwm_limit) >> 10;
 764   1          
 765   1      
 766   1          pwm_sign = SIGN(pwm_input);
 767   1      
 768   1          if (motor_dir)
 769   1              MOTOR_DIR_Write(0x01);
 770   1          else
 771   1              MOTOR_DIR_Write(0x00);
 772   1      
 773   1          PWM_MOTORS_WriteCompare1(abs(pwm_input));
 774   1      }
 775          
 776          //==============================================================================
 777          //                                                                   ENCODER READING
 778          //==============================================================================
 779          
 780          void encoder_reading(const uint8 idx) {
 781   1      
 782   1          uint8 CYDATA index = idx;
 783   1          
 784   1          uint8 jj;
 785   1          
 786   1          uint32 data_encoder;
 787   1          int32 value_encoder;
 788   1          int32 speed_encoder;
 789   1          //int32 accel_encoder;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 14  

 790   1          int32 aux;
 791   1      
 792   1          static int32 last_value_encoder[NUM_OF_SENSORS];
 793   1      
 794   1          static uint8 error[NUM_OF_SENSORS];
 795   1          
 796   1          static CYBIT only_first_time = TRUE;
 797   1      
 798   1          static uint8 one_time_execute = 0;
 799   1          static CYBIT pos_reconstruct = FALSE;
 800   1      
 801   1          static int32 v_value[NUM_OF_SENSORS];   //last value for velocity
 802   1          static int32 vv_value[NUM_OF_SENSORS];  //last last value for velocity
 803   1          static int32 vvv_value[NUM_OF_SENSORS];  //last last last value for velocity
 804   1          
 805   1          //static int32 a_value[NUM_OF_SENSORS];   //last value for acceleration
 806   1          //static int32 aa_value[NUM_OF_SENSORS];  //last last value for acceleration
 807   1          //static int32 aaa_value[NUM_OF_SENSORS];  //last last last value for acceleration
 808   1          
 809   1          static uint8 handle_index = 2;
 810   1          int32 handle_pos;
 811   1          static handle_status CYDATA h_status = H_NORMAL; 
 812   1      
 813   1          if (index >= NUM_OF_SENSORS)
 814   1              return;
 815   1          
 816   1          if (reset_last_value_flag) {
 817   2              for (jj = NUM_OF_SENSORS; jj--;) 
 818   2                  last_value_encoder[jj] = 0;
 819   2              
 820   2              reset_last_value_flag = 0;
 821   2          }
 822   1      
 823   1          //======================================================     reading sensors
 824   1              // Shift 1 right to erase Dummy bit of chain
 825   1          if (index == 0)
 826   1                  data_encoder = (SHIFTREG_ENC_1_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 827   1          else {
 828   2              if (index == 1)
 829   2                  data_encoder = (SHIFTREG_ENC_2_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 830   2              else // index == 2
 831   2                  data_encoder = (SHIFTREG_ENC_3_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 832   2          }
 833   1             
 834   1      
 835   1          if (check_enc_data(&data_encoder)) {
 836   2      
 837   2              value_encoder = (int16) (((data_encoder & 0x3FFC0) - 0x20000) >> 2 ) + g_mem.m_off[index];
 838   2                                                          // reset last 6 bit 
 839   2                                                          // -> |:|:|id|dim|CMD|CHK|(data---
 840   2                                                          // subtract half of max value
 841   2                                                          // and shift to have 16 bit val
 842   2      
 843   2              // Initialize last_value_encoder
 844   2              if (only_first_time) {
 845   3                  last_value_encoder[index] = value_encoder;
 846   3                  if (index == 2)
 847   3                      only_first_time = 0;
 848   3              }
 849   2      
 850   2              // Take care of rotations
 851   2              aux = value_encoder - last_value_encoder[index];
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 15  

 852   2      
 853   2              // ====================== 1 TURN ======================
 854   2              // -32768                    0                    32767 -32768                   0                
             -     32767
 855   2              // |-------------------------|-------------------------|-------------------------|----------------
             ----------|
 856   2              //              |                         |      |           |      |                         |
 857   2              //           -16384                     16383    |           |   -16384                     16383
 858   2              //                                               |           |
 859   2              //                                           24575           -24576
 860   2              //                                               |___________|
 861   2              //                                                   49152
 862   2      
 863   2              // if we are in the right interval, take care of rotation
 864   2              // and update the variable only if the difference between
 865   2              // one measure and another is less than 1/4 of turn
 866   2      
 867   2              // Considering we are sampling at 1kHz, this means that our shaft needs
 868   2              // to go slower than 1/4 turn every ms -> 1 turn every 4ms
 869   2              // equal to 250 turn/s -> 15000 RPM
 870   2      
 871   2              if (aux > 49152)
 872   2                  g_meas.rot[index]--;
 873   2              else{ 
 874   3                  if (aux < -49152)
 875   3                      g_meas.rot[index]++;
 876   3                  else{
 877   4                      if (abs(aux) > 16384) { // if two measure are too far
 878   5                          error[index]++;
 879   5                          if (error[index] < 10)
 880   5                              // Discard
 881   5                              return;
 882   5                      }
 883   4                  }
 884   3              }
 885   2      
 886   2              error[index] = 0;
 887   2      
 888   2              last_value_encoder[index] = value_encoder;
 889   2      
 890   2              value_encoder += (int32)g_meas.rot[index] << 16;
 891   2      
 892   2              if (c_mem.m_mult[index] != 1.0) {
 893   3                  value_encoder *= c_mem.m_mult[index];
 894   3              }
 895   2      
 896   2              g_meas.pos[index] = value_encoder;
 897   2      
 898   2              // KOREA mod. version
 899   2              if (c_mem.double_encoder_on_off) 
 900   2                  handle_index = 2;
 901   2              else
 902   2                  handle_index = 1;
 903   2      
 904   2              if (index == handle_index && c_mem.input_mode == INPUT_MODE_ENCODER3) {
 905   3                  handle_pos = g_meas.pos[handle_index] >> g_mem.res[handle_index];
 906   3              
 907   3                  switch (h_status) {
 908   4                      case H_NORMAL:
 909   4                          if (handle_pos < -80){
 910   5                              h_status = H_WAIT;
 911   5                          }
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 16  

 912   4                          break;
 913   4                      case H_WAIT:                    
 914   4                          if (handle_pos > -40){
 915   5                              // Change mode
 916   5                              if (normally_closed_mode == 0)
 917   5                                  normally_closed_mode = 1;
 918   5                              else
 919   5                                  normally_closed_mode = 0;
 920   5                              
 921   5                              h_status = H_NORMAL;
 922   5                          }
 923   4                          break;
 924   4                  }
 925   3              }
 926   2          }
 927   1          
 928   1          switch(index) {
 929   2              case 0:
 930   2                  speed_encoder = (int16)filter_vel_1((11*value_encoder - 18* v_value[0] + 9 * vv_value[0] -2 * 
             -vvv_value[0]));
 931   2              break;
 932   2       
 933   2              case 1:
 934   2                  speed_encoder = (int16)filter_vel_2((11*value_encoder - 18* v_value[1] + 9 * vv_value[1] -2 * 
             -vvv_value[1]));
 935   2              break;
 936   2          
 937   2              case 2:
 938   2                  speed_encoder = (int16)filter_vel_3((11*value_encoder - 18* v_value[2] + 9 * vv_value[2] -2 * 
             -vvv_value[2]));
 939   2              break;
 940   2          }
 941   1          //Update current speed
 942   1          speed_encoder = speed_encoder / (6*cycle_time);
 943   1          g_meas.vel[index] = speed_encoder;
 944   1          
 945   1          /*
 946   1          //Encoder rotational acceleration calculation
 947   1          switch(index) {
 948   1              case 0:
 949   1                  accel_encoder = (int16)filter_acc_1((11*speed_encoder - 18* a_value[0] + 9 * aa_value[0] -2* a
             -aa_value[0] ));
 950   1                  break;
 951   1              
 952   1              case 1:
 953   1                  accel_encoder = (int16)filter_acc_2((11*speed_encoder - 18* a_value[1] + 9 * aa_value[1] -2* a
             -aa_value[1] ));
 954   1                  break;
 955   1              
 956   1              case 2:
 957   1                  accel_encoder = (int16)filter_acc_3((11*speed_encoder - 18* a_value[2] + 9 * aa_value[2] -2* a
             -aa_value[2] ));
 958   1                  break;
 959   1          }
 960   1          //Update current acceleration
 961   1          g_meas.acc[index] = accel_encoder / (6*cycle_time);
 962   1          */
 963   1      
 964   1          // update old velocity and acceleration values
 965   1          vvv_value[index] = vv_value[index];
 966   1          vv_value[index] = v_value[index];
 967   1          v_value[index] = value_encoder;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 17  

 968   1      
 969   1          /*
 970   1          aaa_value[index] = aa_value[index];
 971   1          aa_value[index] = a_value[index];
 972   1          a_value[index] = speed_encoder;
 973   1          */
 974   1      
 975   1      
 976   1          // wait at least 3 * max_num_of_error (10) + 5 = 35 cycles to reconstruct the right turn
 977   1          if (pos_reconstruct == FALSE){
 978   2              if (one_time_execute < 34) 
 979   2                  one_time_execute++;
 980   2              else {
 981   3                  //Double encoder translation
 982   3                  if (c_mem.double_encoder_on_off)
 983   3                      g_meas.rot[0] = calc_turns_fcn(g_meas.pos[0], g_meas.pos[1]);
 984   3      
 985   3                  g_meas.pos[0] += (int32) g_meas.rot[0] << 16;
 986   3      
 987   3                  // If necessary activate motors
 988   3                  g_refNew.pos[0] = g_meas.pos[0];
 989   3      
 990   3                  MOTOR_ON_OFF_Write(g_ref.onoff);
 991   3                  
 992   3                  pos_reconstruct = TRUE;
 993   3              }
 994   2          }
 995   1      }
 996          
 997          //==============================================================================
 998          //                                                           ANALOG MEASUREMENTS
 999          //==============================================================================
1000          
1001          void analog_read_end() {
1002   1      
1003   1          /* =========================================================================
1004   1          /   Ideal formulation to calculate tension and current
1005   1          /
1006   1          /   tension = ((read_value_mV - offset) * 101) / gain -> [mV]
1007   1          /   current = ((read_value_mV - offset) * 375) / (gain * resistor) -> [mA]
1008   1          /
1009   1          /   Definition:
1010   1          /   read_value_mV = counts_read / 0.819 -> conversion from counts to mV
1011   1          /   offset = 2000 -> hardware amplifier bias in mV
1012   1          /   gain = 8.086 -> amplifier gain
1013   1          /   resistor = 18 -> resistor of voltage divider in KOhm 
1014   1          /
1015   1          /   Real formulation: tradeoff in good performance and accurancy, ADC_buf[] 
1016   1          /   and offset unit of measurment is counts, instead dev_tension and
1017   1          /   g_meas.curr[] are converted in properly unit.
1018   1          /  =========================================================================
1019   1          */
1020   1      
1021   1          int32 CYDATA i_aux;
1022   1      
1023   1          static emg_status CYDATA emg_1_status = RESET; 
1024   1          static emg_status CYDATA emg_2_status = RESET;                                             
1025   1          
1026   1          static uint16 emg_counter_1 = 0;
1027   1          static uint16 emg_counter_2 = 0;
1028   1      
1029   1          // Wait for conversion end
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 18  

1030   1          
1031   1          while(!ADC_STATUS_Read()){
1032   2              if (interrupt_flag){
1033   3                  interrupt_flag = FALSE;
1034   3                  interrupt_manager();
1035   3              }
1036   2          }
1037   1          
1038   1          // Convert tension read
1039   1          dev_tension = ((int32)(ADC_buf[0] - 1638) * 1952) >> 7;
1040   1          
1041   1          if (interrupt_flag){
1042   2              interrupt_flag = FALSE;
1043   2              interrupt_manager();
1044   2          }
1045   1      
1046   1          // Until there is no valid input tension repeat this measurement
1047   1          
1048   1          if (dev_tension > 0) {
1049   2              // Set tension valid bit to TRUE
1050   2      
1051   2              tension_valid = TRUE;
1052   2      
1053   2              if(g_mem.activate_pwm_rescaling)        //pwm rescaling is activated
1054   2                  pwm_limit_search();                 //only for 12V motors
1055   2      
1056   2              // Filter and Set currents
1057   2              g_meas.curr[0] = filter_i1((int16) (((int32)(ADC_buf[1] - 1638) * 25771) >> 13) * pwm_sign);
1058   2              
1059   2                      // Calculate current estimation and put it in the second part of the current measurement array;
1060   2                      g_meas.curr[1] = (int16) filter_curr_diff(((int32) g_meas.curr[0]) - curr_estim(g_meas.pos[0] >> g_mem.r
             -es[0], g_meas.vel[0] >> g_mem.res[0], g_ref.pos[0] >> g_mem.res[0]));
1061   2      
1062   2              // Check Interrupt 
1063   2          
1064   2              if (interrupt_flag){
1065   3                  interrupt_flag = FALSE;
1066   3                  interrupt_manager();
1067   3              }
1068   2      
1069   2              // if calibration is not needed go to "normal execution"
1070   2              if (!g_mem.emg_calibration_flag){
1071   3                  emg_1_status = NORMAL; // normal execution
1072   3                  emg_2_status = NORMAL; // normal execution
1073   3              }
1074   2      
1075   2              // EMG 1 calibration state machine
1076   2              
1077   2              // Calibration state machine
1078   2              switch(emg_1_status) {
1079   3                  case NORMAL: // normal execution
1080   3                      i_aux = filter_ch1(ADC_buf[2]);
1081   3                      i_aux = (i_aux << 10) / g_mem.emg_max_value[0];
1082   3          
1083   3                      if (interrupt_flag){
1084   4                          interrupt_flag = FALSE;
1085   4                          interrupt_manager();
1086   4                      }
1087   3                      //Saturation
1088   3                      if (i_aux < 0)
1089   3                          i_aux = 0;
1090   3                      else 
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 19  

1091   3                          if (i_aux > 1024) 
1092   3                              i_aux = 1024;
1093   3                      
1094   3                      g_meas.emg[0] = i_aux;
1095   3          
1096   3                      if (interrupt_flag){
1097   4                          interrupt_flag = FALSE;
1098   4                          interrupt_manager();
1099   4                      }
1100   3                      
1101   3                      break;
1102   3      
1103   3                  case RESET: // reset variables
1104   3                      emg_counter_1 = 0;
1105   3                      g_mem.emg_max_value[0] = 0;
1106   3                      emg_1_status = DISCARD; // goto next status
1107   3                      
1108   3                      break;
1109   3      
1110   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1111   3                      emg_counter_1++;
1112   3                      if (emg_counter_1 == EMG_SAMPLE_TO_DISCARD) {
1113   4                          emg_counter_1 = 0;          // reset counter
1114   4                          LED_REG_Write(0x01);        // turn on LED
1115   4                              
1116   4                          if (interrupt_flag){
1117   5                              interrupt_flag = FALSE;
1118   5                              interrupt_manager();
1119   5                          }
1120   4                          
1121   4                          emg_1_status = SUM_AND_MEAN;           // sum and mean status
1122   4                      }
1123   3                      break;
1124   3      
1125   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1126   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1127   3                      emg_counter_1++;
1128   3                      g_mem.emg_max_value[0] += filter_ch1(ADC_buf[2]);
1129   3                      
1130   3                      if (interrupt_flag){
1131   4                          interrupt_flag = FALSE;
1132   4                          interrupt_manager();
1133   4                      }
1134   3                      
1135   3                      if (emg_counter_1 == SAMPLES_FOR_EMG_MEAN) {
1136   4                          g_mem.emg_max_value[0] = g_mem.emg_max_value[0] / SAMPLES_FOR_EMG_MEAN; // calc mean
1137   4          
1138   4                          if (interrupt_flag){
1139   5                              interrupt_flag = FALSE;
1140   5                              interrupt_manager();
1141   5                          }                    
1142   4                          
1143   4                          LED_REG_Write(0x00);        // led OFF
1144   4                          emg_counter_1 = 0;          // reset counter
1145   4      
1146   4                          emg_1_status = NORMAL;           // goto normal execution
1147   4                      }
1148   3                      break;
1149   3      
1150   3                  default:
1151   3                      break;
1152   3              }
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 20  

1153   2          
1154   2              if (interrupt_flag){
1155   3                  interrupt_flag = FALSE;
1156   3                  interrupt_manager();
1157   3              }
1158   2              // EMG 2 calibration state machine
1159   2              switch(emg_2_status) {
1160   3                  case NORMAL: // normal execution
1161   3                      i_aux = filter_ch2(ADC_buf[3]);
1162   3                      i_aux = (i_aux << 10) / g_mem.emg_max_value[1];
1163   3          
1164   3                      if (interrupt_flag){
1165   4                          interrupt_flag = FALSE;
1166   4                          interrupt_manager();
1167   4                      }
1168   3                      
1169   3                      if (i_aux < 0) 
1170   3                          i_aux = 0;
1171   3                      else 
1172   3                          if (i_aux > 1024)
1173   3                              i_aux = 1024;
1174   3                      
1175   3                      g_meas.emg[1] = i_aux;
1176   3      
1177   3                      break;
1178   3      
1179   3                  case RESET: // reset variables
1180   3                      emg_counter_2 = 0;
1181   3                      g_mem.emg_max_value[1] = 0;
1182   3          
1183   3                      if (interrupt_flag){
1184   4                          interrupt_flag = FALSE;
1185   4                          interrupt_manager();
1186   4                      }
1187   3                      
1188   3                      emg_2_status = WAIT; // wait for EMG 1 calibration
1189   3                      break;
1190   3      
1191   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1192   3                      emg_counter_2++;
1193   3                      if (emg_counter_2 == EMG_SAMPLE_TO_DISCARD) {
1194   4                          emg_counter_2 = 0;          // reset counter
1195   4                          LED_REG_Write(0x01);        // turn on LED
1196   4          
1197   4                          if (interrupt_flag){
1198   5                              interrupt_flag = FALSE;
1199   5                              interrupt_manager();
1200   5                          }
1201   4                          
1202   4                          emg_2_status = SUM_AND_MEAN;           // sum and mean status
1203   4                      }
1204   3                      break;
1205   3      
1206   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1207   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1208   3                      emg_counter_2++;
1209   3                      g_mem.emg_max_value[1] += filter_ch2(ADC_buf[3]);
1210   3          
1211   3                      if (interrupt_flag){
1212   4                          interrupt_flag = FALSE;
1213   4                          interrupt_manager();
1214   4                      }
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 21  

1215   3                      
1216   3                      if (emg_counter_2 == SAMPLES_FOR_EMG_MEAN) {
1217   4                          g_mem.emg_max_value[1] = g_mem.emg_max_value[1] / SAMPLES_FOR_EMG_MEAN; // calc mean
1218   4                          LED_REG_Write(0x00);        // led OFF
1219   4                          emg_counter_2 = 0;          // reset counter
1220   4                      
1221   4                          if (interrupt_flag){
1222   5                              interrupt_flag = FALSE;
1223   5                              interrupt_manager();
1224   5                          }
1225   4                          
1226   4                          // if EMG control mode active, activate motors accordingly with startup value
1227   4                          if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
1228   4                              (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1229   4                              (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1230   4                              (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1231   5                              if (c_mem.control_mode == CONTROL_ANGLE) {
1232   6                                  g_ref.pos[0] = g_meas.pos[0];
1233   6                                  g_ref.pos[1] = g_meas.pos[1];
1234   6                              }
1235   5                              g_ref.onoff = c_mem.activ;
1236   5                              MOTOR_ON_OFF_Write(g_ref.onoff);
1237   5                          }
1238   4                          emg_2_status = NORMAL;           // goto normal execution
1239   4                      }
1240   3                      break;
1241   3      
1242   3                  case WAIT: // wait for EMG calibration to be done
1243   3                      if (emg_1_status == NORMAL)
1244   3                          emg_2_status = DISCARD;           // goto discard sample
1245   3                      break;
1246   3      
1247   3                  default:
1248   3                      break;
1249   3              }
1250   2                  
1251   2              if (interrupt_flag){
1252   3                  interrupt_flag = FALSE;
1253   3                  interrupt_manager();
1254   3              }
1255   2          }
1256   1          else {
1257   2      
1258   2              emg_1_status = RESET; 
1259   2              emg_2_status = RESET;
1260   2      
1261   2              tension_valid = FALSE;
1262   2                  
1263   2              if (interrupt_flag){
1264   3                  interrupt_flag = FALSE;
1265   3                  interrupt_manager();
1266   3              }
1267   2              
1268   2              if (c_mem.emg_calibration_flag) {
1269   3                  if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
1270   3                      (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1271   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1272   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1273   4                      g_ref.onoff = 0x00;
1274   4                      MOTOR_ON_OFF_Write(g_ref.onoff);
1275   4                  }
1276   3              }
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 22  

1277   2      
1278   2              // Reset current
1279   2              g_meas.curr[0] = 0;
1280   2      
1281   2              // Reset emg
1282   2              g_meas.emg[0] = 0;
1283   2              g_meas.emg[1] = 0;
1284   2      
1285   2          }
1286   1              
1287   1          if (interrupt_flag){
1288   2              interrupt_flag = FALSE;
1289   2              interrupt_manager();
1290   2          }
1291   1      }
1292          
1293          //==============================================================================
1294          //                                                           OVERCURRENT CONTROL
1295          //==============================================================================
1296          
1297          void overcurrent_control() {
1298   1          if (c_mem.current_limit != 0) {
1299   2              // if the current is over the limit
1300   2              if (g_meas.curr[0] > c_mem.current_limit) {
1301   3                  //decrese pwm_limit
1302   3                  dev_pwm_limit--;
1303   3              // if the current is in the safe zone
1304   3              } else if (g_meas.curr[0] < (c_mem.current_limit - CURRENT_HYSTERESIS)) {
1305   3                  //increase pwm_limit
1306   3                  dev_pwm_limit++;
1307   3              }
1308   2      
1309   2              // Bound pwm_limit
1310   2              if (dev_pwm_limit < 0) 
1311   2                  dev_pwm_limit = 0;
1312   2              else 
1313   2                  if (dev_pwm_limit > 100) 
1314   2                      dev_pwm_limit = 100;
1315   2          }
1316   1      }
1317          
1318          //==============================================================================
1319          //                                                              PWM_LIMIT_SEARCH
1320          //==============================================================================
1321          
1322          void pwm_limit_search() {
1323   1      
1324   1          uint8 CYDATA index;
1325   1      
1326   1          if (dev_tension > 25500) {
1327   2              dev_pwm_limit = 0;
1328   2          } else if (dev_tension < 11500) {
1329   2              dev_pwm_limit = 100;
1330   2          } else {
1331   2              index = (uint8)((dev_tension - 11500) >> 9);
1332   2              dev_pwm_limit = pwm_preload_values[index];
1333   2          }
1334   1      }
1335          /* [] END OF FILE */
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 23  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION ISR_WATCHDOG_Handler (BEGIN)
                                           ; SOURCE LINE # 72
                                           ; SOURCE LINE # 76
0000 D200        E     SETB    watchdog_flag
                                           ; SOURCE LINE # 78
0002 32                RETI    
             ; FUNCTION ISR_WATCHDOG_Handler (END)

             ; FUNCTION ISR_RS485_RX_ExInterrupt (BEGIN)
                                           ; SOURCE LINE # 84
                                           ; SOURCE LINE # 88
0000 D200        E     SETB    interrupt_flag
                                           ; SOURCE LINE # 90
0002 32                RETI    
             ; FUNCTION ISR_RS485_RX_ExInterrupt (END)

             ; FUNCTION interrupt_manager (BEGIN)
                                           ; SOURCE LINE # 107
                                           ; SOURCE LINE # 123
0000 E4                CLR     A
0001 F500        R     MOV     package_count,A
0003         ?C0003:
                                           ; SOURCE LINE # 129
0003 120000      E     LCALL   UART_RS485_GetRxBufferSize
0006 EF                MOV     A,R7
0007 7003              JNZ     $ + 5H
0009 020000      R     LJMP    ?C0026
000C E500        R     MOV     A,package_count
000E C3                CLR     C
000F 9406              SUBB    A,#06H
0011 4003              JC      $ + 5H
0013 020000      R     LJMP    ?C0026
                                           ; SOURCE LINE # 133
0016 120000      E     LCALL   UART_RS485_GetChar
0019 8F00        R     MOV     rx_data,R7
                                           ; SOURCE LINE # 135
001B E500        R     MOV     A,state
001D 14                DEC     A
001E 6049              JZ      ?C0010
0020 14                DEC     A
0021 6060              JZ      ?C0014
0023 14                DEC     A
0024 7003              JNZ     $ + 5H
0026 020000      R     LJMP    ?C0021
0029 14                DEC     A
002A 7003              JNZ     $ + 5H
002C 020000      R     LJMP    ?C0024
002F 2404              ADD     A,#04H
0031 70D0              JNZ     ?C0003
                                           ; SOURCE LINE # 137
0033         ?C0006:
                                           ; SOURCE LINE # 139
0033 850000      R     MOV     rx_queue,rx_queue+01H
                                           ; SOURCE LINE # 140
0036 850000      R     MOV     rx_queue+01H,rx_queue+02H
                                           ; SOURCE LINE # 141
0039 850000      R     MOV     rx_queue+02H,rx_data
                                           ; SOURCE LINE # 144
003C E500        R     MOV     A,rx_queue+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 24  

003E B43A11            CJNE    A,#03AH,?C0007
0041 E500        R     MOV     A,rx_queue+02H
0043 B43A0C            CJNE    A,#03AH,?C0007
                                           ; SOURCE LINE # 145
0046 E4                CLR     A
0047 F500        R     MOV     rx_queue,A
                                           ; SOURCE LINE # 146
0049 F500        R     MOV     rx_queue+01H,A
                                           ; SOURCE LINE # 147
004B F500        R     MOV     rx_queue+02H,A
                                           ; SOURCE LINE # 148
004D 750001      R     MOV     state,#01H
                                           ; SOURCE LINE # 149
0050 80B1              SJMP    ?C0003
0052         ?C0007:
                                           ; SOURCE LINE # 150
0052 E500        R     MOV     A,rx_queue
0054 B43FAC            CJNE    A,#03FH,?C0003
0057 E500        R     MOV     A,rx_queue+01H
0059 B40DA7            CJNE    A,#0DH,?C0003
005C E500        R     MOV     A,rx_queue+02H
005E 640A              XRL     A,#0AH
0060 70A1              JNZ     ?C0003
                                           ; SOURCE LINE # 153
0062 FF                MOV     R7,A
0063 FE                MOV     R6,A
0064 120000      E     LCALL   _infoGet
                                           ; SOURCE LINE # 154
0067 809A              SJMP    ?C0003
                                           ; SOURCE LINE # 157
0069         ?C0010:
                                           ; SOURCE LINE # 160
0069 900000      E     MOV     DPTR,#c_mem+01H
006C E0                MOVX    A,@DPTR
006D 6500        R     XRL     A,rx_data
006F 6004              JZ      ?C0012
0071 E500        R     MOV     A,rx_data
0073 7004              JNZ     ?C0011
0075         ?C0012:
                                           ; SOURCE LINE # 161
0075 C200        R     CLR     rx_data_type
0077 8002              SJMP    ?C0013
0079         ?C0011:
                                           ; SOURCE LINE # 163
0079 D200        R     SETB    rx_data_type
007B         ?C0013:
                                           ; SOURCE LINE # 165
007B E4                CLR     A
007C F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 166
007E 750002      R     MOV     state,#02H
                                           ; SOURCE LINE # 167
0081 8080              SJMP    ?C0003
                                           ; SOURCE LINE # 170
0083         ?C0014:
                                           ; SOURCE LINE # 173
0083 850000      R     MOV     data_packet_length,rx_data
                                           ; SOURCE LINE # 175
0086 E500        R     MOV     A,data_packet_length
0088 D3                SETB    C
0089 9401              SUBB    A,#01H
008B 5008              JNC     ?C0015
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 25  

                                           ; SOURCE LINE # 176
008D E4                CLR     A
008E F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 177
0090 F500        R     MOV     state,A
                                           ; SOURCE LINE # 178
0092 020000      R     LJMP    ?C0003
0095         ?C0015:
0095 E500        R     MOV     A,data_packet_length
0097 D3                SETB    C
0098 9480              SUBB    A,#080H
009A 4008              JC      ?C0017
                                           ; SOURCE LINE # 179
009C E4                CLR     A
009D F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 180
009F F500        R     MOV     state,A
                                           ; SOURCE LINE # 181
00A1 020000      R     LJMP    ?C0003
00A4         ?C0017:
                                           ; SOURCE LINE # 182
00A4 E4                CLR     A
00A5 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 184
00A7 200006            JB      rx_data_type,?C0019
                                           ; SOURCE LINE # 185
00AA 750003      R     MOV     state,#03H
00AD 020000      R     LJMP    ?C0003
00B0         ?C0019:
                                           ; SOURCE LINE # 187
00B0 750004      R     MOV     state,#04H
                                           ; SOURCE LINE # 188
                                           ; SOURCE LINE # 189
00B3 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 192
00B6         ?C0021:
                                           ; SOURCE LINE # 194
00B6 7400        R     MOV     A,#LOW data_packet_buffer
00B8 2500        R     ADD     A,data_packet_index
00BA F582              MOV     DPL,A
00BC E4                CLR     A
00BD 3400        R     ADDC    A,#HIGH data_packet_buffer
00BF F583              MOV     DPH,A
00C1 E500        R     MOV     A,rx_data
00C3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 195
00C4 0500        R     INC     data_packet_index
                                           ; SOURCE LINE # 198
00C6 E500        R     MOV     A,data_packet_index
00C8 C3                CLR     C
00C9 9500        R     SUBB    A,data_packet_length
00CB 5003              JNC     $ + 5H
00CD 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 200
00D0 200025            JB      rx_data_type,?C0023
                                           ; SOURCE LINE # 202
00D3 AF00        R     MOV     R7,data_packet_length
00D5 7E00              MOV     R6,#00H
00D7 7800        E     MOV     R0,#LOW g_rx
00D9 7C00        E     MOV     R4,#HIGH g_rx
00DB 7D01              MOV     R5,#01H
00DD 7B01              MOV     R3,#01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 26  

00DF 7A00        R     MOV     R2,#HIGH data_packet_buffer
00E1 7900        R     MOV     R1,#LOW data_packet_buffer
00E3 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 203
00E6 900000      E     MOV     DPTR,#g_rx+080H
00E9 E4                CLR     A
00EA F0                MOVX    @DPTR,A
00EB A3                INC     DPTR
00EC E500        R     MOV     A,data_packet_length
00EE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 204
00EF 900000      E     MOV     DPTR,#g_rx+084H
00F2 7401              MOV     A,#01H
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 205
00F5 120000      E     LCALL   commProcess
                                           ; SOURCE LINE # 206
00F8         ?C0023:
                                           ; SOURCE LINE # 208
00F8 E4                CLR     A
00F9 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 209
00FB F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 210
00FD F500        R     MOV     state,A
                                           ; SOURCE LINE # 211
00FF 0500        R     INC     package_count
                                           ; SOURCE LINE # 213
                                           ; SOURCE LINE # 214
0101 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 217
0104         ?C0024:
                                           ; SOURCE LINE # 218
0104 1500        R     DEC     data_packet_length
0106 E500        R     MOV     A,data_packet_length
0108 6003              JZ      $ + 5H
010A 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 219
010D F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 220
010F F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 221
0111 7F01              MOV     R7,#01H
0113 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 222
0116 E4                CLR     A
0117 FF                MOV     R7,A
0118 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 223
011B E4                CLR     A
011C F500        R     MOV     state,A
                                           ; SOURCE LINE # 224
011E 0500        R     INC     package_count
                                           ; SOURCE LINE # 225
                                           ; SOURCE LINE # 226
0120 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 227
                                           ; SOURCE LINE # 228
0123 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 229
0126         ?C0026:
0126 22                RET     
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 27  

             ; FUNCTION interrupt_manager (END)

             ; FUNCTION function_scheduler (BEGIN)
                                           ; SOURCE LINE # 238
                                           ; SOURCE LINE # 242
0000 120000      E     LCALL   MY_TIMER_ReadCounter
0003 900000      E     MOV     DPTR,#timer_value0
0006 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 246
0009 7F01              MOV     R7,#01H
000B 120000      E     LCALL   _ADC_SOC_Write
                                           ; SOURCE LINE # 250
000E 300005            JNB     interrupt_flag,?C0027
                                           ; SOURCE LINE # 251
0011 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 252
0013 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 253
0016         ?C0027:
                                           ; SOURCE LINE # 257
0016 E4                CLR     A
0017 FF                MOV     R7,A
0018 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 261
001B 300005            JNB     interrupt_flag,?C0028
                                           ; SOURCE LINE # 262
001E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 263
0020 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 264
0023         ?C0028:
                                           ; SOURCE LINE # 266
0023 7F01              MOV     R7,#01H
0025 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 270
0028 300005            JNB     interrupt_flag,?C0029
                                           ; SOURCE LINE # 271
002B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 272
002D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 273
0030         ?C0029:
                                           ; SOURCE LINE # 275
0030 7F02              MOV     R7,#02H
0032 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 279
0035 300005            JNB     interrupt_flag,?C0030
                                           ; SOURCE LINE # 280
0038 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 281
003A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 282
003D         ?C0030:
                                           ; SOURCE LINE # 286
003D 120000      R     LCALL   motor_control
                                           ; SOURCE LINE # 290
0040 300005            JNB     interrupt_flag,?C0031
                                           ; SOURCE LINE # 291
0043 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 292
0045 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 293
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 28  

0048         ?C0031:
                                           ; SOURCE LINE # 297
0048 120000      R     LCALL   analog_read_end
                                           ; SOURCE LINE # 299
004B 300005            JNB     interrupt_flag,?C0032
                                           ; SOURCE LINE # 300
004E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 301
0050 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 302
0053         ?C0032:
                                           ; SOURCE LINE # 306
0053 120000      R     LCALL   overcurrent_control
                                           ; SOURCE LINE # 310
0056 300005            JNB     interrupt_flag,?C0033
                                           ; SOURCE LINE # 311
0059 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 312
005B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 313
005E         ?C0033:
                                           ; SOURCE LINE # 318
005E 900000      E     MOV     DPTR,#calib
0061 E0                MOVX    A,@DPTR
0062 B40124            CJNE    A,#01H,?C0034
                                           ; SOURCE LINE # 319
0065 900000      R     MOV     DPTR,#counter_calibration
0068 E0                MOVX    A,@DPTR
0069 7004              JNZ     ?C0242
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D 640A              XRL     A,#0AH
006F         ?C0242:
006F 700A              JNZ     ?C0035
                                           ; SOURCE LINE # 320
0071 120000      E     LCALL   calibration
                                           ; SOURCE LINE # 321
0074 E4                CLR     A
0075 900000      R     MOV     DPTR,#counter_calibration
0078 F0                MOVX    @DPTR,A
0079 A3                INC     DPTR
007A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 322
007B         ?C0035:
                                           ; SOURCE LINE # 323
007B 900000      R     MOV     DPTR,#counter_calibration+01H
007E E0                MOVX    A,@DPTR
007F 04                INC     A
0080 F0                MOVX    @DPTR,A
0081 7006              JNZ     ?C0243
0083 900000      R     MOV     DPTR,#counter_calibration
0086 E0                MOVX    A,@DPTR
0087 04                INC     A
0088 F0                MOVX    @DPTR,A
0089         ?C0243:
                                           ; SOURCE LINE # 324
0089         ?C0034:
                                           ; SOURCE LINE # 328
0089 300005            JNB     interrupt_flag,?C0036
                                           ; SOURCE LINE # 329
008C C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 330
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 29  

008E 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 331
0091         ?C0036:
                                           ; SOURCE LINE # 336
0091 7800        E     MOV     R0,#LOW g_measOld
0093 7C00        E     MOV     R4,#HIGH g_measOld
0095 7D01              MOV     R5,#01H
0097 7B01              MOV     R3,#01H
0099 7A00        E     MOV     R2,#HIGH g_meas
009B 7900        E     MOV     R1,#LOW g_meas
009D 7E00              MOV     R6,#00H
009F 7F37              MOV     R7,#037H
00A1 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 337
00A4 7800        E     MOV     R0,#LOW g_refOld
00A6 7C00        E     MOV     R4,#HIGH g_refOld
00A8 7D01              MOV     R5,#01H
00AA 7B01              MOV     R3,#01H
00AC 7A00        E     MOV     R2,#HIGH g_ref
00AE 7900        E     MOV     R1,#LOW g_ref
00B0 7E00              MOV     R6,#00H
00B2 7F19              MOV     R7,#019H
00B4 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 340
00B7 7800        E     MOV     R0,#LOW g_ref
00B9 7C00        E     MOV     R4,#HIGH g_ref
00BB 7D01              MOV     R5,#01H
00BD 7B01              MOV     R3,#01H
00BF 7A00        E     MOV     R2,#HIGH g_refNew
00C1 7900        E     MOV     R1,#LOW g_refNew
00C3 7E00              MOV     R6,#00H
00C5 7F19              MOV     R7,#019H
00C7 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 342
00CA 300005            JNB     interrupt_flag,?C0037
                                           ; SOURCE LINE # 343
00CD C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 344
00CF 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 345
00D2         ?C0037:
                                           ; SOURCE LINE # 347
00D2 120000      E     LCALL   MY_TIMER_ReadCounter
00D5 900000      E     MOV     DPTR,#timer_value
00D8 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 348
00DB 900000      E     MOV     DPTR,#timer_value
00DE E0                MOVX    A,@DPTR
00DF F8                MOV     R0,A
00E0 A3                INC     DPTR
00E1 E0                MOVX    A,@DPTR
00E2 F9                MOV     R1,A
00E3 A3                INC     DPTR
00E4 E0                MOVX    A,@DPTR
00E5 FA                MOV     R2,A
00E6 A3                INC     DPTR
00E7 E0                MOVX    A,@DPTR
00E8 FB                MOV     R3,A
00E9 900000      E     MOV     DPTR,#timer_value0
00EC E0                MOVX    A,@DPTR
00ED FC                MOV     R4,A
00EE A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 30  

00EF E0                MOVX    A,@DPTR
00F0 FD                MOV     R5,A
00F1 A3                INC     DPTR
00F2 E0                MOVX    A,@DPTR
00F3 FE                MOV     R6,A
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6 C3                CLR     C
00F7 9B                SUBB    A,R3
00F8 FF                MOV     R7,A
00F9 EE                MOV     A,R6
00FA 9A                SUBB    A,R2
00FB FE                MOV     R6,A
00FC ED                MOV     A,R5
00FD 99                SUBB    A,R1
00FE FD                MOV     R5,A
00FF EC                MOV     A,R4
0100 98                SUBB    A,R0
0101 FC                MOV     R4,A
0102 E4                CLR     A
0103 120000      E     LCALL   ?C?FCASTL
0106 7B00              MOV     R3,#00H
0108 7A24              MOV     R2,#024H
010A 7974              MOV     R1,#074H
010C 7849              MOV     R0,#049H
010E 120000      E     LCALL   ?C?FPDIV
0111 900000      E     MOV     DPTR,#cycle_time
0114 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 349
0117 7F40              MOV     R7,#040H
0119 7E4B              MOV     R6,#04BH
011B 7D4C              MOV     R5,#04CH
011D 7C00              MOV     R4,#00H
011F 120000      E     LCALL   _MY_TIMER_WriteCounter
                                           ; SOURCE LINE # 351
0122 22                RET     
             ; FUNCTION function_scheduler (END)

             ; FUNCTION motor_control (BEGIN)
                                           ; SOURCE LINE # 357
                                           ; SOURCE LINE # 359
0000 E4                CLR     A
0001 F500        R     MOV     pwm_input+03H,A
0003 F500        R     MOV     pwm_input+02H,A
0005 F500        R     MOV     pwm_input+01H,A
0007 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 369
0009 900000      E     MOV     DPTR,#c_mem+02H
000C E0                MOVX    A,@DPTR
000D FC                MOV     R4,A
000E A3                INC     DPTR
000F E0                MOVX    A,@DPTR
0010 FD                MOV     R5,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 FE                MOV     R6,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 F500        R     MOV     k_p+03H,A
0018 8E00        R     MOV     k_p+02H,R6
001A 8D00        R     MOV     k_p+01H,R5
001C 8C00        R     MOV     k_p,R4
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 31  

                                           ; SOURCE LINE # 370
001E A3                INC     DPTR
001F E0                MOVX    A,@DPTR
0020 FC                MOV     R4,A
0021 A3                INC     DPTR
0022 E0                MOVX    A,@DPTR
0023 FD                MOV     R5,A
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 FE                MOV     R6,A
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 F500        R     MOV     k_i+03H,A
002B 8E00        R     MOV     k_i+02H,R6
002D 8D00        R     MOV     k_i+01H,R5
002F 8C00        R     MOV     k_i,R4
                                           ; SOURCE LINE # 371
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 FC                MOV     R4,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 FD                MOV     R5,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FE                MOV     R6,A
003A A3                INC     DPTR
003B E0                MOVX    A,@DPTR
003C F500        R     MOV     k_d+03H,A
003E 8E00        R     MOV     k_d+02H,R6
0040 8D00        R     MOV     k_d+01H,R5
0042 8C00        R     MOV     k_d,R4
                                           ; SOURCE LINE # 373
0044 A3                INC     DPTR
0045 E0                MOVX    A,@DPTR
0046 FC                MOV     R4,A
0047 A3                INC     DPTR
0048 E0                MOVX    A,@DPTR
0049 FD                MOV     R5,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C FE                MOV     R6,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F F500        R     MOV     k_p_c+03H,A
0051 8E00        R     MOV     k_p_c+02H,R6
0053 8D00        R     MOV     k_p_c+01H,R5
0055 8C00        R     MOV     k_p_c,R4
                                           ; SOURCE LINE # 374
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FC                MOV     R4,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
005C FD                MOV     R5,A
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F FE                MOV     R6,A
0060 A3                INC     DPTR
0061 E0                MOVX    A,@DPTR
0062 F500        R     MOV     k_i_c+03H,A
0064 8E00        R     MOV     k_i_c+02H,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 32  

0066 8D00        R     MOV     k_i_c+01H,R5
0068 8C00        R     MOV     k_i_c,R4
                                           ; SOURCE LINE # 375
006A A3                INC     DPTR
006B E0                MOVX    A,@DPTR
006C FC                MOV     R4,A
006D A3                INC     DPTR
006E E0                MOVX    A,@DPTR
006F FD                MOV     R5,A
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 FE                MOV     R6,A
0073 A3                INC     DPTR
0074 E0                MOVX    A,@DPTR
0075 F500        R     MOV     k_d_c+03H,A
0077 8E00        R     MOV     k_d_c+02H,R6
0079 8D00        R     MOV     k_d_c+01H,R5
007B 8C00        R     MOV     k_d_c,R4
                                           ; SOURCE LINE # 377
007D A3                INC     DPTR
007E E0                MOVX    A,@DPTR
007F FC                MOV     R4,A
0080 A3                INC     DPTR
0081 E0                MOVX    A,@DPTR
0082 FD                MOV     R5,A
0083 A3                INC     DPTR
0084 E0                MOVX    A,@DPTR
0085 FE                MOV     R6,A
0086 A3                INC     DPTR
0087 E0                MOVX    A,@DPTR
0088 F500        R     MOV     k_p_dl+03H,A
008A 8E00        R     MOV     k_p_dl+02H,R6
008C 8D00        R     MOV     k_p_dl+01H,R5
008E 8C00        R     MOV     k_p_dl,R4
                                           ; SOURCE LINE # 378
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FC                MOV     R4,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FD                MOV     R5,A
0096 A3                INC     DPTR
0097 E0                MOVX    A,@DPTR
0098 FE                MOV     R6,A
0099 A3                INC     DPTR
009A E0                MOVX    A,@DPTR
009B F500        R     MOV     k_i_dl+03H,A
009D 8E00        R     MOV     k_i_dl+02H,R6
009F 8D00        R     MOV     k_i_dl+01H,R5
00A1 8C00        R     MOV     k_i_dl,R4
                                           ; SOURCE LINE # 379
00A3 A3                INC     DPTR
00A4 E0                MOVX    A,@DPTR
00A5 FC                MOV     R4,A
00A6 A3                INC     DPTR
00A7 E0                MOVX    A,@DPTR
00A8 FD                MOV     R5,A
00A9 A3                INC     DPTR
00AA E0                MOVX    A,@DPTR
00AB FE                MOV     R6,A
00AC A3                INC     DPTR
00AD E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 33  

00AE F500        R     MOV     k_d_dl+03H,A
00B0 8E00        R     MOV     k_d_dl+02H,R6
00B2 8D00        R     MOV     k_d_dl+01H,R5
00B4 8C00        R     MOV     k_d_dl,R4
                                           ; SOURCE LINE # 381
00B6 A3                INC     DPTR
00B7 E0                MOVX    A,@DPTR
00B8 FC                MOV     R4,A
00B9 A3                INC     DPTR
00BA E0                MOVX    A,@DPTR
00BB FD                MOV     R5,A
00BC A3                INC     DPTR
00BD E0                MOVX    A,@DPTR
00BE FE                MOV     R6,A
00BF A3                INC     DPTR
00C0 E0                MOVX    A,@DPTR
00C1 F500        R     MOV     k_p_c_dl+03H,A
00C3 8E00        R     MOV     k_p_c_dl+02H,R6
00C5 8D00        R     MOV     k_p_c_dl+01H,R5
00C7 8C00        R     MOV     k_p_c_dl,R4
                                           ; SOURCE LINE # 382
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB FC                MOV     R4,A
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE FD                MOV     R5,A
00CF A3                INC     DPTR
00D0 E0                MOVX    A,@DPTR
00D1 FE                MOV     R6,A
00D2 A3                INC     DPTR
00D3 E0                MOVX    A,@DPTR
00D4 F500        R     MOV     k_i_c_dl+03H,A
00D6 8E00        R     MOV     k_i_c_dl+02H,R6
00D8 8D00        R     MOV     k_i_c_dl+01H,R5
00DA 8C00        R     MOV     k_i_c_dl,R4
                                           ; SOURCE LINE # 383
00DC A3                INC     DPTR
00DD E0                MOVX    A,@DPTR
00DE FC                MOV     R4,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 FD                MOV     R5,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 FE                MOV     R6,A
00E5 A3                INC     DPTR
00E6 E0                MOVX    A,@DPTR
00E7 F500        R     MOV     k_d_c_dl+03H,A
00E9 8E00        R     MOV     k_d_c_dl+02H,R6
00EB 8D00        R     MOV     k_d_c_dl+01H,R5
00ED 8C00        R     MOV     k_d_c_dl,R4
                                           ; SOURCE LINE # 400
00EF 900000      E     MOV     DPTR,#c_mem+06BH
00F2 E0                MOVX    A,@DPTR
00F3 FE                MOV     R6,A
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6 FF                MOV     R7,A
00F7 FB                MOV     R3,A
00F8 AA06              MOV     R2,AR6
00FA E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 34  

00FB 900000      E     MOV     DPTR,#g_meas+017H
00FE E0                MOVX    A,@DPTR
00FF FC                MOV     R4,A
0100 A3                INC     DPTR
0101 E0                MOVX    A,@DPTR
0102 FD                MOV     R5,A
0103 A3                INC     DPTR
0104 E0                MOVX    A,@DPTR
0105 FE                MOV     R6,A
0106 A3                INC     DPTR
0107 E0                MOVX    A,@DPTR
0108 C3                CLR     C
0109 9B                SUBB    A,R3
010A F500        R     MOV     err_emg_1+03H,A
010C EE                MOV     A,R6
010D 9A                SUBB    A,R2
010E F500        R     MOV     err_emg_1+02H,A
0110 ED                MOV     A,R5
0111 9400              SUBB    A,#00H
0113 F500        R     MOV     err_emg_1+01H,A
0115 EC                MOV     A,R4
0116 9400              SUBB    A,#00H
0118 F500        R     MOV     err_emg_1,A
                                           ; SOURCE LINE # 401
011A 900000      E     MOV     DPTR,#c_mem+06DH
011D E0                MOVX    A,@DPTR
011E FE                MOV     R6,A
011F A3                INC     DPTR
0120 E0                MOVX    A,@DPTR
0121 FF                MOV     R7,A
0122 FB                MOV     R3,A
0123 AA06              MOV     R2,AR6
0125 E4                CLR     A
0126 900000      E     MOV     DPTR,#g_meas+01BH
0129 E0                MOVX    A,@DPTR
012A FC                MOV     R4,A
012B A3                INC     DPTR
012C E0                MOVX    A,@DPTR
012D FD                MOV     R5,A
012E A3                INC     DPTR
012F E0                MOVX    A,@DPTR
0130 FE                MOV     R6,A
0131 A3                INC     DPTR
0132 E0                MOVX    A,@DPTR
0133 C3                CLR     C
0134 9B                SUBB    A,R3
0135 F500        R     MOV     err_emg_2+03H,A
0137 EE                MOV     A,R6
0138 9A                SUBB    A,R2
0139 F500        R     MOV     err_emg_2+02H,A
013B ED                MOV     A,R5
013C 9400              SUBB    A,#00H
013E F500        R     MOV     err_emg_2+01H,A
0140 EC                MOV     A,R4
0141 9400              SUBB    A,#00H
0143 F500        R     MOV     err_emg_2,A
                                           ; SOURCE LINE # 404
0145 900000      E     MOV     DPTR,#c_mem+033H
0148 E0                MOVX    A,@DPTR
0149 24FE              ADD     A,#0FEH
014B 7003              JNZ     $ + 5H
014D 020000      R     LJMP    ?C0048
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 35  

0150 14                DEC     A
0151 7003              JNZ     $ + 5H
0153 020000      R     LJMP    ?C0051
0156 14                DEC     A
0157 7003              JNZ     $ + 5H
0159 020000      R     LJMP    ?C0054
015C 14                DEC     A
015D 7003              JNZ     $ + 5H
015F 020000      R     LJMP    ?C0064
0162 2404              ADD     A,#04H
0164 6003              JZ      $ + 5H
0166 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 406
0169         ?C0040:
                                           ; SOURCE LINE # 410
0169 900000      E     MOV     DPTR,#c_mem+079H
016C E0                MOVX    A,@DPTR
016D 6024              JZ      ?C0041
                                           ; SOURCE LINE # 411
016F A3                INC     DPTR
0170 E0                MOVX    A,@DPTR
0171 FF                MOV     R7,A
0172 33                RLC     A
0173 95E0              SUBB    A,ACC
0175 FE                MOV     R6,A
0176 FD                MOV     R5,A
0177 FC                MOV     R4,A
0178 900000      E     MOV     DPTR,#g_meas+08H
017B E0                MOVX    A,@DPTR
017C F8                MOV     R0,A
017D A3                INC     DPTR
017E E0                MOVX    A,@DPTR
017F F9                MOV     R1,A
0180 A3                INC     DPTR
0181 E0                MOVX    A,@DPTR
0182 FA                MOV     R2,A
0183 A3                INC     DPTR
0184 E0                MOVX    A,@DPTR
0185 FB                MOV     R3,A
0186 120000      E     LCALL   ?C?LMUL
0189 8F00        R     MOV     handle_value+03H,R7
018B 8E00        R     MOV     handle_value+02H,R6
018D 8D00        R     MOV     handle_value+01H,R5
018F 8C00        R     MOV     handle_value,R4
0191 8024              SJMP    ?C0042
0193         ?C0041:
                                           ; SOURCE LINE # 413
0193 900000      E     MOV     DPTR,#c_mem+07AH
0196 E0                MOVX    A,@DPTR
0197 FF                MOV     R7,A
0198 33                RLC     A
0199 95E0              SUBB    A,ACC
019B FE                MOV     R6,A
019C FD                MOV     R5,A
019D FC                MOV     R4,A
019E 900000      E     MOV     DPTR,#g_meas+04H
01A1 E0                MOVX    A,@DPTR
01A2 F8                MOV     R0,A
01A3 A3                INC     DPTR
01A4 E0                MOVX    A,@DPTR
01A5 F9                MOV     R1,A
01A6 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 36  

01A7 E0                MOVX    A,@DPTR
01A8 FA                MOV     R2,A
01A9 A3                INC     DPTR
01AA E0                MOVX    A,@DPTR
01AB FB                MOV     R3,A
01AC 120000      E     LCALL   ?C?LMUL
01AF 8F00        R     MOV     handle_value+03H,R7
01B1 8E00        R     MOV     handle_value+02H,R6
01B3 8D00        R     MOV     handle_value+01H,R5
01B5 8C00        R     MOV     handle_value,R4
01B7         ?C0042:
                                           ; SOURCE LINE # 417
01B7 900000      E     MOV     DPTR,#g_ref
01BA E0                MOVX    A,@DPTR
01BB F8                MOV     R0,A
01BC A3                INC     DPTR
01BD E0                MOVX    A,@DPTR
01BE F9                MOV     R1,A
01BF A3                INC     DPTR
01C0 E0                MOVX    A,@DPTR
01C1 FA                MOV     R2,A
01C2 A3                INC     DPTR
01C3 E0                MOVX    A,@DPTR
01C4 FB                MOV     R3,A
01C5 C3                CLR     C
01C6 E500        R     MOV     A,handle_value+03H
01C8 9B                SUBB    A,R3
01C9 FF                MOV     R7,A
01CA E500        R     MOV     A,handle_value+02H
01CC 9A                SUBB    A,R2
01CD FE                MOV     R6,A
01CE E500        R     MOV     A,handle_value+01H
01D0 99                SUBB    A,R1
01D1 FD                MOV     R5,A
01D2 E500        R     MOV     A,handle_value
01D4 98                SUBB    A,R0
01D5 FC                MOV     R4,A
01D6 900000      E     MOV     DPTR,#c_mem+061H
01D9 E0                MOVX    A,@DPTR
01DA F8                MOV     R0,A
01DB A3                INC     DPTR
01DC E0                MOVX    A,@DPTR
01DD F9                MOV     R1,A
01DE A3                INC     DPTR
01DF E0                MOVX    A,@DPTR
01E0 FA                MOV     R2,A
01E1 A3                INC     DPTR
01E2 E0                MOVX    A,@DPTR
01E3 FB                MOV     R3,A
01E4 C3                CLR     C
01E5 120000      E     LCALL   ?C?SLCMP
01E8 5044              JNC     ?C0043
01EA E4                CLR     A
01EB FF                MOV     R7,A
01EC FE                MOV     R6,A
01ED FD                MOV     R5,A
01EE FC                MOV     R4,A
01EF 900000      E     MOV     DPTR,#c_mem+061H
01F2 E0                MOVX    A,@DPTR
01F3 F8                MOV     R0,A
01F4 A3                INC     DPTR
01F5 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 37  

01F6 A3                INC     DPTR
01F7 E0                MOVX    A,@DPTR
01F8 A3                INC     DPTR
01F9 E0                MOVX    A,@DPTR
01FA C3                CLR     C
01FB 120000      E     LCALL   ?C?SLCMP
01FE 602E              JZ      ?C0043
                                           ; SOURCE LINE # 418
0200 900000      E     MOV     DPTR,#g_ref
0203 E0                MOVX    A,@DPTR
0204 FC                MOV     R4,A
0205 A3                INC     DPTR
0206 E0                MOVX    A,@DPTR
0207 FD                MOV     R5,A
0208 A3                INC     DPTR
0209 E0                MOVX    A,@DPTR
020A FE                MOV     R6,A
020B A3                INC     DPTR
020C E0                MOVX    A,@DPTR
020D FF                MOV     R7,A
020E 900000      E     MOV     DPTR,#c_mem+061H
0211 E0                MOVX    A,@DPTR
0212 F8                MOV     R0,A
0213 A3                INC     DPTR
0214 E0                MOVX    A,@DPTR
0215 A3                INC     DPTR
0216 E0                MOVX    A,@DPTR
0217 A3                INC     DPTR
0218 E0                MOVX    A,@DPTR
0219 EF                MOV     A,R7
021A 2B                ADD     A,R3
021B FF                MOV     R7,A
021C EE                MOV     A,R6
021D 3A                ADDC    A,R2
021E FE                MOV     R6,A
021F ED                MOV     A,R5
0220 39                ADDC    A,R1
0221 FD                MOV     R5,A
0222 EC                MOV     A,R4
0223 38                ADDC    A,R0
0224 FC                MOV     R4,A
0225 900000      E     MOV     DPTR,#g_ref
0228 120000      E     LCALL   ?C?LSTXDATA
022B 020000      R     LJMP    ?C0044
022E         ?C0043:
                                           ; SOURCE LINE # 419
                                           ; SOURCE LINE # 420
022E 900000      E     MOV     DPTR,#g_ref
0231 E0                MOVX    A,@DPTR
0232 F8                MOV     R0,A
0233 A3                INC     DPTR
0234 E0                MOVX    A,@DPTR
0235 F9                MOV     R1,A
0236 A3                INC     DPTR
0237 E0                MOVX    A,@DPTR
0238 FA                MOV     R2,A
0239 A3                INC     DPTR
023A E0                MOVX    A,@DPTR
023B FB                MOV     R3,A
023C C3                CLR     C
023D E500        R     MOV     A,handle_value+03H
023F 9B                SUBB    A,R3
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 38  

0240 FF                MOV     R7,A
0241 E500        R     MOV     A,handle_value+02H
0243 9A                SUBB    A,R2
0244 FE                MOV     R6,A
0245 E500        R     MOV     A,handle_value+01H
0247 99                SUBB    A,R1
0248 FD                MOV     R5,A
0249 E500        R     MOV     A,handle_value
024B 98                SUBB    A,R0
024C FC                MOV     R4,A
024D 900000      E     MOV     DPTR,#c_mem+065H
0250 E0                MOVX    A,@DPTR
0251 F8                MOV     R0,A
0252 A3                INC     DPTR
0253 E0                MOVX    A,@DPTR
0254 F9                MOV     R1,A
0255 A3                INC     DPTR
0256 E0                MOVX    A,@DPTR
0257 FA                MOV     R2,A
0258 A3                INC     DPTR
0259 E0                MOVX    A,@DPTR
025A FB                MOV     R3,A
025B D3                SETB    C
025C 120000      E     LCALL   ?C?SLCMP
025F 4042              JC      ?C0045
0261 E4                CLR     A
0262 FF                MOV     R7,A
0263 FE                MOV     R6,A
0264 FD                MOV     R5,A
0265 FC                MOV     R4,A
0266 900000      E     MOV     DPTR,#c_mem+065H
0269 E0                MOVX    A,@DPTR
026A F8                MOV     R0,A
026B A3                INC     DPTR
026C E0                MOVX    A,@DPTR
026D A3                INC     DPTR
026E E0                MOVX    A,@DPTR
026F A3                INC     DPTR
0270 E0                MOVX    A,@DPTR
0271 120000      E     LCALL   ?C?SLCMP
0274 602D              JZ      ?C0045
                                           ; SOURCE LINE # 421
0276 900000      E     MOV     DPTR,#g_ref
0279 E0                MOVX    A,@DPTR
027A FC                MOV     R4,A
027B A3                INC     DPTR
027C E0                MOVX    A,@DPTR
027D FD                MOV     R5,A
027E A3                INC     DPTR
027F E0                MOVX    A,@DPTR
0280 FE                MOV     R6,A
0281 A3                INC     DPTR
0282 E0                MOVX    A,@DPTR
0283 FF                MOV     R7,A
0284 900000      E     MOV     DPTR,#c_mem+065H
0287 E0                MOVX    A,@DPTR
0288 F8                MOV     R0,A
0289 A3                INC     DPTR
028A E0                MOVX    A,@DPTR
028B A3                INC     DPTR
028C E0                MOVX    A,@DPTR
028D A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 39  

028E E0                MOVX    A,@DPTR
028F EF                MOV     A,R7
0290 2B                ADD     A,R3
0291 FF                MOV     R7,A
0292 EE                MOV     A,R6
0293 3A                ADDC    A,R2
0294 FE                MOV     R6,A
0295 ED                MOV     A,R5
0296 39                ADDC    A,R1
0297 FD                MOV     R5,A
0298 EC                MOV     A,R4
0299 38                ADDC    A,R0
029A FC                MOV     R4,A
029B 900000      E     MOV     DPTR,#g_ref
029E 120000      E     LCALL   ?C?LSTXDATA
02A1 800E              SJMP    ?C0044
02A3         ?C0045:
                                           ; SOURCE LINE # 423
02A3 AF00        R     MOV     R7,handle_value+03H
02A5 AE00        R     MOV     R6,handle_value+02H
02A7 AD00        R     MOV     R5,handle_value+01H
02A9 AC00        R     MOV     R4,handle_value
02AB 900000      E     MOV     DPTR,#g_ref
02AE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 424
02B1         ?C0044:
                                           ; SOURCE LINE # 426
02B1 900000      E     MOV     DPTR,#normally_closed_mode
02B4 E0                MOVX    A,@DPTR
02B5 6401              XRL     A,#01H
02B7 6003              JZ      $ + 5H
02B9 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 427
02BC 900000      E     MOV     DPTR,#g_ref
02BF E0                MOVX    A,@DPTR
02C0 F8                MOV     R0,A
02C1 A3                INC     DPTR
02C2 E0                MOVX    A,@DPTR
02C3 F9                MOV     R1,A
02C4 A3                INC     DPTR
02C5 E0                MOVX    A,@DPTR
02C6 FA                MOV     R2,A
02C7 A3                INC     DPTR
02C8 E0                MOVX    A,@DPTR
02C9 FB                MOV     R3,A
02CA 900000      E     MOV     DPTR,#g_mem+059H
02CD E0                MOVX    A,@DPTR
02CE FC                MOV     R4,A
02CF A3                INC     DPTR
02D0 E0                MOVX    A,@DPTR
02D1 FD                MOV     R5,A
02D2 A3                INC     DPTR
02D3 E0                MOVX    A,@DPTR
02D4 FE                MOV     R6,A
02D5 A3                INC     DPTR
02D6 E0                MOVX    A,@DPTR
02D7 C3                CLR     C
02D8 9B                SUBB    A,R3
02D9 FF                MOV     R7,A
02DA EE                MOV     A,R6
02DB 9A                SUBB    A,R2
02DC FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 40  

02DD ED                MOV     A,R5
02DE 99                SUBB    A,R1
02DF FD                MOV     R5,A
02E0 EC                MOV     A,R4
02E1 98                SUBB    A,R0
02E2 FC                MOV     R4,A
02E3 900000      E     MOV     DPTR,#g_ref
02E6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 429
02E9 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 431
02EC         ?C0048:
                                           ; SOURCE LINE # 432
02EC E4                CLR     A
02ED FF                MOV     R7,A
02EE FE                MOV     R6,A
02EF FD                MOV     R5,A
02F0 FC                MOV     R4,A
02F1 AB00        R     MOV     R3,err_emg_1+03H
02F3 AA00        R     MOV     R2,err_emg_1+02H
02F5 A900        R     MOV     R1,err_emg_1+01H
02F7 A800        R     MOV     R0,err_emg_1
02F9 D3                SETB    C
02FA 120000      E     LCALL   ?C?SLCMP
02FD 403D              JC      ?C0049
                                           ; SOURCE LINE # 433
02FF 900000      E     MOV     DPTR,#g_mem+059H
0302 E0                MOVX    A,@DPTR
0303 FC                MOV     R4,A
0304 A3                INC     DPTR
0305 E0                MOVX    A,@DPTR
0306 FD                MOV     R5,A
0307 A3                INC     DPTR
0308 E0                MOVX    A,@DPTR
0309 FE                MOV     R6,A
030A A3                INC     DPTR
030B E0                MOVX    A,@DPTR
030C FF                MOV     R7,A
030D A800        R     MOV     R0,err_emg_1
030F 120000      E     LCALL   ?C?LMUL
0312 C006              PUSH    AR6
0314 C007              PUSH    AR7
0316 900000      E     MOV     DPTR,#c_mem+06BH
0319 E0                MOVX    A,@DPTR
031A FE                MOV     R6,A
031B A3                INC     DPTR
031C E0                MOVX    A,@DPTR
031D FF                MOV     R7,A
031E C3                CLR     C
031F E4                CLR     A
0320 9F                SUBB    A,R7
0321 FF                MOV     R7,A
0322 7404              MOV     A,#04H
0324 9E                SUBB    A,R6
0325 FE                MOV     R6,A
0326 AB07              MOV     R3,AR7
0328 FA                MOV     R2,A
0329 E4                CLR     A
032A F9                MOV     R1,A
032B F8                MOV     R0,A
032C D007              POP     AR7
032E D006              POP     AR6
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 41  

0330 120000      E     LCALL   ?C?SLDIV
0333 900000      E     MOV     DPTR,#g_ref
0336 120000      E     LCALL   ?C?LSTXDATA
0339 020000      R     LJMP    ?C0039
033C         ?C0049:
                                           ; SOURCE LINE # 435
033C E4                CLR     A
033D FF                MOV     R7,A
033E FE                MOV     R6,A
033F FD                MOV     R5,A
0340 FC                MOV     R4,A
0341 900000      E     MOV     DPTR,#g_ref
0344 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 436
0347 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 438
034A         ?C0051:
                                           ; SOURCE LINE # 439
034A 900000      E     MOV     DPTR,#g_refOld
034D E0                MOVX    A,@DPTR
034E FC                MOV     R4,A
034F A3                INC     DPTR
0350 E0                MOVX    A,@DPTR
0351 FD                MOV     R5,A
0352 A3                INC     DPTR
0353 E0                MOVX    A,@DPTR
0354 FE                MOV     R6,A
0355 A3                INC     DPTR
0356 E0                MOVX    A,@DPTR
0357 FF                MOV     R7,A
0358 900000      E     MOV     DPTR,#g_ref
035B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 440
035E E4                CLR     A
035F FF                MOV     R7,A
0360 FE                MOV     R6,A
0361 FD                MOV     R5,A
0362 FC                MOV     R4,A
0363 AB00        R     MOV     R3,err_emg_1+03H
0365 AA00        R     MOV     R2,err_emg_1+02H
0367 A900        R     MOV     R1,err_emg_1+01H
0369 A800        R     MOV     R0,err_emg_1
036B D3                SETB    C
036C 120000      E     LCALL   ?C?SLCMP
036F 4056              JC      ?C0052
                                           ; SOURCE LINE # 441
0371 900000      E     MOV     DPTR,#g_mem+078H
0374 E0                MOVX    A,@DPTR
0375 FF                MOV     R7,A
0376 E4                CLR     A
0377 FC                MOV     R4,A
0378 FD                MOV     R5,A
0379 FE                MOV     R6,A
037A A800        R     MOV     R0,err_emg_1
037C 120000      E     LCALL   ?C?LMUL
037F E4                CLR     A
0380 7B02              MOV     R3,#02H
0382 FA                MOV     R2,A
0383 F9                MOV     R1,A
0384 F8                MOV     R0,A
0385 120000      E     LCALL   ?C?LMUL
0388 C006              PUSH    AR6
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 42  

038A C007              PUSH    AR7
038C 900000      E     MOV     DPTR,#c_mem+06BH
038F E0                MOVX    A,@DPTR
0390 FE                MOV     R6,A
0391 A3                INC     DPTR
0392 E0                MOVX    A,@DPTR
0393 FF                MOV     R7,A
0394 C3                CLR     C
0395 E4                CLR     A
0396 9F                SUBB    A,R7
0397 FF                MOV     R7,A
0398 7404              MOV     A,#04H
039A 9E                SUBB    A,R6
039B FE                MOV     R6,A
039C AB07              MOV     R3,AR7
039E FA                MOV     R2,A
039F E4                CLR     A
03A0 F9                MOV     R1,A
03A1 F8                MOV     R0,A
03A2 D007              POP     AR7
03A4 D006              POP     AR6
03A6 120000      E     LCALL   ?C?SLDIV
03A9 900000      E     MOV     DPTR,#g_refOld
03AC E0                MOVX    A,@DPTR
03AD F8                MOV     R0,A
03AE A3                INC     DPTR
03AF E0                MOVX    A,@DPTR
03B0 F9                MOV     R1,A
03B1 A3                INC     DPTR
03B2 E0                MOVX    A,@DPTR
03B3 FA                MOV     R2,A
03B4 A3                INC     DPTR
03B5 E0                MOVX    A,@DPTR
03B6 2F                ADD     A,R7
03B7 FF                MOV     R7,A
03B8 EA                MOV     A,R2
03B9 3E                ADDC    A,R6
03BA FE                MOV     R6,A
03BB E9                MOV     A,R1
03BC 3D                ADDC    A,R5
03BD FD                MOV     R5,A
03BE E8                MOV     A,R0
03BF 3C                ADDC    A,R4
03C0 FC                MOV     R4,A
03C1 900000      E     MOV     DPTR,#g_ref
03C4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 442
03C7         ?C0052:
                                           ; SOURCE LINE # 443
03C7 E4                CLR     A
03C8 FF                MOV     R7,A
03C9 FE                MOV     R6,A
03CA FD                MOV     R5,A
03CB FC                MOV     R4,A
03CC AB00        R     MOV     R3,err_emg_2+03H
03CE AA00        R     MOV     R2,err_emg_2+02H
03D0 A900        R     MOV     R1,err_emg_2+01H
03D2 A800        R     MOV     R0,err_emg_2
03D4 D3                SETB    C
03D5 120000      E     LCALL   ?C?SLCMP
03D8 5003              JNC     $ + 5H
03DA 020000      R     LJMP    ?C0039
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 43  

                                           ; SOURCE LINE # 444
03DD 900000      E     MOV     DPTR,#g_mem+078H
03E0 E0                MOVX    A,@DPTR
03E1 FF                MOV     R7,A
03E2 E4                CLR     A
03E3 FC                MOV     R4,A
03E4 FD                MOV     R5,A
03E5 FE                MOV     R6,A
03E6 A800        R     MOV     R0,err_emg_2
03E8 120000      E     LCALL   ?C?LMUL
03EB E4                CLR     A
03EC 7B02              MOV     R3,#02H
03EE FA                MOV     R2,A
03EF F9                MOV     R1,A
03F0 F8                MOV     R0,A
03F1 120000      E     LCALL   ?C?LMUL
03F4 C006              PUSH    AR6
03F6 C007              PUSH    AR7
03F8 900000      E     MOV     DPTR,#c_mem+06DH
03FB E0                MOVX    A,@DPTR
03FC FE                MOV     R6,A
03FD A3                INC     DPTR
03FE E0                MOVX    A,@DPTR
03FF FF                MOV     R7,A
0400 C3                CLR     C
0401 E4                CLR     A
0402 9F                SUBB    A,R7
0403 FF                MOV     R7,A
0404 7404              MOV     A,#04H
0406 9E                SUBB    A,R6
0407 FE                MOV     R6,A
0408 AB07              MOV     R3,AR7
040A FA                MOV     R2,A
040B E4                CLR     A
040C F9                MOV     R1,A
040D F8                MOV     R0,A
040E D007              POP     AR7
0410 D006              POP     AR6
0412 120000      E     LCALL   ?C?SLDIV
0415 A804              MOV     R0,AR4
0417 A905              MOV     R1,AR5
0419 AA06              MOV     R2,AR6
041B AB07              MOV     R3,AR7
041D 900000      E     MOV     DPTR,#g_refOld
0420 E0                MOVX    A,@DPTR
0421 FC                MOV     R4,A
0422 A3                INC     DPTR
0423 E0                MOVX    A,@DPTR
0424 FD                MOV     R5,A
0425 A3                INC     DPTR
0426 E0                MOVX    A,@DPTR
0427 FE                MOV     R6,A
0428 A3                INC     DPTR
0429 E0                MOVX    A,@DPTR
042A C3                CLR     C
042B 9B                SUBB    A,R3
042C FF                MOV     R7,A
042D EE                MOV     A,R6
042E 9A                SUBB    A,R2
042F FE                MOV     R6,A
0430 ED                MOV     A,R5
0431 99                SUBB    A,R1
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 44  

0432 FD                MOV     R5,A
0433 EC                MOV     A,R4
0434 98                SUBB    A,R0
0435 FC                MOV     R4,A
0436 900000      E     MOV     DPTR,#g_ref
0439 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 445
                                           ; SOURCE LINE # 446
043C 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 448
043F         ?C0054:
                                           ; SOURCE LINE # 449
043F 900000      E     MOV     DPTR,#g_refOld
0442 E0                MOVX    A,@DPTR
0443 FC                MOV     R4,A
0444 A3                INC     DPTR
0445 E0                MOVX    A,@DPTR
0446 FD                MOV     R5,A
0447 A3                INC     DPTR
0448 E0                MOVX    A,@DPTR
0449 FE                MOV     R6,A
044A A3                INC     DPTR
044B E0                MOVX    A,@DPTR
044C FF                MOV     R7,A
044D 900000      E     MOV     DPTR,#g_ref
0450 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 450
0453 900000      R     MOV     DPTR,#current_emg
0456 E0                MOVX    A,@DPTR
0457 14                DEC     A
0458 6048              JZ      ?C0059
045A 14                DEC     A
045B 7003              JNZ     $ + 5H
045D 020000      R     LJMP    ?C0061
0460 2402              ADD     A,#02H
0462 6003              JZ      $ + 5H
0464 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 451
0467         ?C0056:
                                           ; SOURCE LINE # 453
0467 E4                CLR     A
0468 FF                MOV     R7,A
0469 FE                MOV     R6,A
046A FD                MOV     R5,A
046B FC                MOV     R4,A
046C AB00        R     MOV     R3,err_emg_1+03H
046E AA00        R     MOV     R2,err_emg_1+02H
0470 A900        R     MOV     R1,err_emg_1+01H
0472 A800        R     MOV     R0,err_emg_1
0474 D3                SETB    C
0475 120000      E     LCALL   ?C?SLCMP
0478 4009              JC      ?C0057
                                           ; SOURCE LINE # 454
047A 900000      R     MOV     DPTR,#current_emg
047D 7401              MOV     A,#01H
047F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 455
0480 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 456
0483         ?C0057:
                                           ; SOURCE LINE # 457
0483 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 45  

0484 FF                MOV     R7,A
0485 FE                MOV     R6,A
0486 FD                MOV     R5,A
0487 FC                MOV     R4,A
0488 AB00        R     MOV     R3,err_emg_2+03H
048A AA00        R     MOV     R2,err_emg_2+02H
048C A900        R     MOV     R1,err_emg_2+01H
048E A800        R     MOV     R0,err_emg_2
0490 D3                SETB    C
0491 120000      E     LCALL   ?C?SLCMP
0494 5003              JNC     $ + 5H
0496 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 458
0499 900000      R     MOV     DPTR,#current_emg
049C 7402              MOV     A,#02H
049E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 459
049F 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 460
                                           ; SOURCE LINE # 461
                                           ; SOURCE LINE # 463
04A2         ?C0059:
                                           ; SOURCE LINE # 465
04A2 E4                CLR     A
04A3 FF                MOV     R7,A
04A4 FE                MOV     R6,A
04A5 FD                MOV     R5,A
04A6 FC                MOV     R4,A
04A7 AB00        R     MOV     R3,err_emg_1+03H
04A9 AA00        R     MOV     R2,err_emg_1+02H
04AB A900        R     MOV     R1,err_emg_1+01H
04AD A800        R     MOV     R0,err_emg_1
04AF C3                CLR     C
04B0 120000      E     LCALL   ?C?SLCMP
04B3 5008              JNC     ?C0060
                                           ; SOURCE LINE # 466
04B5 E4                CLR     A
04B6 900000      R     MOV     DPTR,#current_emg
04B9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 467
04BA 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 468
04BD         ?C0060:
                                           ; SOURCE LINE # 469
04BD 900000      E     MOV     DPTR,#g_mem+078H
04C0 E0                MOVX    A,@DPTR
04C1 FF                MOV     R7,A
04C2 E4                CLR     A
04C3 FC                MOV     R4,A
04C4 FD                MOV     R5,A
04C5 FE                MOV     R6,A
04C6 AB00        R     MOV     R3,err_emg_1+03H
04C8 AA00        R     MOV     R2,err_emg_1+02H
04CA A900        R     MOV     R1,err_emg_1+01H
04CC A800        R     MOV     R0,err_emg_1
04CE 120000      E     LCALL   ?C?LMUL
04D1 E4                CLR     A
04D2 7B02              MOV     R3,#02H
04D4 FA                MOV     R2,A
04D5 F9                MOV     R1,A
04D6 F8                MOV     R0,A
04D7 120000      E     LCALL   ?C?LMUL
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 46  

04DA C006              PUSH    AR6
04DC C007              PUSH    AR7
04DE 900000      E     MOV     DPTR,#c_mem+06BH
04E1 E0                MOVX    A,@DPTR
04E2 FE                MOV     R6,A
04E3 A3                INC     DPTR
04E4 E0                MOVX    A,@DPTR
04E5 FF                MOV     R7,A
04E6 C3                CLR     C
04E7 E4                CLR     A
04E8 9F                SUBB    A,R7
04E9 FF                MOV     R7,A
04EA 7404              MOV     A,#04H
04EC 9E                SUBB    A,R6
04ED FE                MOV     R6,A
04EE AB07              MOV     R3,AR7
04F0 FA                MOV     R2,A
04F1 E4                CLR     A
04F2 F9                MOV     R1,A
04F3 F8                MOV     R0,A
04F4 D007              POP     AR7
04F6 D006              POP     AR6
04F8 120000      E     LCALL   ?C?SLDIV
04FB 900000      E     MOV     DPTR,#g_refOld
04FE E0                MOVX    A,@DPTR
04FF F8                MOV     R0,A
0500 A3                INC     DPTR
0501 E0                MOVX    A,@DPTR
0502 F9                MOV     R1,A
0503 A3                INC     DPTR
0504 E0                MOVX    A,@DPTR
0505 FA                MOV     R2,A
0506 A3                INC     DPTR
0507 E0                MOVX    A,@DPTR
0508 2F                ADD     A,R7
0509 FF                MOV     R7,A
050A EA                MOV     A,R2
050B 3E                ADDC    A,R6
050C FE                MOV     R6,A
050D E9                MOV     A,R1
050E 3D                ADDC    A,R5
050F FD                MOV     R5,A
0510 E8                MOV     A,R0
0511 3C                ADDC    A,R4
0512 FC                MOV     R4,A
0513 900000      E     MOV     DPTR,#g_ref
0516 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 470
0519 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 472
051C         ?C0061:
                                           ; SOURCE LINE # 474
051C E4                CLR     A
051D FF                MOV     R7,A
051E FE                MOV     R6,A
051F FD                MOV     R5,A
0520 FC                MOV     R4,A
0521 AB00        R     MOV     R3,err_emg_2+03H
0523 AA00        R     MOV     R2,err_emg_2+02H
0525 A900        R     MOV     R1,err_emg_2+01H
0527 A800        R     MOV     R0,err_emg_2
0529 C3                CLR     C
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 47  

052A 120000      E     LCALL   ?C?SLCMP
052D 5008              JNC     ?C0062
                                           ; SOURCE LINE # 475
052F E4                CLR     A
0530 900000      R     MOV     DPTR,#current_emg
0533 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 476
0534 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 477
0537         ?C0062:
                                           ; SOURCE LINE # 478
0537 900000      E     MOV     DPTR,#g_mem+078H
053A E0                MOVX    A,@DPTR
053B FF                MOV     R7,A
053C E4                CLR     A
053D FC                MOV     R4,A
053E FD                MOV     R5,A
053F FE                MOV     R6,A
0540 AB00        R     MOV     R3,err_emg_2+03H
0542 AA00        R     MOV     R2,err_emg_2+02H
0544 A900        R     MOV     R1,err_emg_2+01H
0546 A800        R     MOV     R0,err_emg_2
0548 120000      E     LCALL   ?C?LMUL
054B E4                CLR     A
054C 7B02              MOV     R3,#02H
054E FA                MOV     R2,A
054F F9                MOV     R1,A
0550 F8                MOV     R0,A
0551 120000      E     LCALL   ?C?LMUL
0554 C006              PUSH    AR6
0556 C007              PUSH    AR7
0558 900000      E     MOV     DPTR,#c_mem+06DH
055B E0                MOVX    A,@DPTR
055C FE                MOV     R6,A
055D A3                INC     DPTR
055E E0                MOVX    A,@DPTR
055F FF                MOV     R7,A
0560 C3                CLR     C
0561 E4                CLR     A
0562 9F                SUBB    A,R7
0563 FF                MOV     R7,A
0564 7404              MOV     A,#04H
0566 9E                SUBB    A,R6
0567 FE                MOV     R6,A
0568 AB07              MOV     R3,AR7
056A FA                MOV     R2,A
056B E4                CLR     A
056C F9                MOV     R1,A
056D F8                MOV     R0,A
056E D007              POP     AR7
0570 D006              POP     AR6
0572 120000      E     LCALL   ?C?SLDIV
0575 A804              MOV     R0,AR4
0577 A905              MOV     R1,AR5
0579 AA06              MOV     R2,AR6
057B AB07              MOV     R3,AR7
057D 900000      E     MOV     DPTR,#g_refOld
0580 E0                MOVX    A,@DPTR
0581 FC                MOV     R4,A
0582 A3                INC     DPTR
0583 E0                MOVX    A,@DPTR
0584 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 48  

0585 A3                INC     DPTR
0586 E0                MOVX    A,@DPTR
0587 FE                MOV     R6,A
0588 A3                INC     DPTR
0589 E0                MOVX    A,@DPTR
058A C3                CLR     C
058B 9B                SUBB    A,R3
058C FF                MOV     R7,A
058D EE                MOV     A,R6
058E 9A                SUBB    A,R2
058F FE                MOV     R6,A
0590 ED                MOV     A,R5
0591 99                SUBB    A,R1
0592 FD                MOV     R5,A
0593 EC                MOV     A,R4
0594 98                SUBB    A,R0
0595 FC                MOV     R4,A
0596 900000      E     MOV     DPTR,#g_ref
0599 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 479
059C 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 481
                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 483
                                           ; SOURCE LINE # 485
059F 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 487
05A2         ?C0064:
                                           ; SOURCE LINE # 488
05A2 900000      E     MOV     DPTR,#g_refOld
05A5 E0                MOVX    A,@DPTR
05A6 FC                MOV     R4,A
05A7 A3                INC     DPTR
05A8 E0                MOVX    A,@DPTR
05A9 FD                MOV     R5,A
05AA A3                INC     DPTR
05AB E0                MOVX    A,@DPTR
05AC FE                MOV     R6,A
05AD A3                INC     DPTR
05AE E0                MOVX    A,@DPTR
05AF FF                MOV     R7,A
05B0 900000      E     MOV     DPTR,#g_ref
05B3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 489
05B6 900000      R     MOV     DPTR,#current_emg
05B9 E0                MOVX    A,@DPTR
05BA 14                DEC     A
05BB 6048              JZ      ?C0069
05BD 14                DEC     A
05BE 7003              JNZ     $ + 5H
05C0 020000      R     LJMP    ?C0072
05C3 2402              ADD     A,#02H
05C5 6003              JZ      $ + 5H
05C7 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 491
05CA         ?C0066:
                                           ; SOURCE LINE # 492
05CA E4                CLR     A
05CB FF                MOV     R7,A
05CC FE                MOV     R6,A
05CD FD                MOV     R5,A
05CE FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 49  

05CF AB00        R     MOV     R3,err_emg_1+03H
05D1 AA00        R     MOV     R2,err_emg_1+02H
05D3 A900        R     MOV     R1,err_emg_1+01H
05D5 A800        R     MOV     R0,err_emg_1
05D7 D3                SETB    C
05D8 120000      E     LCALL   ?C?SLCMP
05DB 4009              JC      ?C0067
                                           ; SOURCE LINE # 493
05DD 900000      R     MOV     DPTR,#current_emg
05E0 7401              MOV     A,#01H
05E2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 494
05E3 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 495
05E6         ?C0067:
                                           ; SOURCE LINE # 496
05E6 E4                CLR     A
05E7 FF                MOV     R7,A
05E8 FE                MOV     R6,A
05E9 FD                MOV     R5,A
05EA FC                MOV     R4,A
05EB AB00        R     MOV     R3,err_emg_2+03H
05ED AA00        R     MOV     R2,err_emg_2+02H
05EF A900        R     MOV     R1,err_emg_2+01H
05F1 A800        R     MOV     R0,err_emg_2
05F3 D3                SETB    C
05F4 120000      E     LCALL   ?C?SLCMP
05F7 5003              JNC     $ + 5H
05F9 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 497
05FC 900000      R     MOV     DPTR,#current_emg
05FF 7402              MOV     A,#02H
0601 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 498
0602 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 499
                                           ; SOURCE LINE # 500
                                           ; SOURCE LINE # 503
0605         ?C0069:
                                           ; SOURCE LINE # 505
0605 E4                CLR     A
0606 FF                MOV     R7,A
0607 FE                MOV     R6,A
0608 FD                MOV     R5,A
0609 FC                MOV     R4,A
060A AB00        R     MOV     R3,err_emg_1+03H
060C AA00        R     MOV     R2,err_emg_1+02H
060E A900        R     MOV     R1,err_emg_1+01H
0610 A800        R     MOV     R0,err_emg_1
0612 C3                CLR     C
0613 120000      E     LCALL   ?C?SLCMP
0616 501B              JNC     ?C0070
0618 E4                CLR     A
0619 FF                MOV     R7,A
061A FE                MOV     R6,A
061B FD                MOV     R5,A
061C FC                MOV     R4,A
061D AB00        R     MOV     R3,err_emg_2+03H
061F AA00        R     MOV     R2,err_emg_2+02H
0621 A900        R     MOV     R1,err_emg_2+01H
0623 A800        R     MOV     R0,err_emg_2
0625 C3                CLR     C
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 50  

0626 120000      E     LCALL   ?C?SLCMP
0629 5008              JNC     ?C0070
                                           ; SOURCE LINE # 506
062B E4                CLR     A
062C 900000      R     MOV     DPTR,#current_emg
062F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 507
0630 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 508
0633         ?C0070:
                                           ; SOURCE LINE # 510
0633 E4                CLR     A
0634 FF                MOV     R7,A
0635 FE                MOV     R6,A
0636 FD                MOV     R5,A
0637 FC                MOV     R4,A
0638 AB00        R     MOV     R3,err_emg_1+03H
063A AA00        R     MOV     R2,err_emg_1+02H
063C A900        R     MOV     R1,err_emg_1+01H
063E A800        R     MOV     R0,err_emg_1
0640 D3                SETB    C
0641 120000      E     LCALL   ?C?SLCMP
0644 5003              JNC     $ + 5H
0646 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 511
0649 900000      E     MOV     DPTR,#g_mem+078H
064C E0                MOVX    A,@DPTR
064D FF                MOV     R7,A
064E E4                CLR     A
064F FC                MOV     R4,A
0650 FD                MOV     R5,A
0651 FE                MOV     R6,A
0652 A800        R     MOV     R0,err_emg_1
0654 120000      E     LCALL   ?C?LMUL
0657 7802              MOV     R0,#02H
0659 120000      E     LCALL   ?C?LSHL
065C C006              PUSH    AR6
065E C007              PUSH    AR7
0660 900000      E     MOV     DPTR,#c_mem+06BH
0663 E0                MOVX    A,@DPTR
0664 FE                MOV     R6,A
0665 A3                INC     DPTR
0666 E0                MOVX    A,@DPTR
0667 FF                MOV     R7,A
0668 C3                CLR     C
0669 E4                CLR     A
066A 9F                SUBB    A,R7
066B FF                MOV     R7,A
066C 7404              MOV     A,#04H
066E 9E                SUBB    A,R6
066F FE                MOV     R6,A
0670 AB07              MOV     R3,AR7
0672 FA                MOV     R2,A
0673 E4                CLR     A
0674 F9                MOV     R1,A
0675 F8                MOV     R0,A
0676 D007              POP     AR7
0678 D006              POP     AR6
067A 120000      E     LCALL   ?C?SLDIV
067D 900000      E     MOV     DPTR,#g_refOld
0680 E0                MOVX    A,@DPTR
0681 F8                MOV     R0,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 51  

0682 A3                INC     DPTR
0683 E0                MOVX    A,@DPTR
0684 F9                MOV     R1,A
0685 A3                INC     DPTR
0686 E0                MOVX    A,@DPTR
0687 FA                MOV     R2,A
0688 A3                INC     DPTR
0689 E0                MOVX    A,@DPTR
068A 2F                ADD     A,R7
068B FF                MOV     R7,A
068C EA                MOV     A,R2
068D 3E                ADDC    A,R6
068E FE                MOV     R6,A
068F E9                MOV     A,R1
0690 3D                ADDC    A,R5
0691 FD                MOV     R5,A
0692 E8                MOV     A,R0
0693 3C                ADDC    A,R4
0694 FC                MOV     R4,A
0695 900000      E     MOV     DPTR,#g_ref
0698 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 513
069B 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 516
069E         ?C0072:
                                           ; SOURCE LINE # 518
069E E4                CLR     A
069F FF                MOV     R7,A
06A0 FE                MOV     R6,A
06A1 FD                MOV     R5,A
06A2 FC                MOV     R4,A
06A3 AB00        R     MOV     R3,err_emg_1+03H
06A5 AA00        R     MOV     R2,err_emg_1+02H
06A7 A900        R     MOV     R1,err_emg_1+01H
06A9 A800        R     MOV     R0,err_emg_1
06AB C3                CLR     C
06AC 120000      E     LCALL   ?C?SLCMP
06AF 501A              JNC     ?C0073
06B1 E4                CLR     A
06B2 FF                MOV     R7,A
06B3 FE                MOV     R6,A
06B4 FD                MOV     R5,A
06B5 FC                MOV     R4,A
06B6 AB00        R     MOV     R3,err_emg_2+03H
06B8 AA00        R     MOV     R2,err_emg_2+02H
06BA A900        R     MOV     R1,err_emg_2+01H
06BC A800        R     MOV     R0,err_emg_2
06BE C3                CLR     C
06BF 120000      E     LCALL   ?C?SLCMP
06C2 5007              JNC     ?C0073
                                           ; SOURCE LINE # 519
06C4 E4                CLR     A
06C5 900000      R     MOV     DPTR,#current_emg
06C8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 520
06C9 806E              SJMP    ?C0039
                                           ; SOURCE LINE # 521
06CB         ?C0073:
                                           ; SOURCE LINE # 523
06CB E4                CLR     A
06CC FF                MOV     R7,A
06CD FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 52  

06CE FD                MOV     R5,A
06CF FC                MOV     R4,A
06D0 AB00        R     MOV     R3,err_emg_2+03H
06D2 AA00        R     MOV     R2,err_emg_2+02H
06D4 A900        R     MOV     R1,err_emg_2+01H
06D6 A800        R     MOV     R0,err_emg_2
06D8 D3                SETB    C
06D9 120000      E     LCALL   ?C?SLCMP
06DC 405B              JC      ?C0039
                                           ; SOURCE LINE # 524
06DE 900000      E     MOV     DPTR,#c_mem+078H
06E1 E0                MOVX    A,@DPTR
06E2 FF                MOV     R7,A
06E3 E4                CLR     A
06E4 FC                MOV     R4,A
06E5 FD                MOV     R5,A
06E6 FE                MOV     R6,A
06E7 A800        R     MOV     R0,err_emg_2
06E9 120000      E     LCALL   ?C?LMUL
06EC 7802              MOV     R0,#02H
06EE 120000      E     LCALL   ?C?LSHL
06F1 C006              PUSH    AR6
06F3 C007              PUSH    AR7
06F5 900000      E     MOV     DPTR,#c_mem+06DH
06F8 E0                MOVX    A,@DPTR
06F9 FE                MOV     R6,A
06FA A3                INC     DPTR
06FB E0                MOVX    A,@DPTR
06FC FF                MOV     R7,A
06FD C3                CLR     C
06FE E4                CLR     A
06FF 9F                SUBB    A,R7
0700 FF                MOV     R7,A
0701 7404              MOV     A,#04H
0703 9E                SUBB    A,R6
0704 FE                MOV     R6,A
0705 AB07              MOV     R3,AR7
0707 FA                MOV     R2,A
0708 E4                CLR     A
0709 F9                MOV     R1,A
070A F8                MOV     R0,A
070B D007              POP     AR7
070D D006              POP     AR6
070F 120000      E     LCALL   ?C?SLDIV
0712 A804              MOV     R0,AR4
0714 A905              MOV     R1,AR5
0716 AA06              MOV     R2,AR6
0718 AB07              MOV     R3,AR7
071A 900000      E     MOV     DPTR,#g_refOld
071D E0                MOVX    A,@DPTR
071E FC                MOV     R4,A
071F A3                INC     DPTR
0720 E0                MOVX    A,@DPTR
0721 FD                MOV     R5,A
0722 A3                INC     DPTR
0723 E0                MOVX    A,@DPTR
0724 FE                MOV     R6,A
0725 A3                INC     DPTR
0726 E0                MOVX    A,@DPTR
0727 C3                CLR     C
0728 9B                SUBB    A,R3
0729 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 53  

072A EE                MOV     A,R6
072B 9A                SUBB    A,R2
072C FE                MOV     R6,A
072D ED                MOV     A,R5
072E 99                SUBB    A,R1
072F FD                MOV     R5,A
0730 EC                MOV     A,R4
0731 98                SUBB    A,R0
0732 FC                MOV     R4,A
0733 900000      E     MOV     DPTR,#g_ref
0736 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 525
                                           ; SOURCE LINE # 526
                                           ; SOURCE LINE # 528
                                           ; SOURCE LINE # 529
                                           ; SOURCE LINE # 530
                                           ; SOURCE LINE # 532
                                           ; SOURCE LINE # 533
                                           ; SOURCE LINE # 534
0739         ?C0039:
                                           ; SOURCE LINE # 537
0739 900000      E     MOV     DPTR,#c_mem+050H
073C E0                MOVX    A,@DPTR
073D 606A              JZ      ?C0077
                                           ; SOURCE LINE # 538
073F A3                INC     DPTR
0740 E0                MOVX    A,@DPTR
0741 FC                MOV     R4,A
0742 A3                INC     DPTR
0743 E0                MOVX    A,@DPTR
0744 FD                MOV     R5,A
0745 A3                INC     DPTR
0746 E0                MOVX    A,@DPTR
0747 FE                MOV     R6,A
0748 A3                INC     DPTR
0749 E0                MOVX    A,@DPTR
074A FF                MOV     R7,A
074B 900000      E     MOV     DPTR,#g_ref
074E E0                MOVX    A,@DPTR
074F F8                MOV     R0,A
0750 A3                INC     DPTR
0751 E0                MOVX    A,@DPTR
0752 F9                MOV     R1,A
0753 A3                INC     DPTR
0754 E0                MOVX    A,@DPTR
0755 FA                MOV     R2,A
0756 A3                INC     DPTR
0757 E0                MOVX    A,@DPTR
0758 FB                MOV     R3,A
0759 C3                CLR     C
075A 120000      E     LCALL   ?C?SLCMP
075D 5014              JNC     ?C0078
                                           ; SOURCE LINE # 539
075F 900000      E     MOV     DPTR,#c_mem+051H
0762 E0                MOVX    A,@DPTR
0763 FC                MOV     R4,A
0764 A3                INC     DPTR
0765 E0                MOVX    A,@DPTR
0766 FD                MOV     R5,A
0767 A3                INC     DPTR
0768 E0                MOVX    A,@DPTR
0769 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 54  

076A A3                INC     DPTR
076B E0                MOVX    A,@DPTR
076C FF                MOV     R7,A
076D 900000      E     MOV     DPTR,#g_ref
0770 120000      E     LCALL   ?C?LSTXDATA
0773         ?C0078:
                                           ; SOURCE LINE # 540
0773 900000      E     MOV     DPTR,#c_mem+059H
0776 E0                MOVX    A,@DPTR
0777 FC                MOV     R4,A
0778 A3                INC     DPTR
0779 E0                MOVX    A,@DPTR
077A FD                MOV     R5,A
077B A3                INC     DPTR
077C E0                MOVX    A,@DPTR
077D FE                MOV     R6,A
077E A3                INC     DPTR
077F E0                MOVX    A,@DPTR
0780 FF                MOV     R7,A
0781 900000      E     MOV     DPTR,#g_ref
0784 E0                MOVX    A,@DPTR
0785 F8                MOV     R0,A
0786 A3                INC     DPTR
0787 E0                MOVX    A,@DPTR
0788 F9                MOV     R1,A
0789 A3                INC     DPTR
078A E0                MOVX    A,@DPTR
078B FA                MOV     R2,A
078C A3                INC     DPTR
078D E0                MOVX    A,@DPTR
078E FB                MOV     R3,A
078F D3                SETB    C
0790 120000      E     LCALL   ?C?SLCMP
0793 4014              JC      ?C0077
                                           ; SOURCE LINE # 541
0795 900000      E     MOV     DPTR,#c_mem+059H
0798 E0                MOVX    A,@DPTR
0799 FC                MOV     R4,A
079A A3                INC     DPTR
079B E0                MOVX    A,@DPTR
079C FD                MOV     R5,A
079D A3                INC     DPTR
079E E0                MOVX    A,@DPTR
079F FE                MOV     R6,A
07A0 A3                INC     DPTR
07A1 E0                MOVX    A,@DPTR
07A2 FF                MOV     R7,A
07A3 900000      E     MOV     DPTR,#g_ref
07A6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 542
07A9         ?C0077:
                                           ; SOURCE LINE # 544
07A9 900000      E     MOV     DPTR,#c_mem+034H
07AC E0                MOVX    A,@DPTR
07AD 7003              JNZ     $ + 5H
07AF 020000      R     LJMP    ?C0102
07B2 14                DEC     A
07B3 7003              JNZ     $ + 5H
07B5 020000      R     LJMP    ?C0124
07B8 14                DEC     A
07B9 7003              JNZ     $ + 5H
07BB 020000      R     LJMP    ?C0111
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 55  

07BE 14                DEC     A
07BF 6003              JZ      $ + 5H
07C1 020000      R     LJMP    ?C0080
                                           ; SOURCE LINE # 546
07C4         ?C0081:
                                           ; SOURCE LINE # 547
07C4 900000      E     MOV     DPTR,#g_meas
07C7 E0                MOVX    A,@DPTR
07C8 F8                MOV     R0,A
07C9 A3                INC     DPTR
07CA E0                MOVX    A,@DPTR
07CB F9                MOV     R1,A
07CC A3                INC     DPTR
07CD E0                MOVX    A,@DPTR
07CE FA                MOV     R2,A
07CF A3                INC     DPTR
07D0 E0                MOVX    A,@DPTR
07D1 FB                MOV     R3,A
07D2 900000      E     MOV     DPTR,#g_ref
07D5 E0                MOVX    A,@DPTR
07D6 FC                MOV     R4,A
07D7 A3                INC     DPTR
07D8 E0                MOVX    A,@DPTR
07D9 FD                MOV     R5,A
07DA A3                INC     DPTR
07DB E0                MOVX    A,@DPTR
07DC FE                MOV     R6,A
07DD A3                INC     DPTR
07DE E0                MOVX    A,@DPTR
07DF C3                CLR     C
07E0 9B                SUBB    A,R3
07E1 F500        R     MOV     pos_error+03H,A
07E3 EE                MOV     A,R6
07E4 9A                SUBB    A,R2
07E5 F500        R     MOV     pos_error+02H,A
07E7 ED                MOV     A,R5
07E8 99                SUBB    A,R1
07E9 F500        R     MOV     pos_error+01H,A
07EB EC                MOV     A,R4
07EC 98                SUBB    A,R0
07ED F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 549
07EF 900000      R     MOV     DPTR,#pos_error_sum
07F2 E0                MOVX    A,@DPTR
07F3 FC                MOV     R4,A
07F4 A3                INC     DPTR
07F5 E0                MOVX    A,@DPTR
07F6 FD                MOV     R5,A
07F7 A3                INC     DPTR
07F8 E0                MOVX    A,@DPTR
07F9 FE                MOV     R6,A
07FA A3                INC     DPTR
07FB E0                MOVX    A,@DPTR
07FC 2500        R     ADD     A,pos_error+03H
07FE FF                MOV     R7,A
07FF EE                MOV     A,R6
0800 3500        R     ADDC    A,pos_error+02H
0802 FE                MOV     R6,A
0803 ED                MOV     A,R5
0804 3500        R     ADDC    A,pos_error+01H
0806 FD                MOV     R5,A
0807 EC                MOV     A,R4
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 56  

0808 3500        R     ADDC    A,pos_error
080A FC                MOV     R4,A
080B 900000      R     MOV     DPTR,#pos_error_sum
080E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 552
0811 7F80              MOV     R7,#080H
0813 7EF0              MOV     R6,#0F0H
0815 7DFA              MOV     R5,#0FAH
0817 7C02              MOV     R4,#02H
0819 900000      R     MOV     DPTR,#pos_error_sum
081C E0                MOVX    A,@DPTR
081D F8                MOV     R0,A
081E A3                INC     DPTR
081F E0                MOVX    A,@DPTR
0820 F9                MOV     R1,A
0821 A3                INC     DPTR
0822 E0                MOVX    A,@DPTR
0823 FA                MOV     R2,A
0824 A3                INC     DPTR
0825 E0                MOVX    A,@DPTR
0826 FB                MOV     R3,A
0827 D3                SETB    C
0828 120000      E     LCALL   ?C?SLCMP
082B 4010              JC      ?C0082
                                           ; SOURCE LINE # 553
082D 7F80              MOV     R7,#080H
082F 7EF0              MOV     R6,#0F0H
0831 7DFA              MOV     R5,#0FAH
0833 7C02              MOV     R4,#02H
0835 900000      R     MOV     DPTR,#pos_error_sum
0838 120000      E     LCALL   ?C?LSTXDATA
083B 802A              SJMP    ?C0083
083D         ?C0082:
                                           ; SOURCE LINE # 554
                                           ; SOURCE LINE # 555
083D 7F80              MOV     R7,#080H
083F 7E0F              MOV     R6,#0FH
0841 7D05              MOV     R5,#05H
0843 7CFD              MOV     R4,#0FDH
0845 900000      R     MOV     DPTR,#pos_error_sum
0848 E0                MOVX    A,@DPTR
0849 F8                MOV     R0,A
084A A3                INC     DPTR
084B E0                MOVX    A,@DPTR
084C F9                MOV     R1,A
084D A3                INC     DPTR
084E E0                MOVX    A,@DPTR
084F FA                MOV     R2,A
0850 A3                INC     DPTR
0851 E0                MOVX    A,@DPTR
0852 FB                MOV     R3,A
0853 C3                CLR     C
0854 120000      E     LCALL   ?C?SLCMP
0857 500E              JNC     ?C0083
                                           ; SOURCE LINE # 556
0859 7F80              MOV     R7,#080H
085B 7E0F              MOV     R6,#0FH
085D 7D05              MOV     R5,#05H
085F 7CFD              MOV     R4,#0FDH
0861 900000      R     MOV     DPTR,#pos_error_sum
0864 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 557
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 57  

0867         ?C0083:
                                           ; SOURCE LINE # 561
0867 E4                CLR     A
0868 F500        R     MOV     i_ref+03H,A
086A F500        R     MOV     i_ref+02H,A
086C F500        R     MOV     i_ref+01H,A
086E F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 564
0870 FF                MOV     R7,A
0871 FE                MOV     R6,A
0872 FD                MOV     R5,A
0873 FC                MOV     R4,A
0874 AB00        R     MOV     R3,k_p_dl+03H
0876 AA00        R     MOV     R2,k_p_dl+02H
0878 A900        R     MOV     R1,k_p_dl+01H
087A A800        R     MOV     R0,k_p_dl
087C C3                CLR     C
087D 120000      E     LCALL   ?C?SLCMP
0880 6026              JZ      ?C0085
                                           ; SOURCE LINE # 565
0882 AF00        R     MOV     R7,pos_error+03H
0884 AE00        R     MOV     R6,pos_error+02H
0886 AD00        R     MOV     R5,pos_error+01H
0888 AC00        R     MOV     R4,pos_error
088A A800        R     MOV     R0,k_p_dl
088C 120000      E     LCALL   ?C?LMUL
088F 7810              MOV     R0,#010H
0891 120000      E     LCALL   ?C?SLSHR
0894 E500        R     MOV     A,i_ref+03H
0896 2F                ADD     A,R7
0897 F500        R     MOV     i_ref+03H,A
0899 E500        R     MOV     A,i_ref+02H
089B 3E                ADDC    A,R6
089C F500        R     MOV     i_ref+02H,A
089E E500        R     MOV     A,i_ref+01H
08A0 3D                ADDC    A,R5
08A1 F500        R     MOV     i_ref+01H,A
08A3 E500        R     MOV     A,i_ref
08A5 3C                ADDC    A,R4
08A6 F500        R     MOV     i_ref,A
08A8         ?C0085:
                                           ; SOURCE LINE # 568
08A8 E4                CLR     A
08A9 FF                MOV     R7,A
08AA FE                MOV     R6,A
08AB FD                MOV     R5,A
08AC FC                MOV     R4,A
08AD AB00        R     MOV     R3,k_i_dl+03H
08AF AA00        R     MOV     R2,k_i_dl+02H
08B1 A900        R     MOV     R1,k_i_dl+01H
08B3 A800        R     MOV     R0,k_i_dl
08B5 C3                CLR     C
08B6 120000      E     LCALL   ?C?SLCMP
08B9 602C              JZ      ?C0086
                                           ; SOURCE LINE # 569
08BB 900000      R     MOV     DPTR,#pos_error_sum
08BE E0                MOVX    A,@DPTR
08BF FC                MOV     R4,A
08C0 A3                INC     DPTR
08C1 E0                MOVX    A,@DPTR
08C2 FD                MOV     R5,A
08C3 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 58  

08C4 E0                MOVX    A,@DPTR
08C5 FE                MOV     R6,A
08C6 A3                INC     DPTR
08C7 E0                MOVX    A,@DPTR
08C8 FF                MOV     R7,A
08C9 A800        R     MOV     R0,k_i_dl
08CB 120000      E     LCALL   ?C?LMUL
08CE 7810              MOV     R0,#010H
08D0 120000      E     LCALL   ?C?SLSHR
08D3 E500        R     MOV     A,i_ref+03H
08D5 2F                ADD     A,R7
08D6 F500        R     MOV     i_ref+03H,A
08D8 E500        R     MOV     A,i_ref+02H
08DA 3E                ADDC    A,R6
08DB F500        R     MOV     i_ref+02H,A
08DD E500        R     MOV     A,i_ref+01H
08DF 3D                ADDC    A,R5
08E0 F500        R     MOV     i_ref+01H,A
08E2 E500        R     MOV     A,i_ref
08E4 3C                ADDC    A,R4
08E5 F500        R     MOV     i_ref,A
08E7         ?C0086:
                                           ; SOURCE LINE # 572
08E7 E4                CLR     A
08E8 FF                MOV     R7,A
08E9 FE                MOV     R6,A
08EA FD                MOV     R5,A
08EB FC                MOV     R4,A
08EC AB00        R     MOV     R3,k_d_dl+03H
08EE AA00        R     MOV     R2,k_d_dl+02H
08F0 A900        R     MOV     R1,k_d_dl+01H
08F2 A800        R     MOV     R0,k_d_dl
08F4 C3                CLR     C
08F5 120000      E     LCALL   ?C?SLCMP
08F8 6043              JZ      ?C0087
                                           ; SOURCE LINE # 573
08FA 900000      R     MOV     DPTR,#prev_pos_err
08FD E0                MOVX    A,@DPTR
08FE F8                MOV     R0,A
08FF A3                INC     DPTR
0900 E0                MOVX    A,@DPTR
0901 F9                MOV     R1,A
0902 A3                INC     DPTR
0903 E0                MOVX    A,@DPTR
0904 FA                MOV     R2,A
0905 A3                INC     DPTR
0906 E0                MOVX    A,@DPTR
0907 FB                MOV     R3,A
0908 C3                CLR     C
0909 E500        R     MOV     A,pos_error+03H
090B 9B                SUBB    A,R3
090C FF                MOV     R7,A
090D E500        R     MOV     A,pos_error+02H
090F 9A                SUBB    A,R2
0910 FE                MOV     R6,A
0911 E500        R     MOV     A,pos_error+01H
0913 99                SUBB    A,R1
0914 FD                MOV     R5,A
0915 E500        R     MOV     A,pos_error
0917 98                SUBB    A,R0
0918 FC                MOV     R4,A
0919 AB00        R     MOV     R3,k_d_dl+03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 59  

091B AA00        R     MOV     R2,k_d_dl+02H
091D A900        R     MOV     R1,k_d_dl+01H
091F A800        R     MOV     R0,k_d_dl
0921 120000      E     LCALL   ?C?LMUL
0924 7810              MOV     R0,#010H
0926 120000      E     LCALL   ?C?SLSHR
0929 E500        R     MOV     A,i_ref+03H
092B 2F                ADD     A,R7
092C F500        R     MOV     i_ref+03H,A
092E E500        R     MOV     A,i_ref+02H
0930 3E                ADDC    A,R6
0931 F500        R     MOV     i_ref+02H,A
0933 E500        R     MOV     A,i_ref+01H
0935 3D                ADDC    A,R5
0936 F500        R     MOV     i_ref+01H,A
0938 E500        R     MOV     A,i_ref
093A 3C                ADDC    A,R4
093B F500        R     MOV     i_ref,A
093D         ?C0087:
                                           ; SOURCE LINE # 576
093D AF00        R     MOV     R7,pos_error+03H
093F AE00        R     MOV     R6,pos_error+02H
0941 AD00        R     MOV     R5,pos_error+01H
0943 AC00        R     MOV     R4,pos_error
0945 900000      R     MOV     DPTR,#prev_pos_err
0948 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 582
094B E4                CLR     A
094C FF                MOV     R7,A
094D FE                MOV     R6,A
094E FD                MOV     R5,A
094F FC                MOV     R4,A
0950 AB00        R     MOV     R3,i_ref+03H
0952 AA00        R     MOV     R2,i_ref+02H
0954 A900        R     MOV     R1,i_ref+01H
0956 A800        R     MOV     R0,i_ref
0958 C3                CLR     C
0959 120000      E     LCALL   ?C?SLCMP
095C 4004              JC      ?C0088
                                           ; SOURCE LINE # 583
095E D200        R     SETB    motor_dir
0960 8002              SJMP    ?C0089
0962         ?C0088:
                                           ; SOURCE LINE # 585
0962 C200        R     CLR     motor_dir
0964         ?C0089:
                                           ; SOURCE LINE # 591
0964 900000      E     MOV     DPTR,#c_mem+069H
0967 E0                MOVX    A,@DPTR
0968 FE                MOV     R6,A
0969 A3                INC     DPTR
096A E0                MOVX    A,@DPTR
096B FF                MOV     R7,A
096C EE                MOV     A,R6
096D 33                RLC     A
096E 95E0              SUBB    A,ACC
0970 FD                MOV     R5,A
0971 FC                MOV     R4,A
0972 AB00        R     MOV     R3,i_ref+03H
0974 AA00        R     MOV     R2,i_ref+02H
0976 A900        R     MOV     R1,i_ref+01H
0978 A800        R     MOV     R0,i_ref
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 60  

097A D3                SETB    C
097B 120000      E     LCALL   ?C?SLCMP
097E 4016              JC      ?C0090
                                           ; SOURCE LINE # 592
0980 900000      E     MOV     DPTR,#c_mem+069H
0983 E0                MOVX    A,@DPTR
0984 FE                MOV     R6,A
0985 A3                INC     DPTR
0986 E0                MOVX    A,@DPTR
0987 FF                MOV     R7,A
0988 EE                MOV     A,R6
0989 33                RLC     A
098A 95E0              SUBB    A,ACC
098C 8F00        R     MOV     i_ref+03H,R7
098E 8E00        R     MOV     i_ref+02H,R6
0990 F500        R     MOV     i_ref+01H,A
0992 F500        R     MOV     i_ref,A
0994 803C              SJMP    ?C0091
0996         ?C0090:
                                           ; SOURCE LINE # 593
                                           ; SOURCE LINE # 594
0996 900000      E     MOV     DPTR,#c_mem+069H
0999 E0                MOVX    A,@DPTR
099A FE                MOV     R6,A
099B A3                INC     DPTR
099C E0                MOVX    A,@DPTR
099D FF                MOV     R7,A
099E C3                CLR     C
099F E4                CLR     A
09A0 9F                SUBB    A,R7
09A1 FF                MOV     R7,A
09A2 E4                CLR     A
09A3 9E                SUBB    A,R6
09A4 FE                MOV     R6,A
09A5 33                RLC     A
09A6 95E0              SUBB    A,ACC
09A8 FD                MOV     R5,A
09A9 FC                MOV     R4,A
09AA AB00        R     MOV     R3,i_ref+03H
09AC AA00        R     MOV     R2,i_ref+02H
09AE A900        R     MOV     R1,i_ref+01H
09B0 A800        R     MOV     R0,i_ref
09B2 C3                CLR     C
09B3 120000      E     LCALL   ?C?SLCMP
09B6 501A              JNC     ?C0091
                                           ; SOURCE LINE # 595
09B8 900000      E     MOV     DPTR,#c_mem+069H
09BB E0                MOVX    A,@DPTR
09BC FE                MOV     R6,A
09BD A3                INC     DPTR
09BE E0                MOVX    A,@DPTR
09BF FF                MOV     R7,A
09C0 C3                CLR     C
09C1 E4                CLR     A
09C2 9F                SUBB    A,R7
09C3 FF                MOV     R7,A
09C4 E4                CLR     A
09C5 9E                SUBB    A,R6
09C6 FE                MOV     R6,A
09C7 33                RLC     A
09C8 95E0              SUBB    A,ACC
09CA 8F00        R     MOV     i_ref+03H,R7
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 61  

09CC 8E00        R     MOV     i_ref+02H,R6
09CE F500        R     MOV     i_ref+01H,A
09D0 F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 596
09D2         ?C0091:
                                           ; SOURCE LINE # 607
09D2 900000      E     MOV     DPTR,#g_meas+0CH
09D5 E0                MOVX    A,@DPTR
09D6 F8                MOV     R0,A
09D7 A3                INC     DPTR
09D8 E0                MOVX    A,@DPTR
09D9 F9                MOV     R1,A
09DA A3                INC     DPTR
09DB E0                MOVX    A,@DPTR
09DC FA                MOV     R2,A
09DD A3                INC     DPTR
09DE E0                MOVX    A,@DPTR
09DF FB                MOV     R3,A
09E0 C3                CLR     C
09E1 E500        R     MOV     A,i_ref+03H
09E3 9B                SUBB    A,R3
09E4 F500        R     MOV     curr_error+03H,A
09E6 E500        R     MOV     A,i_ref+02H
09E8 9A                SUBB    A,R2
09E9 F500        R     MOV     curr_error+02H,A
09EB E500        R     MOV     A,i_ref+01H
09ED 99                SUBB    A,R1
09EE F500        R     MOV     curr_error+01H,A
09F0 E500        R     MOV     A,i_ref
09F2 98                SUBB    A,R0
09F3 F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 608
09F5 900000      R     MOV     DPTR,#curr_error_sum
09F8 E0                MOVX    A,@DPTR
09F9 FC                MOV     R4,A
09FA A3                INC     DPTR
09FB E0                MOVX    A,@DPTR
09FC FD                MOV     R5,A
09FD A3                INC     DPTR
09FE E0                MOVX    A,@DPTR
09FF FE                MOV     R6,A
0A00 A3                INC     DPTR
0A01 E0                MOVX    A,@DPTR
0A02 2500        R     ADD     A,curr_error+03H
0A04 FF                MOV     R7,A
0A05 EE                MOV     A,R6
0A06 3500        R     ADDC    A,curr_error+02H
0A08 FE                MOV     R6,A
0A09 ED                MOV     A,R5
0A0A 3500        R     ADDC    A,curr_error+01H
0A0C FD                MOV     R5,A
0A0D EC                MOV     A,R4
0A0E 3500        R     ADDC    A,curr_error
0A10 FC                MOV     R4,A
0A11 900000      R     MOV     DPTR,#curr_error_sum
0A14 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 610
0A17 7FA0              MOV     R7,#0A0H
0A19 7E86              MOV     R6,#086H
0A1B 7D01              MOV     R5,#01H
0A1D 7C00              MOV     R4,#00H
0A1F 900000      R     MOV     DPTR,#curr_error_sum
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 62  

0A22 E0                MOVX    A,@DPTR
0A23 F8                MOV     R0,A
0A24 A3                INC     DPTR
0A25 E0                MOVX    A,@DPTR
0A26 F9                MOV     R1,A
0A27 A3                INC     DPTR
0A28 E0                MOVX    A,@DPTR
0A29 FA                MOV     R2,A
0A2A A3                INC     DPTR
0A2B E0                MOVX    A,@DPTR
0A2C FB                MOV     R3,A
0A2D D3                SETB    C
0A2E 120000      E     LCALL   ?C?SLCMP
0A31 4010              JC      ?C0093
                                           ; SOURCE LINE # 611
0A33 7FA0              MOV     R7,#0A0H
0A35 7E86              MOV     R6,#086H
0A37 7D01              MOV     R5,#01H
0A39 7C00              MOV     R4,#00H
0A3B 900000      R     MOV     DPTR,#curr_error_sum
0A3E 120000      E     LCALL   ?C?LSTXDATA
0A41 802A              SJMP    ?C0094
0A43         ?C0093:
                                           ; SOURCE LINE # 612
                                           ; SOURCE LINE # 613
0A43 7F60              MOV     R7,#060H
0A45 7E79              MOV     R6,#079H
0A47 7DFE              MOV     R5,#0FEH
0A49 7CFF              MOV     R4,#0FFH
0A4B 900000      R     MOV     DPTR,#curr_error_sum
0A4E E0                MOVX    A,@DPTR
0A4F F8                MOV     R0,A
0A50 A3                INC     DPTR
0A51 E0                MOVX    A,@DPTR
0A52 F9                MOV     R1,A
0A53 A3                INC     DPTR
0A54 E0                MOVX    A,@DPTR
0A55 FA                MOV     R2,A
0A56 A3                INC     DPTR
0A57 E0                MOVX    A,@DPTR
0A58 FB                MOV     R3,A
0A59 C3                CLR     C
0A5A 120000      E     LCALL   ?C?SLCMP
0A5D 500E              JNC     ?C0094
                                           ; SOURCE LINE # 614
0A5F 7F60              MOV     R7,#060H
0A61 7E79              MOV     R6,#079H
0A63 7DFE              MOV     R5,#0FEH
0A65 7CFF              MOV     R4,#0FFH
0A67 900000      R     MOV     DPTR,#curr_error_sum
0A6A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 615
0A6D         ?C0094:
                                           ; SOURCE LINE # 619
0A6D E4                CLR     A
0A6E F500        R     MOV     pwm_input+03H,A
0A70 F500        R     MOV     pwm_input+02H,A
0A72 F500        R     MOV     pwm_input+01H,A
0A74 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 622
0A76 FF                MOV     R7,A
0A77 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 63  

0A78 FD                MOV     R5,A
0A79 FC                MOV     R4,A
0A7A AB00        R     MOV     R3,k_p_c_dl+03H
0A7C AA00        R     MOV     R2,k_p_c_dl+02H
0A7E A900        R     MOV     R1,k_p_c_dl+01H
0A80 A800        R     MOV     R0,k_p_c_dl
0A82 C3                CLR     C
0A83 120000      E     LCALL   ?C?SLCMP
0A86 6026              JZ      ?C0096
                                           ; SOURCE LINE # 623
0A88 AF00        R     MOV     R7,curr_error+03H
0A8A AE00        R     MOV     R6,curr_error+02H
0A8C AD00        R     MOV     R5,curr_error+01H
0A8E AC00        R     MOV     R4,curr_error
0A90 A800        R     MOV     R0,k_p_c_dl
0A92 120000      E     LCALL   ?C?LMUL
0A95 7810              MOV     R0,#010H
0A97 120000      E     LCALL   ?C?SLSHR
0A9A E500        R     MOV     A,pwm_input+03H
0A9C 2F                ADD     A,R7
0A9D F500        R     MOV     pwm_input+03H,A
0A9F E500        R     MOV     A,pwm_input+02H
0AA1 3E                ADDC    A,R6
0AA2 F500        R     MOV     pwm_input+02H,A
0AA4 E500        R     MOV     A,pwm_input+01H
0AA6 3D                ADDC    A,R5
0AA7 F500        R     MOV     pwm_input+01H,A
0AA9 E500        R     MOV     A,pwm_input
0AAB 3C                ADDC    A,R4
0AAC F500        R     MOV     pwm_input,A
0AAE         ?C0096:
                                           ; SOURCE LINE # 626
0AAE E4                CLR     A
0AAF FF                MOV     R7,A
0AB0 FE                MOV     R6,A
0AB1 FD                MOV     R5,A
0AB2 FC                MOV     R4,A
0AB3 AB00        R     MOV     R3,k_i_c_dl+03H
0AB5 AA00        R     MOV     R2,k_i_c_dl+02H
0AB7 A900        R     MOV     R1,k_i_c_dl+01H
0AB9 A800        R     MOV     R0,k_i_c_dl
0ABB C3                CLR     C
0ABC 120000      E     LCALL   ?C?SLCMP
0ABF 602C              JZ      ?C0097
                                           ; SOURCE LINE # 627
0AC1 900000      R     MOV     DPTR,#curr_error_sum
0AC4 E0                MOVX    A,@DPTR
0AC5 FC                MOV     R4,A
0AC6 A3                INC     DPTR
0AC7 E0                MOVX    A,@DPTR
0AC8 FD                MOV     R5,A
0AC9 A3                INC     DPTR
0ACA E0                MOVX    A,@DPTR
0ACB FE                MOV     R6,A
0ACC A3                INC     DPTR
0ACD E0                MOVX    A,@DPTR
0ACE FF                MOV     R7,A
0ACF A800        R     MOV     R0,k_i_c_dl
0AD1 120000      E     LCALL   ?C?LMUL
0AD4 7810              MOV     R0,#010H
0AD6 120000      E     LCALL   ?C?SLSHR
0AD9 E500        R     MOV     A,pwm_input+03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 64  

0ADB 2F                ADD     A,R7
0ADC F500        R     MOV     pwm_input+03H,A
0ADE E500        R     MOV     A,pwm_input+02H
0AE0 3E                ADDC    A,R6
0AE1 F500        R     MOV     pwm_input+02H,A
0AE3 E500        R     MOV     A,pwm_input+01H
0AE5 3D                ADDC    A,R5
0AE6 F500        R     MOV     pwm_input+01H,A
0AE8 E500        R     MOV     A,pwm_input
0AEA 3C                ADDC    A,R4
0AEB F500        R     MOV     pwm_input,A
0AED         ?C0097:
                                           ; SOURCE LINE # 630
0AED E4                CLR     A
0AEE FF                MOV     R7,A
0AEF FE                MOV     R6,A
0AF0 FD                MOV     R5,A
0AF1 FC                MOV     R4,A
0AF2 AB00        R     MOV     R3,k_d_c_dl+03H
0AF4 AA00        R     MOV     R2,k_d_c_dl+02H
0AF6 A900        R     MOV     R1,k_d_c_dl+01H
0AF8 A800        R     MOV     R0,k_d_c_dl
0AFA C3                CLR     C
0AFB 120000      E     LCALL   ?C?SLCMP
0AFE 6043              JZ      ?C0098
                                           ; SOURCE LINE # 631
0B00 900000      R     MOV     DPTR,#prev_curr_err
0B03 E0                MOVX    A,@DPTR
0B04 F8                MOV     R0,A
0B05 A3                INC     DPTR
0B06 E0                MOVX    A,@DPTR
0B07 F9                MOV     R1,A
0B08 A3                INC     DPTR
0B09 E0                MOVX    A,@DPTR
0B0A FA                MOV     R2,A
0B0B A3                INC     DPTR
0B0C E0                MOVX    A,@DPTR
0B0D FB                MOV     R3,A
0B0E C3                CLR     C
0B0F E500        R     MOV     A,curr_error+03H
0B11 9B                SUBB    A,R3
0B12 FF                MOV     R7,A
0B13 E500        R     MOV     A,curr_error+02H
0B15 9A                SUBB    A,R2
0B16 FE                MOV     R6,A
0B17 E500        R     MOV     A,curr_error+01H
0B19 99                SUBB    A,R1
0B1A FD                MOV     R5,A
0B1B E500        R     MOV     A,curr_error
0B1D 98                SUBB    A,R0
0B1E FC                MOV     R4,A
0B1F AB00        R     MOV     R3,k_d_c_dl+03H
0B21 AA00        R     MOV     R2,k_d_c_dl+02H
0B23 A900        R     MOV     R1,k_d_c_dl+01H
0B25 A800        R     MOV     R0,k_d_c_dl
0B27 120000      E     LCALL   ?C?LMUL
0B2A 7810              MOV     R0,#010H
0B2C 120000      E     LCALL   ?C?SLSHR
0B2F E500        R     MOV     A,pwm_input+03H
0B31 2F                ADD     A,R7
0B32 F500        R     MOV     pwm_input+03H,A
0B34 E500        R     MOV     A,pwm_input+02H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 65  

0B36 3E                ADDC    A,R6
0B37 F500        R     MOV     pwm_input+02H,A
0B39 E500        R     MOV     A,pwm_input+01H
0B3B 3D                ADDC    A,R5
0B3C F500        R     MOV     pwm_input+01H,A
0B3E E500        R     MOV     A,pwm_input
0B40 3C                ADDC    A,R4
0B41 F500        R     MOV     pwm_input,A
0B43         ?C0098:
                                           ; SOURCE LINE # 634
0B43 74FF              MOV     A,#0FFH
0B45 7F9C              MOV     R7,#09CH
0B47 FE                MOV     R6,A
0B48 FD                MOV     R5,A
0B49 FC                MOV     R4,A
0B4A AB00        R     MOV     R3,pwm_input+03H
0B4C AA00        R     MOV     R2,pwm_input+02H
0B4E A900        R     MOV     R1,pwm_input+01H
0B50 A800        R     MOV     R0,pwm_input
0B52 C3                CLR     C
0B53 120000      E     LCALL   ?C?SLCMP
0B56 500D              JNC     ?C0099
                                           ; SOURCE LINE # 635
0B58 74FF              MOV     A,#0FFH
0B5A 75009C      R     MOV     pwm_input+03H,#09CH
0B5D F500        R     MOV     pwm_input+02H,A
0B5F F500        R     MOV     pwm_input+01H,A
0B61 F500        R     MOV     pwm_input,A
0B63 801E              SJMP    ?C0100
0B65         ?C0099:
                                           ; SOURCE LINE # 636
                                           ; SOURCE LINE # 637
0B65 E4                CLR     A
0B66 7F64              MOV     R7,#064H
0B68 FE                MOV     R6,A
0B69 FD                MOV     R5,A
0B6A FC                MOV     R4,A
0B6B AB00        R     MOV     R3,pwm_input+03H
0B6D AA00        R     MOV     R2,pwm_input+02H
0B6F A900        R     MOV     R1,pwm_input+01H
0B71 A800        R     MOV     R0,pwm_input
0B73 D3                SETB    C
0B74 120000      E     LCALL   ?C?SLCMP
0B77 400A              JC      ?C0100
                                           ; SOURCE LINE # 638
0B79 E4                CLR     A
0B7A 750064      R     MOV     pwm_input+03H,#064H
0B7D F500        R     MOV     pwm_input+02H,A
0B7F F500        R     MOV     pwm_input+01H,A
0B81 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 639
0B83         ?C0100:
                                           ; SOURCE LINE # 642
0B83 AF00        R     MOV     R7,curr_error+03H
0B85 AE00        R     MOV     R6,curr_error+02H
0B87 AD00        R     MOV     R5,curr_error+01H
0B89 AC00        R     MOV     R4,curr_error
0B8B 900000      R     MOV     DPTR,#prev_curr_err
0B8E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 644
0B91 020000      R     LJMP    ?C0080
                                           ; SOURCE LINE # 647
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 66  

0B94         ?C0102:
                                           ; SOURCE LINE # 648
0B94 900000      E     MOV     DPTR,#g_meas
0B97 E0                MOVX    A,@DPTR
0B98 F8                MOV     R0,A
0B99 A3                INC     DPTR
0B9A E0                MOVX    A,@DPTR
0B9B F9                MOV     R1,A
0B9C A3                INC     DPTR
0B9D E0                MOVX    A,@DPTR
0B9E FA                MOV     R2,A
0B9F A3                INC     DPTR
0BA0 E0                MOVX    A,@DPTR
0BA1 FB                MOV     R3,A
0BA2 900000      E     MOV     DPTR,#g_ref
0BA5 E0                MOVX    A,@DPTR
0BA6 FC                MOV     R4,A
0BA7 A3                INC     DPTR
0BA8 E0                MOVX    A,@DPTR
0BA9 FD                MOV     R5,A
0BAA A3                INC     DPTR
0BAB E0                MOVX    A,@DPTR
0BAC FE                MOV     R6,A
0BAD A3                INC     DPTR
0BAE E0                MOVX    A,@DPTR
0BAF C3                CLR     C
0BB0 9B                SUBB    A,R3
0BB1 F500        R     MOV     pos_error+03H,A
0BB3 EE                MOV     A,R6
0BB4 9A                SUBB    A,R2
0BB5 F500        R     MOV     pos_error+02H,A
0BB7 ED                MOV     A,R5
0BB8 99                SUBB    A,R1
0BB9 F500        R     MOV     pos_error+01H,A
0BBB EC                MOV     A,R4
0BBC 98                SUBB    A,R0
0BBD F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 650
0BBF 900000      R     MOV     DPTR,#pos_error_sum
0BC2 E0                MOVX    A,@DPTR
0BC3 FC                MOV     R4,A
0BC4 A3                INC     DPTR
0BC5 E0                MOVX    A,@DPTR
0BC6 FD                MOV     R5,A
0BC7 A3                INC     DPTR
0BC8 E0                MOVX    A,@DPTR
0BC9 FE                MOV     R6,A
0BCA A3                INC     DPTR
0BCB E0                MOVX    A,@DPTR
0BCC 2500        R     ADD     A,pos_error+03H
0BCE FF                MOV     R7,A
0BCF EE                MOV     A,R6
0BD0 3500        R     ADDC    A,pos_error+02H
0BD2 FE                MOV     R6,A
0BD3 ED                MOV     A,R5
0BD4 3500        R     ADDC    A,pos_error+01H
0BD6 FD                MOV     R5,A
0BD7 EC                MOV     A,R4
0BD8 3500        R     ADDC    A,pos_error
0BDA FC                MOV     R4,A
0BDB 900000      R     MOV     DPTR,#pos_error_sum
0BDE 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 67  

                                           ; SOURCE LINE # 653
0BE1 E4                CLR     A
0BE2 7FE8              MOV     R7,#0E8H
0BE4 7E03              MOV     R6,#03H
0BE6 FD                MOV     R5,A
0BE7 FC                MOV     R4,A
0BE8 900000      R     MOV     DPTR,#pos_error_sum
0BEB E0                MOVX    A,@DPTR
0BEC F8                MOV     R0,A
0BED A3                INC     DPTR
0BEE E0                MOVX    A,@DPTR
0BEF F9                MOV     R1,A
0BF0 A3                INC     DPTR
0BF1 E0                MOVX    A,@DPTR
0BF2 FA                MOV     R2,A
0BF3 A3                INC     DPTR
0BF4 E0                MOVX    A,@DPTR
0BF5 FB                MOV     R3,A
0BF6 D3                SETB    C
0BF7 120000      E     LCALL   ?C?SLCMP
0BFA 400F              JC      ?C0103
                                           ; SOURCE LINE # 654
0BFC E4                CLR     A
0BFD 7FE8              MOV     R7,#0E8H
0BFF 7E03              MOV     R6,#03H
0C01 FD                MOV     R5,A
0C02 FC                MOV     R4,A
0C03 900000      R     MOV     DPTR,#pos_error_sum
0C06 120000      E     LCALL   ?C?LSTXDATA
0C09 802A              SJMP    ?C0104
0C0B         ?C0103:
                                           ; SOURCE LINE # 655
                                           ; SOURCE LINE # 656
0C0B 7F18              MOV     R7,#018H
0C0D 7EFC              MOV     R6,#0FCH
0C0F 7DFF              MOV     R5,#0FFH
0C11 7CFF              MOV     R4,#0FFH
0C13 900000      R     MOV     DPTR,#pos_error_sum
0C16 E0                MOVX    A,@DPTR
0C17 F8                MOV     R0,A
0C18 A3                INC     DPTR
0C19 E0                MOVX    A,@DPTR
0C1A F9                MOV     R1,A
0C1B A3                INC     DPTR
0C1C E0                MOVX    A,@DPTR
0C1D FA                MOV     R2,A
0C1E A3                INC     DPTR
0C1F E0                MOVX    A,@DPTR
0C20 FB                MOV     R3,A
0C21 C3                CLR     C
0C22 120000      E     LCALL   ?C?SLCMP
0C25 500E              JNC     ?C0104
                                           ; SOURCE LINE # 657
0C27 7F18              MOV     R7,#018H
0C29 7EFC              MOV     R6,#0FCH
0C2B 7DFF              MOV     R5,#0FFH
0C2D 7CFF              MOV     R4,#0FFH
0C2F 900000      R     MOV     DPTR,#pos_error_sum
0C32 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 658
0C35         ?C0104:
                                           ; SOURCE LINE # 661
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 68  

0C35 E4                CLR     A
0C36 FF                MOV     R7,A
0C37 FE                MOV     R6,A
0C38 FD                MOV     R5,A
0C39 FC                MOV     R4,A
0C3A AB00        R     MOV     R3,k_p+03H
0C3C AA00        R     MOV     R2,k_p+02H
0C3E A900        R     MOV     R1,k_p+01H
0C40 A800        R     MOV     R0,k_p
0C42 C3                CLR     C
0C43 120000      E     LCALL   ?C?SLCMP
0C46 601A              JZ      ?C0106
                                           ; SOURCE LINE # 662
0C48 AF00        R     MOV     R7,pos_error+03H
0C4A AE00        R     MOV     R6,pos_error+02H
0C4C AD00        R     MOV     R5,pos_error+01H
0C4E AC00        R     MOV     R4,pos_error
0C50 A800        R     MOV     R0,k_p
0C52 120000      E     LCALL   ?C?LMUL
0C55 7810              MOV     R0,#010H
0C57 120000      E     LCALL   ?C?SLSHR
0C5A 8F00        R     MOV     pwm_input+03H,R7
0C5C 8E00        R     MOV     pwm_input+02H,R6
0C5E 8D00        R     MOV     pwm_input+01H,R5
0C60 8C00        R     MOV     pwm_input,R4
0C62         ?C0106:
                                           ; SOURCE LINE # 666
0C62 E4                CLR     A
0C63 FF                MOV     R7,A
0C64 FE                MOV     R6,A
0C65 FD                MOV     R5,A
0C66 FC                MOV     R4,A
0C67 AB00        R     MOV     R3,k_i+03H
0C69 AA00        R     MOV     R2,k_i+02H
0C6B A900        R     MOV     R1,k_i+01H
0C6D A800        R     MOV     R0,k_i
0C6F C3                CLR     C
0C70 120000      E     LCALL   ?C?SLCMP
0C73 602C              JZ      ?C0107
                                           ; SOURCE LINE # 667
0C75 900000      R     MOV     DPTR,#pos_error_sum
0C78 E0                MOVX    A,@DPTR
0C79 FC                MOV     R4,A
0C7A A3                INC     DPTR
0C7B E0                MOVX    A,@DPTR
0C7C FD                MOV     R5,A
0C7D A3                INC     DPTR
0C7E E0                MOVX    A,@DPTR
0C7F FE                MOV     R6,A
0C80 A3                INC     DPTR
0C81 E0                MOVX    A,@DPTR
0C82 FF                MOV     R7,A
0C83 A800        R     MOV     R0,k_i
0C85 120000      E     LCALL   ?C?LMUL
0C88 7810              MOV     R0,#010H
0C8A 120000      E     LCALL   ?C?SLSHR
0C8D E500        R     MOV     A,pwm_input+03H
0C8F 2F                ADD     A,R7
0C90 F500        R     MOV     pwm_input+03H,A
0C92 E500        R     MOV     A,pwm_input+02H
0C94 3E                ADDC    A,R6
0C95 F500        R     MOV     pwm_input+02H,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 69  

0C97 E500        R     MOV     A,pwm_input+01H
0C99 3D                ADDC    A,R5
0C9A F500        R     MOV     pwm_input+01H,A
0C9C E500        R     MOV     A,pwm_input
0C9E 3C                ADDC    A,R4
0C9F F500        R     MOV     pwm_input,A
0CA1         ?C0107:
                                           ; SOURCE LINE # 671
0CA1 E4                CLR     A
0CA2 FF                MOV     R7,A
0CA3 FE                MOV     R6,A
0CA4 FD                MOV     R5,A
0CA5 FC                MOV     R4,A
0CA6 AB00        R     MOV     R3,k_d+03H
0CA8 AA00        R     MOV     R2,k_d+02H
0CAA A900        R     MOV     R1,k_d+01H
0CAC A800        R     MOV     R0,k_d
0CAE C3                CLR     C
0CAF 120000      E     LCALL   ?C?SLCMP
0CB2 6043              JZ      ?C0108
                                           ; SOURCE LINE # 672
0CB4 900000      R     MOV     DPTR,#prev_pos_err
0CB7 E0                MOVX    A,@DPTR
0CB8 F8                MOV     R0,A
0CB9 A3                INC     DPTR
0CBA E0                MOVX    A,@DPTR
0CBB F9                MOV     R1,A
0CBC A3                INC     DPTR
0CBD E0                MOVX    A,@DPTR
0CBE FA                MOV     R2,A
0CBF A3                INC     DPTR
0CC0 E0                MOVX    A,@DPTR
0CC1 FB                MOV     R3,A
0CC2 C3                CLR     C
0CC3 E500        R     MOV     A,pos_error+03H
0CC5 9B                SUBB    A,R3
0CC6 FF                MOV     R7,A
0CC7 E500        R     MOV     A,pos_error+02H
0CC9 9A                SUBB    A,R2
0CCA FE                MOV     R6,A
0CCB E500        R     MOV     A,pos_error+01H
0CCD 99                SUBB    A,R1
0CCE FD                MOV     R5,A
0CCF E500        R     MOV     A,pos_error
0CD1 98                SUBB    A,R0
0CD2 FC                MOV     R4,A
0CD3 AB00        R     MOV     R3,k_d+03H
0CD5 AA00        R     MOV     R2,k_d+02H
0CD7 A900        R     MOV     R1,k_d+01H
0CD9 A800        R     MOV     R0,k_d
0CDB 120000      E     LCALL   ?C?LMUL
0CDE 7810              MOV     R0,#010H
0CE0 120000      E     LCALL   ?C?SLSHR
0CE3 E500        R     MOV     A,pwm_input+03H
0CE5 2F                ADD     A,R7
0CE6 F500        R     MOV     pwm_input+03H,A
0CE8 E500        R     MOV     A,pwm_input+02H
0CEA 3E                ADDC    A,R6
0CEB F500        R     MOV     pwm_input+02H,A
0CED E500        R     MOV     A,pwm_input+01H
0CEF 3D                ADDC    A,R5
0CF0 F500        R     MOV     pwm_input+01H,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 70  

0CF2 E500        R     MOV     A,pwm_input
0CF4 3C                ADDC    A,R4
0CF5 F500        R     MOV     pwm_input,A
0CF7         ?C0108:
                                           ; SOURCE LINE # 676
0CF7 AF00        R     MOV     R7,pos_error+03H
0CF9 AE00        R     MOV     R6,pos_error+02H
0CFB AD00        R     MOV     R5,pos_error+01H
0CFD AC00        R     MOV     R4,pos_error
0CFF 900000      R     MOV     DPTR,#prev_pos_err
0D02 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 678
0D05 E4                CLR     A
0D06 FF                MOV     R7,A
0D07 FE                MOV     R6,A
0D08 FD                MOV     R5,A
0D09 FC                MOV     R4,A
0D0A AB00        R     MOV     R3,pwm_input+03H
0D0C AA00        R     MOV     R2,pwm_input+02H
0D0E A900        R     MOV     R1,pwm_input+01H
0D10 A800        R     MOV     R0,pwm_input
0D12 D3                SETB    C
0D13 120000      E     LCALL   ?C?SLCMP
0D16 4005              JC      ?C0109
                                           ; SOURCE LINE # 679
0D18 D200        R     SETB    motor_dir
0D1A 020000      R     LJMP    ?C0080
0D1D         ?C0109:
                                           ; SOURCE LINE # 681
0D1D C200        R     CLR     motor_dir
                                           ; SOURCE LINE # 683
0D1F 020000      R     LJMP    ?C0080
                                           ; SOURCE LINE # 686
0D22         ?C0111:
                                           ; SOURCE LINE # 687
0D22 900000      E     MOV     DPTR,#g_ref+018H
0D25 E0                MOVX    A,@DPTR
0D26 7003              JNZ     $ + 5H
0D28 020000      R     LJMP    ?C0080
0D2B 200003      E     JB      tension_valid,$ + 6H
0D2E 020000      R     LJMP    ?C0080
                                           ; SOURCE LINE # 689
0D31 900000      E     MOV     DPTR,#g_ref+08H
0D34 E0                MOVX    A,@DPTR
0D35 FC                MOV     R4,A
0D36 A3                INC     DPTR
0D37 E0                MOVX    A,@DPTR
0D38 FD                MOV     R5,A
0D39 A3                INC     DPTR
0D3A E0                MOVX    A,@DPTR
0D3B FE                MOV     R6,A
0D3C A3                INC     DPTR
0D3D E0                MOVX    A,@DPTR
0D3E F500        R     MOV     i_ref+03H,A
0D40 8E00        R     MOV     i_ref+02H,R6
0D42 8D00        R     MOV     i_ref+01H,R5
0D44 8C00        R     MOV     i_ref,R4
                                           ; SOURCE LINE # 691
0D46 900000      E     MOV     DPTR,#c_mem+069H
0D49 E0                MOVX    A,@DPTR
0D4A FE                MOV     R6,A
0D4B A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 71  

0D4C E0                MOVX    A,@DPTR
0D4D FF                MOV     R7,A
0D4E EE                MOV     A,R6
0D4F 33                RLC     A
0D50 95E0              SUBB    A,ACC
0D52 FD                MOV     R5,A
0D53 FC                MOV     R4,A
0D54 AB00        R     MOV     R3,i_ref+03H
0D56 AA00        R     MOV     R2,i_ref+02H
0D58 A900        R     MOV     R1,i_ref+01H
0D5A A800        R     MOV     R0,i_ref
0D5C D3                SETB    C
0D5D 120000      E     LCALL   ?C?SLCMP
0D60 4016              JC      ?C0113
                                           ; SOURCE LINE # 692
0D62 900000      E     MOV     DPTR,#c_mem+069H
0D65 E0                MOVX    A,@DPTR
0D66 FE                MOV     R6,A
0D67 A3                INC     DPTR
0D68 E0                MOVX    A,@DPTR
0D69 FF                MOV     R7,A
0D6A EE                MOV     A,R6
0D6B 33                RLC     A
0D6C 95E0              SUBB    A,ACC
0D6E 8F00        R     MOV     i_ref+03H,R7
0D70 8E00        R     MOV     i_ref+02H,R6
0D72 F500        R     MOV     i_ref+01H,A
0D74 F500        R     MOV     i_ref,A
0D76 803C              SJMP    ?C0114
0D78         ?C0113:
                                           ; SOURCE LINE # 693
                                           ; SOURCE LINE # 694
0D78 900000      E     MOV     DPTR,#c_mem+069H
0D7B E0                MOVX    A,@DPTR
0D7C FE                MOV     R6,A
0D7D A3                INC     DPTR
0D7E E0                MOVX    A,@DPTR
0D7F FF                MOV     R7,A
0D80 C3                CLR     C
0D81 E4                CLR     A
0D82 9F                SUBB    A,R7
0D83 FF                MOV     R7,A
0D84 E4                CLR     A
0D85 9E                SUBB    A,R6
0D86 FE                MOV     R6,A
0D87 33                RLC     A
0D88 95E0              SUBB    A,ACC
0D8A FD                MOV     R5,A
0D8B FC                MOV     R4,A
0D8C AB00        R     MOV     R3,i_ref+03H
0D8E AA00        R     MOV     R2,i_ref+02H
0D90 A900        R     MOV     R1,i_ref+01H
0D92 A800        R     MOV     R0,i_ref
0D94 C3                CLR     C
0D95 120000      E     LCALL   ?C?SLCMP
0D98 501A              JNC     ?C0114
                                           ; SOURCE LINE # 695
0D9A 900000      E     MOV     DPTR,#c_mem+069H
0D9D E0                MOVX    A,@DPTR
0D9E FE                MOV     R6,A
0D9F A3                INC     DPTR
0DA0 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 72  

0DA1 FF                MOV     R7,A
0DA2 C3                CLR     C
0DA3 E4                CLR     A
0DA4 9F                SUBB    A,R7
0DA5 FF                MOV     R7,A
0DA6 E4                CLR     A
0DA7 9E                SUBB    A,R6
0DA8 FE                MOV     R6,A
0DA9 33                RLC     A
0DAA 95E0              SUBB    A,ACC
0DAC 8F00        R     MOV     i_ref+03H,R7
0DAE 8E00        R     MOV     i_ref+02H,R6
0DB0 F500        R     MOV     i_ref+01H,A
0DB2 F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 696
0DB4         ?C0114:
                                           ; SOURCE LINE # 699
0DB4 900000      E     MOV     DPTR,#g_meas+0CH
0DB7 E0                MOVX    A,@DPTR
0DB8 F8                MOV     R0,A
0DB9 A3                INC     DPTR
0DBA E0                MOVX    A,@DPTR
0DBB F9                MOV     R1,A
0DBC A3                INC     DPTR
0DBD E0                MOVX    A,@DPTR
0DBE FA                MOV     R2,A
0DBF A3                INC     DPTR
0DC0 E0                MOVX    A,@DPTR
0DC1 FB                MOV     R3,A
0DC2 C3                CLR     C
0DC3 E500        R     MOV     A,i_ref+03H
0DC5 9B                SUBB    A,R3
0DC6 F500        R     MOV     curr_error+03H,A
0DC8 E500        R     MOV     A,i_ref+02H
0DCA 9A                SUBB    A,R2
0DCB F500        R     MOV     curr_error+02H,A
0DCD E500        R     MOV     A,i_ref+01H
0DCF 99                SUBB    A,R1
0DD0 F500        R     MOV     curr_error+01H,A
0DD2 E500        R     MOV     A,i_ref
0DD4 98                SUBB    A,R0
0DD5 F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 700
0DD7 900000      R     MOV     DPTR,#curr_error_sum
0DDA E0                MOVX    A,@DPTR
0DDB FC                MOV     R4,A
0DDC A3                INC     DPTR
0DDD E0                MOVX    A,@DPTR
0DDE FD                MOV     R5,A
0DDF A3                INC     DPTR
0DE0 E0                MOVX    A,@DPTR
0DE1 FE                MOV     R6,A
0DE2 A3                INC     DPTR
0DE3 E0                MOVX    A,@DPTR
0DE4 2500        R     ADD     A,curr_error+03H
0DE6 FF                MOV     R7,A
0DE7 EE                MOV     A,R6
0DE8 3500        R     ADDC    A,curr_error+02H
0DEA FE                MOV     R6,A
0DEB ED                MOV     A,R5
0DEC 3500        R     ADDC    A,curr_error+01H
0DEE FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 73  

0DEF EC                MOV     A,R4
0DF0 3500        R     ADDC    A,curr_error
0DF2 FC                MOV     R4,A
0DF3 900000      R     MOV     DPTR,#curr_error_sum
0DF6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 702
0DF9 7FA0              MOV     R7,#0A0H
0DFB 7E86              MOV     R6,#086H
0DFD 7D01              MOV     R5,#01H
0DFF 7C00              MOV     R4,#00H
0E01 900000      R     MOV     DPTR,#curr_error_sum
0E04 E0                MOVX    A,@DPTR
0E05 F8                MOV     R0,A
0E06 A3                INC     DPTR
0E07 E0                MOVX    A,@DPTR
0E08 F9                MOV     R1,A
0E09 A3                INC     DPTR
0E0A E0                MOVX    A,@DPTR
0E0B FA                MOV     R2,A
0E0C A3                INC     DPTR
0E0D E0                MOVX    A,@DPTR
0E0E FB                MOV     R3,A
0E0F D3                SETB    C
0E10 120000      E     LCALL   ?C?SLCMP
0E13 4010              JC      ?C0116
                                           ; SOURCE LINE # 703
0E15 7FA0              MOV     R7,#0A0H
0E17 7E86              MOV     R6,#086H
0E19 7D01              MOV     R5,#01H
0E1B 7C00              MOV     R4,#00H
0E1D 900000      R     MOV     DPTR,#curr_error_sum
0E20 120000      E     LCALL   ?C?LSTXDATA
0E23 802A              SJMP    ?C0117
0E25         ?C0116:
                                           ; SOURCE LINE # 704
                                           ; SOURCE LINE # 705
0E25 7F60              MOV     R7,#060H
0E27 7E79              MOV     R6,#079H
0E29 7DFE              MOV     R5,#0FEH
0E2B 7CFF              MOV     R4,#0FFH
0E2D 900000      R     MOV     DPTR,#curr_error_sum
0E30 E0                MOVX    A,@DPTR
0E31 F8                MOV     R0,A
0E32 A3                INC     DPTR
0E33 E0                MOVX    A,@DPTR
0E34 F9                MOV     R1,A
0E35 A3                INC     DPTR
0E36 E0                MOVX    A,@DPTR
0E37 FA                MOV     R2,A
0E38 A3                INC     DPTR
0E39 E0                MOVX    A,@DPTR
0E3A FB                MOV     R3,A
0E3B C3                CLR     C
0E3C 120000      E     LCALL   ?C?SLCMP
0E3F 500E              JNC     ?C0117
                                           ; SOURCE LINE # 706
0E41 7F60              MOV     R7,#060H
0E43 7E79              MOV     R6,#079H
0E45 7DFE              MOV     R5,#0FEH
0E47 7CFF              MOV     R4,#0FFH
0E49 900000      R     MOV     DPTR,#curr_error_sum
0E4C 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 74  

                                           ; SOURCE LINE # 707
0E4F         ?C0117:
                                           ; SOURCE LINE # 709
0E4F E4                CLR     A
0E50 F500        R     MOV     pwm_input+03H,A
0E52 F500        R     MOV     pwm_input+02H,A
0E54 F500        R     MOV     pwm_input+01H,A
0E56 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 712
0E58 FF                MOV     R7,A
0E59 FE                MOV     R6,A
0E5A FD                MOV     R5,A
0E5B FC                MOV     R4,A
0E5C AB00        R     MOV     R3,k_p_c+03H
0E5E AA00        R     MOV     R2,k_p_c+02H
0E60 A900        R     MOV     R1,k_p_c+01H
0E62 A800        R     MOV     R0,k_p_c
0E64 C3                CLR     C
0E65 120000      E     LCALL   ?C?SLCMP
0E68 6026              JZ      ?C0119
                                           ; SOURCE LINE # 713
0E6A AF00        R     MOV     R7,curr_error+03H
0E6C AE00        R     MOV     R6,curr_error+02H
0E6E AD00        R     MOV     R5,curr_error+01H
0E70 AC00        R     MOV     R4,curr_error
0E72 A800        R     MOV     R0,k_p_c
0E74 120000      E     LCALL   ?C?LMUL
0E77 7810              MOV     R0,#010H
0E79 120000      E     LCALL   ?C?SLSHR
0E7C E500        R     MOV     A,pwm_input+03H
0E7E 2F                ADD     A,R7
0E7F F500        R     MOV     pwm_input+03H,A
0E81 E500        R     MOV     A,pwm_input+02H
0E83 3E                ADDC    A,R6
0E84 F500        R     MOV     pwm_input+02H,A
0E86 E500        R     MOV     A,pwm_input+01H
0E88 3D                ADDC    A,R5
0E89 F500        R     MOV     pwm_input+01H,A
0E8B E500        R     MOV     A,pwm_input
0E8D 3C                ADDC    A,R4
0E8E F500        R     MOV     pwm_input,A
0E90         ?C0119:
                                           ; SOURCE LINE # 716
0E90 E4                CLR     A
0E91 FF                MOV     R7,A
0E92 FE                MOV     R6,A
0E93 FD                MOV     R5,A
0E94 FC                MOV     R4,A
0E95 AB00        R     MOV     R3,k_i_c+03H
0E97 AA00        R     MOV     R2,k_i_c+02H
0E99 A900        R     MOV     R1,k_i_c+01H
0E9B A800        R     MOV     R0,k_i_c
0E9D C3                CLR     C
0E9E 120000      E     LCALL   ?C?SLCMP
0EA1 602C              JZ      ?C0120
                                           ; SOURCE LINE # 717
0EA3 900000      R     MOV     DPTR,#curr_error_sum
0EA6 E0                MOVX    A,@DPTR
0EA7 FC                MOV     R4,A
0EA8 A3                INC     DPTR
0EA9 E0                MOVX    A,@DPTR
0EAA FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 75  

0EAB A3                INC     DPTR
0EAC E0                MOVX    A,@DPTR
0EAD FE                MOV     R6,A
0EAE A3                INC     DPTR
0EAF E0                MOVX    A,@DPTR
0EB0 FF                MOV     R7,A
0EB1 A800        R     MOV     R0,k_i_c
0EB3 120000      E     LCALL   ?C?LMUL
0EB6 7810              MOV     R0,#010H
0EB8 120000      E     LCALL   ?C?SLSHR
0EBB E500        R     MOV     A,pwm_input+03H
0EBD 2F                ADD     A,R7
0EBE F500        R     MOV     pwm_input+03H,A
0EC0 E500        R     MOV     A,pwm_input+02H
0EC2 3E                ADDC    A,R6
0EC3 F500        R     MOV     pwm_input+02H,A
0EC5 E500        R     MOV     A,pwm_input+01H
0EC7 3D                ADDC    A,R5
0EC8 F500        R     MOV     pwm_input+01H,A
0ECA E500        R     MOV     A,pwm_input
0ECC 3C                ADDC    A,R4
0ECD F500        R     MOV     pwm_input,A
0ECF         ?C0120:
                                           ; SOURCE LINE # 720
0ECF E4                CLR     A
0ED0 FF                MOV     R7,A
0ED1 FE                MOV     R6,A
0ED2 FD                MOV     R5,A
0ED3 FC                MOV     R4,A
0ED4 AB00        R     MOV     R3,k_d_c+03H
0ED6 AA00        R     MOV     R2,k_d_c+02H
0ED8 A900        R     MOV     R1,k_d_c+01H
0EDA A800        R     MOV     R0,k_d_c
0EDC C3                CLR     C
0EDD 120000      E     LCALL   ?C?SLCMP
0EE0 6043              JZ      ?C0121
                                           ; SOURCE LINE # 721
0EE2 900000      R     MOV     DPTR,#prev_curr_err
0EE5 E0                MOVX    A,@DPTR
0EE6 F8                MOV     R0,A
0EE7 A3                INC     DPTR
0EE8 E0                MOVX    A,@DPTR
0EE9 F9                MOV     R1,A
0EEA A3                INC     DPTR
0EEB E0                MOVX    A,@DPTR
0EEC FA                MOV     R2,A
0EED A3                INC     DPTR
0EEE E0                MOVX    A,@DPTR
0EEF FB                MOV     R3,A
0EF0 C3                CLR     C
0EF1 E500        R     MOV     A,curr_error+03H
0EF3 9B                SUBB    A,R3
0EF4 FF                MOV     R7,A
0EF5 E500        R     MOV     A,curr_error+02H
0EF7 9A                SUBB    A,R2
0EF8 FE                MOV     R6,A
0EF9 E500        R     MOV     A,curr_error+01H
0EFB 99                SUBB    A,R1
0EFC FD                MOV     R5,A
0EFD E500        R     MOV     A,curr_error
0EFF 98                SUBB    A,R0
0F00 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 76  

0F01 AB00        R     MOV     R3,k_d_c+03H
0F03 AA00        R     MOV     R2,k_d_c+02H
0F05 A900        R     MOV     R1,k_d_c+01H
0F07 A800        R     MOV     R0,k_d_c
0F09 120000      E     LCALL   ?C?LMUL
0F0C 7810              MOV     R0,#010H
0F0E 120000      E     LCALL   ?C?SLSHR
0F11 E500        R     MOV     A,pwm_input+03H
0F13 2F                ADD     A,R7
0F14 F500        R     MOV     pwm_input+03H,A
0F16 E500        R     MOV     A,pwm_input+02H
0F18 3E                ADDC    A,R6
0F19 F500        R     MOV     pwm_input+02H,A
0F1B E500        R     MOV     A,pwm_input+01H
0F1D 3D                ADDC    A,R5
0F1E F500        R     MOV     pwm_input+01H,A
0F20 E500        R     MOV     A,pwm_input
0F22 3C                ADDC    A,R4
0F23 F500        R     MOV     pwm_input,A
0F25         ?C0121:
                                           ; SOURCE LINE # 723
0F25 AF00        R     MOV     R7,curr_error+03H
0F27 AE00        R     MOV     R6,curr_error+02H
0F29 AD00        R     MOV     R5,curr_error+01H
0F2B AC00        R     MOV     R4,curr_error
0F2D 900000      R     MOV     DPTR,#prev_curr_err
0F30 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 725
0F33 E4                CLR     A
0F34 FF                MOV     R7,A
0F35 FE                MOV     R6,A
0F36 FD                MOV     R5,A
0F37 FC                MOV     R4,A
0F38 AB00        R     MOV     R3,pwm_input+03H
0F3A AA00        R     MOV     R2,pwm_input+02H
0F3C A900        R     MOV     R1,pwm_input+01H
0F3E A800        R     MOV     R0,pwm_input
0F40 C3                CLR     C
0F41 120000      E     LCALL   ?C?SLCMP
0F44 4004              JC      ?C0122
                                           ; SOURCE LINE # 726
0F46 D200        R     SETB    motor_dir
0F48 8072              SJMP    ?C0080
0F4A         ?C0122:
                                           ; SOURCE LINE # 728
0F4A C200        R     CLR     motor_dir
                                           ; SOURCE LINE # 729
                                           ; SOURCE LINE # 730
0F4C 806E              SJMP    ?C0080
                                           ; SOURCE LINE # 733
0F4E         ?C0124:
                                           ; SOURCE LINE # 735
0F4E 900000      E     MOV     DPTR,#g_ref+010H
0F51 E0                MOVX    A,@DPTR
0F52 FC                MOV     R4,A
0F53 A3                INC     DPTR
0F54 E0                MOVX    A,@DPTR
0F55 FD                MOV     R5,A
0F56 A3                INC     DPTR
0F57 E0                MOVX    A,@DPTR
0F58 FE                MOV     R6,A
0F59 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 77  

0F5A E0                MOVX    A,@DPTR
0F5B F500        R     MOV     pwm_input+03H,A
0F5D 8E00        R     MOV     pwm_input+02H,R6
0F5F 8D00        R     MOV     pwm_input+01H,R5
0F61 8C00        R     MOV     pwm_input,R4
                                           ; SOURCE LINE # 737
0F63 E4                CLR     A
0F64 FF                MOV     R7,A
0F65 FE                MOV     R6,A
0F66 FD                MOV     R5,A
0F67 FC                MOV     R4,A
0F68 AB00        R     MOV     R3,pwm_input+03H
0F6A AA00        R     MOV     R2,pwm_input+02H
0F6C A900        R     MOV     R1,pwm_input+01H
0F6E A800        R     MOV     R0,pwm_input
0F70 D3                SETB    C
0F71 120000      E     LCALL   ?C?SLCMP
0F74 4004              JC      ?C0125
                                           ; SOURCE LINE # 738
0F76 D200        R     SETB    motor_dir
0F78 8002              SJMP    ?C0126
0F7A         ?C0125:
                                           ; SOURCE LINE # 740
0F7A C200        R     CLR     motor_dir
0F7C         ?C0126:
                                           ; SOURCE LINE # 744
0F7C 74FF              MOV     A,#0FFH
0F7E 7F9C              MOV     R7,#09CH
0F80 FE                MOV     R6,A
0F81 FD                MOV     R5,A
0F82 FC                MOV     R4,A
0F83 AB00        R     MOV     R3,pwm_input+03H
0F85 AA00        R     MOV     R2,pwm_input+02H
0F87 A900        R     MOV     R1,pwm_input+01H
0F89 A800        R     MOV     R0,pwm_input
0F8B C3                CLR     C
0F8C 120000      E     LCALL   ?C?SLCMP
0F8F 500D              JNC     ?C0127
                                           ; SOURCE LINE # 745
0F91 74FF              MOV     A,#0FFH
0F93 75009C      R     MOV     pwm_input+03H,#09CH
0F96 F500        R     MOV     pwm_input+02H,A
0F98 F500        R     MOV     pwm_input+01H,A
0F9A F500        R     MOV     pwm_input,A
0F9C 801E              SJMP    ?C0080
0F9E         ?C0127:
                                           ; SOURCE LINE # 746
                                           ; SOURCE LINE # 747
0F9E E4                CLR     A
0F9F 7F64              MOV     R7,#064H
0FA1 FE                MOV     R6,A
0FA2 FD                MOV     R5,A
0FA3 FC                MOV     R4,A
0FA4 AB00        R     MOV     R3,pwm_input+03H
0FA6 AA00        R     MOV     R2,pwm_input+02H
0FA8 A900        R     MOV     R1,pwm_input+01H
0FAA A800        R     MOV     R0,pwm_input
0FAC D3                SETB    C
0FAD 120000      E     LCALL   ?C?SLCMP
0FB0 400A              JC      ?C0080
                                           ; SOURCE LINE # 748
0FB2 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 78  

0FB3 750064      R     MOV     pwm_input+03H,#064H
0FB6 F500        R     MOV     pwm_input+02H,A
0FB8 F500        R     MOV     pwm_input+01H,A
0FBA F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 749
                                           ; SOURCE LINE # 751
                                           ; SOURCE LINE # 752
0FBC         ?C0080:
                                           ; SOURCE LINE # 756
0FBC E4                CLR     A
0FBD 7F64              MOV     R7,#064H
0FBF FE                MOV     R6,A
0FC0 FD                MOV     R5,A
0FC1 FC                MOV     R4,A
0FC2 AB00        R     MOV     R3,pwm_input+03H
0FC4 AA00        R     MOV     R2,pwm_input+02H
0FC6 A900        R     MOV     R1,pwm_input+01H
0FC8 A800        R     MOV     R0,pwm_input
0FCA D3                SETB    C
0FCB 120000      E     LCALL   ?C?SLCMP
0FCE 400A              JC      ?C0130
                                           ; SOURCE LINE # 757
0FD0 E4                CLR     A
0FD1 750064      R     MOV     pwm_input+03H,#064H
0FD4 F500        R     MOV     pwm_input+02H,A
0FD6 F500        R     MOV     pwm_input+01H,A
0FD8 F500        R     MOV     pwm_input,A
0FDA         ?C0130:
                                           ; SOURCE LINE # 758
0FDA 74FF              MOV     A,#0FFH
0FDC 7F9C              MOV     R7,#09CH
0FDE FE                MOV     R6,A
0FDF FD                MOV     R5,A
0FE0 FC                MOV     R4,A
0FE1 AB00        R     MOV     R3,pwm_input+03H
0FE3 AA00        R     MOV     R2,pwm_input+02H
0FE5 A900        R     MOV     R1,pwm_input+01H
0FE7 A800        R     MOV     R0,pwm_input
0FE9 C3                CLR     C
0FEA 120000      E     LCALL   ?C?SLCMP
0FED 500B              JNC     ?C0131
                                           ; SOURCE LINE # 759
0FEF 74FF              MOV     A,#0FFH
0FF1 75009C      R     MOV     pwm_input+03H,#09CH
0FF4 F500        R     MOV     pwm_input+02H,A
0FF6 F500        R     MOV     pwm_input+01H,A
0FF8 F500        R     MOV     pwm_input,A
0FFA         ?C0131:
                                           ; SOURCE LINE # 762
0FFA 900000      E     MOV     DPTR,#c_mem+034H
0FFD E0                MOVX    A,@DPTR
0FFE 6401              XRL     A,#01H
1000 6037              JZ      ?C0132
                                           ; SOURCE LINE # 763
1002 AF00        R     MOV     R7,pwm_input+03H
1004 AE00        R     MOV     R6,pwm_input+02H
1006 AD00        R     MOV     R5,pwm_input+01H
1008 AC00        R     MOV     R4,pwm_input
100A 780A              MOV     R0,#0AH
100C 120000      E     LCALL   ?C?LSHL
100F E4                CLR     A
1010 7B64              MOV     R3,#064H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 79  

1012 FA                MOV     R2,A
1013 F9                MOV     R1,A
1014 F8                MOV     R0,A
1015 120000      E     LCALL   ?C?SLDIV
1018 A804              MOV     R0,AR4
101A A905              MOV     R1,AR5
101C AA06              MOV     R2,AR6
101E AB07              MOV     R3,AR7
1020 900000      E     MOV     DPTR,#dev_pwm_limit
1023 E0                MOVX    A,@DPTR
1024 FF                MOV     R7,A
1025 E4                CLR     A
1026 FC                MOV     R4,A
1027 FD                MOV     R5,A
1028 FE                MOV     R6,A
1029 120000      E     LCALL   ?C?LMUL
102C 780A              MOV     R0,#0AH
102E 120000      E     LCALL   ?C?SLSHR
1031 8F00        R     MOV     pwm_input+03H,R7
1033 8E00        R     MOV     pwm_input+02H,R6
1035 8D00        R     MOV     pwm_input+01H,R5
1037 8C00        R     MOV     pwm_input,R4
1039         ?C0132:
                                           ; SOURCE LINE # 766
1039 E4                CLR     A
103A FF                MOV     R7,A
103B FE                MOV     R6,A
103C FD                MOV     R5,A
103D FC                MOV     R4,A
103E AB00        R     MOV     R3,pwm_input+03H
1040 AA00        R     MOV     R2,pwm_input+02H
1042 A900        R     MOV     R1,pwm_input+01H
1044 A800        R     MOV     R0,pwm_input
1046 C3                CLR     C
1047 120000      E     LCALL   ?C?SLCMP
104A 4004              JC      ?C0133
104C 7F01              MOV     R7,#01H
104E 8002              SJMP    ?C0134
1050         ?C0133:
1050 7FFF              MOV     R7,#0FFH
1052         ?C0134:
1052 900000      E     MOV     DPTR,#pwm_sign
1055 EF                MOV     A,R7
1056 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 768
1057 300007            JNB     motor_dir,?C0135
                                           ; SOURCE LINE # 769
105A 7F01              MOV     R7,#01H
105C 120000      E     LCALL   _MOTOR_DIR_Write
105F 8005              SJMP    ?C0136
1061         ?C0135:
                                           ; SOURCE LINE # 771
1061 E4                CLR     A
1062 FF                MOV     R7,A
1063 120000      E     LCALL   _MOTOR_DIR_Write
1066         ?C0136:
                                           ; SOURCE LINE # 773
1066 AE00        R     MOV     R6,pwm_input+02H
1068 AF00        R     MOV     R7,pwm_input+03H
106A 120000      E     LCALL   _abs
106D 120000      E     LCALL   _PWM_MOTORS_WriteCompare1
                                           ; SOURCE LINE # 774
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 80  

1070 22                RET     
             ; FUNCTION motor_control (END)

             ; FUNCTION _encoder_reading (BEGIN)
                                           ; SOURCE LINE # 780
;---- Variable 'idx' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 782
0000 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 813
0002 E500        R     MOV     A,index
0004 C3                CLR     C
0005 9403              SUBB    A,#03H
0007 4003              JC      $ + 5H
0009 020000      R     LJMP    ?C0139
000C         ?C0138:
                                           ; SOURCE LINE # 816
000C 300022            JNB     reset_last_value_flag,?C0140
                                           ; SOURCE LINE # 817
;---- Variable 'jj' assigned to Register 'R3' ----
000F 7B03              MOV     R3,#03H
0011         ?C0141:
0011 AF03              MOV     R7,AR3
0013 1B                DEC     R3
0014 EF                MOV     A,R7
0015 6018              JZ      ?C0142
                                           ; SOURCE LINE # 818
0017 E4                CLR     A
0018 FF                MOV     R7,A
0019 FE                MOV     R6,A
001A FD                MOV     R5,A
001B FC                MOV     R4,A
001C EB                MOV     A,R3
001D 25E0              ADD     A,ACC
001F 25E0              ADD     A,ACC
0021 2400        R     ADD     A,#LOW last_value_encoder
0023 F582              MOV     DPL,A
0025 E4                CLR     A
0026 3400        R     ADDC    A,#HIGH last_value_encoder
0028 F583              MOV     DPH,A
002A 120000      E     LCALL   ?C?LSTXDATA
002D 80E2              SJMP    ?C0141
002F         ?C0142:
                                           ; SOURCE LINE # 820
002F C200        E     CLR     reset_last_value_flag
                                           ; SOURCE LINE # 821
0031         ?C0140:
                                           ; SOURCE LINE # 825
0031 E500        R     MOV     A,index
0033 7018              JNZ     ?C0143
                                           ; SOURCE LINE # 826
0035 120000      E     LCALL   SHIFTREG_ENC_1_ReadData
0038 7801              MOV     R0,#01H
003A 120000      E     LCALL   ?C?ULSHR
003D EF                MOV     A,R7
003E EE                MOV     A,R6
003F ED                MOV     A,R5
0040 5403              ANL     A,#03H
0042 FD                MOV     R5,A
0043 E4                CLR     A
0044 FC                MOV     R4,A
0045 900000      R     MOV     DPTR,#data_encoder
0048 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 81  

004B 8033              SJMP    ?C0144
004D         ?C0143:
                                           ; SOURCE LINE # 827
                                           ; SOURCE LINE # 828
004D E500        R     MOV     A,index
004F B40118            CJNE    A,#01H,?C0145
                                           ; SOURCE LINE # 829
0052 120000      E     LCALL   SHIFTREG_ENC_2_ReadData
0055 7801              MOV     R0,#01H
0057 120000      E     LCALL   ?C?ULSHR
005A EF                MOV     A,R7
005B EE                MOV     A,R6
005C ED                MOV     A,R5
005D 5403              ANL     A,#03H
005F FD                MOV     R5,A
0060 E4                CLR     A
0061 FC                MOV     R4,A
0062 900000      R     MOV     DPTR,#data_encoder
0065 120000      E     LCALL   ?C?LSTXDATA
0068 8016              SJMP    ?C0144
006A         ?C0145:
                                           ; SOURCE LINE # 831
006A 120000      E     LCALL   SHIFTREG_ENC_3_ReadData
006D 7801              MOV     R0,#01H
006F 120000      E     LCALL   ?C?ULSHR
0072 EF                MOV     A,R7
0073 EE                MOV     A,R6
0074 ED                MOV     A,R5
0075 5403              ANL     A,#03H
0077 FD                MOV     R5,A
0078 E4                CLR     A
0079 FC                MOV     R4,A
007A 900000      R     MOV     DPTR,#data_encoder
007D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 832
0080         ?C0144:
                                           ; SOURCE LINE # 835
0080 7B01              MOV     R3,#01H
0082 7A00        R     MOV     R2,#HIGH data_encoder
0084 7900        R     MOV     R1,#LOW data_encoder
0086 120000      E     LCALL   _check_enc_data
0089 4003              JC      $ + 5H
008B 020000      R     LJMP    ?C0147
                                           ; SOURCE LINE # 837
008E 900000      R     MOV     DPTR,#data_encoder
0091 E0                MOVX    A,@DPTR
0092 FC                MOV     R4,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FD                MOV     R5,A
0096 A3                INC     DPTR
0097 E0                MOVX    A,@DPTR
0098 FE                MOV     R6,A
0099 A3                INC     DPTR
009A E0                MOVX    A,@DPTR
009B 54C0              ANL     A,#0C0H
009D FF                MOV     R7,A
009E EE                MOV     A,R6
009F ED                MOV     A,R5
00A0 5403              ANL     A,#03H
00A2 FD                MOV     R5,A
00A3 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 82  

00A4 2F                ADD     A,R7
00A5 FF                MOV     R7,A
00A6 E4                CLR     A
00A7 3E                ADDC    A,R6
00A8 FE                MOV     R6,A
00A9 ED                MOV     A,R5
00AA 34FE              ADDC    A,#0FEH
00AC FD                MOV     R5,A
00AD E4                CLR     A
00AE 34FF              ADDC    A,#0FFH
00B0 FC                MOV     R4,A
00B1 7802              MOV     R0,#02H
00B3 120000      E     LCALL   ?C?ULSHR
00B6 EE                MOV     A,R6
00B7 33                RLC     A
00B8 95E0              SUBB    A,ACC
00BA FD                MOV     R5,A
00BB FC                MOV     R4,A
00BC E500        R     MOV     A,index
00BE 25E0              ADD     A,ACC
00C0 25E0              ADD     A,ACC
00C2 2400        E     ADD     A,#LOW g_mem+038H
00C4 F582              MOV     DPL,A
00C6 E4                CLR     A
00C7 3400        E     ADDC    A,#HIGH g_mem+038H
00C9 F583              MOV     DPH,A
00CB E0                MOVX    A,@DPTR
00CC F8                MOV     R0,A
00CD A3                INC     DPTR
00CE E0                MOVX    A,@DPTR
00CF F9                MOV     R1,A
00D0 A3                INC     DPTR
00D1 E0                MOVX    A,@DPTR
00D2 FA                MOV     R2,A
00D3 A3                INC     DPTR
00D4 E0                MOVX    A,@DPTR
00D5 2F                ADD     A,R7
00D6 FF                MOV     R7,A
00D7 EA                MOV     A,R2
00D8 3E                ADDC    A,R6
00D9 FE                MOV     R6,A
00DA E9                MOV     A,R1
00DB 3D                ADDC    A,R5
00DC FD                MOV     R5,A
00DD E8                MOV     A,R0
00DE 3C                ADDC    A,R4
00DF FC                MOV     R4,A
00E0 900000      R     MOV     DPTR,#value_encoder
00E3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 844
00E6 300027            JNB     only_first_time,?C0148
                                           ; SOURCE LINE # 845
00E9 900000      R     MOV     DPTR,#value_encoder
00EC E0                MOVX    A,@DPTR
00ED FC                MOV     R4,A
00EE A3                INC     DPTR
00EF E0                MOVX    A,@DPTR
00F0 FD                MOV     R5,A
00F1 A3                INC     DPTR
00F2 E0                MOVX    A,@DPTR
00F3 FE                MOV     R6,A
00F4 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 83  

00F5 E0                MOVX    A,@DPTR
00F6 FF                MOV     R7,A
00F7 E500        R     MOV     A,index
00F9 25E0              ADD     A,ACC
00FB 25E0              ADD     A,ACC
00FD 2400        R     ADD     A,#LOW last_value_encoder
00FF F582              MOV     DPL,A
0101 E4                CLR     A
0102 3400        R     ADDC    A,#HIGH last_value_encoder
0104 F583              MOV     DPH,A
0106 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 846
0109 E500        R     MOV     A,index
010B B40202            CJNE    A,#02H,?C0148
                                           ; SOURCE LINE # 847
010E C200        R     CLR     only_first_time
                                           ; SOURCE LINE # 848
0110         ?C0148:
                                           ; SOURCE LINE # 851
0110 E500        R     MOV     A,index
0112 25E0              ADD     A,ACC
0114 25E0              ADD     A,ACC
0116 2400        R     ADD     A,#LOW last_value_encoder
0118 F582              MOV     DPL,A
011A E4                CLR     A
011B 3400        R     ADDC    A,#HIGH last_value_encoder
011D F583              MOV     DPH,A
011F E0                MOVX    A,@DPTR
0120 F8                MOV     R0,A
0121 A3                INC     DPTR
0122 E0                MOVX    A,@DPTR
0123 F9                MOV     R1,A
0124 A3                INC     DPTR
0125 E0                MOVX    A,@DPTR
0126 FA                MOV     R2,A
0127 A3                INC     DPTR
0128 E0                MOVX    A,@DPTR
0129 FB                MOV     R3,A
012A 900000      R     MOV     DPTR,#value_encoder
012D E0                MOVX    A,@DPTR
012E FC                MOV     R4,A
012F A3                INC     DPTR
0130 E0                MOVX    A,@DPTR
0131 FD                MOV     R5,A
0132 A3                INC     DPTR
0133 E0                MOVX    A,@DPTR
0134 FE                MOV     R6,A
0135 A3                INC     DPTR
0136 E0                MOVX    A,@DPTR
0137 C3                CLR     C
0138 9B                SUBB    A,R3
0139 FF                MOV     R7,A
013A EE                MOV     A,R6
013B 9A                SUBB    A,R2
013C FE                MOV     R6,A
013D ED                MOV     A,R5
013E 99                SUBB    A,R1
013F FD                MOV     R5,A
0140 EC                MOV     A,R4
0141 98                SUBB    A,R0
0142 FC                MOV     R4,A
0143 900000      R     MOV     DPTR,#aux
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 84  

0146 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 871
0149 E4                CLR     A
014A FF                MOV     R7,A
014B 7EC0              MOV     R6,#0C0H
014D FD                MOV     R5,A
014E FC                MOV     R4,A
014F 900000      R     MOV     DPTR,#aux
0152 E0                MOVX    A,@DPTR
0153 F8                MOV     R0,A
0154 A3                INC     DPTR
0155 E0                MOVX    A,@DPTR
0156 F9                MOV     R1,A
0157 A3                INC     DPTR
0158 E0                MOVX    A,@DPTR
0159 FA                MOV     R2,A
015A A3                INC     DPTR
015B E0                MOVX    A,@DPTR
015C FB                MOV     R3,A
015D D3                SETB    C
015E 120000      E     LCALL   ?C?SLCMP
0161 4010              JC      ?C0150
                                           ; SOURCE LINE # 872
0163 7400        E     MOV     A,#LOW g_meas+014H
0165 2500        R     ADD     A,index
0167 F582              MOV     DPL,A
0169 E4                CLR     A
016A 3400        E     ADDC    A,#HIGH g_meas+014H
016C F583              MOV     DPH,A
016E E0                MOVX    A,@DPTR
016F 14                DEC     A
0170 F0                MOVX    @DPTR,A
0171 8068              SJMP    ?C0151
0173         ?C0150:
                                           ; SOURCE LINE # 873
                                           ; SOURCE LINE # 874
0173 7F00              MOV     R7,#00H
0175 7E40              MOV     R6,#040H
0177 7DFF              MOV     R5,#0FFH
0179 7CFF              MOV     R4,#0FFH
017B 900000      R     MOV     DPTR,#aux
017E E0                MOVX    A,@DPTR
017F F8                MOV     R0,A
0180 A3                INC     DPTR
0181 E0                MOVX    A,@DPTR
0182 F9                MOV     R1,A
0183 A3                INC     DPTR
0184 E0                MOVX    A,@DPTR
0185 FA                MOV     R2,A
0186 A3                INC     DPTR
0187 E0                MOVX    A,@DPTR
0188 FB                MOV     R3,A
0189 C3                CLR     C
018A 120000      E     LCALL   ?C?SLCMP
018D 5010              JNC     ?C0152
                                           ; SOURCE LINE # 875
018F 7400        E     MOV     A,#LOW g_meas+014H
0191 2500        R     ADD     A,index
0193 F582              MOV     DPL,A
0195 E4                CLR     A
0196 3400        E     ADDC    A,#HIGH g_meas+014H
0198 F583              MOV     DPH,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 85  

019A E0                MOVX    A,@DPTR
019B 04                INC     A
019C F0                MOVX    @DPTR,A
019D 803C              SJMP    ?C0151
019F         ?C0152:
                                           ; SOURCE LINE # 876
                                           ; SOURCE LINE # 877
019F 900000      R     MOV     DPTR,#aux
01A2 E0                MOVX    A,@DPTR
01A3 A3                INC     DPTR
01A4 E0                MOVX    A,@DPTR
01A5 A3                INC     DPTR
01A6 E0                MOVX    A,@DPTR
01A7 FE                MOV     R6,A
01A8 A3                INC     DPTR
01A9 E0                MOVX    A,@DPTR
01AA FF                MOV     R7,A
01AB 120000      E     LCALL   _abs
01AE D3                SETB    C
01AF EF                MOV     A,R7
01B0 9400              SUBB    A,#00H
01B2 EE                MOV     A,R6
01B3 6480              XRL     A,#080H
01B5 94C0              SUBB    A,#0C0H
01B7 4022              JC      ?C0151
                                           ; SOURCE LINE # 878
01B9 7400        R     MOV     A,#LOW error
01BB 2500        R     ADD     A,index
01BD F582              MOV     DPL,A
01BF E4                CLR     A
01C0 3400        R     ADDC    A,#HIGH error
01C2 F583              MOV     DPH,A
01C4 E0                MOVX    A,@DPTR
01C5 04                INC     A
01C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 879
01C7 7400        R     MOV     A,#LOW error
01C9 2500        R     ADD     A,index
01CB F582              MOV     DPL,A
01CD E4                CLR     A
01CE 3400        R     ADDC    A,#HIGH error
01D0 F583              MOV     DPH,A
01D2 E0                MOVX    A,@DPTR
01D3 C3                CLR     C
01D4 940A              SUBB    A,#0AH
01D6 5003              JNC     $ + 5H
01D8 020000      R     LJMP    ?C0139
01DB         ?C0155:
                                           ; SOURCE LINE # 882
                                           ; SOURCE LINE # 883
                                           ; SOURCE LINE # 884
01DB         ?C0151:
                                           ; SOURCE LINE # 886
01DB 7400        R     MOV     A,#LOW error
01DD 2500        R     ADD     A,index
01DF F582              MOV     DPL,A
01E1 E4                CLR     A
01E2 3400        R     ADDC    A,#HIGH error
01E4 F583              MOV     DPH,A
01E6 E4                CLR     A
01E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 888
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 86  

01E8 900000      R     MOV     DPTR,#value_encoder
01EB E0                MOVX    A,@DPTR
01EC FC                MOV     R4,A
01ED A3                INC     DPTR
01EE E0                MOVX    A,@DPTR
01EF FD                MOV     R5,A
01F0 A3                INC     DPTR
01F1 E0                MOVX    A,@DPTR
01F2 FE                MOV     R6,A
01F3 A3                INC     DPTR
01F4 E0                MOVX    A,@DPTR
01F5 FF                MOV     R7,A
01F6 E500        R     MOV     A,index
01F8 25E0              ADD     A,ACC
01FA 25E0              ADD     A,ACC
01FC 2400        R     ADD     A,#LOW last_value_encoder
01FE F582              MOV     DPL,A
0200 E4                CLR     A
0201 3400        R     ADDC    A,#HIGH last_value_encoder
0203 F583              MOV     DPH,A
0205 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 890
0208 900000      R     MOV     DPTR,#value_encoder
020B E0                MOVX    A,@DPTR
020C F8                MOV     R0,A
020D A3                INC     DPTR
020E E0                MOVX    A,@DPTR
020F F9                MOV     R1,A
0210 A3                INC     DPTR
0211 E0                MOVX    A,@DPTR
0212 FA                MOV     R2,A
0213 A3                INC     DPTR
0214 E0                MOVX    A,@DPTR
0215 FB                MOV     R3,A
0216 C000              PUSH    AR0
0218 7400        E     MOV     A,#LOW g_meas+014H
021A 2500        R     ADD     A,index
021C F582              MOV     DPL,A
021E E4                CLR     A
021F 3400        E     ADDC    A,#HIGH g_meas+014H
0221 F583              MOV     DPH,A
0223 E0                MOVX    A,@DPTR
0224 FF                MOV     R7,A
0225 33                RLC     A
0226 95E0              SUBB    A,ACC
0228 FE                MOV     R6,A
0229 FD                MOV     R5,A
022A FC                MOV     R4,A
022B 7810              MOV     R0,#010H
022D 120000      E     LCALL   ?C?LSHL
0230 D000              POP     AR0
0232 EB                MOV     A,R3
0233 2F                ADD     A,R7
0234 FF                MOV     R7,A
0235 EA                MOV     A,R2
0236 3E                ADDC    A,R6
0237 FE                MOV     R6,A
0238 E9                MOV     A,R1
0239 3D                ADDC    A,R5
023A FD                MOV     R5,A
023B E8                MOV     A,R0
023C 3C                ADDC    A,R4
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 87  

023D FC                MOV     R4,A
023E 900000      R     MOV     DPTR,#value_encoder
0241 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 892
0244 E500        R     MOV     A,index
0246 25E0              ADD     A,ACC
0248 25E0              ADD     A,ACC
024A 2400        E     ADD     A,#LOW c_mem+044H
024C F582              MOV     DPL,A
024E E4                CLR     A
024F 3400        E     ADDC    A,#HIGH c_mem+044H
0251 F583              MOV     DPH,A
0253 E0                MOVX    A,@DPTR
0254 FC                MOV     R4,A
0255 A3                INC     DPTR
0256 E0                MOVX    A,@DPTR
0257 FD                MOV     R5,A
0258 A3                INC     DPTR
0259 E0                MOVX    A,@DPTR
025A FE                MOV     R6,A
025B A3                INC     DPTR
025C E0                MOVX    A,@DPTR
025D FF                MOV     R7,A
025E E4                CLR     A
025F FB                MOV     R3,A
0260 FA                MOV     R2,A
0261 7980              MOV     R1,#080H
0263 783F              MOV     R0,#03FH
0265 120000      E     LCALL   ?C?FPCMP3
0268 6038              JZ      ?C0156
                                           ; SOURCE LINE # 893
026A 900000      R     MOV     DPTR,#value_encoder
026D E0                MOVX    A,@DPTR
026E FC                MOV     R4,A
026F A3                INC     DPTR
0270 E0                MOVX    A,@DPTR
0271 FD                MOV     R5,A
0272 A3                INC     DPTR
0273 E0                MOVX    A,@DPTR
0274 FE                MOV     R6,A
0275 A3                INC     DPTR
0276 E0                MOVX    A,@DPTR
0277 FF                MOV     R7,A
0278 EC                MOV     A,R4
0279 120000      E     LCALL   ?C?FCASTL
027C E500        R     MOV     A,index
027E 25E0              ADD     A,ACC
0280 25E0              ADD     A,ACC
0282 2400        E     ADD     A,#LOW c_mem+044H
0284 F582              MOV     DPL,A
0286 E4                CLR     A
0287 3400        E     ADDC    A,#HIGH c_mem+044H
0289 F583              MOV     DPH,A
028B E0                MOVX    A,@DPTR
028C F8                MOV     R0,A
028D A3                INC     DPTR
028E E0                MOVX    A,@DPTR
028F F9                MOV     R1,A
0290 A3                INC     DPTR
0291 E0                MOVX    A,@DPTR
0292 FA                MOV     R2,A
0293 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 88  

0294 E0                MOVX    A,@DPTR
0295 FB                MOV     R3,A
0296 120000      E     LCALL   ?C?FPMUL
0299 120000      E     LCALL   ?C?CASTF
029C 900000      R     MOV     DPTR,#value_encoder
029F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 894
02A2         ?C0156:
                                           ; SOURCE LINE # 896
02A2 900000      R     MOV     DPTR,#value_encoder
02A5 E0                MOVX    A,@DPTR
02A6 FC                MOV     R4,A
02A7 A3                INC     DPTR
02A8 E0                MOVX    A,@DPTR
02A9 FD                MOV     R5,A
02AA A3                INC     DPTR
02AB E0                MOVX    A,@DPTR
02AC FE                MOV     R6,A
02AD A3                INC     DPTR
02AE E0                MOVX    A,@DPTR
02AF FF                MOV     R7,A
02B0 E500        R     MOV     A,index
02B2 25E0              ADD     A,ACC
02B4 25E0              ADD     A,ACC
02B6 2400        E     ADD     A,#LOW g_meas
02B8 F582              MOV     DPL,A
02BA E4                CLR     A
02BB 3400        E     ADDC    A,#HIGH g_meas
02BD F583              MOV     DPH,A
02BF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 899
02C2 900000      E     MOV     DPTR,#c_mem+079H
02C5 E0                MOVX    A,@DPTR
02C6 6008              JZ      ?C0157
                                           ; SOURCE LINE # 900
02C8 900000      R     MOV     DPTR,#handle_index
02CB 7402              MOV     A,#02H
02CD F0                MOVX    @DPTR,A
02CE 8006              SJMP    ?C0158
02D0         ?C0157:
                                           ; SOURCE LINE # 902
02D0 900000      R     MOV     DPTR,#handle_index
02D3 7401              MOV     A,#01H
02D5 F0                MOVX    @DPTR,A
02D6         ?C0158:
                                           ; SOURCE LINE # 904
02D6 900000      R     MOV     DPTR,#handle_index
02D9 E0                MOVX    A,@DPTR
02DA FB                MOV     R3,A
02DB 6500        R     XRL     A,index
02DD 6003              JZ      $ + 5H
02DF 020000      R     LJMP    ?C0147
02E2 900000      E     MOV     DPTR,#c_mem+033H
02E5 E0                MOVX    A,@DPTR
02E6 6401              XRL     A,#01H
02E8 6003              JZ      $ + 5H
02EA 020000      R     LJMP    ?C0147
                                           ; SOURCE LINE # 905
02ED EB                MOV     A,R3
02EE 25E0              ADD     A,ACC
02F0 25E0              ADD     A,ACC
02F2 2400        E     ADD     A,#LOW g_meas
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 89  

02F4 F582              MOV     DPL,A
02F6 E4                CLR     A
02F7 3400        E     ADDC    A,#HIGH g_meas
02F9 F583              MOV     DPH,A
02FB E0                MOVX    A,@DPTR
02FC FC                MOV     R4,A
02FD A3                INC     DPTR
02FE E0                MOVX    A,@DPTR
02FF FD                MOV     R5,A
0300 A3                INC     DPTR
0301 E0                MOVX    A,@DPTR
0302 FE                MOV     R6,A
0303 A3                INC     DPTR
0304 E0                MOVX    A,@DPTR
0305 FF                MOV     R7,A
0306 7400        E     MOV     A,#LOW g_mem+035H
0308 2B                ADD     A,R3
0309 F582              MOV     DPL,A
030B E4                CLR     A
030C 3400        E     ADDC    A,#HIGH g_mem+035H
030E F583              MOV     DPH,A
0310 E0                MOVX    A,@DPTR
0311 F9                MOV     R1,A
0312 F8                MOV     R0,A
0313 120000      E     LCALL   ?C?SLSHR
0316 900000      R     MOV     DPTR,#handle_pos
0319 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 907
031C E500        R     MOV     A,h_status
031E 14                DEC     A
031F 6023              JZ      ?C0163
0321 04                INC     A
0322 704D              JNZ     ?C0147
                                           ; SOURCE LINE # 908
0324         ?C0161:
                                           ; SOURCE LINE # 909
0324 74FF              MOV     A,#0FFH
0326 7FB0              MOV     R7,#0B0H
0328 FE                MOV     R6,A
0329 FD                MOV     R5,A
032A FC                MOV     R4,A
032B 900000      R     MOV     DPTR,#handle_pos
032E E0                MOVX    A,@DPTR
032F F8                MOV     R0,A
0330 A3                INC     DPTR
0331 E0                MOVX    A,@DPTR
0332 F9                MOV     R1,A
0333 A3                INC     DPTR
0334 E0                MOVX    A,@DPTR
0335 FA                MOV     R2,A
0336 A3                INC     DPTR
0337 E0                MOVX    A,@DPTR
0338 FB                MOV     R3,A
0339 C3                CLR     C
033A 120000      E     LCALL   ?C?SLCMP
033D 5032              JNC     ?C0147
                                           ; SOURCE LINE # 910
033F 750001      R     MOV     h_status,#01H
                                           ; SOURCE LINE # 911
                                           ; SOURCE LINE # 912
0342 802D              SJMP    ?C0147
                                           ; SOURCE LINE # 913
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 90  

0344         ?C0163:
                                           ; SOURCE LINE # 914
0344 74FF              MOV     A,#0FFH
0346 7FD8              MOV     R7,#0D8H
0348 FE                MOV     R6,A
0349 FD                MOV     R5,A
034A FC                MOV     R4,A
034B 900000      R     MOV     DPTR,#handle_pos
034E E0                MOVX    A,@DPTR
034F F8                MOV     R0,A
0350 A3                INC     DPTR
0351 E0                MOVX    A,@DPTR
0352 F9                MOV     R1,A
0353 A3                INC     DPTR
0354 E0                MOVX    A,@DPTR
0355 FA                MOV     R2,A
0356 A3                INC     DPTR
0357 E0                MOVX    A,@DPTR
0358 FB                MOV     R3,A
0359 D3                SETB    C
035A 120000      E     LCALL   ?C?SLCMP
035D 4012              JC      ?C0147
                                           ; SOURCE LINE # 916
035F 900000      E     MOV     DPTR,#normally_closed_mode
0362 E0                MOVX    A,@DPTR
0363 7004              JNZ     ?C0165
                                           ; SOURCE LINE # 917
0365 04                INC     A
0366 F0                MOVX    @DPTR,A
0367 8005              SJMP    ?C0166
0369         ?C0165:
                                           ; SOURCE LINE # 919
0369 E4                CLR     A
036A 900000      E     MOV     DPTR,#normally_closed_mode
036D F0                MOVX    @DPTR,A
036E         ?C0166:
                                           ; SOURCE LINE # 921
036E E4                CLR     A
036F F500        R     MOV     h_status,A
                                           ; SOURCE LINE # 922
                                           ; SOURCE LINE # 923
                                           ; SOURCE LINE # 924
                                           ; SOURCE LINE # 925
                                           ; SOURCE LINE # 926
0371         ?C0147:
                                           ; SOURCE LINE # 928
0371 E500        R     MOV     A,index
0373 14                DEC     A
0374 7003              JNZ     $ + 5H
0376 020000      R     LJMP    ?C0169
0379 14                DEC     A
037A 7003              JNZ     $ + 5H
037C 020000      R     LJMP    ?C0170
037F 2402              ADD     A,#02H
0381 6003              JZ      $ + 5H
0383 020000      R     LJMP    ?C0167
                                           ; SOURCE LINE # 929
0386         ?C0168:
                                           ; SOURCE LINE # 930
0386 E4                CLR     A
0387 7F12              MOV     R7,#012H
0389 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 91  

038A FD                MOV     R5,A
038B FC                MOV     R4,A
038C 900000      R     MOV     DPTR,#v_value
038F E0                MOVX    A,@DPTR
0390 F8                MOV     R0,A
0391 A3                INC     DPTR
0392 E0                MOVX    A,@DPTR
0393 F9                MOV     R1,A
0394 A3                INC     DPTR
0395 E0                MOVX    A,@DPTR
0396 FA                MOV     R2,A
0397 A3                INC     DPTR
0398 E0                MOVX    A,@DPTR
0399 FB                MOV     R3,A
039A 120000      E     LCALL   ?C?LMUL
039D C004              PUSH    AR4
039F C005              PUSH    AR5
03A1 C006              PUSH    AR6
03A3 C007              PUSH    AR7
03A5 E4                CLR     A
03A6 7F0B              MOV     R7,#0BH
03A8 FE                MOV     R6,A
03A9 FD                MOV     R5,A
03AA FC                MOV     R4,A
03AB 900000      R     MOV     DPTR,#value_encoder
03AE E0                MOVX    A,@DPTR
03AF F8                MOV     R0,A
03B0 A3                INC     DPTR
03B1 E0                MOVX    A,@DPTR
03B2 F9                MOV     R1,A
03B3 A3                INC     DPTR
03B4 E0                MOVX    A,@DPTR
03B5 FA                MOV     R2,A
03B6 A3                INC     DPTR
03B7 E0                MOVX    A,@DPTR
03B8 FB                MOV     R3,A
03B9 120000      E     LCALL   ?C?LMUL
03BC D003              POP     AR3
03BE D002              POP     AR2
03C0 D001              POP     AR1
03C2 D000              POP     AR0
03C4 C3                CLR     C
03C5 EF                MOV     A,R7
03C6 9B                SUBB    A,R3
03C7 FF                MOV     R7,A
03C8 EE                MOV     A,R6
03C9 9A                SUBB    A,R2
03CA FE                MOV     R6,A
03CB ED                MOV     A,R5
03CC 99                SUBB    A,R1
03CD FD                MOV     R5,A
03CE EC                MOV     A,R4
03CF 98                SUBB    A,R0
03D0 FC                MOV     R4,A
03D1 C004              PUSH    AR4
03D3 C005              PUSH    AR5
03D5 C006              PUSH    AR6
03D7 C007              PUSH    AR7
03D9 E4                CLR     A
03DA 7F09              MOV     R7,#09H
03DC FE                MOV     R6,A
03DD FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 92  

03DE FC                MOV     R4,A
03DF 900000      R     MOV     DPTR,#vv_value
03E2 E0                MOVX    A,@DPTR
03E3 F8                MOV     R0,A
03E4 A3                INC     DPTR
03E5 E0                MOVX    A,@DPTR
03E6 F9                MOV     R1,A
03E7 A3                INC     DPTR
03E8 E0                MOVX    A,@DPTR
03E9 FA                MOV     R2,A
03EA A3                INC     DPTR
03EB E0                MOVX    A,@DPTR
03EC FB                MOV     R3,A
03ED 120000      E     LCALL   ?C?LMUL
03F0 D003              POP     AR3
03F2 D002              POP     AR2
03F4 D001              POP     AR1
03F6 D000              POP     AR0
03F8 EF                MOV     A,R7
03F9 2B                ADD     A,R3
03FA FF                MOV     R7,A
03FB EE                MOV     A,R6
03FC 3A                ADDC    A,R2
03FD FE                MOV     R6,A
03FE ED                MOV     A,R5
03FF 39                ADDC    A,R1
0400 FD                MOV     R5,A
0401 EC                MOV     A,R4
0402 38                ADDC    A,R0
0403 FC                MOV     R4,A
0404 C004              PUSH    AR4
0406 C005              PUSH    AR5
0408 C006              PUSH    AR6
040A C007              PUSH    AR7
040C E4                CLR     A
040D 7F02              MOV     R7,#02H
040F FE                MOV     R6,A
0410 FD                MOV     R5,A
0411 FC                MOV     R4,A
0412 900000      R     MOV     DPTR,#vvv_value
0415 E0                MOVX    A,@DPTR
0416 F8                MOV     R0,A
0417 A3                INC     DPTR
0418 E0                MOVX    A,@DPTR
0419 F9                MOV     R1,A
041A A3                INC     DPTR
041B E0                MOVX    A,@DPTR
041C FA                MOV     R2,A
041D A3                INC     DPTR
041E E0                MOVX    A,@DPTR
041F FB                MOV     R3,A
0420 120000      E     LCALL   ?C?LMUL
0423 A804              MOV     R0,AR4
0425 A905              MOV     R1,AR5
0427 AA06              MOV     R2,AR6
0429 AB07              MOV     R3,AR7
042B D007              POP     AR7
042D D006              POP     AR6
042F D005              POP     AR5
0431 D004              POP     AR4
0433 C3                CLR     C
0434 EF                MOV     A,R7
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 93  

0435 9B                SUBB    A,R3
0436 FF                MOV     R7,A
0437 EE                MOV     A,R6
0438 9A                SUBB    A,R2
0439 FE                MOV     R6,A
043A ED                MOV     A,R5
043B 99                SUBB    A,R1
043C FD                MOV     R5,A
043D EC                MOV     A,R4
043E 98                SUBB    A,R0
043F FC                MOV     R4,A
0440 120000      E     LCALL   _filter_vel_1
0443 EE                MOV     A,R6
0444 33                RLC     A
0445 95E0              SUBB    A,ACC
0447 FD                MOV     R5,A
0448 FC                MOV     R4,A
0449 900000      R     MOV     DPTR,#speed_encoder
044C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 931
044F 020000      R     LJMP    ?C0167
                                           ; SOURCE LINE # 933
0452         ?C0169:
                                           ; SOURCE LINE # 934
0452 E4                CLR     A
0453 7F12              MOV     R7,#012H
0455 FE                MOV     R6,A
0456 FD                MOV     R5,A
0457 FC                MOV     R4,A
0458 900000      R     MOV     DPTR,#v_value+04H
045B E0                MOVX    A,@DPTR
045C F8                MOV     R0,A
045D A3                INC     DPTR
045E E0                MOVX    A,@DPTR
045F F9                MOV     R1,A
0460 A3                INC     DPTR
0461 E0                MOVX    A,@DPTR
0462 FA                MOV     R2,A
0463 A3                INC     DPTR
0464 E0                MOVX    A,@DPTR
0465 FB                MOV     R3,A
0466 120000      E     LCALL   ?C?LMUL
0469 C004              PUSH    AR4
046B C005              PUSH    AR5
046D C006              PUSH    AR6
046F C007              PUSH    AR7
0471 E4                CLR     A
0472 7F0B              MOV     R7,#0BH
0474 FE                MOV     R6,A
0475 FD                MOV     R5,A
0476 FC                MOV     R4,A
0477 900000      R     MOV     DPTR,#value_encoder
047A E0                MOVX    A,@DPTR
047B F8                MOV     R0,A
047C A3                INC     DPTR
047D E0                MOVX    A,@DPTR
047E F9                MOV     R1,A
047F A3                INC     DPTR
0480 E0                MOVX    A,@DPTR
0481 FA                MOV     R2,A
0482 A3                INC     DPTR
0483 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 94  

0484 FB                MOV     R3,A
0485 120000      E     LCALL   ?C?LMUL
0488 D003              POP     AR3
048A D002              POP     AR2
048C D001              POP     AR1
048E D000              POP     AR0
0490 C3                CLR     C
0491 EF                MOV     A,R7
0492 9B                SUBB    A,R3
0493 FF                MOV     R7,A
0494 EE                MOV     A,R6
0495 9A                SUBB    A,R2
0496 FE                MOV     R6,A
0497 ED                MOV     A,R5
0498 99                SUBB    A,R1
0499 FD                MOV     R5,A
049A EC                MOV     A,R4
049B 98                SUBB    A,R0
049C FC                MOV     R4,A
049D C004              PUSH    AR4
049F C005              PUSH    AR5
04A1 C006              PUSH    AR6
04A3 C007              PUSH    AR7
04A5 E4                CLR     A
04A6 7F09              MOV     R7,#09H
04A8 FE                MOV     R6,A
04A9 FD                MOV     R5,A
04AA FC                MOV     R4,A
04AB 900000      R     MOV     DPTR,#vv_value+04H
04AE E0                MOVX    A,@DPTR
04AF F8                MOV     R0,A
04B0 A3                INC     DPTR
04B1 E0                MOVX    A,@DPTR
04B2 F9                MOV     R1,A
04B3 A3                INC     DPTR
04B4 E0                MOVX    A,@DPTR
04B5 FA                MOV     R2,A
04B6 A3                INC     DPTR
04B7 E0                MOVX    A,@DPTR
04B8 FB                MOV     R3,A
04B9 120000      E     LCALL   ?C?LMUL
04BC D003              POP     AR3
04BE D002              POP     AR2
04C0 D001              POP     AR1
04C2 D000              POP     AR0
04C4 EF                MOV     A,R7
04C5 2B                ADD     A,R3
04C6 FF                MOV     R7,A
04C7 EE                MOV     A,R6
04C8 3A                ADDC    A,R2
04C9 FE                MOV     R6,A
04CA ED                MOV     A,R5
04CB 39                ADDC    A,R1
04CC FD                MOV     R5,A
04CD EC                MOV     A,R4
04CE 38                ADDC    A,R0
04CF FC                MOV     R4,A
04D0 C004              PUSH    AR4
04D2 C005              PUSH    AR5
04D4 C006              PUSH    AR6
04D6 C007              PUSH    AR7
04D8 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 95  

04D9 7F02              MOV     R7,#02H
04DB FE                MOV     R6,A
04DC FD                MOV     R5,A
04DD FC                MOV     R4,A
04DE 900000      R     MOV     DPTR,#vvv_value+04H
04E1 E0                MOVX    A,@DPTR
04E2 F8                MOV     R0,A
04E3 A3                INC     DPTR
04E4 E0                MOVX    A,@DPTR
04E5 F9                MOV     R1,A
04E6 A3                INC     DPTR
04E7 E0                MOVX    A,@DPTR
04E8 FA                MOV     R2,A
04E9 A3                INC     DPTR
04EA E0                MOVX    A,@DPTR
04EB FB                MOV     R3,A
04EC 120000      E     LCALL   ?C?LMUL
04EF A804              MOV     R0,AR4
04F1 A905              MOV     R1,AR5
04F3 AA06              MOV     R2,AR6
04F5 AB07              MOV     R3,AR7
04F7 D007              POP     AR7
04F9 D006              POP     AR6
04FB D005              POP     AR5
04FD D004              POP     AR4
04FF C3                CLR     C
0500 EF                MOV     A,R7
0501 9B                SUBB    A,R3
0502 FF                MOV     R7,A
0503 EE                MOV     A,R6
0504 9A                SUBB    A,R2
0505 FE                MOV     R6,A
0506 ED                MOV     A,R5
0507 99                SUBB    A,R1
0508 FD                MOV     R5,A
0509 EC                MOV     A,R4
050A 98                SUBB    A,R0
050B FC                MOV     R4,A
050C 120000      E     LCALL   _filter_vel_2
050F EE                MOV     A,R6
0510 33                RLC     A
0511 95E0              SUBB    A,ACC
0513 FD                MOV     R5,A
0514 FC                MOV     R4,A
0515 900000      R     MOV     DPTR,#speed_encoder
0518 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 935
051B 020000      R     LJMP    ?C0167
                                           ; SOURCE LINE # 937
051E         ?C0170:
                                           ; SOURCE LINE # 938
051E E4                CLR     A
051F 7F12              MOV     R7,#012H
0521 FE                MOV     R6,A
0522 FD                MOV     R5,A
0523 FC                MOV     R4,A
0524 900000      R     MOV     DPTR,#v_value+08H
0527 E0                MOVX    A,@DPTR
0528 F8                MOV     R0,A
0529 A3                INC     DPTR
052A E0                MOVX    A,@DPTR
052B F9                MOV     R1,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 96  

052C A3                INC     DPTR
052D E0                MOVX    A,@DPTR
052E FA                MOV     R2,A
052F A3                INC     DPTR
0530 E0                MOVX    A,@DPTR
0531 FB                MOV     R3,A
0532 120000      E     LCALL   ?C?LMUL
0535 C004              PUSH    AR4
0537 C005              PUSH    AR5
0539 C006              PUSH    AR6
053B C007              PUSH    AR7
053D E4                CLR     A
053E 7F0B              MOV     R7,#0BH
0540 FE                MOV     R6,A
0541 FD                MOV     R5,A
0542 FC                MOV     R4,A
0543 900000      R     MOV     DPTR,#value_encoder
0546 E0                MOVX    A,@DPTR
0547 F8                MOV     R0,A
0548 A3                INC     DPTR
0549 E0                MOVX    A,@DPTR
054A F9                MOV     R1,A
054B A3                INC     DPTR
054C E0                MOVX    A,@DPTR
054D FA                MOV     R2,A
054E A3                INC     DPTR
054F E0                MOVX    A,@DPTR
0550 FB                MOV     R3,A
0551 120000      E     LCALL   ?C?LMUL
0554 D003              POP     AR3
0556 D002              POP     AR2
0558 D001              POP     AR1
055A D000              POP     AR0
055C C3                CLR     C
055D EF                MOV     A,R7
055E 9B                SUBB    A,R3
055F FF                MOV     R7,A
0560 EE                MOV     A,R6
0561 9A                SUBB    A,R2
0562 FE                MOV     R6,A
0563 ED                MOV     A,R5
0564 99                SUBB    A,R1
0565 FD                MOV     R5,A
0566 EC                MOV     A,R4
0567 98                SUBB    A,R0
0568 FC                MOV     R4,A
0569 C004              PUSH    AR4
056B C005              PUSH    AR5
056D C006              PUSH    AR6
056F C007              PUSH    AR7
0571 E4                CLR     A
0572 7F09              MOV     R7,#09H
0574 FE                MOV     R6,A
0575 FD                MOV     R5,A
0576 FC                MOV     R4,A
0577 900000      R     MOV     DPTR,#vv_value+08H
057A E0                MOVX    A,@DPTR
057B F8                MOV     R0,A
057C A3                INC     DPTR
057D E0                MOVX    A,@DPTR
057E F9                MOV     R1,A
057F A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 97  

0580 E0                MOVX    A,@DPTR
0581 FA                MOV     R2,A
0582 A3                INC     DPTR
0583 E0                MOVX    A,@DPTR
0584 FB                MOV     R3,A
0585 120000      E     LCALL   ?C?LMUL
0588 D003              POP     AR3
058A D002              POP     AR2
058C D001              POP     AR1
058E D000              POP     AR0
0590 EF                MOV     A,R7
0591 2B                ADD     A,R3
0592 FF                MOV     R7,A
0593 EE                MOV     A,R6
0594 3A                ADDC    A,R2
0595 FE                MOV     R6,A
0596 ED                MOV     A,R5
0597 39                ADDC    A,R1
0598 FD                MOV     R5,A
0599 EC                MOV     A,R4
059A 38                ADDC    A,R0
059B FC                MOV     R4,A
059C C004              PUSH    AR4
059E C005              PUSH    AR5
05A0 C006              PUSH    AR6
05A2 C007              PUSH    AR7
05A4 E4                CLR     A
05A5 7F02              MOV     R7,#02H
05A7 FE                MOV     R6,A
05A8 FD                MOV     R5,A
05A9 FC                MOV     R4,A
05AA 900000      R     MOV     DPTR,#vvv_value+08H
05AD E0                MOVX    A,@DPTR
05AE F8                MOV     R0,A
05AF A3                INC     DPTR
05B0 E0                MOVX    A,@DPTR
05B1 F9                MOV     R1,A
05B2 A3                INC     DPTR
05B3 E0                MOVX    A,@DPTR
05B4 FA                MOV     R2,A
05B5 A3                INC     DPTR
05B6 E0                MOVX    A,@DPTR
05B7 FB                MOV     R3,A
05B8 120000      E     LCALL   ?C?LMUL
05BB A804              MOV     R0,AR4
05BD A905              MOV     R1,AR5
05BF AA06              MOV     R2,AR6
05C1 AB07              MOV     R3,AR7
05C3 D007              POP     AR7
05C5 D006              POP     AR6
05C7 D005              POP     AR5
05C9 D004              POP     AR4
05CB C3                CLR     C
05CC EF                MOV     A,R7
05CD 9B                SUBB    A,R3
05CE FF                MOV     R7,A
05CF EE                MOV     A,R6
05D0 9A                SUBB    A,R2
05D1 FE                MOV     R6,A
05D2 ED                MOV     A,R5
05D3 99                SUBB    A,R1
05D4 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 98  

05D5 EC                MOV     A,R4
05D6 98                SUBB    A,R0
05D7 FC                MOV     R4,A
05D8 120000      E     LCALL   _filter_vel_3
05DB EE                MOV     A,R6
05DC 33                RLC     A
05DD 95E0              SUBB    A,ACC
05DF FD                MOV     R5,A
05E0 FC                MOV     R4,A
05E1 900000      R     MOV     DPTR,#speed_encoder
05E4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 939
                                           ; SOURCE LINE # 940
05E7         ?C0167:
                                           ; SOURCE LINE # 942
05E7 E4                CLR     A
05E8 FF                MOV     R7,A
05E9 FE                MOV     R6,A
05EA 7DC0              MOV     R5,#0C0H
05EC 7C40              MOV     R4,#040H
05EE 900000      E     MOV     DPTR,#cycle_time
05F1 E0                MOVX    A,@DPTR
05F2 F8                MOV     R0,A
05F3 A3                INC     DPTR
05F4 E0                MOVX    A,@DPTR
05F5 F9                MOV     R1,A
05F6 A3                INC     DPTR
05F7 E0                MOVX    A,@DPTR
05F8 FA                MOV     R2,A
05F9 A3                INC     DPTR
05FA E0                MOVX    A,@DPTR
05FB FB                MOV     R3,A
05FC 120000      E     LCALL   ?C?FPMUL
05FF C004              PUSH    AR4
0601 C005              PUSH    AR5
0603 C006              PUSH    AR6
0605 C007              PUSH    AR7
0607 900000      R     MOV     DPTR,#speed_encoder
060A E0                MOVX    A,@DPTR
060B FC                MOV     R4,A
060C A3                INC     DPTR
060D E0                MOVX    A,@DPTR
060E FD                MOV     R5,A
060F A3                INC     DPTR
0610 E0                MOVX    A,@DPTR
0611 FE                MOV     R6,A
0612 A3                INC     DPTR
0613 E0                MOVX    A,@DPTR
0614 FF                MOV     R7,A
0615 EC                MOV     A,R4
0616 120000      E     LCALL   ?C?FCASTL
0619 D003              POP     AR3
061B D002              POP     AR2
061D D001              POP     AR1
061F D000              POP     AR0
0621 120000      E     LCALL   ?C?FPDIV
0624 120000      E     LCALL   ?C?CASTF
0627 900000      R     MOV     DPTR,#speed_encoder
062A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 943
062D 900000      R     MOV     DPTR,#speed_encoder
0630 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 99  

0631 FC                MOV     R4,A
0632 A3                INC     DPTR
0633 E0                MOVX    A,@DPTR
0634 FD                MOV     R5,A
0635 A3                INC     DPTR
0636 E0                MOVX    A,@DPTR
0637 FE                MOV     R6,A
0638 A3                INC     DPTR
0639 E0                MOVX    A,@DPTR
063A FF                MOV     R7,A
063B E500        R     MOV     A,index
063D 25E0              ADD     A,ACC
063F 25E0              ADD     A,ACC
0641 2400        E     ADD     A,#LOW g_meas+01FH
0643 F582              MOV     DPL,A
0645 E4                CLR     A
0646 3400        E     ADDC    A,#HIGH g_meas+01FH
0648 F583              MOV     DPH,A
064A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 965
064D E500        R     MOV     A,index
064F 25E0              ADD     A,ACC
0651 25E0              ADD     A,ACC
0653 2400        R     ADD     A,#LOW vv_value
0655 F582              MOV     DPL,A
0657 E4                CLR     A
0658 3400        R     ADDC    A,#HIGH vv_value
065A F583              MOV     DPH,A
065C E0                MOVX    A,@DPTR
065D FC                MOV     R4,A
065E A3                INC     DPTR
065F E0                MOVX    A,@DPTR
0660 FD                MOV     R5,A
0661 A3                INC     DPTR
0662 E0                MOVX    A,@DPTR
0663 FE                MOV     R6,A
0664 A3                INC     DPTR
0665 E0                MOVX    A,@DPTR
0666 FF                MOV     R7,A
0667 E500        R     MOV     A,index
0669 25E0              ADD     A,ACC
066B 25E0              ADD     A,ACC
066D 2400        R     ADD     A,#LOW vvv_value
066F F582              MOV     DPL,A
0671 E4                CLR     A
0672 3400        R     ADDC    A,#HIGH vvv_value
0674 F583              MOV     DPH,A
0676 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 966
0679 E500        R     MOV     A,index
067B 25E0              ADD     A,ACC
067D 25E0              ADD     A,ACC
067F 2400        R     ADD     A,#LOW v_value
0681 F582              MOV     DPL,A
0683 E4                CLR     A
0684 3400        R     ADDC    A,#HIGH v_value
0686 F583              MOV     DPH,A
0688 E0                MOVX    A,@DPTR
0689 FC                MOV     R4,A
068A A3                INC     DPTR
068B E0                MOVX    A,@DPTR
068C FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 100 

068D A3                INC     DPTR
068E E0                MOVX    A,@DPTR
068F FE                MOV     R6,A
0690 A3                INC     DPTR
0691 E0                MOVX    A,@DPTR
0692 FF                MOV     R7,A
0693 E500        R     MOV     A,index
0695 25E0              ADD     A,ACC
0697 25E0              ADD     A,ACC
0699 2400        R     ADD     A,#LOW vv_value
069B F582              MOV     DPL,A
069D E4                CLR     A
069E 3400        R     ADDC    A,#HIGH vv_value
06A0 F583              MOV     DPH,A
06A2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 967
06A5 900000      R     MOV     DPTR,#value_encoder
06A8 E0                MOVX    A,@DPTR
06A9 FC                MOV     R4,A
06AA A3                INC     DPTR
06AB E0                MOVX    A,@DPTR
06AC FD                MOV     R5,A
06AD A3                INC     DPTR
06AE E0                MOVX    A,@DPTR
06AF FE                MOV     R6,A
06B0 A3                INC     DPTR
06B1 E0                MOVX    A,@DPTR
06B2 FF                MOV     R7,A
06B3 E500        R     MOV     A,index
06B5 25E0              ADD     A,ACC
06B7 25E0              ADD     A,ACC
06B9 2400        R     ADD     A,#LOW v_value
06BB F582              MOV     DPL,A
06BD E4                CLR     A
06BE 3400        R     ADDC    A,#HIGH v_value
06C0 F583              MOV     DPH,A
06C2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 977
06C5 300003      R     JNB     pos_reconstruct,$ + 6H
06C8 020000      R     LJMP    ?C0139
                                           ; SOURCE LINE # 978
06CB 900000      R     MOV     DPTR,#one_time_execute
06CE E0                MOVX    A,@DPTR
06CF C3                CLR     C
06D0 9422              SUBB    A,#022H
06D2 5004              JNC     ?C0172
                                           ; SOURCE LINE # 979
06D4 E0                MOVX    A,@DPTR
06D5 04                INC     A
06D6 F0                MOVX    @DPTR,A
06D7 22                RET     
06D8         ?C0172:
                                           ; SOURCE LINE # 980
                                           ; SOURCE LINE # 982
06D8 900000      E     MOV     DPTR,#c_mem+079H
06DB E0                MOVX    A,@DPTR
06DC 602A              JZ      ?C0174
                                           ; SOURCE LINE # 983
06DE 900000      E     MOV     DPTR,#g_meas+04H
06E1 E0                MOVX    A,@DPTR
06E2 FC                MOV     R4,A
06E3 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 101 

06E4 E0                MOVX    A,@DPTR
06E5 FD                MOV     R5,A
06E6 A3                INC     DPTR
06E7 E0                MOVX    A,@DPTR
06E8 FE                MOV     R6,A
06E9 A3                INC     DPTR
06EA E0                MOVX    A,@DPTR
06EB FF                MOV     R7,A
06EC 900000      E     MOV     DPTR,#?_calc_turns_fcn?BYTE+04H
06EF 120000      E     LCALL   ?C?LSTXDATA
06F2 900000      E     MOV     DPTR,#g_meas
06F5 E0                MOVX    A,@DPTR
06F6 FC                MOV     R4,A
06F7 A3                INC     DPTR
06F8 E0                MOVX    A,@DPTR
06F9 FD                MOV     R5,A
06FA A3                INC     DPTR
06FB E0                MOVX    A,@DPTR
06FC FE                MOV     R6,A
06FD A3                INC     DPTR
06FE E0                MOVX    A,@DPTR
06FF FF                MOV     R7,A
0700 120000      E     LCALL   _calc_turns_fcn
0703 900000      E     MOV     DPTR,#g_meas+014H
0706 EF                MOV     A,R7
0707 F0                MOVX    @DPTR,A
0708         ?C0174:
                                           ; SOURCE LINE # 985
0708 900000      E     MOV     DPTR,#g_meas
070B E0                MOVX    A,@DPTR
070C F8                MOV     R0,A
070D A3                INC     DPTR
070E E0                MOVX    A,@DPTR
070F F9                MOV     R1,A
0710 A3                INC     DPTR
0711 E0                MOVX    A,@DPTR
0712 FA                MOV     R2,A
0713 A3                INC     DPTR
0714 E0                MOVX    A,@DPTR
0715 FB                MOV     R3,A
0716 C000              PUSH    AR0
0718 900000      E     MOV     DPTR,#g_meas+014H
071B E0                MOVX    A,@DPTR
071C FF                MOV     R7,A
071D 33                RLC     A
071E 95E0              SUBB    A,ACC
0720 FE                MOV     R6,A
0721 FD                MOV     R5,A
0722 FC                MOV     R4,A
0723 7810              MOV     R0,#010H
0725 120000      E     LCALL   ?C?LSHL
0728 D000              POP     AR0
072A EB                MOV     A,R3
072B 2F                ADD     A,R7
072C FF                MOV     R7,A
072D EA                MOV     A,R2
072E 3E                ADDC    A,R6
072F FE                MOV     R6,A
0730 E9                MOV     A,R1
0731 3D                ADDC    A,R5
0732 FD                MOV     R5,A
0733 E8                MOV     A,R0
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 102 

0734 3C                ADDC    A,R4
0735 FC                MOV     R4,A
0736 900000      E     MOV     DPTR,#g_meas
0739 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 988
073C 900000      E     MOV     DPTR,#g_meas
073F E0                MOVX    A,@DPTR
0740 FC                MOV     R4,A
0741 A3                INC     DPTR
0742 E0                MOVX    A,@DPTR
0743 FD                MOV     R5,A
0744 A3                INC     DPTR
0745 E0                MOVX    A,@DPTR
0746 FE                MOV     R6,A
0747 A3                INC     DPTR
0748 E0                MOVX    A,@DPTR
0749 FF                MOV     R7,A
074A 900000      E     MOV     DPTR,#g_refNew
074D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 990
0750 900000      E     MOV     DPTR,#g_ref+018H
0753 E0                MOVX    A,@DPTR
0754 FF                MOV     R7,A
0755 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 992
0758 D200        R     SETB    pos_reconstruct
                                           ; SOURCE LINE # 993
                                           ; SOURCE LINE # 994
                                           ; SOURCE LINE # 995
075A         ?C0139:
075A 22                RET     
             ; FUNCTION _encoder_reading (END)

             ; FUNCTION analog_read_end (BEGIN)
                                           ; SOURCE LINE # 1001
0000         ?C0175:
                                           ; SOURCE LINE # 1031
0000 120000      E     LCALL   ADC_STATUS_Read
0003 EF                MOV     A,R7
0004 700A              JNZ     ?C0176
                                           ; SOURCE LINE # 1032
0006 3000F7            JNB     interrupt_flag,?C0175
                                           ; SOURCE LINE # 1033
0009 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1034
000B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1035
                                           ; SOURCE LINE # 1036
000E 80F0              SJMP    ?C0175
0010         ?C0176:
                                           ; SOURCE LINE # 1039
0010 900000      E     MOV     DPTR,#ADC_buf+01H
0013 E0                MOVX    A,@DPTR
0014 249A              ADD     A,#09AH
0016 FF                MOV     R7,A
0017 900000      E     MOV     DPTR,#ADC_buf
001A E0                MOVX    A,@DPTR
001B 34F9              ADDC    A,#0F9H
001D FE                MOV     R6,A
001E 33                RLC     A
001F 95E0              SUBB    A,ACC
0021 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 103 

0022 FC                MOV     R4,A
0023 E4                CLR     A
0024 7BA0              MOV     R3,#0A0H
0026 7A07              MOV     R2,#07H
0028 F9                MOV     R1,A
0029 F8                MOV     R0,A
002A 120000      E     LCALL   ?C?LMUL
002D 7807              MOV     R0,#07H
002F 120000      E     LCALL   ?C?SLSHR
0032 900000      E     MOV     DPTR,#dev_tension
0035 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1041
0038 300005            JNB     interrupt_flag,?C0178
                                           ; SOURCE LINE # 1042
003B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1043
003D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1044
0040         ?C0178:
                                           ; SOURCE LINE # 1048
0040 E4                CLR     A
0041 FF                MOV     R7,A
0042 FE                MOV     R6,A
0043 FD                MOV     R5,A
0044 FC                MOV     R4,A
0045 900000      E     MOV     DPTR,#dev_tension
0048 E0                MOVX    A,@DPTR
0049 F8                MOV     R0,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C F9                MOV     R1,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F FA                MOV     R2,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 FB                MOV     R3,A
0053 D3                SETB    C
0054 120000      E     LCALL   ?C?SLCMP
0057 5003              JNC     $ + 5H
0059 020000      R     LJMP    ?C0179
                                           ; SOURCE LINE # 1051
005C D200        E     SETB    tension_valid
                                           ; SOURCE LINE # 1053
005E 900000      E     MOV     DPTR,#g_mem+07BH
0061 E0                MOVX    A,@DPTR
0062 6003              JZ      ?C0180
                                           ; SOURCE LINE # 1054
0064 120000      R     LCALL   pwm_limit_search
0067         ?C0180:
                                           ; SOURCE LINE # 1057
0067 900000      E     MOV     DPTR,#ADC_buf+03H
006A E0                MOVX    A,@DPTR
006B 249A              ADD     A,#09AH
006D FF                MOV     R7,A
006E 900000      E     MOV     DPTR,#ADC_buf+02H
0071 E0                MOVX    A,@DPTR
0072 34F9              ADDC    A,#0F9H
0074 FE                MOV     R6,A
0075 33                RLC     A
0076 95E0              SUBB    A,ACC
0078 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 104 

0079 FC                MOV     R4,A
007A E4                CLR     A
007B 7BAB              MOV     R3,#0ABH
007D 7A64              MOV     R2,#064H
007F F9                MOV     R1,A
0080 F8                MOV     R0,A
0081 120000      E     LCALL   ?C?LMUL
0084 780D              MOV     R0,#0DH
0086 120000      E     LCALL   ?C?SLSHR
0089 900000      E     MOV     DPTR,#pwm_sign
008C E0                MOVX    A,@DPTR
008D FD                MOV     R5,A
008E 33                RLC     A
008F 95E0              SUBB    A,ACC
0091 FC                MOV     R4,A
0092 120000      E     LCALL   ?C?IMUL
0095 EE                MOV     A,R6
0096 33                RLC     A
0097 95E0              SUBB    A,ACC
0099 FD                MOV     R5,A
009A FC                MOV     R4,A
009B 120000      E     LCALL   _filter_i1
009E 900000      E     MOV     DPTR,#g_meas+0CH
00A1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1060
00A4 900000      E     MOV     DPTR,#g_meas
00A7 E0                MOVX    A,@DPTR
00A8 FC                MOV     R4,A
00A9 A3                INC     DPTR
00AA E0                MOVX    A,@DPTR
00AB FD                MOV     R5,A
00AC A3                INC     DPTR
00AD E0                MOVX    A,@DPTR
00AE FE                MOV     R6,A
00AF A3                INC     DPTR
00B0 E0                MOVX    A,@DPTR
00B1 FF                MOV     R7,A
00B2 900000      E     MOV     DPTR,#g_mem+035H
00B5 E0                MOVX    A,@DPTR
00B6 F9                MOV     R1,A
00B7 F8                MOV     R0,A
00B8 120000      E     LCALL   ?C?SLSHR
00BB C004              PUSH    AR4
00BD C005              PUSH    AR5
00BF C006              PUSH    AR6
00C1 C007              PUSH    AR7
00C3 900000      E     MOV     DPTR,#g_meas+01FH
00C6 E0                MOVX    A,@DPTR
00C7 FC                MOV     R4,A
00C8 A3                INC     DPTR
00C9 E0                MOVX    A,@DPTR
00CA FD                MOV     R5,A
00CB A3                INC     DPTR
00CC E0                MOVX    A,@DPTR
00CD FE                MOV     R6,A
00CE A3                INC     DPTR
00CF E0                MOVX    A,@DPTR
00D0 FF                MOV     R7,A
00D1 900000      E     MOV     DPTR,#g_mem+035H
00D4 E0                MOVX    A,@DPTR
00D5 F8                MOV     R0,A
00D6 120000      E     LCALL   ?C?SLSHR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 105 

00D9 900000      E     MOV     DPTR,#?_curr_estim?BYTE+04H
00DC 120000      E     LCALL   ?C?LSTXDATA
00DF 900000      E     MOV     DPTR,#g_ref
00E2 E0                MOVX    A,@DPTR
00E3 FC                MOV     R4,A
00E4 A3                INC     DPTR
00E5 E0                MOVX    A,@DPTR
00E6 FD                MOV     R5,A
00E7 A3                INC     DPTR
00E8 E0                MOVX    A,@DPTR
00E9 FE                MOV     R6,A
00EA A3                INC     DPTR
00EB E0                MOVX    A,@DPTR
00EC FF                MOV     R7,A
00ED A801              MOV     R0,AR1
00EF 120000      E     LCALL   ?C?SLSHR
00F2 900000      E     MOV     DPTR,#?_curr_estim?BYTE+08H
00F5 120000      E     LCALL   ?C?LSTXDATA
00F8 D007              POP     AR7
00FA D006              POP     AR6
00FC D005              POP     AR5
00FE D004              POP     AR4
0100 120000      E     LCALL   _curr_estim
0103 A804              MOV     R0,AR4
0105 A905              MOV     R1,AR5
0107 AA06              MOV     R2,AR6
0109 AB07              MOV     R3,AR7
010B 900000      E     MOV     DPTR,#g_meas+0CH
010E E0                MOVX    A,@DPTR
010F FC                MOV     R4,A
0110 A3                INC     DPTR
0111 E0                MOVX    A,@DPTR
0112 FD                MOV     R5,A
0113 A3                INC     DPTR
0114 E0                MOVX    A,@DPTR
0115 FE                MOV     R6,A
0116 A3                INC     DPTR
0117 E0                MOVX    A,@DPTR
0118 C3                CLR     C
0119 9B                SUBB    A,R3
011A FF                MOV     R7,A
011B EE                MOV     A,R6
011C 9A                SUBB    A,R2
011D FE                MOV     R6,A
011E ED                MOV     A,R5
011F 99                SUBB    A,R1
0120 FD                MOV     R5,A
0121 EC                MOV     A,R4
0122 98                SUBB    A,R0
0123 FC                MOV     R4,A
0124 120000      E     LCALL   _filter_curr_diff
0127 EE                MOV     A,R6
0128 33                RLC     A
0129 95E0              SUBB    A,ACC
012B FD                MOV     R5,A
012C FC                MOV     R4,A
012D 900000      E     MOV     DPTR,#g_meas+010H
0130 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1064
0133 300005            JNB     interrupt_flag,?C0181
                                           ; SOURCE LINE # 1065
0136 C200        E     CLR     interrupt_flag
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 106 

                                           ; SOURCE LINE # 1066
0138 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1067
013B         ?C0181:
                                           ; SOURCE LINE # 1070
013B 900000      E     MOV     DPTR,#g_mem+06FH
013E E0                MOVX    A,@DPTR
013F 7004              JNZ     ?C0182
                                           ; SOURCE LINE # 1071
0141 F500        R     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1072
0143 F500        R     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1073
0145         ?C0182:
                                           ; SOURCE LINE # 1078
0145 E500        R     MOV     A,emg_1_status
0147 14                DEC     A
0148 7003              JNZ     $ + 5H
014A 020000      R     LJMP    ?C0190
014D 14                DEC     A
014E 7003              JNZ     $ + 5H
0150 020000      R     LJMP    ?C0191
0153 14                DEC     A
0154 7003              JNZ     $ + 5H
0156 020000      R     LJMP    ?C0194
0159 2403              ADD     A,#03H
015B 6003              JZ      $ + 5H
015D 020000      R     LJMP    ?C0183
                                           ; SOURCE LINE # 1079
0160         ?C0184:
                                           ; SOURCE LINE # 1080
0160 900000      E     MOV     DPTR,#ADC_buf+04H
0163 E0                MOVX    A,@DPTR
0164 FE                MOV     R6,A
0165 A3                INC     DPTR
0166 E0                MOVX    A,@DPTR
0167 FF                MOV     R7,A
0168 EE                MOV     A,R6
0169 33                RLC     A
016A 95E0              SUBB    A,ACC
016C FD                MOV     R5,A
016D FC                MOV     R4,A
016E 120000      E     LCALL   _filter_ch1
0171 8F00        R     MOV     i_aux+03H,R7
0173 8E00        R     MOV     i_aux+02H,R6
0175 8D00        R     MOV     i_aux+01H,R5
0177 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1081
0179 780A              MOV     R0,#0AH
017B 120000      E     LCALL   ?C?LSHL
017E 900000      E     MOV     DPTR,#g_mem+070H
0181 E0                MOVX    A,@DPTR
0182 F8                MOV     R0,A
0183 A3                INC     DPTR
0184 E0                MOVX    A,@DPTR
0185 F9                MOV     R1,A
0186 A3                INC     DPTR
0187 E0                MOVX    A,@DPTR
0188 FA                MOV     R2,A
0189 A3                INC     DPTR
018A E0                MOVX    A,@DPTR
018B FB                MOV     R3,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 107 

018C 120000      E     LCALL   ?C?ULDIV
018F 8F00        R     MOV     i_aux+03H,R7
0191 8E00        R     MOV     i_aux+02H,R6
0193 8D00        R     MOV     i_aux+01H,R5
0195 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1083
0197 300005            JNB     interrupt_flag,?C0185
                                           ; SOURCE LINE # 1084
019A C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1085
019C 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1086
019F         ?C0185:
                                           ; SOURCE LINE # 1088
019F E4                CLR     A
01A0 FF                MOV     R7,A
01A1 FE                MOV     R6,A
01A2 FD                MOV     R5,A
01A3 FC                MOV     R4,A
01A4 AB00        R     MOV     R3,i_aux+03H
01A6 AA00        R     MOV     R2,i_aux+02H
01A8 A900        R     MOV     R1,i_aux+01H
01AA A800        R     MOV     R0,i_aux
01AC C3                CLR     C
01AD 120000      E     LCALL   ?C?SLCMP
01B0 500B              JNC     ?C0186
                                           ; SOURCE LINE # 1089
01B2 E4                CLR     A
01B3 F500        R     MOV     i_aux+03H,A
01B5 F500        R     MOV     i_aux+02H,A
01B7 F500        R     MOV     i_aux+01H,A
01B9 F500        R     MOV     i_aux,A
01BB 801E              SJMP    ?C0187
01BD         ?C0186:
                                           ; SOURCE LINE # 1091
01BD E4                CLR     A
01BE FF                MOV     R7,A
01BF 7E04              MOV     R6,#04H
01C1 FD                MOV     R5,A
01C2 FC                MOV     R4,A
01C3 AB00        R     MOV     R3,i_aux+03H
01C5 AA00        R     MOV     R2,i_aux+02H
01C7 A900        R     MOV     R1,i_aux+01H
01C9 A800        R     MOV     R0,i_aux
01CB D3                SETB    C
01CC 120000      E     LCALL   ?C?SLCMP
01CF 400A              JC      ?C0187
                                           ; SOURCE LINE # 1092
01D1 E4                CLR     A
01D2 F500        R     MOV     i_aux+03H,A
01D4 750004      R     MOV     i_aux+02H,#04H
01D7 F500        R     MOV     i_aux+01H,A
01D9 F500        R     MOV     i_aux,A
01DB         ?C0187:
                                           ; SOURCE LINE # 1094
01DB AF00        R     MOV     R7,i_aux+03H
01DD AE00        R     MOV     R6,i_aux+02H
01DF AD00        R     MOV     R5,i_aux+01H
01E1 AC00        R     MOV     R4,i_aux
01E3 900000      E     MOV     DPTR,#g_meas+017H
01E6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1096
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 108 

01E9 200003      E     JB      interrupt_flag,$ + 6H
01EC 020000      R     LJMP    ?C0183
                                           ; SOURCE LINE # 1097
01EF C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1098
01F1 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1099
                                           ; SOURCE LINE # 1101
01F4 020000      R     LJMP    ?C0183
                                           ; SOURCE LINE # 1103
01F7         ?C0190:
                                           ; SOURCE LINE # 1104
01F7 E4                CLR     A
01F8 900000      R     MOV     DPTR,#emg_counter_1
01FB F0                MOVX    @DPTR,A
01FC A3                INC     DPTR
01FD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1105
01FE FF                MOV     R7,A
01FF FE                MOV     R6,A
0200 FD                MOV     R5,A
0201 FC                MOV     R4,A
0202 900000      E     MOV     DPTR,#g_mem+070H
0205 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1106
0208 750002      R     MOV     emg_1_status,#02H
                                           ; SOURCE LINE # 1108
020B 020000      R     LJMP    ?C0183
                                           ; SOURCE LINE # 1110
020E         ?C0191:
                                           ; SOURCE LINE # 1111
020E 900000      R     MOV     DPTR,#emg_counter_1+01H
0211 E0                MOVX    A,@DPTR
0212 04                INC     A
0213 F0                MOVX    @DPTR,A
0214 7006              JNZ     ?C0244
0216 900000      R     MOV     DPTR,#emg_counter_1
0219 E0                MOVX    A,@DPTR
021A 04                INC     A
021B F0                MOVX    @DPTR,A
021C         ?C0244:
                                           ; SOURCE LINE # 1112
021C 900000      R     MOV     DPTR,#emg_counter_1
021F E0                MOVX    A,@DPTR
0220 6401              XRL     A,#01H
0222 7004              JNZ     ?C0245
0224 A3                INC     DPTR
0225 E0                MOVX    A,@DPTR
0226 64F4              XRL     A,#0F4H
0228         ?C0245:
0228 6003              JZ      $ + 5H
022A 020000      R     LJMP    ?C0183
                                           ; SOURCE LINE # 1113
022D 900000      R     MOV     DPTR,#emg_counter_1
0230 F0                MOVX    @DPTR,A
0231 A3                INC     DPTR
0232 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1114
0233 7F01              MOV     R7,#01H
0235 120000      E     LCALL   _LED_REG_Write
                                           ; SOURCE LINE # 1116
0238 300005            JNB     interrupt_flag,?C0193
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 109 

                                           ; SOURCE LINE # 1117
023B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1118
023D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1119
0240         ?C0193:
                                           ; SOURCE LINE # 1121
0240 750003      R     MOV     emg_1_status,#03H
                                           ; SOURCE LINE # 1122
                                           ; SOURCE LINE # 1123
0243 020000      R     LJMP    ?C0183
                                           ; SOURCE LINE # 1125
0246         ?C0194:
                                           ; SOURCE LINE # 1127
0246 900000      R     MOV     DPTR,#emg_counter_1+01H
0249 E0                MOVX    A,@DPTR
024A 04                INC     A
024B F0                MOVX    @DPTR,A
024C 7006              JNZ     ?C0246
024E 900000      R     MOV     DPTR,#emg_counter_1
0251 E0                MOVX    A,@DPTR
0252 04                INC     A
0253 F0                MOVX    @DPTR,A
0254         ?C0246:
                                           ; SOURCE LINE # 1128
0254 900000      E     MOV     DPTR,#g_mem+070H
0257 E0                MOVX    A,@DPTR
0258 F8                MOV     R0,A
0259 A3                INC     DPTR
025A E0                MOVX    A,@DPTR
025B F9                MOV     R1,A
025C A3                INC     DPTR
025D E0                MOVX    A,@DPTR
025E FA                MOV     R2,A
025F A3                INC     DPTR
0260 E0                MOVX    A,@DPTR
0261 FB                MOV     R3,A
0262 C000              PUSH    AR0
0264 C001              PUSH    AR1
0266 C002              PUSH    AR2
0268 C003              PUSH    AR3
026A 900000      E     MOV     DPTR,#ADC_buf+04H
026D E0                MOVX    A,@DPTR
026E FE                MOV     R6,A
026F A3                INC     DPTR
0270 E0                MOVX    A,@DPTR
0271 FF                MOV     R7,A
0272 EE                MOV     A,R6
0273 33                RLC     A
0274 95E0              SUBB    A,ACC
0276 FD                MOV     R5,A
0277 FC                MOV     R4,A
0278 120000      E     LCALL   _filter_ch1
027B D003              POP     AR3
027D D002              POP     AR2
027F D001              POP     AR1
0281 D000              POP     AR0
0283 EB                MOV     A,R3
0284 2F                ADD     A,R7
0285 FF                MOV     R7,A
0286 EA                MOV     A,R2
0287 3E                ADDC    A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 110 

0288 FE                MOV     R6,A
0289 E9                MOV     A,R1
028A 3D                ADDC    A,R5
028B FD                MOV     R5,A
028C E8                MOV     A,R0
028D 3C                ADDC    A,R4
028E FC                MOV     R4,A
028F 900000      E     MOV     DPTR,#g_mem+070H
0292 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1130
0295 300005            JNB     interrupt_flag,?C0195
                                           ; SOURCE LINE # 1131
0298 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1132
029A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1133
029D         ?C0195:
                                           ; SOURCE LINE # 1135
029D 900000      R     MOV     DPTR,#emg_counter_1
02A0 E0                MOVX    A,@DPTR
02A1 B40339            CJNE    A,#03H,?C0183
02A4 A3                INC     DPTR
02A5 E0                MOVX    A,@DPTR
02A6 B4E834            CJNE    A,#0E8H,?C0183
                                           ; SOURCE LINE # 1136
02A9 900000      E     MOV     DPTR,#g_mem+070H
02AC E0                MOVX    A,@DPTR
02AD FC                MOV     R4,A
02AE A3                INC     DPTR
02AF E0                MOVX    A,@DPTR
02B0 FD                MOV     R5,A
02B1 A3                INC     DPTR
02B2 E0                MOVX    A,@DPTR
02B3 FE                MOV     R6,A
02B4 A3                INC     DPTR
02B5 E0                MOVX    A,@DPTR
02B6 FF                MOV     R7,A
02B7 E4                CLR     A
02B8 7BE8              MOV     R3,#0E8H
02BA 7A03              MOV     R2,#03H
02BC F9                MOV     R1,A
02BD F8                MOV     R0,A
02BE 120000      E     LCALL   ?C?ULDIV
02C1 900000      E     MOV     DPTR,#g_mem+070H
02C4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1138
02C7 300005            JNB     interrupt_flag,?C0197
                                           ; SOURCE LINE # 1139
02CA C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1140
02CC 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1141
02CF         ?C0197:
                                           ; SOURCE LINE # 1143
02CF E4                CLR     A
02D0 FF                MOV     R7,A
02D1 120000      E     LCALL   _LED_REG_Write
                                           ; SOURCE LINE # 1144
02D4 E4                CLR     A
02D5 900000      R     MOV     DPTR,#emg_counter_1
02D8 F0                MOVX    @DPTR,A
02D9 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 111 

02DA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1146
02DB F500        R     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1147
                                           ; SOURCE LINE # 1148
                                           ; SOURCE LINE # 1150
                                           ; SOURCE LINE # 1151
                                           ; SOURCE LINE # 1152
02DD         ?C0183:
                                           ; SOURCE LINE # 1154
02DD 300005            JNB     interrupt_flag,?C0199
                                           ; SOURCE LINE # 1155
02E0 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1156
02E2 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1157
02E5         ?C0199:
                                           ; SOURCE LINE # 1159
02E5 E500        R     MOV     A,emg_2_status
02E7 14                DEC     A
02E8 7003              JNZ     $ + 5H
02EA 020000      R     LJMP    ?C0206
02ED 14                DEC     A
02EE 7003              JNZ     $ + 5H
02F0 020000      R     LJMP    ?C0208
02F3 14                DEC     A
02F4 7003              JNZ     $ + 5H
02F6 020000      R     LJMP    ?C0211
02F9 14                DEC     A
02FA 7003              JNZ     $ + 5H
02FC 020000      R     LJMP    ?C0218
02FF 2404              ADD     A,#04H
0301 6003              JZ      $ + 5H
0303 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1160
0306         ?C0201:
                                           ; SOURCE LINE # 1161
0306 900000      E     MOV     DPTR,#ADC_buf+06H
0309 E0                MOVX    A,@DPTR
030A FE                MOV     R6,A
030B A3                INC     DPTR
030C E0                MOVX    A,@DPTR
030D FF                MOV     R7,A
030E EE                MOV     A,R6
030F 33                RLC     A
0310 95E0              SUBB    A,ACC
0312 FD                MOV     R5,A
0313 FC                MOV     R4,A
0314 120000      E     LCALL   _filter_ch2
0317 8F00        R     MOV     i_aux+03H,R7
0319 8E00        R     MOV     i_aux+02H,R6
031B 8D00        R     MOV     i_aux+01H,R5
031D 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1162
031F 780A              MOV     R0,#0AH
0321 120000      E     LCALL   ?C?LSHL
0324 900000      E     MOV     DPTR,#g_mem+074H
0327 E0                MOVX    A,@DPTR
0328 F8                MOV     R0,A
0329 A3                INC     DPTR
032A E0                MOVX    A,@DPTR
032B F9                MOV     R1,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 112 

032C A3                INC     DPTR
032D E0                MOVX    A,@DPTR
032E FA                MOV     R2,A
032F A3                INC     DPTR
0330 E0                MOVX    A,@DPTR
0331 FB                MOV     R3,A
0332 120000      E     LCALL   ?C?ULDIV
0335 8F00        R     MOV     i_aux+03H,R7
0337 8E00        R     MOV     i_aux+02H,R6
0339 8D00        R     MOV     i_aux+01H,R5
033B 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1164
033D 300005            JNB     interrupt_flag,?C0202
                                           ; SOURCE LINE # 1165
0340 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1166
0342 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1167
0345         ?C0202:
                                           ; SOURCE LINE # 1169
0345 E4                CLR     A
0346 FF                MOV     R7,A
0347 FE                MOV     R6,A
0348 FD                MOV     R5,A
0349 FC                MOV     R4,A
034A AB00        R     MOV     R3,i_aux+03H
034C AA00        R     MOV     R2,i_aux+02H
034E A900        R     MOV     R1,i_aux+01H
0350 A800        R     MOV     R0,i_aux
0352 C3                CLR     C
0353 120000      E     LCALL   ?C?SLCMP
0356 500B              JNC     ?C0203
                                           ; SOURCE LINE # 1170
0358 E4                CLR     A
0359 F500        R     MOV     i_aux+03H,A
035B F500        R     MOV     i_aux+02H,A
035D F500        R     MOV     i_aux+01H,A
035F F500        R     MOV     i_aux,A
0361 801E              SJMP    ?C0204
0363         ?C0203:
                                           ; SOURCE LINE # 1172
0363 E4                CLR     A
0364 FF                MOV     R7,A
0365 7E04              MOV     R6,#04H
0367 FD                MOV     R5,A
0368 FC                MOV     R4,A
0369 AB00        R     MOV     R3,i_aux+03H
036B AA00        R     MOV     R2,i_aux+02H
036D A900        R     MOV     R1,i_aux+01H
036F A800        R     MOV     R0,i_aux
0371 D3                SETB    C
0372 120000      E     LCALL   ?C?SLCMP
0375 400A              JC      ?C0204
                                           ; SOURCE LINE # 1173
0377 E4                CLR     A
0378 F500        R     MOV     i_aux+03H,A
037A 750004      R     MOV     i_aux+02H,#04H
037D F500        R     MOV     i_aux+01H,A
037F F500        R     MOV     i_aux,A
0381         ?C0204:
                                           ; SOURCE LINE # 1175
0381 AF00        R     MOV     R7,i_aux+03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 113 

0383 AE00        R     MOV     R6,i_aux+02H
0385 AD00        R     MOV     R5,i_aux+01H
0387 AC00        R     MOV     R4,i_aux
0389 900000      E     MOV     DPTR,#g_meas+01BH
038C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1177
038F 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1179
0392         ?C0206:
                                           ; SOURCE LINE # 1180
0392 E4                CLR     A
0393 900000      R     MOV     DPTR,#emg_counter_2
0396 F0                MOVX    @DPTR,A
0397 A3                INC     DPTR
0398 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1181
0399 FF                MOV     R7,A
039A FE                MOV     R6,A
039B FD                MOV     R5,A
039C FC                MOV     R4,A
039D 900000      E     MOV     DPTR,#g_mem+074H
03A0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1183
03A3 300005            JNB     interrupt_flag,?C0207
                                           ; SOURCE LINE # 1184
03A6 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1185
03A8 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1186
03AB         ?C0207:
                                           ; SOURCE LINE # 1188
03AB 750004      R     MOV     emg_2_status,#04H
                                           ; SOURCE LINE # 1189
03AE 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1191
03B1         ?C0208:
                                           ; SOURCE LINE # 1192
03B1 900000      R     MOV     DPTR,#emg_counter_2+01H
03B4 E0                MOVX    A,@DPTR
03B5 04                INC     A
03B6 F0                MOVX    @DPTR,A
03B7 7006              JNZ     ?C0248
03B9 900000      R     MOV     DPTR,#emg_counter_2
03BC E0                MOVX    A,@DPTR
03BD 04                INC     A
03BE F0                MOVX    @DPTR,A
03BF         ?C0248:
                                           ; SOURCE LINE # 1193
03BF 900000      R     MOV     DPTR,#emg_counter_2
03C2 E0                MOVX    A,@DPTR
03C3 6401              XRL     A,#01H
03C5 7004              JNZ     ?C0249
03C7 A3                INC     DPTR
03C8 E0                MOVX    A,@DPTR
03C9 64F4              XRL     A,#0F4H
03CB         ?C0249:
03CB 6003              JZ      $ + 5H
03CD 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1194
03D0 900000      R     MOV     DPTR,#emg_counter_2
03D3 F0                MOVX    @DPTR,A
03D4 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 114 

03D5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1195
03D6 7F01              MOV     R7,#01H
03D8 120000      E     LCALL   _LED_REG_Write
                                           ; SOURCE LINE # 1197
03DB 300005            JNB     interrupt_flag,?C0210
                                           ; SOURCE LINE # 1198
03DE C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1199
03E0 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1200
03E3         ?C0210:
                                           ; SOURCE LINE # 1202
03E3 750003      R     MOV     emg_2_status,#03H
                                           ; SOURCE LINE # 1203
                                           ; SOURCE LINE # 1204
03E6 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1206
03E9         ?C0211:
                                           ; SOURCE LINE # 1208
03E9 900000      R     MOV     DPTR,#emg_counter_2+01H
03EC E0                MOVX    A,@DPTR
03ED 04                INC     A
03EE F0                MOVX    @DPTR,A
03EF 7006              JNZ     ?C0250
03F1 900000      R     MOV     DPTR,#emg_counter_2
03F4 E0                MOVX    A,@DPTR
03F5 04                INC     A
03F6 F0                MOVX    @DPTR,A
03F7         ?C0250:
                                           ; SOURCE LINE # 1209
03F7 900000      E     MOV     DPTR,#g_mem+074H
03FA E0                MOVX    A,@DPTR
03FB F8                MOV     R0,A
03FC A3                INC     DPTR
03FD E0                MOVX    A,@DPTR
03FE F9                MOV     R1,A
03FF A3                INC     DPTR
0400 E0                MOVX    A,@DPTR
0401 FA                MOV     R2,A
0402 A3                INC     DPTR
0403 E0                MOVX    A,@DPTR
0404 FB                MOV     R3,A
0405 C000              PUSH    AR0
0407 C001              PUSH    AR1
0409 C002              PUSH    AR2
040B C003              PUSH    AR3
040D 900000      E     MOV     DPTR,#ADC_buf+06H
0410 E0                MOVX    A,@DPTR
0411 FE                MOV     R6,A
0412 A3                INC     DPTR
0413 E0                MOVX    A,@DPTR
0414 FF                MOV     R7,A
0415 EE                MOV     A,R6
0416 33                RLC     A
0417 95E0              SUBB    A,ACC
0419 FD                MOV     R5,A
041A FC                MOV     R4,A
041B 120000      E     LCALL   _filter_ch2
041E D003              POP     AR3
0420 D002              POP     AR2
0422 D001              POP     AR1
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 115 

0424 D000              POP     AR0
0426 EB                MOV     A,R3
0427 2F                ADD     A,R7
0428 FF                MOV     R7,A
0429 EA                MOV     A,R2
042A 3E                ADDC    A,R6
042B FE                MOV     R6,A
042C E9                MOV     A,R1
042D 3D                ADDC    A,R5
042E FD                MOV     R5,A
042F E8                MOV     A,R0
0430 3C                ADDC    A,R4
0431 FC                MOV     R4,A
0432 900000      E     MOV     DPTR,#g_mem+074H
0435 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1211
0438 300005            JNB     interrupt_flag,?C0212
                                           ; SOURCE LINE # 1212
043B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1213
043D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1214
0440         ?C0212:
                                           ; SOURCE LINE # 1216
0440 900000      R     MOV     DPTR,#emg_counter_2
0443 E0                MOVX    A,@DPTR
0444 6403              XRL     A,#03H
0446 7004              JNZ     ?C0251
0448 A3                INC     DPTR
0449 E0                MOVX    A,@DPTR
044A 64E8              XRL     A,#0E8H
044C         ?C0251:
044C 6003              JZ      $ + 5H
044E 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1217
0451 900000      E     MOV     DPTR,#g_mem+074H
0454 E0                MOVX    A,@DPTR
0455 FC                MOV     R4,A
0456 A3                INC     DPTR
0457 E0                MOVX    A,@DPTR
0458 FD                MOV     R5,A
0459 A3                INC     DPTR
045A E0                MOVX    A,@DPTR
045B FE                MOV     R6,A
045C A3                INC     DPTR
045D E0                MOVX    A,@DPTR
045E FF                MOV     R7,A
045F E4                CLR     A
0460 7BE8              MOV     R3,#0E8H
0462 7A03              MOV     R2,#03H
0464 F9                MOV     R1,A
0465 F8                MOV     R0,A
0466 120000      E     LCALL   ?C?ULDIV
0469 900000      E     MOV     DPTR,#g_mem+074H
046C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1218
046F E4                CLR     A
0470 FF                MOV     R7,A
0471 120000      E     LCALL   _LED_REG_Write
                                           ; SOURCE LINE # 1219
0474 E4                CLR     A
0475 900000      R     MOV     DPTR,#emg_counter_2
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 116 

0478 F0                MOVX    @DPTR,A
0479 A3                INC     DPTR
047A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1221
047B 300005            JNB     interrupt_flag,?C0214
                                           ; SOURCE LINE # 1222
047E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1223
0480 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1224
0483         ?C0214:
                                           ; SOURCE LINE # 1227
0483 900000      E     MOV     DPTR,#c_mem+033H
0486 E0                MOVX    A,@DPTR
0487 FF                MOV     R7,A
0488 6402              XRL     A,#02H
048A 600E              JZ      ?C0216
048C EF                MOV     A,R7
048D 6403              XRL     A,#03H
048F 6009              JZ      ?C0216
0491 EF                MOV     A,R7
0492 6404              XRL     A,#04H
0494 6004              JZ      ?C0216
0496 EF                MOV     A,R7
0497 B4053A            CJNE    A,#05H,?C0215
049A         ?C0216:
                                           ; SOURCE LINE # 1230
                                           ; SOURCE LINE # 1231
049A 900000      E     MOV     DPTR,#c_mem+034H
049D E0                MOVX    A,@DPTR
049E 7028              JNZ     ?C0217
                                           ; SOURCE LINE # 1232
04A0 900000      E     MOV     DPTR,#g_meas
04A3 E0                MOVX    A,@DPTR
04A4 FC                MOV     R4,A
04A5 A3                INC     DPTR
04A6 E0                MOVX    A,@DPTR
04A7 FD                MOV     R5,A
04A8 A3                INC     DPTR
04A9 E0                MOVX    A,@DPTR
04AA FE                MOV     R6,A
04AB A3                INC     DPTR
04AC E0                MOVX    A,@DPTR
04AD FF                MOV     R7,A
04AE 900000      E     MOV     DPTR,#g_ref
04B1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1233
04B4 900000      E     MOV     DPTR,#g_meas+04H
04B7 E0                MOVX    A,@DPTR
04B8 FC                MOV     R4,A
04B9 A3                INC     DPTR
04BA E0                MOVX    A,@DPTR
04BB FD                MOV     R5,A
04BC A3                INC     DPTR
04BD E0                MOVX    A,@DPTR
04BE FE                MOV     R6,A
04BF A3                INC     DPTR
04C0 E0                MOVX    A,@DPTR
04C1 FF                MOV     R7,A
04C2 900000      E     MOV     DPTR,#g_ref+04H
04C5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1234
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 117 

04C8         ?C0217:
                                           ; SOURCE LINE # 1235
04C8 900000      E     MOV     DPTR,#c_mem+032H
04CB E0                MOVX    A,@DPTR
04CC FF                MOV     R7,A
04CD 900000      E     MOV     DPTR,#g_ref+018H
04D0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1236
04D1 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1237
04D4         ?C0215:
                                           ; SOURCE LINE # 1238
04D4 E4                CLR     A
04D5 F500        R     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1239
                                           ; SOURCE LINE # 1240
04D7 8007              SJMP    ?C0200
                                           ; SOURCE LINE # 1242
04D9         ?C0218:
                                           ; SOURCE LINE # 1243
04D9 E500        R     MOV     A,emg_1_status
04DB 7003              JNZ     ?C0200
                                           ; SOURCE LINE # 1244
04DD 750002      R     MOV     emg_2_status,#02H
                                           ; SOURCE LINE # 1245
                                           ; SOURCE LINE # 1247
                                           ; SOURCE LINE # 1248
                                           ; SOURCE LINE # 1249
04E0         ?C0200:
                                           ; SOURCE LINE # 1251
04E0 30005E            JNB     interrupt_flag,?C0222
                                           ; SOURCE LINE # 1252
04E3 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1253
04E5 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1254
                                           ; SOURCE LINE # 1255
04E8 8057              SJMP    ?C0222
04EA         ?C0179:
                                           ; SOURCE LINE # 1256
                                           ; SOURCE LINE # 1258
04EA 750001      R     MOV     emg_1_status,#01H
                                           ; SOURCE LINE # 1259
04ED 750001      R     MOV     emg_2_status,#01H
                                           ; SOURCE LINE # 1261
04F0 C200        E     CLR     tension_valid
                                           ; SOURCE LINE # 1263
04F2 300005            JNB     interrupt_flag,?C0223
                                           ; SOURCE LINE # 1264
04F5 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1265
04F7 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1266
04FA         ?C0223:
                                           ; SOURCE LINE # 1268
04FA 900000      E     MOV     DPTR,#c_mem+06FH
04FD E0                MOVX    A,@DPTR
04FE 6020              JZ      ?C0224
                                           ; SOURCE LINE # 1269
0500 900000      E     MOV     DPTR,#c_mem+033H
0503 E0                MOVX    A,@DPTR
0504 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 118 

0505 6402              XRL     A,#02H
0507 600E              JZ      ?C0226
0509 EF                MOV     A,R7
050A 6403              XRL     A,#03H
050C 6009              JZ      ?C0226
050E EF                MOV     A,R7
050F 6404              XRL     A,#04H
0511 6004              JZ      ?C0226
0513 EF                MOV     A,R7
0514 B40509            CJNE    A,#05H,?C0224
0517         ?C0226:
                                           ; SOURCE LINE # 1272
                                           ; SOURCE LINE # 1273
0517 E4                CLR     A
0518 900000      E     MOV     DPTR,#g_ref+018H
051B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1274
051C FF                MOV     R7,A
051D 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1275
                                           ; SOURCE LINE # 1276
0520         ?C0224:
                                           ; SOURCE LINE # 1279
0520 E4                CLR     A
0521 FF                MOV     R7,A
0522 FE                MOV     R6,A
0523 FD                MOV     R5,A
0524 FC                MOV     R4,A
0525 900000      E     MOV     DPTR,#g_meas+0CH
0528 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1282
052B E4                CLR     A
052C FF                MOV     R7,A
052D FE                MOV     R6,A
052E FD                MOV     R5,A
052F FC                MOV     R4,A
0530 900000      E     MOV     DPTR,#g_meas+017H
0533 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1283
0536 E4                CLR     A
0537 FF                MOV     R7,A
0538 FE                MOV     R6,A
0539 FD                MOV     R5,A
053A FC                MOV     R4,A
053B 900000      E     MOV     DPTR,#g_meas+01BH
053E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1285
0541         ?C0222:
                                           ; SOURCE LINE # 1287
0541 300005            JNB     interrupt_flag,?C0228
                                           ; SOURCE LINE # 1288
0544 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1289
0546 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1290
                                           ; SOURCE LINE # 1291
0549         ?C0228:
0549 22                RET     
             ; FUNCTION analog_read_end (END)

             ; FUNCTION overcurrent_control (BEGIN)
                                           ; SOURCE LINE # 1297
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 119 

                                           ; SOURCE LINE # 1298
0000 900000      E     MOV     DPTR,#c_mem+069H
0003 E0                MOVX    A,@DPTR
0004 FE                MOV     R6,A
0005 A3                INC     DPTR
0006 E0                MOVX    A,@DPTR
0007 FF                MOV     R7,A
0008 4E                ORL     A,R6
0009 6068              JZ      ?C0236
                                           ; SOURCE LINE # 1300
000B EE                MOV     A,R6
000C 33                RLC     A
000D 95E0              SUBB    A,ACC
000F FD                MOV     R5,A
0010 FC                MOV     R4,A
0011 900000      E     MOV     DPTR,#g_meas+0CH
0014 E0                MOVX    A,@DPTR
0015 F8                MOV     R0,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 F9                MOV     R1,A
0019 A3                INC     DPTR
001A E0                MOVX    A,@DPTR
001B FA                MOV     R2,A
001C A3                INC     DPTR
001D E0                MOVX    A,@DPTR
001E FB                MOV     R3,A
001F D3                SETB    C
0020 120000      E     LCALL   ?C?SLCMP
0023 4008              JC      ?C0230
                                           ; SOURCE LINE # 1302
0025 900000      E     MOV     DPTR,#dev_pwm_limit
0028 E0                MOVX    A,@DPTR
0029 14                DEC     A
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1304
002B 802D              SJMP    ?C0231
002D         ?C0230:
002D 900000      E     MOV     DPTR,#c_mem+06AH
0030 E0                MOVX    A,@DPTR
0031 24F6              ADD     A,#0F6H
0033 FF                MOV     R7,A
0034 900000      E     MOV     DPTR,#c_mem+069H
0037 E0                MOVX    A,@DPTR
0038 34FF              ADDC    A,#0FFH
003A FE                MOV     R6,A
003B 33                RLC     A
003C 95E0              SUBB    A,ACC
003E FD                MOV     R5,A
003F FC                MOV     R4,A
0040 900000      E     MOV     DPTR,#g_meas+0CH
0043 E0                MOVX    A,@DPTR
0044 F8                MOV     R0,A
0045 A3                INC     DPTR
0046 E0                MOVX    A,@DPTR
0047 F9                MOV     R1,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FA                MOV     R2,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D FB                MOV     R3,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 120 

004E C3                CLR     C
004F 120000      E     LCALL   ?C?SLCMP
0052 5006              JNC     ?C0231
                                           ; SOURCE LINE # 1306
0054 900000      E     MOV     DPTR,#dev_pwm_limit
0057 E0                MOVX    A,@DPTR
0058 04                INC     A
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1307
005A         ?C0231:
                                           ; SOURCE LINE # 1310
005A 900000      E     MOV     DPTR,#dev_pwm_limit
005D E0                MOVX    A,@DPTR
005E FF                MOV     R7,A
005F C3                CLR     C
0060 9400              SUBB    A,#00H
0062 5003              JNC     ?C0233
                                           ; SOURCE LINE # 1311
0064 E4                CLR     A
0065 F0                MOVX    @DPTR,A
0066 22                RET     
0067         ?C0233:
                                           ; SOURCE LINE # 1313
0067 EF                MOV     A,R7
0068 D3                SETB    C
0069 9464              SUBB    A,#064H
006B 4006              JC      ?C0236
                                           ; SOURCE LINE # 1314
006D 900000      E     MOV     DPTR,#dev_pwm_limit
0070 7464              MOV     A,#064H
0072 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1315
                                           ; SOURCE LINE # 1316
0073         ?C0236:
0073 22                RET     
             ; FUNCTION overcurrent_control (END)

             ; FUNCTION pwm_limit_search (BEGIN)
                                           ; SOURCE LINE # 1322
                                           ; SOURCE LINE # 1326
0000 E4                CLR     A
0001 7F9C              MOV     R7,#09CH
0003 7E63              MOV     R6,#063H
0005 FD                MOV     R5,A
0006 FC                MOV     R4,A
0007 900000      E     MOV     DPTR,#dev_tension
000A E0                MOVX    A,@DPTR
000B F8                MOV     R0,A
000C A3                INC     DPTR
000D E0                MOVX    A,@DPTR
000E F9                MOV     R1,A
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011 FA                MOV     R2,A
0012 A3                INC     DPTR
0013 E0                MOVX    A,@DPTR
0014 FB                MOV     R3,A
0015 D3                SETB    C
0016 120000      E     LCALL   ?C?SLCMP
0019 4006              JC      ?C0237
                                           ; SOURCE LINE # 1327
001B E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 121 

001C 900000      E     MOV     DPTR,#dev_pwm_limit
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1328
0020 22                RET     
0021         ?C0237:
0021 E4                CLR     A
0022 7FEC              MOV     R7,#0ECH
0024 7E2C              MOV     R6,#02CH
0026 FD                MOV     R5,A
0027 FC                MOV     R4,A
0028 900000      E     MOV     DPTR,#dev_tension
002B E0                MOVX    A,@DPTR
002C F8                MOV     R0,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F F9                MOV     R1,A
0030 A3                INC     DPTR
0031 E0                MOVX    A,@DPTR
0032 FA                MOV     R2,A
0033 A3                INC     DPTR
0034 E0                MOVX    A,@DPTR
0035 FB                MOV     R3,A
0036 C3                CLR     C
0037 120000      E     LCALL   ?C?SLCMP
003A 5007              JNC     ?C0239
                                           ; SOURCE LINE # 1329
003C 900000      E     MOV     DPTR,#dev_pwm_limit
003F 7464              MOV     A,#064H
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1330
0042 22                RET     
0043         ?C0239:
                                           ; SOURCE LINE # 1331
0043 900000      E     MOV     DPTR,#dev_tension
0046 E0                MOVX    A,@DPTR
0047 FC                MOV     R4,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FD                MOV     R5,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D FE                MOV     R6,A
004E A3                INC     DPTR
004F E0                MOVX    A,@DPTR
0050 2414              ADD     A,#014H
0052 FF                MOV     R7,A
0053 EE                MOV     A,R6
0054 34D3              ADDC    A,#0D3H
0056 FE                MOV     R6,A
0057 ED                MOV     A,R5
0058 34FF              ADDC    A,#0FFH
005A FD                MOV     R5,A
005B EC                MOV     A,R4
005C 34FF              ADDC    A,#0FFH
005E FC                MOV     R4,A
005F 7809              MOV     R0,#09H
0061 120000      E     LCALL   ?C?SLSHR
0064 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 1332
0066 7400        R     MOV     A,#LOW pwm_preload_values
0068 2F                ADD     A,R7
0069 F582              MOV     DPL,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/26/2017 09:18:20 PAGE 122 

006B E4                CLR     A
006C 3400        R     ADDC    A,#HIGH pwm_preload_values
006E F583              MOV     DPH,A
0070 E0                MOVX    A,@DPTR
0071 900000      E     MOV     DPTR,#dev_pwm_limit
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1333
                                           ; SOURCE LINE # 1334
0075         ?C0241:
0075 22                RET     
             ; FUNCTION pwm_limit_search (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   8272    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    233      20
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9      84
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE INTERRUPTIONS
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Release\interruptions.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.3\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\interruptions.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(NDEBUG) WL(2) PR(.\DP80
                    -51_Keil_951\Release/interruptions.lst) CD OT(8,SPEED) OJ(.\DP8051_Keil_951\Release\interruptions.obj)

line level    source

*** MESSAGE C286 IN LINE 0 OF (null): license limits optimization to level 5
   1          // ----------------------------------------------------------------------------
   2          // BSD 3-Clause License
   3          
   4          // Copyright (c) 2016, qbrobotics
   5          // Copyright (c) 2017, Centro "E.Piaggio"
   6          // All rights reserved.
   7          
   8          // Redistribution and use in source and binary forms, with or without
   9          // modification, are permitted provided that the following conditions are met:
  10          
  11          // * Redistributions of source code must retain the above copyright notice, this
  12          //   list of conditions and the following disclaimer.
  13          
  14          // * Redistributions in binary form must reproduce the above copyright notice,
  15          //   this list of conditions and the following disclaimer in the documentation
  16          //   and/or other materials provided with the distribution.
  17          
  18          // * Neither the name of the copyright holder nor the names of its
  19          //   contributors may be used to endorse or promote products derived from
  20          //   this software without specific prior written permission.
  21          
  22          // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  23          // AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  24          // IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  25          // DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
  26          // FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  27          // DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
  28          // SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
  29          // CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  30          // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  31          // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  32          // POSSIBILITY OF SUCH DAMAGE.
  33          // ----------------------------------------------------------------------------
  34          
  35          /**
  36          * \file         interruptions.c
  37          *
  38          * \brief        Interruption handling and firmware core functions
  39          * \date         June 06, 2016
  40          * \author       _qbrobotics_
  41          * \copyright    (C) 2012-2016 qbrobotics. All rights reserved.
  42          * \copyright    (C) 2017 Centro "E.Piaggio". All rights reserved.
  43          */
  44          
  45          
  46          //=================================================================     includes
  47          #include <interruptions.h>
  48          #include <command_processing.h>
  49          #include <globals.h>
  50          #include <utils.h>
  51          
  52          
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 2   

  53          //==============================================================================
  54          //                                                            RS485 RX INTERRUPT
  55          //==============================================================================
  56          // Processing RS-485 data frame:
  57          //
  58          // - 0:     Waits for beggining characters
  59          // - 1:     Waits for ID;
  60          // - 2:     Data length;
  61          // - 3:     Receive all bytes;
  62          // - 4:     Wait for another device end of transmission;
  63          //
  64          //==============================================================================
  65          
  66          // PWM values needed to obtain 11.5 V given a certain input tension
  67          // Numbers are sperimentally calculated //[index] (millivolts)
  68          static const uint8 pwm_preload_values[29] = {100,    //0 (11500)
  69                                                        83,
  70                                                        78,
  71                                                        76,
  72                                                        74,
  73                                                        72,    //5 (14000)
  74                                                        70,
  75                                                        68,
  76                                                        67,
  77                                                        65,
  78                                                        64,    //10 (16500)
  79                                                        63,
  80                                                        62,
  81                                                        61,
  82                                                        60,
  83                                                        59,    //15 (19000)
  84                                                        58,
  85                                                        57,
  86                                                        56,
  87                                                        56,
  88                                                        55,    //20 (21500)
  89                                                        54,
  90                                                        54,
  91                                                        53,
  92                                                        52,
  93                                                        52,    //25 (24000)
  94                                                        52,
  95                                                        51,
  96                                                        51};   //28 (25500)
  97          
  98          //==============================================================================
  99          //                                                            WATCHDOG INTERRUPT
 100          //==============================================================================
 101          
 102          CY_ISR(ISR_WATCHDOG_Handler){
 103   1      
 104   1          // Set WDT flag
 105   1          
 106   1          watchdog_flag = TRUE;
 107   1      
 108   1      }
 109          
 110          //==============================================================================
 111          //                                                            RS485 RX INTERRUPT
 112          //==============================================================================
 113          
 114          CY_ISR(ISR_RS485_RX_ExInterrupt) {
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 3   

 115   1      
 116   1          // Set RS485 flag
 117   1          
 118   1          interrupt_flag = TRUE;
 119   1           
 120   1      }
 121          
 122          //==============================================================================
 123          //                                                             INTERRUPT MANAGER
 124          //==============================================================================
 125          // Manage interrupt from RS485 
 126          //==============================================================================
 127          // Processing RS-485 data frame:
 128          //
 129          // - WAIT_START:    Waits for beginning characters;
 130          // - WAIT_ID:       Waits for ID;
 131          // - WAIT_LENGTH:   Data length;
 132          // - RECEIVE:       Receive all bytes;
 133          // - UNLOAD:        Wait for another device end of transmission;
 134          //
 135          //==============================================================================
 136          
 137          void interrupt_manager(){
 138   1      
 139   1          
 140   1          //===========================================     local variables definition
 141   1      
 142   1          static uint8 CYDATA state = WAIT_START;                      // state
 143   1          
 144   1          //------------------------------------------------- local data packet
 145   1          static uint8 CYDATA data_packet_index;
 146   1          static uint8 CYDATA data_packet_length;
 147   1          static uint8 data_packet_buffer[128];                     
 148   1          static uint8 CYDATA rx_queue[3];                    // last 2 bytes received
 149   1          //-------------------------------------------------
 150   1      
 151   1          uint8 CYDATA    rx_data;                            // RS485 UART rx data
 152   1          CYBIT           rx_data_type;                       // my id?
 153   1          uint8 CYDATA    package_count = 0;                     
 154   1      
 155   1          //======================================================     receive routine
 156   1          
 157   1          // Get data until buffer is not empty 
 158   1          
 159   1          while(UART_RS485_GetRxBufferSize() && (package_count < 6)){  
 160   2              // 6 stima di numero massimo di pacchetti che riesco a leggere senza bloccare l'esecuzione del fir
             -mware
 161   2              
 162   2              // Get next char
 163   2              rx_data = UART_RS485_GetChar();
 164   2              
 165   2              switch (state) {
 166   3                  //-----     wait for frame start     -------------------------------
 167   3                  case WAIT_START:
 168   3                  
 169   3                      rx_queue[0] = rx_queue[1];
 170   3                      rx_queue[1] = rx_queue[2];
 171   3                      rx_queue[2] = rx_data;
 172   3                      
 173   3                      // Check for header configuration package
 174   3                      if ((rx_queue[1] == 58) && (rx_queue[2] == 58)) {
 175   4                          rx_queue[0] = 0;
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 4   

 176   4                          rx_queue[1] = 0;
 177   4                          rx_queue[2] = 0;
 178   4                          state       = WAIT_ID;                    
 179   4                      }else
 180   3                          if ((rx_queue[0] == 63) &&      //ASCII - ?
 181   3                              (rx_queue[1] == 13) &&      //ASCII - CR
 182   3                              (rx_queue[2] == 10))        //ASCII - LF)
 183   3                              infoGet(INFO_ALL);
 184   3                      break;
 185   3      
 186   3                  //-----     wait for id     ----------------------------------------
 187   3                  case  WAIT_ID:
 188   3      
 189   3                      // packet is for my ID or is broadcast
 190   3                      if (rx_data == c_mem.id || rx_data == 0)
 191   3                          rx_data_type = FALSE;
 192   3                      else                //packet is for others
 193   3                          rx_data_type = TRUE;
 194   3                      
 195   3                      data_packet_length = 0;
 196   3                      state = WAIT_LENGTH;
 197   3                      break;
 198   3      
 199   3                  //-----     wait for length     ------------------------------------
 200   3                  case  WAIT_LENGTH:
 201   3      
 202   3       
 203   3                      data_packet_length = rx_data;
 204   3                      // check validity of pack length
 205   3                      if (data_packet_length <= 1) {
 206   4                          data_packet_length = 0;
 207   4                          state = WAIT_START;
 208   4                      } else if (data_packet_length > 128) {
 209   4                          data_packet_length = 0;
 210   4                          state = WAIT_START;
 211   4                      } else {
 212   4                          data_packet_index = 0;
 213   4                          
 214   4                          if(rx_data_type == FALSE)
 215   4                              state = RECEIVE;          // packet for me or broadcast
 216   4                          else
 217   4                              state = UNLOAD;           // packet for others
 218   4                      }
 219   3                      break;
 220   3      
 221   3                  //-----     receiving     -------------------------------------------
 222   3                  case RECEIVE:
 223   3      
 224   3                      data_packet_buffer[data_packet_index] = rx_data;
 225   3                      data_packet_index++;
 226   3                      
 227   3                      // check end of transmission
 228   3                      if (data_packet_index >= data_packet_length) {
 229   4                          // verify if frame ID corresponded to the device ID
 230   4                          if (rx_data_type == FALSE) {
 231   5                              // copying data from buffer to global packet
 232   5                              memcpy(g_rx.buffer, data_packet_buffer, data_packet_length);
 233   5                              g_rx.length = data_packet_length;
 234   5                              g_rx.ready  = 1;
 235   5                              commProcess();
 236   5                          }
 237   4                          
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 5   

 238   4                          data_packet_index  = 0;
 239   4                          data_packet_length = 0;
 240   4                          state              = WAIT_START;
 241   4                          package_count++;
 242   4                      
 243   4                      }
 244   3                      break;
 245   3      
 246   3                  //-----     other device is receving     ---------------------------
 247   3                  case UNLOAD:
 248   3                      if (!(--data_packet_length)) {
 249   4                          data_packet_index  = 0;
 250   4                          data_packet_length = 0;
 251   4                          RS485_CTS_Write(1);
 252   4                          RS485_CTS_Write(0);
 253   4                          state              = WAIT_START;
 254   4                          package_count++;
 255   4                      }
 256   3                      break;
 257   3              }
 258   2          }
 259   1      }
 260          //==============================================================================
 261          //                                                            FUNCTION SCHEDULER
 262          //==============================================================================
 263          // Call all the function with the right frequency
 264          //==============================================================================
 265          // Base frequency 1000 Hz
 266          //==============================================================================
 267          
 268          void function_scheduler(void) {
 269   1       
 270   1          static uint16 counter_calibration = DIV_INIT_VALUE;
 271   1      
 272   1          timer_value0 = (uint32)MY_TIMER_ReadCounter();
 273   1      
 274   1          // Start ADC Conversion, SOC = 1
 275   1      
 276   1          ADC_SOC_Write(0x01); 
 277   1          
 278   1          // Check Interrupt 
 279   1      
 280   1          if (interrupt_flag){
 281   2              interrupt_flag = FALSE;
 282   2              interrupt_manager();
 283   2          }
 284   1        
 285   1          //---------------------------------- Get Encoders
 286   1      
 287   1          encoder_reading(0); 
 288   1          
 289   1          // Check Interrupt     
 290   1          
 291   1          if (interrupt_flag){
 292   2              interrupt_flag = FALSE;
 293   2              interrupt_manager();
 294   2          }   
 295   1          
 296   1          encoder_reading(1);
 297   1          
 298   1          // Check Interrupt 
 299   1          
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 6   

 300   1          if (interrupt_flag){
 301   2              interrupt_flag = FALSE;
 302   2              interrupt_manager();
 303   2          }
 304   1          
 305   1          encoder_reading(2);
 306   1          
 307   1          // Check Interrupt 
 308   1          
 309   1          if (interrupt_flag){
 310   2              interrupt_flag = FALSE;
 311   2              interrupt_manager();
 312   2          }
 313   1      
 314   1          //---------------------------------- Control Motor
 315   1         
 316   1          motor_control();
 317   1      
 318   1          // Check Interrupt 
 319   1      
 320   1          if (interrupt_flag){
 321   2              interrupt_flag = FALSE;
 322   2              interrupt_manager();
 323   2          }
 324   1      
 325   1          //---------------------------------- Read conversion buffer - LOCK function
 326   1      
 327   1          analog_read_end();
 328   1      
 329   1          if (interrupt_flag){
 330   2              interrupt_flag = FALSE;
 331   2              interrupt_manager();
 332   2          }
 333   1      
 334   1          //---------------------------------- Control Overcurrent
 335   1      
 336   1          overcurrent_control();
 337   1          
 338   1          // Check Interrupt 
 339   1          
 340   1          if (interrupt_flag){
 341   2              interrupt_flag = FALSE;
 342   2              interrupt_manager();
 343   2          }
 344   1      
 345   1          //---------------------------------- Calibration 
 346   1      
 347   1          // Divider 10, freq = 500 Hz
 348   1          if (calib.enabled == TRUE) {
 349   2              if (counter_calibration == CALIBRATION_DIV) {
 350   3                  calibration();
 351   3                  counter_calibration = 0;
 352   3              }
 353   2              counter_calibration++;
 354   2          }
 355   1      
 356   1          // Check Interrupt 
 357   1          
 358   1          if (interrupt_flag){
 359   2              interrupt_flag = FALSE;
 360   2              interrupt_manager();
 361   2          }
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 7   

 362   1          
 363   1           
 364   1          //---------------------------------- Rest position check
 365   1          
 366   1          // Divider 10, freq = 500 Hz
 367   1          if (c_mem.control_mode == CONTROL_ANGLE_AND_REST_POS){
 368   2              if (counter_calibration == CALIBRATION_DIV) {
 369   3                      check_rest_position();
 370   3                      counter_calibration = 0;
 371   3              }
 372   2              counter_calibration++;
 373   2      
 374   2              // Check Interrupt     
 375   2              if (interrupt_flag){
 376   3                  interrupt_flag = FALSE;
 377   3                  interrupt_manager();
 378   3              }
 379   2          }
 380   1         
 381   1          //---------------------------------- Update States
 382   1          
 383   1          // Load k-1 state
 384   1          memcpy( &g_measOld, &g_meas, sizeof(g_meas) );
 385   1          memcpy( &g_refOld, &g_ref, sizeof(g_ref) );
 386   1      
 387   1          // Load k+1 state
 388   1          memcpy( &g_ref, &g_refNew, sizeof(g_ref) );
 389   1      
 390   1          if (interrupt_flag){
 391   2              interrupt_flag = FALSE;
 392   2              interrupt_manager();
 393   2          }
 394   1      
 395   1          timer_value = (uint32)MY_TIMER_ReadCounter();
 396   1          cycle_time = (float)((timer_value0 - timer_value)/1000000.0);
 397   1          MY_TIMER_WriteCounter(5000000);
 398   1      
 399   1      }
 400          
 401          //==============================================================================
 402          //                                                                MOTORS CONTROL
 403          //==============================================================================
 404          
 405          void motor_control() {
 406   1      
 407   1          int32 CYDATA pwm_input = 0;
 408   1      
 409   1          int32 CYDATA pos_error;         // position error
 410   1          int32 CYDATA curr_error;        // current error
 411   1      
 412   1          int32 CYDATA i_ref;             // current reference
 413   1          int32 CYDATA handle_value;
 414   1      
 415   1          int32 CYDATA err_emg_1, err_emg_2;
 416   1      
 417   1          int32 CYDATA k_p = c_mem.k_p;  
 418   1          int32 CYDATA k_i = c_mem.k_i; 
 419   1          int32 CYDATA k_d = c_mem.k_d; 
 420   1      
 421   1          int32 CYDATA k_p_c = c_mem.k_p_c;  
 422   1          int32 CYDATA k_i_c = c_mem.k_i_c; 
 423   1          int32 CYDATA k_d_c = c_mem.k_d_c;   
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 8   

 424   1      
 425   1          int32 CYDATA k_p_dl = c_mem.k_p_dl;  
 426   1          int32 CYDATA k_i_dl = c_mem.k_i_dl; 
 427   1          int32 CYDATA k_d_dl = c_mem.k_d_dl;
 428   1          
 429   1          int32 CYDATA k_p_c_dl = c_mem.k_p_c_dl;  
 430   1          int32 CYDATA k_i_c_dl = c_mem.k_i_c_dl; 
 431   1          int32 CYDATA k_d_c_dl = c_mem.k_d_c_dl;   
 432   1      
 433   1          // Static Variables
 434   1      
 435   1          static int32 pos_error_sum;     // position error sum for integral
 436   1          static int32 curr_error_sum;    // current error sum for integral
 437   1          
 438   1          static int32 prev_pos_err;      // previous position error for deriv. control
 439   1          static int32 prev_curr_err;     // previous current error for deriv. control
 440   1      
 441   1          static CYBIT motor_dir = FALSE;
 442   1      
 443   1          static uint8 current_emg = 0;   // 0 NONE
 444   1                                          // 1 EMG 1
 445   1                                          // 2 EMG 2
 446   1                                          // wait for both to get down
 447   1      
 448   1          err_emg_1 = g_meas.emg[0] - c_mem.emg_threshold[0];
 449   1          err_emg_2 = g_meas.emg[1] - c_mem.emg_threshold[1];
 450   1      
 451   1          // =========================== POSITION INPUT ==============================
 452   1          switch(c_mem.input_mode) {
 453   2      
 454   2              case INPUT_MODE_ENCODER3:
 455   2      
 456   2                  // Calculate handle value based on position of handle in the
 457   2                  // sensor chain and multiplication factor between handle and motor position
 458   2                  if (c_mem.double_encoder_on_off) 
 459   2                      handle_value = g_meas.pos[2] * c_mem.motor_handle_ratio;
 460   2                  else
 461   2                      handle_value = g_meas.pos[1] * c_mem.motor_handle_ratio;
 462   2                  
 463   2      
 464   2                  // Read handle and use it as reference for the motor
 465   2                  if (((handle_value - g_ref.pos[0]) > c_mem.max_step_pos) && (c_mem.max_step_pos != 0))
 466   2                      g_ref.pos[0] += c_mem.max_step_pos;
 467   2                  else {
 468   3                      if (((handle_value - g_ref.pos[0]) < c_mem.max_step_neg) && (c_mem.max_step_neg != 0))
 469   3                          g_ref.pos[0] += c_mem.max_step_neg;
 470   3                      else
 471   3                          g_ref.pos[0] = handle_value;
 472   3                  }
 473   2                  break;
 474   2      
 475   2              case INPUT_MODE_EMG_PROPORTIONAL:
 476   2                  if (err_emg_1 > 0)
 477   2                      g_ref.pos[0] = (err_emg_1 * g_mem.pos_lim_sup[0]) / (1024 - c_mem.emg_threshold[0]);
 478   2                  else
 479   2                      g_ref.pos[0] = 0;
 480   2                  break;
 481   2      
 482   2              case INPUT_MODE_EMG_INTEGRAL:
 483   2                  g_ref.pos[0] = g_refOld.pos[0];
 484   2                  if (err_emg_1 > 0) {
 485   3                      g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * (int)g_mem.emg_speed * 2) / (1024 - c_mem.em
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 9   

             -g_threshold[0]);
 486   3                  }
 487   2                  if (err_emg_2 > 0) {
 488   3                      g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * (int)g_mem.emg_speed * 2) / (1024 - c_mem.em
             -g_threshold[1]);
 489   3                  }
 490   2                  break;
 491   2      
 492   2              case INPUT_MODE_EMG_FCFS:
 493   2                  g_ref.pos[0] = g_refOld.pos[0];
 494   2                  switch (current_emg) {
 495   3                      case 0:
 496   3                          // Look for the first EMG passing the threshold
 497   3                          if (err_emg_1 > 0) {
 498   4                              current_emg = 1;
 499   4                              break;
 500   4                          }
 501   3                          if (err_emg_2 > 0) {
 502   4                              current_emg = 2;
 503   4                              break;
 504   4                          }
 505   3                          break;
 506   3      
 507   3                      case 1:
 508   3                          // EMG 1 is first
 509   3                          if (err_emg_1 < 0) {
 510   4                              current_emg = 0;
 511   4                              break;
 512   4                          }
 513   3                          g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * g_mem.emg_speed * 2) / (1024 - c_mem.emg
             -_threshold[0]);
 514   3                          break;
 515   3      
 516   3                      case 2:
 517   3                          // EMG 2 is first
 518   3                          if (err_emg_2 < 0) {
 519   4                              current_emg = 0;
 520   4                              break;
 521   4                          }
 522   3                          g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * g_mem.emg_speed * 2) / (1024 - c_mem.emg
             -_threshold[1]);
 523   3                          break;
 524   3      
 525   3                      default:
 526   3                          break;
 527   3                  }
 528   2      
 529   2                  break;
 530   2      
 531   2              case INPUT_MODE_EMG_FCFS_ADV:
 532   2                  g_ref.pos[0] = g_refOld.pos[0];
 533   2                  switch (current_emg) {
 534   3                      // Look for the first EMG passing the threshold
 535   3                      case 0:
 536   3                          if (err_emg_1 > 0) {
 537   4                              current_emg = 1;
 538   4                              break;
 539   4                          }
 540   3                          if (err_emg_2 > 0) {
 541   4                              current_emg = 2;
 542   4                              break;
 543   4                          }
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 10  

 544   3                          break;
 545   3      
 546   3                      // EMG 1 is first
 547   3                      case 1:
 548   3                          // If both signals are under threshold go back to status 0
 549   3                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 550   4                              current_emg = 0;
 551   4                              break;
 552   4                          }
 553   3                          // but if the current signal come back over threshold, continue using it
 554   3                          if (err_emg_1 > 0) 
 555   3                              g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * g_mem.emg_speed << 2) / (1024 - c_me
             -m.emg_threshold[0]);
 556   3                          
 557   3                          break;
 558   3      
 559   3                      // EMG 2 is first
 560   3                      case 2:
 561   3                          // If both signals are under threshold go back to status 0
 562   3                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 563   4                              current_emg = 0;
 564   4                              break;
 565   4                          }
 566   3                          // but if the current signal come back over threshold, continue using it
 567   3                          if (err_emg_2 > 0) {
 568   4                              g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * c_mem.emg_speed << 2) / (1024 - c_me
             -m.emg_threshold[1]);
 569   4                          }
 570   3                          break;
 571   3      
 572   3                      default:
 573   3                          break;
 574   3                  }
 575   2      
 576   2              default:
 577   2                  break;
 578   2          }
 579   1      
 580   1          // Position limit saturation
 581   1          if (c_mem.pos_lim_flag) {
 582   2              if (g_ref.pos[0] < c_mem.pos_lim_inf[0]) 
 583   2                  g_ref.pos[0] = c_mem.pos_lim_inf[0];
 584   2              if (g_ref.pos[0] > c_mem.pos_lim_sup[0]) 
 585   2                  g_ref.pos[0] = c_mem.pos_lim_sup[0];
 586   2          }
 587   1      
 588   1          switch(c_mem.control_mode) {
 589   2              // ======================= CURRENT AND POSITION CONTROL =======================
 590   2              case CURR_AND_POS_CONTROL:
 591   2                  pos_error = g_ref.pos[0] - g_meas.pos[0];
 592   2      
 593   2                  pos_error_sum += pos_error;
 594   2      
 595   2                  // error_sum saturation
 596   2                  if (pos_error_sum > POS_INTEGRAL_SAT_LIMIT)
 597   2                      pos_error_sum = POS_INTEGRAL_SAT_LIMIT;
 598   2                  else {
 599   3                      if (pos_error_sum < -POS_INTEGRAL_SAT_LIMIT) 
 600   3                          pos_error_sum = -POS_INTEGRAL_SAT_LIMIT;
 601   3                  }
 602   2                  
 603   2                  // ------ position PID control ------
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 11  

 604   2      
 605   2                  i_ref = 0;
 606   2                  
 607   2                  // Proportional
 608   2                  if (k_p_dl != 0)
 609   2                      i_ref += (int32)(k_p_dl * pos_error) >> 16;
 610   2      
 611   2                  // Integral
 612   2                  if (k_i_dl != 0)
 613   2                      i_ref += (int32)(k_i_dl * pos_error_sum) >> 16;
 614   2      
 615   2                  // Derivative
 616   2                  if (k_d_dl != 0)
 617   2                      i_ref += (int32)(k_d_dl * (pos_error - prev_pos_err)) >> 16;
 618   2                              
 619   2                  // Update previous position
 620   2                  prev_pos_err = pos_error;
 621   2      
 622   2                  // // current set through position reference
 623   2                  // i_ref = g_ref.pos[0] >> g_mem.res[0];
 624   2      
 625   2                  // motor direction depends on i_ref
 626   2                  if (i_ref >= 0)
 627   2                      motor_dir = TRUE;
 628   2                  else
 629   2                      motor_dir = FALSE;
 630   2      
 631   2                  // current ref must be positive
 632   2                  //i_ref = abs(i_ref);
 633   2      
 634   2                  // saturate max current
 635   2                  if (i_ref > c_mem.current_limit)
 636   2                      i_ref = c_mem.current_limit;
 637   2                  else {
 638   3                      if (i_ref < -c_mem.current_limit)
 639   3                          i_ref = -c_mem.current_limit;
 640   3                      }
 641   2      
 642   2                  // saturate min current
 643   2                  /*if (i_ref < MIN_CURR_SAT_LIMIT && i_ref > 0) {
 644   2                      i_ref = MIN_CURR_SAT_LIMIT;
 645   2                  }*/
 646   2      
 647   2                  // // write i_ref on meas curr 2 for DEBUG
 648   2                  //g_meas.curr[1] = i_ref;
 649   2      
 650   2                  // current error and curr error sum
 651   2                  curr_error = i_ref - g_meas.curr[0];
 652   2                  curr_error_sum += curr_error;
 653   2                  
 654   2                  if (curr_error_sum > CURR_INTEGRAL_SAT_LIMIT)
 655   2                      curr_error_sum = CURR_INTEGRAL_SAT_LIMIT;
 656   2                  else {
 657   3                      if (curr_error_sum < -CURR_INTEGRAL_SAT_LIMIT)
 658   3                          curr_error_sum = -CURR_INTEGRAL_SAT_LIMIT;
 659   3                  }
 660   2      
 661   2                  // ----- current PID control -----
 662   2      
 663   2                  pwm_input = 0;
 664   2      
 665   2                  // Proportional
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 12  

 666   2                  if (k_p_c_dl != 0)
 667   2                      pwm_input += (int32)(k_p_c_dl * curr_error) >> 16;
 668   2      
 669   2                  // Integral
 670   2                  if (k_i_c_dl != 0)
 671   2                      pwm_input += (int32)(k_i_c_dl * curr_error_sum) >> 16;
 672   2      
 673   2                  // Derivative
 674   2                  if (k_d_c_dl != 0)
 675   2                      pwm_input += (int32)(k_d_c_dl * (curr_error - prev_curr_err)) >> 16;
 676   2      
 677   2                  // pwm_input saturation
 678   2                  if (pwm_input < -PWM_MAX_VALUE) 
 679   2                      pwm_input = -PWM_MAX_VALUE;
 680   2                  else {
 681   3                      if (pwm_input > PWM_MAX_VALUE)
 682   3                          pwm_input = PWM_MAX_VALUE;
 683   3                  }
 684   2      
 685   2                  // Update previous current
 686   2                  prev_curr_err = curr_error;
 687   2      
 688   2              break;
 689   2      
 690   2              // ============================== POSITION CONTROL =====================
 691   2              case CONTROL_ANGLE:
 692   2                  pos_error = g_ref.pos[0] - g_meas.pos[0];
 693   2      
 694   2                  pos_error_sum += pos_error;
 695   2      
 696   2                  // anti-windup (for integral control)
 697   2                  if (pos_error_sum > ANTI_WINDUP)
 698   2                      pos_error_sum = ANTI_WINDUP;
 699   2                  else {
 700   3                                      if (pos_error_sum < -ANTI_WINDUP)
 701   3                              pos_error_sum = -ANTI_WINDUP;
 702   3                  }
 703   2      
 704   2                  // Proportional
 705   2                  if (k_p != 0) 
 706   2                      pwm_input = (int32)(k_p * pos_error) >> 16;
 707   2                  
 708   2      
 709   2                  // Integral
 710   2                  if (k_i != 0) 
 711   2                      pwm_input += (int32)(k_i * pos_error_sum) >> 16;
 712   2                  
 713   2      
 714   2                  // Derivative
 715   2                  if (k_d != 0) 
 716   2                      pwm_input += (int32)(k_d * (pos_error - prev_pos_err)) >> 16;
 717   2                  
 718   2      
 719   2                  // Update measure
 720   2                  prev_pos_err = pos_error;
 721   2      
 722   2                  if (pwm_input > 0)
 723   2                      motor_dir = TRUE;
 724   2                  else
 725   2                      motor_dir = FALSE;
 726   2      
 727   2              break;
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 13  

 728   2      
 729   2              // ========================== CURRENT CONTROL ==========================
 730   2              case CONTROL_CURRENT:
 731   2                  if(g_ref.onoff && tension_valid) {
 732   3                      
 733   3                      i_ref = g_ref.curr[0];
 734   3      
 735   3                      if (i_ref > c_mem.current_limit) 
 736   3                          i_ref = c_mem.current_limit;
 737   3                      else {
 738   4                          if (i_ref < -c_mem.current_limit)
 739   4                              i_ref = -c_mem.current_limit;
 740   4                      }
 741   3                      
 742   3                      // current error
 743   3                      curr_error = i_ref - g_meas.curr[0];            
 744   3                      curr_error_sum += curr_error;
 745   3                      
 746   3                      if (curr_error_sum > CURR_INTEGRAL_SAT_LIMIT)
 747   3                          curr_error_sum = CURR_INTEGRAL_SAT_LIMIT;
 748   3                      else {
 749   4                          if (curr_error_sum < -CURR_INTEGRAL_SAT_LIMIT) 
 750   4                              curr_error_sum = -CURR_INTEGRAL_SAT_LIMIT;
 751   4                      }
 752   3      
 753   3                      pwm_input = 0;
 754   3      
 755   3                      // Proportional
 756   3                      if (k_p_c != 0)
 757   3                          pwm_input += (int32)(k_p_c * curr_error) >> 16;
 758   3      
 759   3                      // Integral
 760   3                      if (k_i_c != 0)
 761   3                          pwm_input += (int32)(k_i_c * curr_error_sum) >> 16;
 762   3      
 763   3                      // Derivative
 764   3                      if (k_d_c != 0)
 765   3                          pwm_input += (int32)(k_d_c * (curr_error - prev_curr_err)) >> 16;
 766   3                      
 767   3                      prev_curr_err = curr_error;
 768   3                      
 769   3                      if (pwm_input >= 0) 
 770   3                          motor_dir = TRUE;
 771   3                      else
 772   3                          motor_dir = FALSE;
 773   3                  }
 774   2              break;
 775   2              
 776   2              // ================= DIRECT PWM CONTROL ================================
 777   2              case CONTROL_PWM:
 778   2      
 779   2                  pwm_input = g_ref.pwm[0];
 780   2      
 781   2                  if (pwm_input > 0) 
 782   2                      motor_dir = TRUE;
 783   2                  else 
 784   2                      motor_dir = FALSE;
 785   2                  
 786   2      
 787   2                  // pwm_input saturation
 788   2                  if (pwm_input < -PWM_MAX_VALUE) 
 789   2                      pwm_input = -PWM_MAX_VALUE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 14  

 790   2                  else {
 791   3                                      if (pwm_input > PWM_MAX_VALUE) 
 792   3                              pwm_input = PWM_MAX_VALUE;
 793   3                      }
 794   2      
 795   2              break;
 796   2          
 797   2              // =============== POSITION CONTROL WITH REST CHECK =================
 798   2              case CONTROL_ANGLE_AND_REST_POS:
 799   2                  
 800   2                  if (rest_enabled == 1){
 801   3                      // Change position reference to drive motor to rest position smoothly
 802   3                      g_ref.pos[0] = rest_pos_curr_ref;
 803   3                  }
 804   2                  
 805   2                  if (forced_open == 1) {
 806   3                      // Open the SoftHand as EMG PROPORTIONAL input mode 
 807   3                      if (err_emg_2 > 0)
 808   3                          g_ref.pos[0] = g_mem.rest_pos - (err_emg_2 * g_mem.rest_pos) / (1024 - c_mem.emg_thres
             -hold[1]);
 809   3                      else {
 810   4                          g_ref.pos[0] = g_mem.rest_pos;
 811   4                          forced_open = 0;
 812   4                      }
 813   3                  }
 814   2                  
 815   2                  
 816   2                  pos_error = g_ref.pos[0] - g_meas.pos[0];
 817   2      
 818   2                  pos_error_sum += pos_error;
 819   2      
 820   2                  // anti-windup (for integral control)
 821   2                  if (pos_error_sum > ANTI_WINDUP) {
 822   3                      pos_error_sum = ANTI_WINDUP;
 823   3                  } else if (pos_error_sum < -ANTI_WINDUP) {
 824   3                      pos_error_sum = -ANTI_WINDUP;
 825   3                  }
 826   2      
 827   2                  // Proportional
 828   2                  if (k_p != 0) 
 829   2                      pwm_input = (int32)(k_p * pos_error) >> 16;
 830   2                  
 831   2      
 832   2                  // Integral
 833   2                  if (k_i != 0) 
 834   2                      pwm_input += (int32)(k_i * pos_error_sum) >> 16;
 835   2                  
 836   2      
 837   2                  // Derivative
 838   2                  if (k_d != 0) 
 839   2                      pwm_input += (int32)(k_d * (pos_error - prev_pos_err)) >> 16;
 840   2                  
 841   2      
 842   2                  // Update measure
 843   2                  prev_pos_err = pos_error;
 844   2      
 845   2                  if (pwm_input > 0)
 846   2                      motor_dir = TRUE;
 847   2                  else
 848   2                      motor_dir = FALSE;
 849   2      
 850   2              break;
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 15  

 851   2          }
 852   1      
 853   1          ////////////////////////////////////////////////////////////////////////////
 854   1      
 855   1          if(pwm_input >  PWM_MAX_VALUE) 
 856   1              pwm_input =  PWM_MAX_VALUE;
 857   1          if(pwm_input < -PWM_MAX_VALUE) 
 858   1              pwm_input = -PWM_MAX_VALUE;
 859   1      
 860   1      
 861   1          if (c_mem.control_mode != CONTROL_PWM) 
 862   1              pwm_input = (((pwm_input << 10) / PWM_MAX_VALUE) * dev_pwm_limit) >> 10;
 863   1          
 864   1      
 865   1          pwm_sign = SIGN(pwm_input);
 866   1      
 867   1          if (motor_dir)
 868   1              MOTOR_DIR_Write(0x01);
 869   1          else
 870   1              MOTOR_DIR_Write(0x00);
 871   1      
 872   1          PWM_MOTORS_WriteCompare1(abs(pwm_input));
 873   1      }
 874          
 875          //==============================================================================
 876          //                                                                   ENCODER READING
 877          //==============================================================================
 878          
 879          void encoder_reading(const uint8 idx) {
 880   1      
 881   1          uint8 CYDATA index = idx;
 882   1          
 883   1          uint8 jj;
 884   1          
 885   1          uint32 data_encoder;
 886   1          int32 value_encoder;
 887   1          int32 speed_encoder;
 888   1          //int32 accel_encoder;
 889   1          int32 aux;
 890   1          int32 init_rot = 0;
 891   1      
 892   1          static int32 last_value_encoder[NUM_OF_SENSORS];
 893   1      
 894   1          static uint8 error[NUM_OF_SENSORS];
 895   1          
 896   1          static CYBIT only_first_time = TRUE;
 897   1      
 898   1          static uint8 one_time_execute = 0;
 899   1          static CYBIT pos_reconstruct = FALSE;
 900   1      
 901   1          static int32 v_value[NUM_OF_SENSORS];   //last value for velocity
 902   1          static int32 vv_value[NUM_OF_SENSORS];  //last last value for velocity
 903   1          static int32 vvv_value[NUM_OF_SENSORS];  //last last last value for velocity
 904   1          
 905   1          //static int32 a_value[NUM_OF_SENSORS];   //last value for acceleration
 906   1          //static int32 aa_value[NUM_OF_SENSORS];  //last last value for acceleration
 907   1          //static int32 aaa_value[NUM_OF_SENSORS];  //last last last value for acceleration
 908   1      
 909   1          if (index >= NUM_OF_SENSORS)
 910   1              return;
 911   1          
 912   1          if (reset_last_value_flag) {
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 16  

 913   2              for (jj = NUM_OF_SENSORS; jj--;) 
 914   2                  last_value_encoder[jj] = 0;
 915   2              
 916   2              reset_last_value_flag = 0;
 917   2          }
 918   1      
 919   1          //======================================================     reading sensors
 920   1              // Shift 1 right to erase Dummy bit of chain
 921   1          if (index == 0)
 922   1                  data_encoder = (SHIFTREG_ENC_1_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 923   1          else {
 924   2              if (index == 1)
 925   2                  data_encoder = (SHIFTREG_ENC_2_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 926   2              else // index == 2
 927   2                  data_encoder = (SHIFTREG_ENC_3_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 928   2          }
 929   1             
 930   1      
 931   1          if (check_enc_data(&data_encoder)) {
 932   2      
 933   2              value_encoder = (int16) (((data_encoder & 0x3FFC0) - 0x20000) >> 2 ) + g_mem.m_off[index];
 934   2                                                          // reset last 6 bit 
 935   2                                                          // -> |:|:|id|dim|CMD|CHK|(data---
 936   2                                                          // subtract half of max value
 937   2                                                          // and shift to have 16 bit val
 938   2      
 939   2              // Initialize last_value_encoder
 940   2              if (only_first_time) {
 941   3                  last_value_encoder[index] = value_encoder;
 942   3                  if (index == 2)
 943   3                      only_first_time = 0;
 944   3              }
 945   2      
 946   2              // Take care of rotations
 947   2              aux = value_encoder - last_value_encoder[index];
 948   2      
 949   2              // ====================== 1 TURN ======================
 950   2              // -32768                    0                    32767 -32768                   0                
             -     32767
 951   2              // |-------------------------|-------------------------|-------------------------|----------------
             ----------|
 952   2              //              |                         |      |           |      |                         |
 953   2              //           -16384                     16383    |           |   -16384                     16383
 954   2              //                                               |           |
 955   2              //                                           24575           -24576
 956   2              //                                               |___________|
 957   2              //                                                   49152
 958   2      
 959   2              // if we are in the right interval, take care of rotation
 960   2              // and update the variable only if the difference between
 961   2              // one measure and another is less than 1/4 of turn
 962   2      
 963   2              // Considering we are sampling at 1kHz, this means that our shaft needs
 964   2              // to go slower than 1/4 turn every ms -> 1 turn every 4ms
 965   2              // equal to 250 turn/s -> 15000 RPM
 966   2      
 967   2              if (aux > 49152)
 968   2                  g_meas.rot[index]--;
 969   2              else{ 
 970   3                  if (aux < -49152)
 971   3                      g_meas.rot[index]++;
 972   3                  else{
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 17  

 973   4                      if (abs(aux) > 16384) { // if two measure are too far
 974   5                          error[index]++;
 975   5                          if (error[index] < 10)
 976   5                              // Discard
 977   5                              return;
 978   5                      }
 979   4                  }
 980   3              }
 981   2      
 982   2              error[index] = 0;
 983   2      
 984   2              last_value_encoder[index] = value_encoder;
 985   2      
 986   2              value_encoder += (int32)g_meas.rot[index] << 16;
 987   2      
 988   2              if (c_mem.m_mult[index] != 1.0) {
 989   3                  value_encoder *= c_mem.m_mult[index];
 990   3              }
 991   2      
 992   2              g_meas.pos[index] = value_encoder;
 993   2          }
 994   1          
 995   1          switch(index) {
 996   2              case 0:
 997   2                  speed_encoder = (int16)filter_vel_1((11*value_encoder - 18* v_value[0] + 9 * vv_value[0] -2 * 
             -vvv_value[0]));
 998   2              break;
 999   2       
1000   2              case 1:
1001   2                  speed_encoder = (int16)filter_vel_2((11*value_encoder - 18* v_value[1] + 9 * vv_value[1] -2 * 
             -vvv_value[1]));
1002   2              break;
1003   2          
1004   2              case 2:
1005   2                  speed_encoder = (int16)filter_vel_3((11*value_encoder - 18* v_value[2] + 9 * vv_value[2] -2 * 
             -vvv_value[2]));
1006   2              break;
1007   2          }
1008   1          //Update current speed
1009   1          speed_encoder = speed_encoder / (6*cycle_time);
1010   1          g_meas.vel[index] = speed_encoder;
1011   1          
1012   1          /*
1013   1          //Encoder rotational acceleration calculation
1014   1          switch(index) {
1015   1              case 0:
1016   1                  accel_encoder = (int16)filter_acc_1((11*speed_encoder - 18* a_value[0] + 9 * aa_value[0] -2* a
             -aa_value[0] ));
1017   1                  break;
1018   1              
1019   1              case 1:
1020   1                  accel_encoder = (int16)filter_acc_2((11*speed_encoder - 18* a_value[1] + 9 * aa_value[1] -2* a
             -aa_value[1] ));
1021   1                  break;
1022   1              
1023   1              case 2:
1024   1                  accel_encoder = (int16)filter_acc_3((11*speed_encoder - 18* a_value[2] + 9 * aa_value[2] -2* a
             -aa_value[2] ));
1025   1                  break;
1026   1          }
1027   1          //Update current acceleration
1028   1          g_meas.acc[index] = accel_encoder / (6*cycle_time);
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 18  

1029   1          */
1030   1      
1031   1          // update old velocity and acceleration values
1032   1          vvv_value[index] = vv_value[index];
1033   1          vv_value[index] = v_value[index];
1034   1          v_value[index] = value_encoder;
1035   1      
1036   1          /*
1037   1          aaa_value[index] = aa_value[index];
1038   1          aa_value[index] = a_value[index];
1039   1          a_value[index] = speed_encoder;
1040   1          */
1041   1      
1042   1      
1043   1          // wait at least 3 * max_num_of_error (10) + 5 = 35 cycles to reconstruct the right turn
1044   1          if (pos_reconstruct == FALSE){
1045   2              if (one_time_execute < 34) 
1046   2                  one_time_execute++;
1047   2              else {
1048   3                  //Double encoder translation
1049   3                  if (c_mem.double_encoder_on_off){
1050   4      
1051   4                      init_rot = calc_turns_fcn(g_meas.pos[0],g_meas.pos[1]);
1052   4                      
1053   4                      if (c_mem.m_mult[0] < 0)
1054   4                          init_rot = -init_rot;
1055   4                      
1056   4                      g_meas.rot[0] = (int8)init_rot;
1057   4      
1058   4                  }
1059   3      
1060   3                  if (c_mem.m_mult != 1.0)
1061   3                      g_meas.pos[0] /= c_mem.m_mult[0];
1062   3                  
1063   3                  g_meas.pos[0] += (int32)(init_rot << 16);
1064   3                  
1065   3                  if (c_mem.m_mult != 1.0)
1066   3                      g_meas.pos[0] *= c_mem.m_mult[0];
1067   3                          
1068   3                  // If necessary activate motors
1069   3                  g_refNew.pos[0] = g_meas.pos[0];
1070   3      
1071   3                  MOTOR_ON_OFF_Write(g_ref.onoff);
1072   3                  
1073   3                  pos_reconstruct = TRUE;
1074   3              }
1075   2          }
1076   1      }
1077          
1078          //==============================================================================
1079          //                                                           ANALOG MEASUREMENTS
1080          //==============================================================================
1081          
1082          void analog_read_end() {
1083   1      
1084   1          /* =========================================================================
1085   1          /   Ideal formulation to calculate tension and current
1086   1          /
1087   1          /   tension = ((read_value_mV - offset) * 101) / gain -> [mV]
1088   1          /   current = ((read_value_mV - offset) * 375) / (gain * resistor) -> [mA]
1089   1          /
1090   1          /   Definition:
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 19  

1091   1          /   read_value_mV = counts_read / 0.819 -> conversion from counts to mV
1092   1          /   offset = 2000 -> hardware amplifier bias in mV
1093   1          /   gain = 8.086 -> amplifier gain
1094   1          /   resistor = 18 -> resistor of voltage divider in KOhm 
1095   1          /
1096   1          /   Real formulation: tradeoff in good performance and accurancy, ADC_buf[] 
1097   1          /   and offset unit of measurment is counts, instead dev_tension and
1098   1          /   g_meas.curr[] are converted in properly unit.
1099   1          /  =========================================================================
1100   1          */
1101   1      
1102   1          int32 CYDATA i_aux;
1103   1      
1104   1          static emg_status CYDATA emg_1_status = RESET; 
1105   1          static emg_status CYDATA emg_2_status = RESET;                                             
1106   1          
1107   1          static uint16 emg_counter_1 = 0;
1108   1          static uint16 emg_counter_2 = 0;
1109   1              static uint8 first_tension_valid = TRUE;
1110   1          static int32 pow_tension = 12000;       //12000 mV (12 V)
1111   1          static uint8 count = 0;
1112   1          static uint32 count2 = 0;
1113   1      
1114   1      
1115   1          // Wait for conversion end
1116   1          
1117   1          while(!ADC_STATUS_Read()){
1118   2              if (interrupt_flag){
1119   3                  interrupt_flag = FALSE;
1120   3                  interrupt_manager();
1121   3              }
1122   2          }
1123   1          
1124   1          // Convert tension read
1125   1          dev_tension = ((int32)(ADC_buf[0] - 1638) * 1952) >> 7;
1126   1          
1127   1          if (interrupt_flag){
1128   2              interrupt_flag = FALSE;
1129   2              interrupt_manager();
1130   2          }
1131   1              if (first_tension_valid && tension_valid) {
1132   2              count = count + 1;
1133   2              
1134   2              if (count == 1000){
1135   3                  if (dev_tension < 9000) {   // 8 V case
1136   4                      pow_tension = 8000;
1137   4                  }
1138   3                  else {      // 12 V - 24 V cases
1139   4                      if (dev_tension < 13000) {
1140   5                          pow_tension = 12000;
1141   5                      }
1142   4                      else
1143   4                          pow_tension = 24000;
1144   4                  }
1145   3      
1146   3                  first_tension_valid = FALSE;
1147   3              }
1148   2          }
1149   1      
1150   1          // Until there is no valid input tension repeat this measurement
1151   1          
1152   1          if (dev_tension > 7000) {       //at least > 7.36 V (92% of 8 V) that is minimum charge of smallest ba
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 20  

             -ttery
1153   2              // Set tension valid bit to TRUE
1154   2      
1155   2              if (count2 == 1000){
1156   3                  tension_valid = TRUE;   
1157   3              }
1158   2              else {                      // wait for battery voltage stabilization
1159   3                  count2 = count2 + 1;
1160   3                  dev_tension_f = filter_voltage(dev_tension);
1161   3              }
1162   2      
1163   2              if(g_mem.activate_pwm_rescaling)        //pwm rescaling is activated
1164   2                  pwm_limit_search();                 //only for 12V motors
1165   2      
1166   2              // Filter and Set currents
1167   2              g_meas.curr[0] = filter_i1((int16) (((int32)(ADC_buf[1] - 1638) * 25771) >> 13) * pwm_sign);
1168   2              
1169   2                      // Calculate current estimation and put it in the second part of the current measurement array;
1170   2                      g_meas.curr[1] = (int16) filter_curr_diff(((int32) g_meas.curr[0]) - curr_estim(g_meas.pos[0] >> g_mem.r
             -es[0], g_meas.vel[0] >> g_mem.res[0], g_ref.pos[0] >> g_mem.res[0]));
1171   2      
1172   2              // Check Interrupt 
1173   2          
1174   2              if (interrupt_flag){
1175   3                  interrupt_flag = FALSE;
1176   3                  interrupt_manager();
1177   3              }
1178   2      
1179   2              // if calibration is not needed go to "normal execution"
1180   2              if (!g_mem.emg_calibration_flag){
1181   3                  emg_1_status = NORMAL; // normal execution
1182   3                  emg_2_status = NORMAL; // normal execution
1183   3              }
1184   2      
1185   2              // EMG 1 calibration state machine
1186   2              
1187   2              // Calibration state machine
1188   2              switch(emg_1_status) {
1189   3                  case NORMAL: // normal execution
1190   3                      i_aux = (int32)ADC_buf[2];
1191   3                      i_aux = filter_ch1(i_aux);
1192   3                      i_aux = (i_aux << 10) / g_mem.emg_max_value[0];
1193   3          
1194   3                      if (interrupt_flag){
1195   4                          interrupt_flag = FALSE;
1196   4                          interrupt_manager();
1197   4                      }
1198   3                      //Saturation
1199   3                      if (i_aux < 0)
1200   3                          i_aux = 0;
1201   3                      else
1202   3                          if (i_aux > 1024) 
1203   3                              i_aux = 1024;
1204   3                      
1205   3                      g_meas.emg[0] = i_aux;
1206   3          
1207   3                      if (interrupt_flag){
1208   4                          interrupt_flag = FALSE;
1209   4                          interrupt_manager();
1210   4                      }
1211   3                      
1212   3                      break;
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 21  

1213   3      
1214   3                  case RESET: // reset variables
1215   3                      emg_counter_1 = 0;
1216   3                      g_mem.emg_max_value[0] = 0;
1217   3                      emg_1_status = DISCARD; // goto next status
1218   3                      
1219   3                      break;
1220   3      
1221   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1222   3                      emg_counter_1++;
1223   3                      if (emg_counter_1 == EMG_SAMPLE_TO_DISCARD) {
1224   4                          emg_counter_1 = 0;          // reset counter
1225   4                          
1226   4                          LED_CTRL_Write(1);
1227   4                          LED_BLINK_EN_Write(0);
1228   4                              
1229   4                          if (interrupt_flag){
1230   5                              interrupt_flag = FALSE;
1231   5                              interrupt_manager();
1232   5                          }
1233   4                          
1234   4                          emg_1_status = SUM_AND_MEAN;           // sum and mean status
1235   4                      }
1236   3                      break;
1237   3      
1238   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1239   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1240   3                      emg_counter_1++;
1241   3                      g_mem.emg_max_value[0] += filter_ch1((int32)ADC_buf[2]);
1242   3                      
1243   3                      if (interrupt_flag){
1244   4                          interrupt_flag = FALSE;
1245   4                          interrupt_manager();
1246   4                      }
1247   3                      
1248   3                      if (emg_counter_1 == SAMPLES_FOR_EMG_MEAN) {
1249   4                          g_mem.emg_max_value[0] = g_mem.emg_max_value[0] / SAMPLES_FOR_EMG_MEAN; // calc mean
1250   4          
1251   4                          if (interrupt_flag){
1252   5                              interrupt_flag = FALSE;
1253   5                              interrupt_manager();
1254   5                          }                    
1255   4                          
1256   4                          LED_CTRL_Write(0);
1257   4                          LED_BLINK_EN_Write(0);
1258   4                          
1259   4                          emg_counter_1 = 0;          // reset counter
1260   4      
1261   4                          emg_1_status = NORMAL;           // goto normal execution
1262   4                      }
1263   3                      break;
1264   3      
1265   3                  default:
1266   3                      break;
1267   3              }
1268   2          
1269   2              if (interrupt_flag){
1270   3                  interrupt_flag = FALSE;
1271   3                  interrupt_manager();
1272   3              }
1273   2              // EMG 2 calibration state machine
1274   2              switch(emg_2_status) {
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 22  

1275   3                  case NORMAL: // normal execution
1276   3                      i_aux = (int32)ADC_buf[3];
1277   3                      i_aux = filter_ch2(i_aux);
1278   3                      i_aux = (i_aux << 10) / g_mem.emg_max_value[1];
1279   3          
1280   3                      if (interrupt_flag){
1281   4                          interrupt_flag = FALSE;
1282   4                          interrupt_manager();
1283   4                      }
1284   3                      
1285   3                      if (i_aux < 0) 
1286   3                          i_aux = 0;
1287   3                      else
1288   3                          if (i_aux > 1024)
1289   3                              i_aux = 1024;
1290   3                      
1291   3                      g_meas.emg[1] = i_aux;
1292   3      
1293   3                      break;
1294   3      
1295   3                  case RESET: // reset variables
1296   3                      emg_counter_2 = 0;
1297   3                      g_mem.emg_max_value[1] = 0;
1298   3          
1299   3                      if (interrupt_flag){
1300   4                          interrupt_flag = FALSE;
1301   4                          interrupt_manager();
1302   4                      }
1303   3                      
1304   3                      emg_2_status = WAIT; // wait for EMG 1 calibration
1305   3                      break;
1306   3      
1307   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1308   3                      emg_counter_2++;
1309   3                      if (emg_counter_2 == EMG_SAMPLE_TO_DISCARD) {
1310   4                          emg_counter_2 = 0;          // reset counter
1311   4                          
1312   4                          LED_CTRL_Write(1);
1313   4                          LED_BLINK_EN_Write(0);
1314   4          
1315   4                          if (interrupt_flag){
1316   5                              interrupt_flag = FALSE;
1317   5                              interrupt_manager();
1318   5                          }
1319   4                          
1320   4                          emg_2_status = SUM_AND_MEAN;           // sum and mean status
1321   4                      }
1322   3                      break;
1323   3      
1324   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1325   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1326   3                      emg_counter_2++;
1327   3                      g_mem.emg_max_value[1] += filter_ch2((int32)ADC_buf[3]);
1328   3          
1329   3                      if (interrupt_flag){
1330   4                          interrupt_flag = FALSE;
1331   4                          interrupt_manager();
1332   4                      }
1333   3                      
1334   3                      if (emg_counter_2 == SAMPLES_FOR_EMG_MEAN) {
1335   4                          g_mem.emg_max_value[1] = g_mem.emg_max_value[1] / SAMPLES_FOR_EMG_MEAN; // calc mean
1336   4                          
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 23  

1337   4                          LED_CTRL_Write(0);
1338   4                          LED_BLINK_EN_Write(0);
1339   4                          
1340   4                          emg_counter_2 = 0;          // reset counter
1341   4                      
1342   4                          if (interrupt_flag){
1343   5                              interrupt_flag = FALSE;
1344   5                              interrupt_manager();
1345   5                          }
1346   4                          
1347   4                          emg_2_status = WAIT_EoC;           // goto end of calibration wait
1348   4                      }
1349   3                      break;
1350   3      
1351   3                  case WAIT: // wait for EMG calibration to be done
1352   3                      if (emg_1_status == NORMAL)
1353   3                          emg_2_status = DISCARD;           // goto discard sample
1354   3                      break;
1355   3      
1356   3                  case WAIT_EoC:  // wait for end of calibration procedure (only for LED visibility reasons)
1357   3                      emg_counter_2++;
1358   3                      if (emg_counter_2 == EMG_SAMPLE_TO_DISCARD) {
1359   4                          emg_counter_2 = 0;          // reset counter
1360   4      
1361   4                          if (interrupt_flag){
1362   5                              interrupt_flag = FALSE;
1363   5                              interrupt_manager();
1364   5                          }
1365   4                          
1366   4                          // if EMG control mode active, activate motors accordingly with startup value
1367   4                          if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
1368   4                              (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1369   4                              (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1370   4                              (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1371   5                              if (c_mem.control_mode == CONTROL_ANGLE) {
1372   6                                  g_ref.pos[0] = g_meas.pos[0];
1373   6                                  g_ref.pos[1] = g_meas.pos[1];
1374   6                              }
1375   5                              g_ref.onoff = c_mem.activ;
1376   5                              MOTOR_ON_OFF_Write(g_ref.onoff);
1377   5                          }
1378   4                              
1379   4                          emg_2_status = NORMAL;           // goto normal execution
1380   4                      }
1381   3                      break;
1382   3                      
1383   3                  default:
1384   3                      break;
1385   3              }
1386   2                  
1387   2              if (interrupt_flag){
1388   3                  interrupt_flag = FALSE;
1389   3                  interrupt_manager();
1390   3              }
1391   2          }
1392   1          else {
1393   2      
1394   2              emg_1_status = RESET; 
1395   2              emg_2_status = RESET;
1396   2      
1397   2              tension_valid = FALSE;
1398   2                      //fixed
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 24  

1399   2              LED_CTRL_Write(1);
1400   2              //PWM Blink Enable
1401   2              LED_BLINK_EN_Write(0);
1402   2                  
1403   2              if (interrupt_flag){
1404   3                  interrupt_flag = FALSE;
1405   3                  interrupt_manager();
1406   3              }
1407   2              
1408   2              if (c_mem.emg_calibration_flag) {
1409   3                  if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
1410   3                      (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1411   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1412   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1413   4                      g_ref.onoff = 0x00;
1414   4                      MOTOR_ON_OFF_Write(g_ref.onoff);
1415   4                  }
1416   3              }
1417   2      
1418   2              // Reset current
1419   2              g_meas.curr[0] = 0;
1420   2      
1421   2              // Reset emg
1422   2              g_meas.emg[0] = 0;
1423   2              g_meas.emg[1] = 0;
1424   2      
1425   2          }
1426   1              // The board LED blinks if attached battery is not fully charged
1427   1          if (!first_tension_valid && tension_valid == TRUE && emg_1_status == NORMAL && emg_2_status == NORMAL)
             -{
1428   2              dev_tension_f = filter_voltage(dev_tension);
1429   2              if (dev_tension_f > 0.92 * pow_tension){        // Sometimes pow_tension is not well computed when
             - using power supply
1430   3                  //fixed
1431   3                  LED_CTRL_Write(1);
1432   3                  
1433   3                  //PWM Blink Enable
1434   3                  LED_BLINK_EN_Write(0);
1435   3              }
1436   2              else {
1437   3                  // blink
1438   3                  LED_CTRL_Write(0);
1439   3                  
1440   3                  //PWM Blink Enable
1441   3                  LED_BLINK_EN_Write(1);
1442   3                  
1443   3                  // Disable motors because of not fully charged battery
1444   3                  g_refNew.onoff = 0x00;
1445   3                  MOTOR_ON_OFF_Write(g_refNew.onoff); // Deactivate motors
1446   3              }
1447   2          }
1448   1              
1449   1          if (interrupt_flag){
1450   2              interrupt_flag = FALSE;
1451   2              interrupt_manager();
1452   2          }
1453   1      }
1454          
1455          //==============================================================================
1456          //                                                           OVERCURRENT CONTROL
1457          //==============================================================================
1458          
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 25  

1459          void overcurrent_control() {
1460   1          if (c_mem.current_limit != 0) {
1461   2              // if the current is over the limit
1462   2              if (g_meas.curr[0] > c_mem.current_limit) {
1463   3                  //decrese pwm_limit
1464   3                  dev_pwm_limit--;
1465   3              // if the current is in the safe zone
1466   3              } else if (g_meas.curr[0] < (c_mem.current_limit - CURRENT_HYSTERESIS)) {
1467   3                  //increase pwm_limit
1468   3                  dev_pwm_limit++;
1469   3              }
1470   2      
1471   2              // Bound pwm_limit
1472   2              if (dev_pwm_limit < 0) 
1473   2                  dev_pwm_limit = 0;
1474   2              else 
1475   2                  if (dev_pwm_limit > dev_pwm_sat) 
1476   2                      dev_pwm_limit = dev_pwm_sat;
1477   2          }
1478   1      }
1479          
1480          //==============================================================================
1481          //                                                              PWM_LIMIT_SEARCH
1482          //==============================================================================
1483          
1484          void pwm_limit_search() {
1485   1      
1486   1          uint8 CYDATA index;
1487   1      
1488   1          if (dev_tension > 25500) {
1489   2              dev_pwm_sat = 0;
1490   2          } else if (dev_tension < 11500) {
1491   2              dev_pwm_sat = 100;
1492   2          } else {
1493   2              index = (uint8)((dev_tension - 11500) >> 9);
1494   2              dev_pwm_sat = pwm_preload_values[index];
1495   2          }
1496   1      }
1497          /* [] END OF FILE */
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 26  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION ISR_WATCHDOG_Handler (BEGIN)
                                           ; SOURCE LINE # 102
                                           ; SOURCE LINE # 106
0000 D200        E     SETB    watchdog_flag
                                           ; SOURCE LINE # 108
0002 32                RETI    
             ; FUNCTION ISR_WATCHDOG_Handler (END)

             ; FUNCTION ISR_RS485_RX_ExInterrupt (BEGIN)
                                           ; SOURCE LINE # 114
                                           ; SOURCE LINE # 118
0000 D200        E     SETB    interrupt_flag
                                           ; SOURCE LINE # 120
0002 32                RETI    
             ; FUNCTION ISR_RS485_RX_ExInterrupt (END)

             ; FUNCTION interrupt_manager (BEGIN)
                                           ; SOURCE LINE # 137
                                           ; SOURCE LINE # 153
0000 E4                CLR     A
0001 F500        R     MOV     package_count,A
0003         ?C0003:
                                           ; SOURCE LINE # 159
0003 120000      E     LCALL   UART_RS485_GetRxBufferSize
0006 EF                MOV     A,R7
0007 7003              JNZ     $ + 5H
0009 020000      R     LJMP    ?C0026
000C E500        R     MOV     A,package_count
000E C3                CLR     C
000F 9406              SUBB    A,#06H
0011 4003              JC      $ + 5H
0013 020000      R     LJMP    ?C0026
                                           ; SOURCE LINE # 163
0016 120000      E     LCALL   UART_RS485_GetChar
0019 8F00        R     MOV     rx_data,R7
                                           ; SOURCE LINE # 165
001B E500        R     MOV     A,state
001D 14                DEC     A
001E 6049              JZ      ?C0010
0020 14                DEC     A
0021 6060              JZ      ?C0014
0023 14                DEC     A
0024 7003              JNZ     $ + 5H
0026 020000      R     LJMP    ?C0021
0029 14                DEC     A
002A 7003              JNZ     $ + 5H
002C 020000      R     LJMP    ?C0024
002F 2404              ADD     A,#04H
0031 70D0              JNZ     ?C0003
                                           ; SOURCE LINE # 167
0033         ?C0006:
                                           ; SOURCE LINE # 169
0033 850000      R     MOV     rx_queue,rx_queue+01H
                                           ; SOURCE LINE # 170
0036 850000      R     MOV     rx_queue+01H,rx_queue+02H
                                           ; SOURCE LINE # 171
0039 850000      R     MOV     rx_queue+02H,rx_data
                                           ; SOURCE LINE # 174
003C E500        R     MOV     A,rx_queue+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 27  

003E B43A11            CJNE    A,#03AH,?C0007
0041 E500        R     MOV     A,rx_queue+02H
0043 B43A0C            CJNE    A,#03AH,?C0007
                                           ; SOURCE LINE # 175
0046 E4                CLR     A
0047 F500        R     MOV     rx_queue,A
                                           ; SOURCE LINE # 176
0049 F500        R     MOV     rx_queue+01H,A
                                           ; SOURCE LINE # 177
004B F500        R     MOV     rx_queue+02H,A
                                           ; SOURCE LINE # 178
004D 750001      R     MOV     state,#01H
                                           ; SOURCE LINE # 179
0050 80B1              SJMP    ?C0003
0052         ?C0007:
                                           ; SOURCE LINE # 180
0052 E500        R     MOV     A,rx_queue
0054 B43FAC            CJNE    A,#03FH,?C0003
0057 E500        R     MOV     A,rx_queue+01H
0059 B40DA7            CJNE    A,#0DH,?C0003
005C E500        R     MOV     A,rx_queue+02H
005E 640A              XRL     A,#0AH
0060 70A1              JNZ     ?C0003
                                           ; SOURCE LINE # 183
0062 FF                MOV     R7,A
0063 FE                MOV     R6,A
0064 120000      E     LCALL   _infoGet
                                           ; SOURCE LINE # 184
0067 809A              SJMP    ?C0003
                                           ; SOURCE LINE # 187
0069         ?C0010:
                                           ; SOURCE LINE # 190
0069 900000      E     MOV     DPTR,#c_mem+01H
006C E0                MOVX    A,@DPTR
006D 6500        R     XRL     A,rx_data
006F 6004              JZ      ?C0012
0071 E500        R     MOV     A,rx_data
0073 7004              JNZ     ?C0011
0075         ?C0012:
                                           ; SOURCE LINE # 191
0075 C200        R     CLR     rx_data_type
0077 8002              SJMP    ?C0013
0079         ?C0011:
                                           ; SOURCE LINE # 193
0079 D200        R     SETB    rx_data_type
007B         ?C0013:
                                           ; SOURCE LINE # 195
007B E4                CLR     A
007C F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 196
007E 750002      R     MOV     state,#02H
                                           ; SOURCE LINE # 197
0081 8080              SJMP    ?C0003
                                           ; SOURCE LINE # 200
0083         ?C0014:
                                           ; SOURCE LINE # 203
0083 850000      R     MOV     data_packet_length,rx_data
                                           ; SOURCE LINE # 205
0086 E500        R     MOV     A,data_packet_length
0088 D3                SETB    C
0089 9401              SUBB    A,#01H
008B 5008              JNC     ?C0015
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 28  

                                           ; SOURCE LINE # 206
008D E4                CLR     A
008E F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 207
0090 F500        R     MOV     state,A
                                           ; SOURCE LINE # 208
0092 020000      R     LJMP    ?C0003
0095         ?C0015:
0095 E500        R     MOV     A,data_packet_length
0097 D3                SETB    C
0098 9480              SUBB    A,#080H
009A 4008              JC      ?C0017
                                           ; SOURCE LINE # 209
009C E4                CLR     A
009D F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 210
009F F500        R     MOV     state,A
                                           ; SOURCE LINE # 211
00A1 020000      R     LJMP    ?C0003
00A4         ?C0017:
                                           ; SOURCE LINE # 212
00A4 E4                CLR     A
00A5 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 214
00A7 200006            JB      rx_data_type,?C0019
                                           ; SOURCE LINE # 215
00AA 750003      R     MOV     state,#03H
00AD 020000      R     LJMP    ?C0003
00B0         ?C0019:
                                           ; SOURCE LINE # 217
00B0 750004      R     MOV     state,#04H
                                           ; SOURCE LINE # 218
                                           ; SOURCE LINE # 219
00B3 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 222
00B6         ?C0021:
                                           ; SOURCE LINE # 224
00B6 7400        R     MOV     A,#LOW data_packet_buffer
00B8 2500        R     ADD     A,data_packet_index
00BA F582              MOV     DPL,A
00BC E4                CLR     A
00BD 3400        R     ADDC    A,#HIGH data_packet_buffer
00BF F583              MOV     DPH,A
00C1 E500        R     MOV     A,rx_data
00C3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 225
00C4 0500        R     INC     data_packet_index
                                           ; SOURCE LINE # 228
00C6 E500        R     MOV     A,data_packet_index
00C8 C3                CLR     C
00C9 9500        R     SUBB    A,data_packet_length
00CB 5003              JNC     $ + 5H
00CD 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 230
00D0 200025            JB      rx_data_type,?C0023
                                           ; SOURCE LINE # 232
00D3 AF00        R     MOV     R7,data_packet_length
00D5 7E00              MOV     R6,#00H
00D7 7800        E     MOV     R0,#LOW g_rx
00D9 7C00        E     MOV     R4,#HIGH g_rx
00DB 7D01              MOV     R5,#01H
00DD 7B01              MOV     R3,#01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 29  

00DF 7A00        R     MOV     R2,#HIGH data_packet_buffer
00E1 7900        R     MOV     R1,#LOW data_packet_buffer
00E3 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 233
00E6 900000      E     MOV     DPTR,#g_rx+080H
00E9 E4                CLR     A
00EA F0                MOVX    @DPTR,A
00EB A3                INC     DPTR
00EC E500        R     MOV     A,data_packet_length
00EE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 234
00EF 900000      E     MOV     DPTR,#g_rx+084H
00F2 7401              MOV     A,#01H
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 235
00F5 120000      E     LCALL   commProcess
                                           ; SOURCE LINE # 236
00F8         ?C0023:
                                           ; SOURCE LINE # 238
00F8 E4                CLR     A
00F9 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 239
00FB F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 240
00FD F500        R     MOV     state,A
                                           ; SOURCE LINE # 241
00FF 0500        R     INC     package_count
                                           ; SOURCE LINE # 243
                                           ; SOURCE LINE # 244
0101 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 247
0104         ?C0024:
                                           ; SOURCE LINE # 248
0104 1500        R     DEC     data_packet_length
0106 E500        R     MOV     A,data_packet_length
0108 6003              JZ      $ + 5H
010A 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 249
010D F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 250
010F F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 251
0111 7F01              MOV     R7,#01H
0113 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 252
0116 E4                CLR     A
0117 FF                MOV     R7,A
0118 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 253
011B E4                CLR     A
011C F500        R     MOV     state,A
                                           ; SOURCE LINE # 254
011E 0500        R     INC     package_count
                                           ; SOURCE LINE # 255
                                           ; SOURCE LINE # 256
0120 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 257
                                           ; SOURCE LINE # 258
0123 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 259
0126         ?C0026:
0126 22                RET     
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 30  

             ; FUNCTION interrupt_manager (END)

             ; FUNCTION function_scheduler (BEGIN)
                                           ; SOURCE LINE # 268
                                           ; SOURCE LINE # 272
0000 120000      E     LCALL   MY_TIMER_ReadCounter
0003 900000      E     MOV     DPTR,#timer_value0
0006 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 276
0009 7F01              MOV     R7,#01H
000B 120000      E     LCALL   _ADC_SOC_Write
                                           ; SOURCE LINE # 280
000E 300005            JNB     interrupt_flag,?C0027
                                           ; SOURCE LINE # 281
0011 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 282
0013 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 283
0016         ?C0027:
                                           ; SOURCE LINE # 287
0016 E4                CLR     A
0017 FF                MOV     R7,A
0018 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 291
001B 300005            JNB     interrupt_flag,?C0028
                                           ; SOURCE LINE # 292
001E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 293
0020 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 294
0023         ?C0028:
                                           ; SOURCE LINE # 296
0023 7F01              MOV     R7,#01H
0025 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 300
0028 300005            JNB     interrupt_flag,?C0029
                                           ; SOURCE LINE # 301
002B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 302
002D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 303
0030         ?C0029:
                                           ; SOURCE LINE # 305
0030 7F02              MOV     R7,#02H
0032 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 309
0035 300005            JNB     interrupt_flag,?C0030
                                           ; SOURCE LINE # 310
0038 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 311
003A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 312
003D         ?C0030:
                                           ; SOURCE LINE # 316
003D 120000      R     LCALL   motor_control
                                           ; SOURCE LINE # 320
0040 300005            JNB     interrupt_flag,?C0031
                                           ; SOURCE LINE # 321
0043 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 322
0045 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 323
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 31  

0048         ?C0031:
                                           ; SOURCE LINE # 327
0048 120000      R     LCALL   analog_read_end
                                           ; SOURCE LINE # 329
004B 300005            JNB     interrupt_flag,?C0032
                                           ; SOURCE LINE # 330
004E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 331
0050 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 332
0053         ?C0032:
                                           ; SOURCE LINE # 336
0053 120000      R     LCALL   overcurrent_control
                                           ; SOURCE LINE # 340
0056 300005            JNB     interrupt_flag,?C0033
                                           ; SOURCE LINE # 341
0059 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 342
005B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 343
005E         ?C0033:
                                           ; SOURCE LINE # 348
005E 900000      E     MOV     DPTR,#calib
0061 E0                MOVX    A,@DPTR
0062 B40124            CJNE    A,#01H,?C0034
                                           ; SOURCE LINE # 349
0065 900000      R     MOV     DPTR,#counter_calibration
0068 E0                MOVX    A,@DPTR
0069 7004              JNZ     ?C0264
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D 640A              XRL     A,#0AH
006F         ?C0264:
006F 700A              JNZ     ?C0035
                                           ; SOURCE LINE # 350
0071 120000      E     LCALL   calibration
                                           ; SOURCE LINE # 351
0074 E4                CLR     A
0075 900000      R     MOV     DPTR,#counter_calibration
0078 F0                MOVX    @DPTR,A
0079 A3                INC     DPTR
007A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 352
007B         ?C0035:
                                           ; SOURCE LINE # 353
007B 900000      R     MOV     DPTR,#counter_calibration+01H
007E E0                MOVX    A,@DPTR
007F 04                INC     A
0080 F0                MOVX    @DPTR,A
0081 7006              JNZ     ?C0265
0083 900000      R     MOV     DPTR,#counter_calibration
0086 E0                MOVX    A,@DPTR
0087 04                INC     A
0088 F0                MOVX    @DPTR,A
0089         ?C0265:
                                           ; SOURCE LINE # 354
0089         ?C0034:
                                           ; SOURCE LINE # 358
0089 300005            JNB     interrupt_flag,?C0036
                                           ; SOURCE LINE # 359
008C C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 360
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 32  

008E 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 361
0091         ?C0036:
                                           ; SOURCE LINE # 367
0091 900000      E     MOV     DPTR,#c_mem+034H
0094 E0                MOVX    A,@DPTR
0095 B4042C            CJNE    A,#04H,?C0037
                                           ; SOURCE LINE # 368
0098 900000      R     MOV     DPTR,#counter_calibration
009B E0                MOVX    A,@DPTR
009C 7004              JNZ     ?C0266
009E A3                INC     DPTR
009F E0                MOVX    A,@DPTR
00A0 640A              XRL     A,#0AH
00A2         ?C0266:
00A2 700A              JNZ     ?C0038
                                           ; SOURCE LINE # 369
00A4 120000      E     LCALL   check_rest_position
                                           ; SOURCE LINE # 370
00A7 E4                CLR     A
00A8 900000      R     MOV     DPTR,#counter_calibration
00AB F0                MOVX    @DPTR,A
00AC A3                INC     DPTR
00AD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 371
00AE         ?C0038:
                                           ; SOURCE LINE # 372
00AE 900000      R     MOV     DPTR,#counter_calibration+01H
00B1 E0                MOVX    A,@DPTR
00B2 04                INC     A
00B3 F0                MOVX    @DPTR,A
00B4 7006              JNZ     ?C0267
00B6 900000      R     MOV     DPTR,#counter_calibration
00B9 E0                MOVX    A,@DPTR
00BA 04                INC     A
00BB F0                MOVX    @DPTR,A
00BC         ?C0267:
                                           ; SOURCE LINE # 375
00BC 300005            JNB     interrupt_flag,?C0037
                                           ; SOURCE LINE # 376
00BF C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 377
00C1 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 378
                                           ; SOURCE LINE # 379
00C4         ?C0037:
                                           ; SOURCE LINE # 384
00C4 7800        E     MOV     R0,#LOW g_measOld
00C6 7C00        E     MOV     R4,#HIGH g_measOld
00C8 7D01              MOV     R5,#01H
00CA 7B01              MOV     R3,#01H
00CC 7A00        E     MOV     R2,#HIGH g_meas
00CE 7900        E     MOV     R1,#LOW g_meas
00D0 7E00              MOV     R6,#00H
00D2 7F37              MOV     R7,#037H
00D4 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 385
00D7 7800        E     MOV     R0,#LOW g_refOld
00D9 7C00        E     MOV     R4,#HIGH g_refOld
00DB 7D01              MOV     R5,#01H
00DD 7B01              MOV     R3,#01H
00DF 7A00        E     MOV     R2,#HIGH g_ref
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 33  

00E1 7900        E     MOV     R1,#LOW g_ref
00E3 7E00              MOV     R6,#00H
00E5 7F19              MOV     R7,#019H
00E7 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 388
00EA 7800        E     MOV     R0,#LOW g_ref
00EC 7C00        E     MOV     R4,#HIGH g_ref
00EE 7D01              MOV     R5,#01H
00F0 7B01              MOV     R3,#01H
00F2 7A00        E     MOV     R2,#HIGH g_refNew
00F4 7900        E     MOV     R1,#LOW g_refNew
00F6 7E00              MOV     R6,#00H
00F8 7F19              MOV     R7,#019H
00FA 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 390
00FD 300005            JNB     interrupt_flag,?C0040
                                           ; SOURCE LINE # 391
0100 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 392
0102 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 393
0105         ?C0040:
                                           ; SOURCE LINE # 395
0105 120000      E     LCALL   MY_TIMER_ReadCounter
0108 900000      E     MOV     DPTR,#timer_value
010B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 396
010E 900000      E     MOV     DPTR,#timer_value
0111 E0                MOVX    A,@DPTR
0112 F8                MOV     R0,A
0113 A3                INC     DPTR
0114 E0                MOVX    A,@DPTR
0115 F9                MOV     R1,A
0116 A3                INC     DPTR
0117 E0                MOVX    A,@DPTR
0118 FA                MOV     R2,A
0119 A3                INC     DPTR
011A E0                MOVX    A,@DPTR
011B FB                MOV     R3,A
011C 900000      E     MOV     DPTR,#timer_value0
011F E0                MOVX    A,@DPTR
0120 FC                MOV     R4,A
0121 A3                INC     DPTR
0122 E0                MOVX    A,@DPTR
0123 FD                MOV     R5,A
0124 A3                INC     DPTR
0125 E0                MOVX    A,@DPTR
0126 FE                MOV     R6,A
0127 A3                INC     DPTR
0128 E0                MOVX    A,@DPTR
0129 C3                CLR     C
012A 9B                SUBB    A,R3
012B FF                MOV     R7,A
012C EE                MOV     A,R6
012D 9A                SUBB    A,R2
012E FE                MOV     R6,A
012F ED                MOV     A,R5
0130 99                SUBB    A,R1
0131 FD                MOV     R5,A
0132 EC                MOV     A,R4
0133 98                SUBB    A,R0
0134 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 34  

0135 E4                CLR     A
0136 120000      E     LCALL   ?C?FCASTL
0139 7B00              MOV     R3,#00H
013B 7A24              MOV     R2,#024H
013D 7974              MOV     R1,#074H
013F 7849              MOV     R0,#049H
0141 120000      E     LCALL   ?C?FPDIV
0144 900000      E     MOV     DPTR,#cycle_time
0147 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 397
014A 7F40              MOV     R7,#040H
014C 7E4B              MOV     R6,#04BH
014E 7D4C              MOV     R5,#04CH
0150 7C00              MOV     R4,#00H
0152 120000      E     LCALL   _MY_TIMER_WriteCounter
                                           ; SOURCE LINE # 399
0155 22                RET     
             ; FUNCTION function_scheduler (END)

             ; FUNCTION motor_control (BEGIN)
                                           ; SOURCE LINE # 405
                                           ; SOURCE LINE # 407
0000 E4                CLR     A
0001 F500        R     MOV     pwm_input+03H,A
0003 F500        R     MOV     pwm_input+02H,A
0005 F500        R     MOV     pwm_input+01H,A
0007 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 417
0009 900000      E     MOV     DPTR,#c_mem+02H
000C E0                MOVX    A,@DPTR
000D FC                MOV     R4,A
000E A3                INC     DPTR
000F E0                MOVX    A,@DPTR
0010 FD                MOV     R5,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 FE                MOV     R6,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 F500        R     MOV     k_p+03H,A
0018 8E00        R     MOV     k_p+02H,R6
001A 8D00        R     MOV     k_p+01H,R5
001C 8C00        R     MOV     k_p,R4
                                           ; SOURCE LINE # 418
001E A3                INC     DPTR
001F E0                MOVX    A,@DPTR
0020 FC                MOV     R4,A
0021 A3                INC     DPTR
0022 E0                MOVX    A,@DPTR
0023 FD                MOV     R5,A
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 FE                MOV     R6,A
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 F500        R     MOV     k_i+03H,A
002B 8E00        R     MOV     k_i+02H,R6
002D 8D00        R     MOV     k_i+01H,R5
002F 8C00        R     MOV     k_i,R4
                                           ; SOURCE LINE # 419
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 35  

0033 FC                MOV     R4,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 FD                MOV     R5,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FE                MOV     R6,A
003A A3                INC     DPTR
003B E0                MOVX    A,@DPTR
003C F500        R     MOV     k_d+03H,A
003E 8E00        R     MOV     k_d+02H,R6
0040 8D00        R     MOV     k_d+01H,R5
0042 8C00        R     MOV     k_d,R4
                                           ; SOURCE LINE # 421
0044 A3                INC     DPTR
0045 E0                MOVX    A,@DPTR
0046 FC                MOV     R4,A
0047 A3                INC     DPTR
0048 E0                MOVX    A,@DPTR
0049 FD                MOV     R5,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C FE                MOV     R6,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F F500        R     MOV     k_p_c+03H,A
0051 8E00        R     MOV     k_p_c+02H,R6
0053 8D00        R     MOV     k_p_c+01H,R5
0055 8C00        R     MOV     k_p_c,R4
                                           ; SOURCE LINE # 422
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FC                MOV     R4,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
005C FD                MOV     R5,A
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F FE                MOV     R6,A
0060 A3                INC     DPTR
0061 E0                MOVX    A,@DPTR
0062 F500        R     MOV     k_i_c+03H,A
0064 8E00        R     MOV     k_i_c+02H,R6
0066 8D00        R     MOV     k_i_c+01H,R5
0068 8C00        R     MOV     k_i_c,R4
                                           ; SOURCE LINE # 423
006A A3                INC     DPTR
006B E0                MOVX    A,@DPTR
006C FC                MOV     R4,A
006D A3                INC     DPTR
006E E0                MOVX    A,@DPTR
006F FD                MOV     R5,A
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 FE                MOV     R6,A
0073 A3                INC     DPTR
0074 E0                MOVX    A,@DPTR
0075 F500        R     MOV     k_d_c+03H,A
0077 8E00        R     MOV     k_d_c+02H,R6
0079 8D00        R     MOV     k_d_c+01H,R5
007B 8C00        R     MOV     k_d_c,R4
                                           ; SOURCE LINE # 425
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 36  

007D A3                INC     DPTR
007E E0                MOVX    A,@DPTR
007F FC                MOV     R4,A
0080 A3                INC     DPTR
0081 E0                MOVX    A,@DPTR
0082 FD                MOV     R5,A
0083 A3                INC     DPTR
0084 E0                MOVX    A,@DPTR
0085 FE                MOV     R6,A
0086 A3                INC     DPTR
0087 E0                MOVX    A,@DPTR
0088 F500        R     MOV     k_p_dl+03H,A
008A 8E00        R     MOV     k_p_dl+02H,R6
008C 8D00        R     MOV     k_p_dl+01H,R5
008E 8C00        R     MOV     k_p_dl,R4
                                           ; SOURCE LINE # 426
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FC                MOV     R4,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FD                MOV     R5,A
0096 A3                INC     DPTR
0097 E0                MOVX    A,@DPTR
0098 FE                MOV     R6,A
0099 A3                INC     DPTR
009A E0                MOVX    A,@DPTR
009B F500        R     MOV     k_i_dl+03H,A
009D 8E00        R     MOV     k_i_dl+02H,R6
009F 8D00        R     MOV     k_i_dl+01H,R5
00A1 8C00        R     MOV     k_i_dl,R4
                                           ; SOURCE LINE # 427
00A3 A3                INC     DPTR
00A4 E0                MOVX    A,@DPTR
00A5 FC                MOV     R4,A
00A6 A3                INC     DPTR
00A7 E0                MOVX    A,@DPTR
00A8 FD                MOV     R5,A
00A9 A3                INC     DPTR
00AA E0                MOVX    A,@DPTR
00AB FE                MOV     R6,A
00AC A3                INC     DPTR
00AD E0                MOVX    A,@DPTR
00AE F500        R     MOV     k_d_dl+03H,A
00B0 8E00        R     MOV     k_d_dl+02H,R6
00B2 8D00        R     MOV     k_d_dl+01H,R5
00B4 8C00        R     MOV     k_d_dl,R4
                                           ; SOURCE LINE # 429
00B6 A3                INC     DPTR
00B7 E0                MOVX    A,@DPTR
00B8 FC                MOV     R4,A
00B9 A3                INC     DPTR
00BA E0                MOVX    A,@DPTR
00BB FD                MOV     R5,A
00BC A3                INC     DPTR
00BD E0                MOVX    A,@DPTR
00BE FE                MOV     R6,A
00BF A3                INC     DPTR
00C0 E0                MOVX    A,@DPTR
00C1 F500        R     MOV     k_p_c_dl+03H,A
00C3 8E00        R     MOV     k_p_c_dl+02H,R6
00C5 8D00        R     MOV     k_p_c_dl+01H,R5
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 37  

00C7 8C00        R     MOV     k_p_c_dl,R4
                                           ; SOURCE LINE # 430
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB FC                MOV     R4,A
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE FD                MOV     R5,A
00CF A3                INC     DPTR
00D0 E0                MOVX    A,@DPTR
00D1 FE                MOV     R6,A
00D2 A3                INC     DPTR
00D3 E0                MOVX    A,@DPTR
00D4 F500        R     MOV     k_i_c_dl+03H,A
00D6 8E00        R     MOV     k_i_c_dl+02H,R6
00D8 8D00        R     MOV     k_i_c_dl+01H,R5
00DA 8C00        R     MOV     k_i_c_dl,R4
                                           ; SOURCE LINE # 431
00DC A3                INC     DPTR
00DD E0                MOVX    A,@DPTR
00DE FC                MOV     R4,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 FD                MOV     R5,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 FE                MOV     R6,A
00E5 A3                INC     DPTR
00E6 E0                MOVX    A,@DPTR
00E7 F500        R     MOV     k_d_c_dl+03H,A
00E9 8E00        R     MOV     k_d_c_dl+02H,R6
00EB 8D00        R     MOV     k_d_c_dl+01H,R5
00ED 8C00        R     MOV     k_d_c_dl,R4
                                           ; SOURCE LINE # 448
00EF 900000      E     MOV     DPTR,#c_mem+06BH
00F2 E0                MOVX    A,@DPTR
00F3 FE                MOV     R6,A
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6 FF                MOV     R7,A
00F7 FB                MOV     R3,A
00F8 AA06              MOV     R2,AR6
00FA E4                CLR     A
00FB 900000      E     MOV     DPTR,#g_meas+017H
00FE E0                MOVX    A,@DPTR
00FF FC                MOV     R4,A
0100 A3                INC     DPTR
0101 E0                MOVX    A,@DPTR
0102 FD                MOV     R5,A
0103 A3                INC     DPTR
0104 E0                MOVX    A,@DPTR
0105 FE                MOV     R6,A
0106 A3                INC     DPTR
0107 E0                MOVX    A,@DPTR
0108 C3                CLR     C
0109 9B                SUBB    A,R3
010A F500        R     MOV     err_emg_1+03H,A
010C EE                MOV     A,R6
010D 9A                SUBB    A,R2
010E F500        R     MOV     err_emg_1+02H,A
0110 ED                MOV     A,R5
0111 9400              SUBB    A,#00H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 38  

0113 F500        R     MOV     err_emg_1+01H,A
0115 EC                MOV     A,R4
0116 9400              SUBB    A,#00H
0118 F500        R     MOV     err_emg_1,A
                                           ; SOURCE LINE # 449
011A 900000      E     MOV     DPTR,#c_mem+06DH
011D E0                MOVX    A,@DPTR
011E FE                MOV     R6,A
011F A3                INC     DPTR
0120 E0                MOVX    A,@DPTR
0121 FF                MOV     R7,A
0122 FB                MOV     R3,A
0123 AA06              MOV     R2,AR6
0125 E4                CLR     A
0126 900000      E     MOV     DPTR,#g_meas+01BH
0129 E0                MOVX    A,@DPTR
012A FC                MOV     R4,A
012B A3                INC     DPTR
012C E0                MOVX    A,@DPTR
012D FD                MOV     R5,A
012E A3                INC     DPTR
012F E0                MOVX    A,@DPTR
0130 FE                MOV     R6,A
0131 A3                INC     DPTR
0132 E0                MOVX    A,@DPTR
0133 C3                CLR     C
0134 9B                SUBB    A,R3
0135 F500        R     MOV     err_emg_2+03H,A
0137 EE                MOV     A,R6
0138 9A                SUBB    A,R2
0139 F500        R     MOV     err_emg_2+02H,A
013B ED                MOV     A,R5
013C 9400              SUBB    A,#00H
013E F500        R     MOV     err_emg_2+01H,A
0140 EC                MOV     A,R4
0141 9400              SUBB    A,#00H
0143 F500        R     MOV     err_emg_2,A
                                           ; SOURCE LINE # 452
0145 900000      E     MOV     DPTR,#c_mem+033H
0148 E0                MOVX    A,@DPTR
0149 24FE              ADD     A,#0FEH
014B 7003              JNZ     $ + 5H
014D 020000      R     LJMP    ?C0050
0150 14                DEC     A
0151 7003              JNZ     $ + 5H
0153 020000      R     LJMP    ?C0053
0156 14                DEC     A
0157 7003              JNZ     $ + 5H
0159 020000      R     LJMP    ?C0056
015C 14                DEC     A
015D 7003              JNZ     $ + 5H
015F 020000      R     LJMP    ?C0066
0162 2404              ADD     A,#04H
0164 6003              JZ      $ + 5H
0166 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 454
0169         ?C0043:
                                           ; SOURCE LINE # 458
0169 900000      E     MOV     DPTR,#c_mem+079H
016C E0                MOVX    A,@DPTR
016D 6024              JZ      ?C0044
                                           ; SOURCE LINE # 459
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 39  

016F A3                INC     DPTR
0170 E0                MOVX    A,@DPTR
0171 FF                MOV     R7,A
0172 33                RLC     A
0173 95E0              SUBB    A,ACC
0175 FE                MOV     R6,A
0176 FD                MOV     R5,A
0177 FC                MOV     R4,A
0178 900000      E     MOV     DPTR,#g_meas+08H
017B E0                MOVX    A,@DPTR
017C F8                MOV     R0,A
017D A3                INC     DPTR
017E E0                MOVX    A,@DPTR
017F F9                MOV     R1,A
0180 A3                INC     DPTR
0181 E0                MOVX    A,@DPTR
0182 FA                MOV     R2,A
0183 A3                INC     DPTR
0184 E0                MOVX    A,@DPTR
0185 FB                MOV     R3,A
0186 120000      E     LCALL   ?C?LMUL
0189 8F00        R     MOV     handle_value+03H,R7
018B 8E00        R     MOV     handle_value+02H,R6
018D 8D00        R     MOV     handle_value+01H,R5
018F 8C00        R     MOV     handle_value,R4
0191 8024              SJMP    ?C0045
0193         ?C0044:
                                           ; SOURCE LINE # 461
0193 900000      E     MOV     DPTR,#c_mem+07AH
0196 E0                MOVX    A,@DPTR
0197 FF                MOV     R7,A
0198 33                RLC     A
0199 95E0              SUBB    A,ACC
019B FE                MOV     R6,A
019C FD                MOV     R5,A
019D FC                MOV     R4,A
019E 900000      E     MOV     DPTR,#g_meas+04H
01A1 E0                MOVX    A,@DPTR
01A2 F8                MOV     R0,A
01A3 A3                INC     DPTR
01A4 E0                MOVX    A,@DPTR
01A5 F9                MOV     R1,A
01A6 A3                INC     DPTR
01A7 E0                MOVX    A,@DPTR
01A8 FA                MOV     R2,A
01A9 A3                INC     DPTR
01AA E0                MOVX    A,@DPTR
01AB FB                MOV     R3,A
01AC 120000      E     LCALL   ?C?LMUL
01AF 8F00        R     MOV     handle_value+03H,R7
01B1 8E00        R     MOV     handle_value+02H,R6
01B3 8D00        R     MOV     handle_value+01H,R5
01B5 8C00        R     MOV     handle_value,R4
01B7         ?C0045:
                                           ; SOURCE LINE # 465
01B7 900000      E     MOV     DPTR,#g_ref
01BA E0                MOVX    A,@DPTR
01BB F8                MOV     R0,A
01BC A3                INC     DPTR
01BD E0                MOVX    A,@DPTR
01BE F9                MOV     R1,A
01BF A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 40  

01C0 E0                MOVX    A,@DPTR
01C1 FA                MOV     R2,A
01C2 A3                INC     DPTR
01C3 E0                MOVX    A,@DPTR
01C4 FB                MOV     R3,A
01C5 C3                CLR     C
01C6 E500        R     MOV     A,handle_value+03H
01C8 9B                SUBB    A,R3
01C9 FF                MOV     R7,A
01CA E500        R     MOV     A,handle_value+02H
01CC 9A                SUBB    A,R2
01CD FE                MOV     R6,A
01CE E500        R     MOV     A,handle_value+01H
01D0 99                SUBB    A,R1
01D1 FD                MOV     R5,A
01D2 E500        R     MOV     A,handle_value
01D4 98                SUBB    A,R0
01D5 FC                MOV     R4,A
01D6 900000      E     MOV     DPTR,#c_mem+061H
01D9 E0                MOVX    A,@DPTR
01DA F8                MOV     R0,A
01DB A3                INC     DPTR
01DC E0                MOVX    A,@DPTR
01DD F9                MOV     R1,A
01DE A3                INC     DPTR
01DF E0                MOVX    A,@DPTR
01E0 FA                MOV     R2,A
01E1 A3                INC     DPTR
01E2 E0                MOVX    A,@DPTR
01E3 FB                MOV     R3,A
01E4 C3                CLR     C
01E5 120000      E     LCALL   ?C?SLCMP
01E8 5044              JNC     ?C0046
01EA E4                CLR     A
01EB FF                MOV     R7,A
01EC FE                MOV     R6,A
01ED FD                MOV     R5,A
01EE FC                MOV     R4,A
01EF 900000      E     MOV     DPTR,#c_mem+061H
01F2 E0                MOVX    A,@DPTR
01F3 F8                MOV     R0,A
01F4 A3                INC     DPTR
01F5 E0                MOVX    A,@DPTR
01F6 A3                INC     DPTR
01F7 E0                MOVX    A,@DPTR
01F8 A3                INC     DPTR
01F9 E0                MOVX    A,@DPTR
01FA C3                CLR     C
01FB 120000      E     LCALL   ?C?SLCMP
01FE 602E              JZ      ?C0046
                                           ; SOURCE LINE # 466
0200 900000      E     MOV     DPTR,#g_ref
0203 E0                MOVX    A,@DPTR
0204 FC                MOV     R4,A
0205 A3                INC     DPTR
0206 E0                MOVX    A,@DPTR
0207 FD                MOV     R5,A
0208 A3                INC     DPTR
0209 E0                MOVX    A,@DPTR
020A FE                MOV     R6,A
020B A3                INC     DPTR
020C E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 41  

020D FF                MOV     R7,A
020E 900000      E     MOV     DPTR,#c_mem+061H
0211 E0                MOVX    A,@DPTR
0212 F8                MOV     R0,A
0213 A3                INC     DPTR
0214 E0                MOVX    A,@DPTR
0215 A3                INC     DPTR
0216 E0                MOVX    A,@DPTR
0217 A3                INC     DPTR
0218 E0                MOVX    A,@DPTR
0219 EF                MOV     A,R7
021A 2B                ADD     A,R3
021B FF                MOV     R7,A
021C EE                MOV     A,R6
021D 3A                ADDC    A,R2
021E FE                MOV     R6,A
021F ED                MOV     A,R5
0220 39                ADDC    A,R1
0221 FD                MOV     R5,A
0222 EC                MOV     A,R4
0223 38                ADDC    A,R0
0224 FC                MOV     R4,A
0225 900000      E     MOV     DPTR,#g_ref
0228 120000      E     LCALL   ?C?LSTXDATA
022B 020000      R     LJMP    ?C0042
022E         ?C0046:
                                           ; SOURCE LINE # 467
                                           ; SOURCE LINE # 468
022E 900000      E     MOV     DPTR,#g_ref
0231 E0                MOVX    A,@DPTR
0232 F8                MOV     R0,A
0233 A3                INC     DPTR
0234 E0                MOVX    A,@DPTR
0235 F9                MOV     R1,A
0236 A3                INC     DPTR
0237 E0                MOVX    A,@DPTR
0238 FA                MOV     R2,A
0239 A3                INC     DPTR
023A E0                MOVX    A,@DPTR
023B FB                MOV     R3,A
023C C3                CLR     C
023D E500        R     MOV     A,handle_value+03H
023F 9B                SUBB    A,R3
0240 FF                MOV     R7,A
0241 E500        R     MOV     A,handle_value+02H
0243 9A                SUBB    A,R2
0244 FE                MOV     R6,A
0245 E500        R     MOV     A,handle_value+01H
0247 99                SUBB    A,R1
0248 FD                MOV     R5,A
0249 E500        R     MOV     A,handle_value
024B 98                SUBB    A,R0
024C FC                MOV     R4,A
024D 900000      E     MOV     DPTR,#c_mem+065H
0250 E0                MOVX    A,@DPTR
0251 F8                MOV     R0,A
0252 A3                INC     DPTR
0253 E0                MOVX    A,@DPTR
0254 F9                MOV     R1,A
0255 A3                INC     DPTR
0256 E0                MOVX    A,@DPTR
0257 FA                MOV     R2,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 42  

0258 A3                INC     DPTR
0259 E0                MOVX    A,@DPTR
025A FB                MOV     R3,A
025B D3                SETB    C
025C 120000      E     LCALL   ?C?SLCMP
025F 4043              JC      ?C0048
0261 E4                CLR     A
0262 FF                MOV     R7,A
0263 FE                MOV     R6,A
0264 FD                MOV     R5,A
0265 FC                MOV     R4,A
0266 900000      E     MOV     DPTR,#c_mem+065H
0269 E0                MOVX    A,@DPTR
026A F8                MOV     R0,A
026B A3                INC     DPTR
026C E0                MOVX    A,@DPTR
026D A3                INC     DPTR
026E E0                MOVX    A,@DPTR
026F A3                INC     DPTR
0270 E0                MOVX    A,@DPTR
0271 120000      E     LCALL   ?C?SLCMP
0274 602E              JZ      ?C0048
                                           ; SOURCE LINE # 469
0276 900000      E     MOV     DPTR,#g_ref
0279 E0                MOVX    A,@DPTR
027A FC                MOV     R4,A
027B A3                INC     DPTR
027C E0                MOVX    A,@DPTR
027D FD                MOV     R5,A
027E A3                INC     DPTR
027F E0                MOVX    A,@DPTR
0280 FE                MOV     R6,A
0281 A3                INC     DPTR
0282 E0                MOVX    A,@DPTR
0283 FF                MOV     R7,A
0284 900000      E     MOV     DPTR,#c_mem+065H
0287 E0                MOVX    A,@DPTR
0288 F8                MOV     R0,A
0289 A3                INC     DPTR
028A E0                MOVX    A,@DPTR
028B A3                INC     DPTR
028C E0                MOVX    A,@DPTR
028D A3                INC     DPTR
028E E0                MOVX    A,@DPTR
028F EF                MOV     A,R7
0290 2B                ADD     A,R3
0291 FF                MOV     R7,A
0292 EE                MOV     A,R6
0293 3A                ADDC    A,R2
0294 FE                MOV     R6,A
0295 ED                MOV     A,R5
0296 39                ADDC    A,R1
0297 FD                MOV     R5,A
0298 EC                MOV     A,R4
0299 38                ADDC    A,R0
029A FC                MOV     R4,A
029B 900000      E     MOV     DPTR,#g_ref
029E 120000      E     LCALL   ?C?LSTXDATA
02A1 020000      R     LJMP    ?C0042
02A4         ?C0048:
                                           ; SOURCE LINE # 471
02A4 AF00        R     MOV     R7,handle_value+03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 43  

02A6 AE00        R     MOV     R6,handle_value+02H
02A8 AD00        R     MOV     R5,handle_value+01H
02AA AC00        R     MOV     R4,handle_value
02AC 900000      E     MOV     DPTR,#g_ref
02AF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 472
                                           ; SOURCE LINE # 473
02B2 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 475
02B5         ?C0050:
                                           ; SOURCE LINE # 476
02B5 E4                CLR     A
02B6 FF                MOV     R7,A
02B7 FE                MOV     R6,A
02B8 FD                MOV     R5,A
02B9 FC                MOV     R4,A
02BA AB00        R     MOV     R3,err_emg_1+03H
02BC AA00        R     MOV     R2,err_emg_1+02H
02BE A900        R     MOV     R1,err_emg_1+01H
02C0 A800        R     MOV     R0,err_emg_1
02C2 D3                SETB    C
02C3 120000      E     LCALL   ?C?SLCMP
02C6 403D              JC      ?C0051
                                           ; SOURCE LINE # 477
02C8 900000      E     MOV     DPTR,#g_mem+059H
02CB E0                MOVX    A,@DPTR
02CC FC                MOV     R4,A
02CD A3                INC     DPTR
02CE E0                MOVX    A,@DPTR
02CF FD                MOV     R5,A
02D0 A3                INC     DPTR
02D1 E0                MOVX    A,@DPTR
02D2 FE                MOV     R6,A
02D3 A3                INC     DPTR
02D4 E0                MOVX    A,@DPTR
02D5 FF                MOV     R7,A
02D6 A800        R     MOV     R0,err_emg_1
02D8 120000      E     LCALL   ?C?LMUL
02DB C006              PUSH    AR6
02DD C007              PUSH    AR7
02DF 900000      E     MOV     DPTR,#c_mem+06BH
02E2 E0                MOVX    A,@DPTR
02E3 FE                MOV     R6,A
02E4 A3                INC     DPTR
02E5 E0                MOVX    A,@DPTR
02E6 FF                MOV     R7,A
02E7 C3                CLR     C
02E8 E4                CLR     A
02E9 9F                SUBB    A,R7
02EA FF                MOV     R7,A
02EB 7404              MOV     A,#04H
02ED 9E                SUBB    A,R6
02EE FE                MOV     R6,A
02EF AB07              MOV     R3,AR7
02F1 FA                MOV     R2,A
02F2 E4                CLR     A
02F3 F9                MOV     R1,A
02F4 F8                MOV     R0,A
02F5 D007              POP     AR7
02F7 D006              POP     AR6
02F9 120000      E     LCALL   ?C?SLDIV
02FC 900000      E     MOV     DPTR,#g_ref
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 44  

02FF 120000      E     LCALL   ?C?LSTXDATA
0302 020000      R     LJMP    ?C0042
0305         ?C0051:
                                           ; SOURCE LINE # 479
0305 E4                CLR     A
0306 FF                MOV     R7,A
0307 FE                MOV     R6,A
0308 FD                MOV     R5,A
0309 FC                MOV     R4,A
030A 900000      E     MOV     DPTR,#g_ref
030D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 480
0310 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 482
0313         ?C0053:
                                           ; SOURCE LINE # 483
0313 900000      E     MOV     DPTR,#g_refOld
0316 E0                MOVX    A,@DPTR
0317 FC                MOV     R4,A
0318 A3                INC     DPTR
0319 E0                MOVX    A,@DPTR
031A FD                MOV     R5,A
031B A3                INC     DPTR
031C E0                MOVX    A,@DPTR
031D FE                MOV     R6,A
031E A3                INC     DPTR
031F E0                MOVX    A,@DPTR
0320 FF                MOV     R7,A
0321 900000      E     MOV     DPTR,#g_ref
0324 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 484
0327 E4                CLR     A
0328 FF                MOV     R7,A
0329 FE                MOV     R6,A
032A FD                MOV     R5,A
032B FC                MOV     R4,A
032C AB00        R     MOV     R3,err_emg_1+03H
032E AA00        R     MOV     R2,err_emg_1+02H
0330 A900        R     MOV     R1,err_emg_1+01H
0332 A800        R     MOV     R0,err_emg_1
0334 D3                SETB    C
0335 120000      E     LCALL   ?C?SLCMP
0338 4056              JC      ?C0054
                                           ; SOURCE LINE # 485
033A 900000      E     MOV     DPTR,#g_mem+078H
033D E0                MOVX    A,@DPTR
033E FF                MOV     R7,A
033F E4                CLR     A
0340 FC                MOV     R4,A
0341 FD                MOV     R5,A
0342 FE                MOV     R6,A
0343 A800        R     MOV     R0,err_emg_1
0345 120000      E     LCALL   ?C?LMUL
0348 E4                CLR     A
0349 7B02              MOV     R3,#02H
034B FA                MOV     R2,A
034C F9                MOV     R1,A
034D F8                MOV     R0,A
034E 120000      E     LCALL   ?C?LMUL
0351 C006              PUSH    AR6
0353 C007              PUSH    AR7
0355 900000      E     MOV     DPTR,#c_mem+06BH
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 45  

0358 E0                MOVX    A,@DPTR
0359 FE                MOV     R6,A
035A A3                INC     DPTR
035B E0                MOVX    A,@DPTR
035C FF                MOV     R7,A
035D C3                CLR     C
035E E4                CLR     A
035F 9F                SUBB    A,R7
0360 FF                MOV     R7,A
0361 7404              MOV     A,#04H
0363 9E                SUBB    A,R6
0364 FE                MOV     R6,A
0365 AB07              MOV     R3,AR7
0367 FA                MOV     R2,A
0368 E4                CLR     A
0369 F9                MOV     R1,A
036A F8                MOV     R0,A
036B D007              POP     AR7
036D D006              POP     AR6
036F 120000      E     LCALL   ?C?SLDIV
0372 900000      E     MOV     DPTR,#g_refOld
0375 E0                MOVX    A,@DPTR
0376 F8                MOV     R0,A
0377 A3                INC     DPTR
0378 E0                MOVX    A,@DPTR
0379 F9                MOV     R1,A
037A A3                INC     DPTR
037B E0                MOVX    A,@DPTR
037C FA                MOV     R2,A
037D A3                INC     DPTR
037E E0                MOVX    A,@DPTR
037F 2F                ADD     A,R7
0380 FF                MOV     R7,A
0381 EA                MOV     A,R2
0382 3E                ADDC    A,R6
0383 FE                MOV     R6,A
0384 E9                MOV     A,R1
0385 3D                ADDC    A,R5
0386 FD                MOV     R5,A
0387 E8                MOV     A,R0
0388 3C                ADDC    A,R4
0389 FC                MOV     R4,A
038A 900000      E     MOV     DPTR,#g_ref
038D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 486
0390         ?C0054:
                                           ; SOURCE LINE # 487
0390 E4                CLR     A
0391 FF                MOV     R7,A
0392 FE                MOV     R6,A
0393 FD                MOV     R5,A
0394 FC                MOV     R4,A
0395 AB00        R     MOV     R3,err_emg_2+03H
0397 AA00        R     MOV     R2,err_emg_2+02H
0399 A900        R     MOV     R1,err_emg_2+01H
039B A800        R     MOV     R0,err_emg_2
039D D3                SETB    C
039E 120000      E     LCALL   ?C?SLCMP
03A1 5003              JNC     $ + 5H
03A3 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 488
03A6 900000      E     MOV     DPTR,#g_mem+078H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 46  

03A9 E0                MOVX    A,@DPTR
03AA FF                MOV     R7,A
03AB E4                CLR     A
03AC FC                MOV     R4,A
03AD FD                MOV     R5,A
03AE FE                MOV     R6,A
03AF A800        R     MOV     R0,err_emg_2
03B1 120000      E     LCALL   ?C?LMUL
03B4 E4                CLR     A
03B5 7B02              MOV     R3,#02H
03B7 FA                MOV     R2,A
03B8 F9                MOV     R1,A
03B9 F8                MOV     R0,A
03BA 120000      E     LCALL   ?C?LMUL
03BD C006              PUSH    AR6
03BF C007              PUSH    AR7
03C1 900000      E     MOV     DPTR,#c_mem+06DH
03C4 E0                MOVX    A,@DPTR
03C5 FE                MOV     R6,A
03C6 A3                INC     DPTR
03C7 E0                MOVX    A,@DPTR
03C8 FF                MOV     R7,A
03C9 C3                CLR     C
03CA E4                CLR     A
03CB 9F                SUBB    A,R7
03CC FF                MOV     R7,A
03CD 7404              MOV     A,#04H
03CF 9E                SUBB    A,R6
03D0 FE                MOV     R6,A
03D1 AB07              MOV     R3,AR7
03D3 FA                MOV     R2,A
03D4 E4                CLR     A
03D5 F9                MOV     R1,A
03D6 F8                MOV     R0,A
03D7 D007              POP     AR7
03D9 D006              POP     AR6
03DB 120000      E     LCALL   ?C?SLDIV
03DE A804              MOV     R0,AR4
03E0 A905              MOV     R1,AR5
03E2 AA06              MOV     R2,AR6
03E4 AB07              MOV     R3,AR7
03E6 900000      E     MOV     DPTR,#g_refOld
03E9 E0                MOVX    A,@DPTR
03EA FC                MOV     R4,A
03EB A3                INC     DPTR
03EC E0                MOVX    A,@DPTR
03ED FD                MOV     R5,A
03EE A3                INC     DPTR
03EF E0                MOVX    A,@DPTR
03F0 FE                MOV     R6,A
03F1 A3                INC     DPTR
03F2 E0                MOVX    A,@DPTR
03F3 C3                CLR     C
03F4 9B                SUBB    A,R3
03F5 FF                MOV     R7,A
03F6 EE                MOV     A,R6
03F7 9A                SUBB    A,R2
03F8 FE                MOV     R6,A
03F9 ED                MOV     A,R5
03FA 99                SUBB    A,R1
03FB FD                MOV     R5,A
03FC EC                MOV     A,R4
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 47  

03FD 98                SUBB    A,R0
03FE FC                MOV     R4,A
03FF 900000      E     MOV     DPTR,#g_ref
0402 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 489
                                           ; SOURCE LINE # 490
0405 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 492
0408         ?C0056:
                                           ; SOURCE LINE # 493
0408 900000      E     MOV     DPTR,#g_refOld
040B E0                MOVX    A,@DPTR
040C FC                MOV     R4,A
040D A3                INC     DPTR
040E E0                MOVX    A,@DPTR
040F FD                MOV     R5,A
0410 A3                INC     DPTR
0411 E0                MOVX    A,@DPTR
0412 FE                MOV     R6,A
0413 A3                INC     DPTR
0414 E0                MOVX    A,@DPTR
0415 FF                MOV     R7,A
0416 900000      E     MOV     DPTR,#g_ref
0419 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 494
041C 900000      R     MOV     DPTR,#current_emg
041F E0                MOVX    A,@DPTR
0420 14                DEC     A
0421 6048              JZ      ?C0061
0423 14                DEC     A
0424 7003              JNZ     $ + 5H
0426 020000      R     LJMP    ?C0063
0429 2402              ADD     A,#02H
042B 6003              JZ      $ + 5H
042D 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 495
0430         ?C0058:
                                           ; SOURCE LINE # 497
0430 E4                CLR     A
0431 FF                MOV     R7,A
0432 FE                MOV     R6,A
0433 FD                MOV     R5,A
0434 FC                MOV     R4,A
0435 AB00        R     MOV     R3,err_emg_1+03H
0437 AA00        R     MOV     R2,err_emg_1+02H
0439 A900        R     MOV     R1,err_emg_1+01H
043B A800        R     MOV     R0,err_emg_1
043D D3                SETB    C
043E 120000      E     LCALL   ?C?SLCMP
0441 4009              JC      ?C0059
                                           ; SOURCE LINE # 498
0443 900000      R     MOV     DPTR,#current_emg
0446 7401              MOV     A,#01H
0448 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 499
0449 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 500
044C         ?C0059:
                                           ; SOURCE LINE # 501
044C E4                CLR     A
044D FF                MOV     R7,A
044E FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 48  

044F FD                MOV     R5,A
0450 FC                MOV     R4,A
0451 AB00        R     MOV     R3,err_emg_2+03H
0453 AA00        R     MOV     R2,err_emg_2+02H
0455 A900        R     MOV     R1,err_emg_2+01H
0457 A800        R     MOV     R0,err_emg_2
0459 D3                SETB    C
045A 120000      E     LCALL   ?C?SLCMP
045D 5003              JNC     $ + 5H
045F 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 502
0462 900000      R     MOV     DPTR,#current_emg
0465 7402              MOV     A,#02H
0467 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 503
0468 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 504
                                           ; SOURCE LINE # 505
                                           ; SOURCE LINE # 507
046B         ?C0061:
                                           ; SOURCE LINE # 509
046B E4                CLR     A
046C FF                MOV     R7,A
046D FE                MOV     R6,A
046E FD                MOV     R5,A
046F FC                MOV     R4,A
0470 AB00        R     MOV     R3,err_emg_1+03H
0472 AA00        R     MOV     R2,err_emg_1+02H
0474 A900        R     MOV     R1,err_emg_1+01H
0476 A800        R     MOV     R0,err_emg_1
0478 C3                CLR     C
0479 120000      E     LCALL   ?C?SLCMP
047C 5008              JNC     ?C0062
                                           ; SOURCE LINE # 510
047E E4                CLR     A
047F 900000      R     MOV     DPTR,#current_emg
0482 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 511
0483 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 512
0486         ?C0062:
                                           ; SOURCE LINE # 513
0486 900000      E     MOV     DPTR,#g_mem+078H
0489 E0                MOVX    A,@DPTR
048A FF                MOV     R7,A
048B E4                CLR     A
048C FC                MOV     R4,A
048D FD                MOV     R5,A
048E FE                MOV     R6,A
048F AB00        R     MOV     R3,err_emg_1+03H
0491 AA00        R     MOV     R2,err_emg_1+02H
0493 A900        R     MOV     R1,err_emg_1+01H
0495 A800        R     MOV     R0,err_emg_1
0497 120000      E     LCALL   ?C?LMUL
049A E4                CLR     A
049B 7B02              MOV     R3,#02H
049D FA                MOV     R2,A
049E F9                MOV     R1,A
049F F8                MOV     R0,A
04A0 120000      E     LCALL   ?C?LMUL
04A3 C006              PUSH    AR6
04A5 C007              PUSH    AR7
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 49  

04A7 900000      E     MOV     DPTR,#c_mem+06BH
04AA E0                MOVX    A,@DPTR
04AB FE                MOV     R6,A
04AC A3                INC     DPTR
04AD E0                MOVX    A,@DPTR
04AE FF                MOV     R7,A
04AF C3                CLR     C
04B0 E4                CLR     A
04B1 9F                SUBB    A,R7
04B2 FF                MOV     R7,A
04B3 7404              MOV     A,#04H
04B5 9E                SUBB    A,R6
04B6 FE                MOV     R6,A
04B7 AB07              MOV     R3,AR7
04B9 FA                MOV     R2,A
04BA E4                CLR     A
04BB F9                MOV     R1,A
04BC F8                MOV     R0,A
04BD D007              POP     AR7
04BF D006              POP     AR6
04C1 120000      E     LCALL   ?C?SLDIV
04C4 900000      E     MOV     DPTR,#g_refOld
04C7 E0                MOVX    A,@DPTR
04C8 F8                MOV     R0,A
04C9 A3                INC     DPTR
04CA E0                MOVX    A,@DPTR
04CB F9                MOV     R1,A
04CC A3                INC     DPTR
04CD E0                MOVX    A,@DPTR
04CE FA                MOV     R2,A
04CF A3                INC     DPTR
04D0 E0                MOVX    A,@DPTR
04D1 2F                ADD     A,R7
04D2 FF                MOV     R7,A
04D3 EA                MOV     A,R2
04D4 3E                ADDC    A,R6
04D5 FE                MOV     R6,A
04D6 E9                MOV     A,R1
04D7 3D                ADDC    A,R5
04D8 FD                MOV     R5,A
04D9 E8                MOV     A,R0
04DA 3C                ADDC    A,R4
04DB FC                MOV     R4,A
04DC 900000      E     MOV     DPTR,#g_ref
04DF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 514
04E2 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 516
04E5         ?C0063:
                                           ; SOURCE LINE # 518
04E5 E4                CLR     A
04E6 FF                MOV     R7,A
04E7 FE                MOV     R6,A
04E8 FD                MOV     R5,A
04E9 FC                MOV     R4,A
04EA AB00        R     MOV     R3,err_emg_2+03H
04EC AA00        R     MOV     R2,err_emg_2+02H
04EE A900        R     MOV     R1,err_emg_2+01H
04F0 A800        R     MOV     R0,err_emg_2
04F2 C3                CLR     C
04F3 120000      E     LCALL   ?C?SLCMP
04F6 5008              JNC     ?C0064
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 50  

                                           ; SOURCE LINE # 519
04F8 E4                CLR     A
04F9 900000      R     MOV     DPTR,#current_emg
04FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 520
04FD 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 521
0500         ?C0064:
                                           ; SOURCE LINE # 522
0500 900000      E     MOV     DPTR,#g_mem+078H
0503 E0                MOVX    A,@DPTR
0504 FF                MOV     R7,A
0505 E4                CLR     A
0506 FC                MOV     R4,A
0507 FD                MOV     R5,A
0508 FE                MOV     R6,A
0509 AB00        R     MOV     R3,err_emg_2+03H
050B AA00        R     MOV     R2,err_emg_2+02H
050D A900        R     MOV     R1,err_emg_2+01H
050F A800        R     MOV     R0,err_emg_2
0511 120000      E     LCALL   ?C?LMUL
0514 E4                CLR     A
0515 7B02              MOV     R3,#02H
0517 FA                MOV     R2,A
0518 F9                MOV     R1,A
0519 F8                MOV     R0,A
051A 120000      E     LCALL   ?C?LMUL
051D C006              PUSH    AR6
051F C007              PUSH    AR7
0521 900000      E     MOV     DPTR,#c_mem+06DH
0524 E0                MOVX    A,@DPTR
0525 FE                MOV     R6,A
0526 A3                INC     DPTR
0527 E0                MOVX    A,@DPTR
0528 FF                MOV     R7,A
0529 C3                CLR     C
052A E4                CLR     A
052B 9F                SUBB    A,R7
052C FF                MOV     R7,A
052D 7404              MOV     A,#04H
052F 9E                SUBB    A,R6
0530 FE                MOV     R6,A
0531 AB07              MOV     R3,AR7
0533 FA                MOV     R2,A
0534 E4                CLR     A
0535 F9                MOV     R1,A
0536 F8                MOV     R0,A
0537 D007              POP     AR7
0539 D006              POP     AR6
053B 120000      E     LCALL   ?C?SLDIV
053E A804              MOV     R0,AR4
0540 A905              MOV     R1,AR5
0542 AA06              MOV     R2,AR6
0544 AB07              MOV     R3,AR7
0546 900000      E     MOV     DPTR,#g_refOld
0549 E0                MOVX    A,@DPTR
054A FC                MOV     R4,A
054B A3                INC     DPTR
054C E0                MOVX    A,@DPTR
054D FD                MOV     R5,A
054E A3                INC     DPTR
054F E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 51  

0550 FE                MOV     R6,A
0551 A3                INC     DPTR
0552 E0                MOVX    A,@DPTR
0553 C3                CLR     C
0554 9B                SUBB    A,R3
0555 FF                MOV     R7,A
0556 EE                MOV     A,R6
0557 9A                SUBB    A,R2
0558 FE                MOV     R6,A
0559 ED                MOV     A,R5
055A 99                SUBB    A,R1
055B FD                MOV     R5,A
055C EC                MOV     A,R4
055D 98                SUBB    A,R0
055E FC                MOV     R4,A
055F 900000      E     MOV     DPTR,#g_ref
0562 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 523
0565 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 525
                                           ; SOURCE LINE # 526
                                           ; SOURCE LINE # 527
                                           ; SOURCE LINE # 529
0568 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 531
056B         ?C0066:
                                           ; SOURCE LINE # 532
056B 900000      E     MOV     DPTR,#g_refOld
056E E0                MOVX    A,@DPTR
056F FC                MOV     R4,A
0570 A3                INC     DPTR
0571 E0                MOVX    A,@DPTR
0572 FD                MOV     R5,A
0573 A3                INC     DPTR
0574 E0                MOVX    A,@DPTR
0575 FE                MOV     R6,A
0576 A3                INC     DPTR
0577 E0                MOVX    A,@DPTR
0578 FF                MOV     R7,A
0579 900000      E     MOV     DPTR,#g_ref
057C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 533
057F 900000      R     MOV     DPTR,#current_emg
0582 E0                MOVX    A,@DPTR
0583 14                DEC     A
0584 6048              JZ      ?C0071
0586 14                DEC     A
0587 7003              JNZ     $ + 5H
0589 020000      R     LJMP    ?C0074
058C 2402              ADD     A,#02H
058E 6003              JZ      $ + 5H
0590 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 535
0593         ?C0068:
                                           ; SOURCE LINE # 536
0593 E4                CLR     A
0594 FF                MOV     R7,A
0595 FE                MOV     R6,A
0596 FD                MOV     R5,A
0597 FC                MOV     R4,A
0598 AB00        R     MOV     R3,err_emg_1+03H
059A AA00        R     MOV     R2,err_emg_1+02H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 52  

059C A900        R     MOV     R1,err_emg_1+01H
059E A800        R     MOV     R0,err_emg_1
05A0 D3                SETB    C
05A1 120000      E     LCALL   ?C?SLCMP
05A4 4009              JC      ?C0069
                                           ; SOURCE LINE # 537
05A6 900000      R     MOV     DPTR,#current_emg
05A9 7401              MOV     A,#01H
05AB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 538
05AC 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 539
05AF         ?C0069:
                                           ; SOURCE LINE # 540
05AF E4                CLR     A
05B0 FF                MOV     R7,A
05B1 FE                MOV     R6,A
05B2 FD                MOV     R5,A
05B3 FC                MOV     R4,A
05B4 AB00        R     MOV     R3,err_emg_2+03H
05B6 AA00        R     MOV     R2,err_emg_2+02H
05B8 A900        R     MOV     R1,err_emg_2+01H
05BA A800        R     MOV     R0,err_emg_2
05BC D3                SETB    C
05BD 120000      E     LCALL   ?C?SLCMP
05C0 5003              JNC     $ + 5H
05C2 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 541
05C5 900000      R     MOV     DPTR,#current_emg
05C8 7402              MOV     A,#02H
05CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 542
05CB 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 543
                                           ; SOURCE LINE # 544
                                           ; SOURCE LINE # 547
05CE         ?C0071:
                                           ; SOURCE LINE # 549
05CE E4                CLR     A
05CF FF                MOV     R7,A
05D0 FE                MOV     R6,A
05D1 FD                MOV     R5,A
05D2 FC                MOV     R4,A
05D3 AB00        R     MOV     R3,err_emg_1+03H
05D5 AA00        R     MOV     R2,err_emg_1+02H
05D7 A900        R     MOV     R1,err_emg_1+01H
05D9 A800        R     MOV     R0,err_emg_1
05DB C3                CLR     C
05DC 120000      E     LCALL   ?C?SLCMP
05DF 501B              JNC     ?C0072
05E1 E4                CLR     A
05E2 FF                MOV     R7,A
05E3 FE                MOV     R6,A
05E4 FD                MOV     R5,A
05E5 FC                MOV     R4,A
05E6 AB00        R     MOV     R3,err_emg_2+03H
05E8 AA00        R     MOV     R2,err_emg_2+02H
05EA A900        R     MOV     R1,err_emg_2+01H
05EC A800        R     MOV     R0,err_emg_2
05EE C3                CLR     C
05EF 120000      E     LCALL   ?C?SLCMP
05F2 5008              JNC     ?C0072
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 53  

                                           ; SOURCE LINE # 550
05F4 E4                CLR     A
05F5 900000      R     MOV     DPTR,#current_emg
05F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 551
05F9 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 552
05FC         ?C0072:
                                           ; SOURCE LINE # 554
05FC E4                CLR     A
05FD FF                MOV     R7,A
05FE FE                MOV     R6,A
05FF FD                MOV     R5,A
0600 FC                MOV     R4,A
0601 AB00        R     MOV     R3,err_emg_1+03H
0603 AA00        R     MOV     R2,err_emg_1+02H
0605 A900        R     MOV     R1,err_emg_1+01H
0607 A800        R     MOV     R0,err_emg_1
0609 D3                SETB    C
060A 120000      E     LCALL   ?C?SLCMP
060D 5003              JNC     $ + 5H
060F 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 555
0612 900000      E     MOV     DPTR,#g_mem+078H
0615 E0                MOVX    A,@DPTR
0616 FF                MOV     R7,A
0617 E4                CLR     A
0618 FC                MOV     R4,A
0619 FD                MOV     R5,A
061A FE                MOV     R6,A
061B A800        R     MOV     R0,err_emg_1
061D 120000      E     LCALL   ?C?LMUL
0620 7802              MOV     R0,#02H
0622 120000      E     LCALL   ?C?LSHL
0625 C006              PUSH    AR6
0627 C007              PUSH    AR7
0629 900000      E     MOV     DPTR,#c_mem+06BH
062C E0                MOVX    A,@DPTR
062D FE                MOV     R6,A
062E A3                INC     DPTR
062F E0                MOVX    A,@DPTR
0630 FF                MOV     R7,A
0631 C3                CLR     C
0632 E4                CLR     A
0633 9F                SUBB    A,R7
0634 FF                MOV     R7,A
0635 7404              MOV     A,#04H
0637 9E                SUBB    A,R6
0638 FE                MOV     R6,A
0639 AB07              MOV     R3,AR7
063B FA                MOV     R2,A
063C E4                CLR     A
063D F9                MOV     R1,A
063E F8                MOV     R0,A
063F D007              POP     AR7
0641 D006              POP     AR6
0643 120000      E     LCALL   ?C?SLDIV
0646 900000      E     MOV     DPTR,#g_refOld
0649 E0                MOVX    A,@DPTR
064A F8                MOV     R0,A
064B A3                INC     DPTR
064C E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 54  

064D F9                MOV     R1,A
064E A3                INC     DPTR
064F E0                MOVX    A,@DPTR
0650 FA                MOV     R2,A
0651 A3                INC     DPTR
0652 E0                MOVX    A,@DPTR
0653 2F                ADD     A,R7
0654 FF                MOV     R7,A
0655 EA                MOV     A,R2
0656 3E                ADDC    A,R6
0657 FE                MOV     R6,A
0658 E9                MOV     A,R1
0659 3D                ADDC    A,R5
065A FD                MOV     R5,A
065B E8                MOV     A,R0
065C 3C                ADDC    A,R4
065D FC                MOV     R4,A
065E 900000      E     MOV     DPTR,#g_ref
0661 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 557
0664 020000      R     LJMP    ?C0042
                                           ; SOURCE LINE # 560
0667         ?C0074:
                                           ; SOURCE LINE # 562
0667 E4                CLR     A
0668 FF                MOV     R7,A
0669 FE                MOV     R6,A
066A FD                MOV     R5,A
066B FC                MOV     R4,A
066C AB00        R     MOV     R3,err_emg_1+03H
066E AA00        R     MOV     R2,err_emg_1+02H
0670 A900        R     MOV     R1,err_emg_1+01H
0672 A800        R     MOV     R0,err_emg_1
0674 C3                CLR     C
0675 120000      E     LCALL   ?C?SLCMP
0678 501A              JNC     ?C0075
067A E4                CLR     A
067B FF                MOV     R7,A
067C FE                MOV     R6,A
067D FD                MOV     R5,A
067E FC                MOV     R4,A
067F AB00        R     MOV     R3,err_emg_2+03H
0681 AA00        R     MOV     R2,err_emg_2+02H
0683 A900        R     MOV     R1,err_emg_2+01H
0685 A800        R     MOV     R0,err_emg_2
0687 C3                CLR     C
0688 120000      E     LCALL   ?C?SLCMP
068B 5007              JNC     ?C0075
                                           ; SOURCE LINE # 563
068D E4                CLR     A
068E 900000      R     MOV     DPTR,#current_emg
0691 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 564
0692 806E              SJMP    ?C0042
                                           ; SOURCE LINE # 565
0694         ?C0075:
                                           ; SOURCE LINE # 567
0694 E4                CLR     A
0695 FF                MOV     R7,A
0696 FE                MOV     R6,A
0697 FD                MOV     R5,A
0698 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 55  

0699 AB00        R     MOV     R3,err_emg_2+03H
069B AA00        R     MOV     R2,err_emg_2+02H
069D A900        R     MOV     R1,err_emg_2+01H
069F A800        R     MOV     R0,err_emg_2
06A1 D3                SETB    C
06A2 120000      E     LCALL   ?C?SLCMP
06A5 405B              JC      ?C0042
                                           ; SOURCE LINE # 568
06A7 900000      E     MOV     DPTR,#c_mem+078H
06AA E0                MOVX    A,@DPTR
06AB FF                MOV     R7,A
06AC E4                CLR     A
06AD FC                MOV     R4,A
06AE FD                MOV     R5,A
06AF FE                MOV     R6,A
06B0 A800        R     MOV     R0,err_emg_2
06B2 120000      E     LCALL   ?C?LMUL
06B5 7802              MOV     R0,#02H
06B7 120000      E     LCALL   ?C?LSHL
06BA C006              PUSH    AR6
06BC C007              PUSH    AR7
06BE 900000      E     MOV     DPTR,#c_mem+06DH
06C1 E0                MOVX    A,@DPTR
06C2 FE                MOV     R6,A
06C3 A3                INC     DPTR
06C4 E0                MOVX    A,@DPTR
06C5 FF                MOV     R7,A
06C6 C3                CLR     C
06C7 E4                CLR     A
06C8 9F                SUBB    A,R7
06C9 FF                MOV     R7,A
06CA 7404              MOV     A,#04H
06CC 9E                SUBB    A,R6
06CD FE                MOV     R6,A
06CE AB07              MOV     R3,AR7
06D0 FA                MOV     R2,A
06D1 E4                CLR     A
06D2 F9                MOV     R1,A
06D3 F8                MOV     R0,A
06D4 D007              POP     AR7
06D6 D006              POP     AR6
06D8 120000      E     LCALL   ?C?SLDIV
06DB A804              MOV     R0,AR4
06DD A905              MOV     R1,AR5
06DF AA06              MOV     R2,AR6
06E1 AB07              MOV     R3,AR7
06E3 900000      E     MOV     DPTR,#g_refOld
06E6 E0                MOVX    A,@DPTR
06E7 FC                MOV     R4,A
06E8 A3                INC     DPTR
06E9 E0                MOVX    A,@DPTR
06EA FD                MOV     R5,A
06EB A3                INC     DPTR
06EC E0                MOVX    A,@DPTR
06ED FE                MOV     R6,A
06EE A3                INC     DPTR
06EF E0                MOVX    A,@DPTR
06F0 C3                CLR     C
06F1 9B                SUBB    A,R3
06F2 FF                MOV     R7,A
06F3 EE                MOV     A,R6
06F4 9A                SUBB    A,R2
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 56  

06F5 FE                MOV     R6,A
06F6 ED                MOV     A,R5
06F7 99                SUBB    A,R1
06F8 FD                MOV     R5,A
06F9 EC                MOV     A,R4
06FA 98                SUBB    A,R0
06FB FC                MOV     R4,A
06FC 900000      E     MOV     DPTR,#g_ref
06FF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 569
                                           ; SOURCE LINE # 570
                                           ; SOURCE LINE # 572
                                           ; SOURCE LINE # 573
                                           ; SOURCE LINE # 574
                                           ; SOURCE LINE # 576
                                           ; SOURCE LINE # 577
                                           ; SOURCE LINE # 578
0702         ?C0042:
                                           ; SOURCE LINE # 581
0702 900000      E     MOV     DPTR,#c_mem+050H
0705 E0                MOVX    A,@DPTR
0706 606A              JZ      ?C0079
                                           ; SOURCE LINE # 582
0708 A3                INC     DPTR
0709 E0                MOVX    A,@DPTR
070A FC                MOV     R4,A
070B A3                INC     DPTR
070C E0                MOVX    A,@DPTR
070D FD                MOV     R5,A
070E A3                INC     DPTR
070F E0                MOVX    A,@DPTR
0710 FE                MOV     R6,A
0711 A3                INC     DPTR
0712 E0                MOVX    A,@DPTR
0713 FF                MOV     R7,A
0714 900000      E     MOV     DPTR,#g_ref
0717 E0                MOVX    A,@DPTR
0718 F8                MOV     R0,A
0719 A3                INC     DPTR
071A E0                MOVX    A,@DPTR
071B F9                MOV     R1,A
071C A3                INC     DPTR
071D E0                MOVX    A,@DPTR
071E FA                MOV     R2,A
071F A3                INC     DPTR
0720 E0                MOVX    A,@DPTR
0721 FB                MOV     R3,A
0722 C3                CLR     C
0723 120000      E     LCALL   ?C?SLCMP
0726 5014              JNC     ?C0080
                                           ; SOURCE LINE # 583
0728 900000      E     MOV     DPTR,#c_mem+051H
072B E0                MOVX    A,@DPTR
072C FC                MOV     R4,A
072D A3                INC     DPTR
072E E0                MOVX    A,@DPTR
072F FD                MOV     R5,A
0730 A3                INC     DPTR
0731 E0                MOVX    A,@DPTR
0732 FE                MOV     R6,A
0733 A3                INC     DPTR
0734 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 57  

0735 FF                MOV     R7,A
0736 900000      E     MOV     DPTR,#g_ref
0739 120000      E     LCALL   ?C?LSTXDATA
073C         ?C0080:
                                           ; SOURCE LINE # 584
073C 900000      E     MOV     DPTR,#c_mem+059H
073F E0                MOVX    A,@DPTR
0740 FC                MOV     R4,A
0741 A3                INC     DPTR
0742 E0                MOVX    A,@DPTR
0743 FD                MOV     R5,A
0744 A3                INC     DPTR
0745 E0                MOVX    A,@DPTR
0746 FE                MOV     R6,A
0747 A3                INC     DPTR
0748 E0                MOVX    A,@DPTR
0749 FF                MOV     R7,A
074A 900000      E     MOV     DPTR,#g_ref
074D E0                MOVX    A,@DPTR
074E F8                MOV     R0,A
074F A3                INC     DPTR
0750 E0                MOVX    A,@DPTR
0751 F9                MOV     R1,A
0752 A3                INC     DPTR
0753 E0                MOVX    A,@DPTR
0754 FA                MOV     R2,A
0755 A3                INC     DPTR
0756 E0                MOVX    A,@DPTR
0757 FB                MOV     R3,A
0758 D3                SETB    C
0759 120000      E     LCALL   ?C?SLCMP
075C 4014              JC      ?C0079
                                           ; SOURCE LINE # 585
075E 900000      E     MOV     DPTR,#c_mem+059H
0761 E0                MOVX    A,@DPTR
0762 FC                MOV     R4,A
0763 A3                INC     DPTR
0764 E0                MOVX    A,@DPTR
0765 FD                MOV     R5,A
0766 A3                INC     DPTR
0767 E0                MOVX    A,@DPTR
0768 FE                MOV     R6,A
0769 A3                INC     DPTR
076A E0                MOVX    A,@DPTR
076B FF                MOV     R7,A
076C 900000      E     MOV     DPTR,#g_ref
076F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 586
0772         ?C0079:
                                           ; SOURCE LINE # 588
0772 900000      E     MOV     DPTR,#c_mem+034H
0775 E0                MOVX    A,@DPTR
0776 7003              JNZ     $ + 5H
0778 020000      R     LJMP    ?C0104
077B 14                DEC     A
077C 7003              JNZ     $ + 5H
077E 020000      R     LJMP    ?C0126
0781 14                DEC     A
0782 7003              JNZ     $ + 5H
0784 020000      R     LJMP    ?C0113
0787 24FE              ADD     A,#0FEH
0789 7003              JNZ     $ + 5H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 58  

078B 020000      R     LJMP    ?C0132
078E 04                INC     A
078F 6003              JZ      $ + 5H
0791 020000      R     LJMP    ?C0082
                                           ; SOURCE LINE # 590
0794         ?C0083:
                                           ; SOURCE LINE # 591
0794 900000      E     MOV     DPTR,#g_meas
0797 E0                MOVX    A,@DPTR
0798 F8                MOV     R0,A
0799 A3                INC     DPTR
079A E0                MOVX    A,@DPTR
079B F9                MOV     R1,A
079C A3                INC     DPTR
079D E0                MOVX    A,@DPTR
079E FA                MOV     R2,A
079F A3                INC     DPTR
07A0 E0                MOVX    A,@DPTR
07A1 FB                MOV     R3,A
07A2 900000      E     MOV     DPTR,#g_ref
07A5 E0                MOVX    A,@DPTR
07A6 FC                MOV     R4,A
07A7 A3                INC     DPTR
07A8 E0                MOVX    A,@DPTR
07A9 FD                MOV     R5,A
07AA A3                INC     DPTR
07AB E0                MOVX    A,@DPTR
07AC FE                MOV     R6,A
07AD A3                INC     DPTR
07AE E0                MOVX    A,@DPTR
07AF C3                CLR     C
07B0 9B                SUBB    A,R3
07B1 F500        R     MOV     pos_error+03H,A
07B3 EE                MOV     A,R6
07B4 9A                SUBB    A,R2
07B5 F500        R     MOV     pos_error+02H,A
07B7 ED                MOV     A,R5
07B8 99                SUBB    A,R1
07B9 F500        R     MOV     pos_error+01H,A
07BB EC                MOV     A,R4
07BC 98                SUBB    A,R0
07BD F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 593
07BF 900000      R     MOV     DPTR,#pos_error_sum
07C2 E0                MOVX    A,@DPTR
07C3 FC                MOV     R4,A
07C4 A3                INC     DPTR
07C5 E0                MOVX    A,@DPTR
07C6 FD                MOV     R5,A
07C7 A3                INC     DPTR
07C8 E0                MOVX    A,@DPTR
07C9 FE                MOV     R6,A
07CA A3                INC     DPTR
07CB E0                MOVX    A,@DPTR
07CC 2500        R     ADD     A,pos_error+03H
07CE FF                MOV     R7,A
07CF EE                MOV     A,R6
07D0 3500        R     ADDC    A,pos_error+02H
07D2 FE                MOV     R6,A
07D3 ED                MOV     A,R5
07D4 3500        R     ADDC    A,pos_error+01H
07D6 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 59  

07D7 EC                MOV     A,R4
07D8 3500        R     ADDC    A,pos_error
07DA FC                MOV     R4,A
07DB 900000      R     MOV     DPTR,#pos_error_sum
07DE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 596
07E1 7F80              MOV     R7,#080H
07E3 7EF0              MOV     R6,#0F0H
07E5 7DFA              MOV     R5,#0FAH
07E7 7C02              MOV     R4,#02H
07E9 900000      R     MOV     DPTR,#pos_error_sum
07EC E0                MOVX    A,@DPTR
07ED F8                MOV     R0,A
07EE A3                INC     DPTR
07EF E0                MOVX    A,@DPTR
07F0 F9                MOV     R1,A
07F1 A3                INC     DPTR
07F2 E0                MOVX    A,@DPTR
07F3 FA                MOV     R2,A
07F4 A3                INC     DPTR
07F5 E0                MOVX    A,@DPTR
07F6 FB                MOV     R3,A
07F7 D3                SETB    C
07F8 120000      E     LCALL   ?C?SLCMP
07FB 4010              JC      ?C0084
                                           ; SOURCE LINE # 597
07FD 7F80              MOV     R7,#080H
07FF 7EF0              MOV     R6,#0F0H
0801 7DFA              MOV     R5,#0FAH
0803 7C02              MOV     R4,#02H
0805 900000      R     MOV     DPTR,#pos_error_sum
0808 120000      E     LCALL   ?C?LSTXDATA
080B 802A              SJMP    ?C0085
080D         ?C0084:
                                           ; SOURCE LINE # 598
                                           ; SOURCE LINE # 599
080D 7F80              MOV     R7,#080H
080F 7E0F              MOV     R6,#0FH
0811 7D05              MOV     R5,#05H
0813 7CFD              MOV     R4,#0FDH
0815 900000      R     MOV     DPTR,#pos_error_sum
0818 E0                MOVX    A,@DPTR
0819 F8                MOV     R0,A
081A A3                INC     DPTR
081B E0                MOVX    A,@DPTR
081C F9                MOV     R1,A
081D A3                INC     DPTR
081E E0                MOVX    A,@DPTR
081F FA                MOV     R2,A
0820 A3                INC     DPTR
0821 E0                MOVX    A,@DPTR
0822 FB                MOV     R3,A
0823 C3                CLR     C
0824 120000      E     LCALL   ?C?SLCMP
0827 500E              JNC     ?C0085
                                           ; SOURCE LINE # 600
0829 7F80              MOV     R7,#080H
082B 7E0F              MOV     R6,#0FH
082D 7D05              MOV     R5,#05H
082F 7CFD              MOV     R4,#0FDH
0831 900000      R     MOV     DPTR,#pos_error_sum
0834 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 60  

                                           ; SOURCE LINE # 601
0837         ?C0085:
                                           ; SOURCE LINE # 605
0837 E4                CLR     A
0838 F500        R     MOV     i_ref+03H,A
083A F500        R     MOV     i_ref+02H,A
083C F500        R     MOV     i_ref+01H,A
083E F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 608
0840 FF                MOV     R7,A
0841 FE                MOV     R6,A
0842 FD                MOV     R5,A
0843 FC                MOV     R4,A
0844 AB00        R     MOV     R3,k_p_dl+03H
0846 AA00        R     MOV     R2,k_p_dl+02H
0848 A900        R     MOV     R1,k_p_dl+01H
084A A800        R     MOV     R0,k_p_dl
084C C3                CLR     C
084D 120000      E     LCALL   ?C?SLCMP
0850 6026              JZ      ?C0087
                                           ; SOURCE LINE # 609
0852 AF00        R     MOV     R7,pos_error+03H
0854 AE00        R     MOV     R6,pos_error+02H
0856 AD00        R     MOV     R5,pos_error+01H
0858 AC00        R     MOV     R4,pos_error
085A A800        R     MOV     R0,k_p_dl
085C 120000      E     LCALL   ?C?LMUL
085F 7810              MOV     R0,#010H
0861 120000      E     LCALL   ?C?SLSHR
0864 E500        R     MOV     A,i_ref+03H
0866 2F                ADD     A,R7
0867 F500        R     MOV     i_ref+03H,A
0869 E500        R     MOV     A,i_ref+02H
086B 3E                ADDC    A,R6
086C F500        R     MOV     i_ref+02H,A
086E E500        R     MOV     A,i_ref+01H
0870 3D                ADDC    A,R5
0871 F500        R     MOV     i_ref+01H,A
0873 E500        R     MOV     A,i_ref
0875 3C                ADDC    A,R4
0876 F500        R     MOV     i_ref,A
0878         ?C0087:
                                           ; SOURCE LINE # 612
0878 E4                CLR     A
0879 FF                MOV     R7,A
087A FE                MOV     R6,A
087B FD                MOV     R5,A
087C FC                MOV     R4,A
087D AB00        R     MOV     R3,k_i_dl+03H
087F AA00        R     MOV     R2,k_i_dl+02H
0881 A900        R     MOV     R1,k_i_dl+01H
0883 A800        R     MOV     R0,k_i_dl
0885 C3                CLR     C
0886 120000      E     LCALL   ?C?SLCMP
0889 602C              JZ      ?C0088
                                           ; SOURCE LINE # 613
088B 900000      R     MOV     DPTR,#pos_error_sum
088E E0                MOVX    A,@DPTR
088F FC                MOV     R4,A
0890 A3                INC     DPTR
0891 E0                MOVX    A,@DPTR
0892 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 61  

0893 A3                INC     DPTR
0894 E0                MOVX    A,@DPTR
0895 FE                MOV     R6,A
0896 A3                INC     DPTR
0897 E0                MOVX    A,@DPTR
0898 FF                MOV     R7,A
0899 A800        R     MOV     R0,k_i_dl
089B 120000      E     LCALL   ?C?LMUL
089E 7810              MOV     R0,#010H
08A0 120000      E     LCALL   ?C?SLSHR
08A3 E500        R     MOV     A,i_ref+03H
08A5 2F                ADD     A,R7
08A6 F500        R     MOV     i_ref+03H,A
08A8 E500        R     MOV     A,i_ref+02H
08AA 3E                ADDC    A,R6
08AB F500        R     MOV     i_ref+02H,A
08AD E500        R     MOV     A,i_ref+01H
08AF 3D                ADDC    A,R5
08B0 F500        R     MOV     i_ref+01H,A
08B2 E500        R     MOV     A,i_ref
08B4 3C                ADDC    A,R4
08B5 F500        R     MOV     i_ref,A
08B7         ?C0088:
                                           ; SOURCE LINE # 616
08B7 E4                CLR     A
08B8 FF                MOV     R7,A
08B9 FE                MOV     R6,A
08BA FD                MOV     R5,A
08BB FC                MOV     R4,A
08BC AB00        R     MOV     R3,k_d_dl+03H
08BE AA00        R     MOV     R2,k_d_dl+02H
08C0 A900        R     MOV     R1,k_d_dl+01H
08C2 A800        R     MOV     R0,k_d_dl
08C4 C3                CLR     C
08C5 120000      E     LCALL   ?C?SLCMP
08C8 6043              JZ      ?C0089
                                           ; SOURCE LINE # 617
08CA 900000      R     MOV     DPTR,#prev_pos_err
08CD E0                MOVX    A,@DPTR
08CE F8                MOV     R0,A
08CF A3                INC     DPTR
08D0 E0                MOVX    A,@DPTR
08D1 F9                MOV     R1,A
08D2 A3                INC     DPTR
08D3 E0                MOVX    A,@DPTR
08D4 FA                MOV     R2,A
08D5 A3                INC     DPTR
08D6 E0                MOVX    A,@DPTR
08D7 FB                MOV     R3,A
08D8 C3                CLR     C
08D9 E500        R     MOV     A,pos_error+03H
08DB 9B                SUBB    A,R3
08DC FF                MOV     R7,A
08DD E500        R     MOV     A,pos_error+02H
08DF 9A                SUBB    A,R2
08E0 FE                MOV     R6,A
08E1 E500        R     MOV     A,pos_error+01H
08E3 99                SUBB    A,R1
08E4 FD                MOV     R5,A
08E5 E500        R     MOV     A,pos_error
08E7 98                SUBB    A,R0
08E8 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 62  

08E9 AB00        R     MOV     R3,k_d_dl+03H
08EB AA00        R     MOV     R2,k_d_dl+02H
08ED A900        R     MOV     R1,k_d_dl+01H
08EF A800        R     MOV     R0,k_d_dl
08F1 120000      E     LCALL   ?C?LMUL
08F4 7810              MOV     R0,#010H
08F6 120000      E     LCALL   ?C?SLSHR
08F9 E500        R     MOV     A,i_ref+03H
08FB 2F                ADD     A,R7
08FC F500        R     MOV     i_ref+03H,A
08FE E500        R     MOV     A,i_ref+02H
0900 3E                ADDC    A,R6
0901 F500        R     MOV     i_ref+02H,A
0903 E500        R     MOV     A,i_ref+01H
0905 3D                ADDC    A,R5
0906 F500        R     MOV     i_ref+01H,A
0908 E500        R     MOV     A,i_ref
090A 3C                ADDC    A,R4
090B F500        R     MOV     i_ref,A
090D         ?C0089:
                                           ; SOURCE LINE # 620
090D AF00        R     MOV     R7,pos_error+03H
090F AE00        R     MOV     R6,pos_error+02H
0911 AD00        R     MOV     R5,pos_error+01H
0913 AC00        R     MOV     R4,pos_error
0915 900000      R     MOV     DPTR,#prev_pos_err
0918 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 626
091B E4                CLR     A
091C FF                MOV     R7,A
091D FE                MOV     R6,A
091E FD                MOV     R5,A
091F FC                MOV     R4,A
0920 AB00        R     MOV     R3,i_ref+03H
0922 AA00        R     MOV     R2,i_ref+02H
0924 A900        R     MOV     R1,i_ref+01H
0926 A800        R     MOV     R0,i_ref
0928 C3                CLR     C
0929 120000      E     LCALL   ?C?SLCMP
092C 4004              JC      ?C0090
                                           ; SOURCE LINE # 627
092E D200        R     SETB    motor_dir
0930 8002              SJMP    ?C0091
0932         ?C0090:
                                           ; SOURCE LINE # 629
0932 C200        R     CLR     motor_dir
0934         ?C0091:
                                           ; SOURCE LINE # 635
0934 900000      E     MOV     DPTR,#c_mem+069H
0937 E0                MOVX    A,@DPTR
0938 FE                MOV     R6,A
0939 A3                INC     DPTR
093A E0                MOVX    A,@DPTR
093B FF                MOV     R7,A
093C EE                MOV     A,R6
093D 33                RLC     A
093E 95E0              SUBB    A,ACC
0940 FD                MOV     R5,A
0941 FC                MOV     R4,A
0942 AB00        R     MOV     R3,i_ref+03H
0944 AA00        R     MOV     R2,i_ref+02H
0946 A900        R     MOV     R1,i_ref+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 63  

0948 A800        R     MOV     R0,i_ref
094A D3                SETB    C
094B 120000      E     LCALL   ?C?SLCMP
094E 4016              JC      ?C0092
                                           ; SOURCE LINE # 636
0950 900000      E     MOV     DPTR,#c_mem+069H
0953 E0                MOVX    A,@DPTR
0954 FE                MOV     R6,A
0955 A3                INC     DPTR
0956 E0                MOVX    A,@DPTR
0957 FF                MOV     R7,A
0958 EE                MOV     A,R6
0959 33                RLC     A
095A 95E0              SUBB    A,ACC
095C 8F00        R     MOV     i_ref+03H,R7
095E 8E00        R     MOV     i_ref+02H,R6
0960 F500        R     MOV     i_ref+01H,A
0962 F500        R     MOV     i_ref,A
0964 803C              SJMP    ?C0093
0966         ?C0092:
                                           ; SOURCE LINE # 637
                                           ; SOURCE LINE # 638
0966 900000      E     MOV     DPTR,#c_mem+069H
0969 E0                MOVX    A,@DPTR
096A FE                MOV     R6,A
096B A3                INC     DPTR
096C E0                MOVX    A,@DPTR
096D FF                MOV     R7,A
096E C3                CLR     C
096F E4                CLR     A
0970 9F                SUBB    A,R7
0971 FF                MOV     R7,A
0972 E4                CLR     A
0973 9E                SUBB    A,R6
0974 FE                MOV     R6,A
0975 33                RLC     A
0976 95E0              SUBB    A,ACC
0978 FD                MOV     R5,A
0979 FC                MOV     R4,A
097A AB00        R     MOV     R3,i_ref+03H
097C AA00        R     MOV     R2,i_ref+02H
097E A900        R     MOV     R1,i_ref+01H
0980 A800        R     MOV     R0,i_ref
0982 C3                CLR     C
0983 120000      E     LCALL   ?C?SLCMP
0986 501A              JNC     ?C0093
                                           ; SOURCE LINE # 639
0988 900000      E     MOV     DPTR,#c_mem+069H
098B E0                MOVX    A,@DPTR
098C FE                MOV     R6,A
098D A3                INC     DPTR
098E E0                MOVX    A,@DPTR
098F FF                MOV     R7,A
0990 C3                CLR     C
0991 E4                CLR     A
0992 9F                SUBB    A,R7
0993 FF                MOV     R7,A
0994 E4                CLR     A
0995 9E                SUBB    A,R6
0996 FE                MOV     R6,A
0997 33                RLC     A
0998 95E0              SUBB    A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 64  

099A 8F00        R     MOV     i_ref+03H,R7
099C 8E00        R     MOV     i_ref+02H,R6
099E F500        R     MOV     i_ref+01H,A
09A0 F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 640
09A2         ?C0093:
                                           ; SOURCE LINE # 651
09A2 900000      E     MOV     DPTR,#g_meas+0CH
09A5 E0                MOVX    A,@DPTR
09A6 F8                MOV     R0,A
09A7 A3                INC     DPTR
09A8 E0                MOVX    A,@DPTR
09A9 F9                MOV     R1,A
09AA A3                INC     DPTR
09AB E0                MOVX    A,@DPTR
09AC FA                MOV     R2,A
09AD A3                INC     DPTR
09AE E0                MOVX    A,@DPTR
09AF FB                MOV     R3,A
09B0 C3                CLR     C
09B1 E500        R     MOV     A,i_ref+03H
09B3 9B                SUBB    A,R3
09B4 F500        R     MOV     curr_error+03H,A
09B6 E500        R     MOV     A,i_ref+02H
09B8 9A                SUBB    A,R2
09B9 F500        R     MOV     curr_error+02H,A
09BB E500        R     MOV     A,i_ref+01H
09BD 99                SUBB    A,R1
09BE F500        R     MOV     curr_error+01H,A
09C0 E500        R     MOV     A,i_ref
09C2 98                SUBB    A,R0
09C3 F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 652
09C5 900000      R     MOV     DPTR,#curr_error_sum
09C8 E0                MOVX    A,@DPTR
09C9 FC                MOV     R4,A
09CA A3                INC     DPTR
09CB E0                MOVX    A,@DPTR
09CC FD                MOV     R5,A
09CD A3                INC     DPTR
09CE E0                MOVX    A,@DPTR
09CF FE                MOV     R6,A
09D0 A3                INC     DPTR
09D1 E0                MOVX    A,@DPTR
09D2 2500        R     ADD     A,curr_error+03H
09D4 FF                MOV     R7,A
09D5 EE                MOV     A,R6
09D6 3500        R     ADDC    A,curr_error+02H
09D8 FE                MOV     R6,A
09D9 ED                MOV     A,R5
09DA 3500        R     ADDC    A,curr_error+01H
09DC FD                MOV     R5,A
09DD EC                MOV     A,R4
09DE 3500        R     ADDC    A,curr_error
09E0 FC                MOV     R4,A
09E1 900000      R     MOV     DPTR,#curr_error_sum
09E4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 654
09E7 7FA0              MOV     R7,#0A0H
09E9 7E86              MOV     R6,#086H
09EB 7D01              MOV     R5,#01H
09ED 7C00              MOV     R4,#00H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 65  

09EF 900000      R     MOV     DPTR,#curr_error_sum
09F2 E0                MOVX    A,@DPTR
09F3 F8                MOV     R0,A
09F4 A3                INC     DPTR
09F5 E0                MOVX    A,@DPTR
09F6 F9                MOV     R1,A
09F7 A3                INC     DPTR
09F8 E0                MOVX    A,@DPTR
09F9 FA                MOV     R2,A
09FA A3                INC     DPTR
09FB E0                MOVX    A,@DPTR
09FC FB                MOV     R3,A
09FD D3                SETB    C
09FE 120000      E     LCALL   ?C?SLCMP
0A01 4010              JC      ?C0095
                                           ; SOURCE LINE # 655
0A03 7FA0              MOV     R7,#0A0H
0A05 7E86              MOV     R6,#086H
0A07 7D01              MOV     R5,#01H
0A09 7C00              MOV     R4,#00H
0A0B 900000      R     MOV     DPTR,#curr_error_sum
0A0E 120000      E     LCALL   ?C?LSTXDATA
0A11 802A              SJMP    ?C0096
0A13         ?C0095:
                                           ; SOURCE LINE # 656
                                           ; SOURCE LINE # 657
0A13 7F60              MOV     R7,#060H
0A15 7E79              MOV     R6,#079H
0A17 7DFE              MOV     R5,#0FEH
0A19 7CFF              MOV     R4,#0FFH
0A1B 900000      R     MOV     DPTR,#curr_error_sum
0A1E E0                MOVX    A,@DPTR
0A1F F8                MOV     R0,A
0A20 A3                INC     DPTR
0A21 E0                MOVX    A,@DPTR
0A22 F9                MOV     R1,A
0A23 A3                INC     DPTR
0A24 E0                MOVX    A,@DPTR
0A25 FA                MOV     R2,A
0A26 A3                INC     DPTR
0A27 E0                MOVX    A,@DPTR
0A28 FB                MOV     R3,A
0A29 C3                CLR     C
0A2A 120000      E     LCALL   ?C?SLCMP
0A2D 500E              JNC     ?C0096
                                           ; SOURCE LINE # 658
0A2F 7F60              MOV     R7,#060H
0A31 7E79              MOV     R6,#079H
0A33 7DFE              MOV     R5,#0FEH
0A35 7CFF              MOV     R4,#0FFH
0A37 900000      R     MOV     DPTR,#curr_error_sum
0A3A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 659
0A3D         ?C0096:
                                           ; SOURCE LINE # 663
0A3D E4                CLR     A
0A3E F500        R     MOV     pwm_input+03H,A
0A40 F500        R     MOV     pwm_input+02H,A
0A42 F500        R     MOV     pwm_input+01H,A
0A44 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 666
0A46 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 66  

0A47 FE                MOV     R6,A
0A48 FD                MOV     R5,A
0A49 FC                MOV     R4,A
0A4A AB00        R     MOV     R3,k_p_c_dl+03H
0A4C AA00        R     MOV     R2,k_p_c_dl+02H
0A4E A900        R     MOV     R1,k_p_c_dl+01H
0A50 A800        R     MOV     R0,k_p_c_dl
0A52 C3                CLR     C
0A53 120000      E     LCALL   ?C?SLCMP
0A56 6026              JZ      ?C0098
                                           ; SOURCE LINE # 667
0A58 AF00        R     MOV     R7,curr_error+03H
0A5A AE00        R     MOV     R6,curr_error+02H
0A5C AD00        R     MOV     R5,curr_error+01H
0A5E AC00        R     MOV     R4,curr_error
0A60 A800        R     MOV     R0,k_p_c_dl
0A62 120000      E     LCALL   ?C?LMUL
0A65 7810              MOV     R0,#010H
0A67 120000      E     LCALL   ?C?SLSHR
0A6A E500        R     MOV     A,pwm_input+03H
0A6C 2F                ADD     A,R7
0A6D F500        R     MOV     pwm_input+03H,A
0A6F E500        R     MOV     A,pwm_input+02H
0A71 3E                ADDC    A,R6
0A72 F500        R     MOV     pwm_input+02H,A
0A74 E500        R     MOV     A,pwm_input+01H
0A76 3D                ADDC    A,R5
0A77 F500        R     MOV     pwm_input+01H,A
0A79 E500        R     MOV     A,pwm_input
0A7B 3C                ADDC    A,R4
0A7C F500        R     MOV     pwm_input,A
0A7E         ?C0098:
                                           ; SOURCE LINE # 670
0A7E E4                CLR     A
0A7F FF                MOV     R7,A
0A80 FE                MOV     R6,A
0A81 FD                MOV     R5,A
0A82 FC                MOV     R4,A
0A83 AB00        R     MOV     R3,k_i_c_dl+03H
0A85 AA00        R     MOV     R2,k_i_c_dl+02H
0A87 A900        R     MOV     R1,k_i_c_dl+01H
0A89 A800        R     MOV     R0,k_i_c_dl
0A8B C3                CLR     C
0A8C 120000      E     LCALL   ?C?SLCMP
0A8F 602C              JZ      ?C0099
                                           ; SOURCE LINE # 671
0A91 900000      R     MOV     DPTR,#curr_error_sum
0A94 E0                MOVX    A,@DPTR
0A95 FC                MOV     R4,A
0A96 A3                INC     DPTR
0A97 E0                MOVX    A,@DPTR
0A98 FD                MOV     R5,A
0A99 A3                INC     DPTR
0A9A E0                MOVX    A,@DPTR
0A9B FE                MOV     R6,A
0A9C A3                INC     DPTR
0A9D E0                MOVX    A,@DPTR
0A9E FF                MOV     R7,A
0A9F A800        R     MOV     R0,k_i_c_dl
0AA1 120000      E     LCALL   ?C?LMUL
0AA4 7810              MOV     R0,#010H
0AA6 120000      E     LCALL   ?C?SLSHR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 67  

0AA9 E500        R     MOV     A,pwm_input+03H
0AAB 2F                ADD     A,R7
0AAC F500        R     MOV     pwm_input+03H,A
0AAE E500        R     MOV     A,pwm_input+02H
0AB0 3E                ADDC    A,R6
0AB1 F500        R     MOV     pwm_input+02H,A
0AB3 E500        R     MOV     A,pwm_input+01H
0AB5 3D                ADDC    A,R5
0AB6 F500        R     MOV     pwm_input+01H,A
0AB8 E500        R     MOV     A,pwm_input
0ABA 3C                ADDC    A,R4
0ABB F500        R     MOV     pwm_input,A
0ABD         ?C0099:
                                           ; SOURCE LINE # 674
0ABD E4                CLR     A
0ABE FF                MOV     R7,A
0ABF FE                MOV     R6,A
0AC0 FD                MOV     R5,A
0AC1 FC                MOV     R4,A
0AC2 AB00        R     MOV     R3,k_d_c_dl+03H
0AC4 AA00        R     MOV     R2,k_d_c_dl+02H
0AC6 A900        R     MOV     R1,k_d_c_dl+01H
0AC8 A800        R     MOV     R0,k_d_c_dl
0ACA C3                CLR     C
0ACB 120000      E     LCALL   ?C?SLCMP
0ACE 6043              JZ      ?C0100
                                           ; SOURCE LINE # 675
0AD0 900000      R     MOV     DPTR,#prev_curr_err
0AD3 E0                MOVX    A,@DPTR
0AD4 F8                MOV     R0,A
0AD5 A3                INC     DPTR
0AD6 E0                MOVX    A,@DPTR
0AD7 F9                MOV     R1,A
0AD8 A3                INC     DPTR
0AD9 E0                MOVX    A,@DPTR
0ADA FA                MOV     R2,A
0ADB A3                INC     DPTR
0ADC E0                MOVX    A,@DPTR
0ADD FB                MOV     R3,A
0ADE C3                CLR     C
0ADF E500        R     MOV     A,curr_error+03H
0AE1 9B                SUBB    A,R3
0AE2 FF                MOV     R7,A
0AE3 E500        R     MOV     A,curr_error+02H
0AE5 9A                SUBB    A,R2
0AE6 FE                MOV     R6,A
0AE7 E500        R     MOV     A,curr_error+01H
0AE9 99                SUBB    A,R1
0AEA FD                MOV     R5,A
0AEB E500        R     MOV     A,curr_error
0AED 98                SUBB    A,R0
0AEE FC                MOV     R4,A
0AEF AB00        R     MOV     R3,k_d_c_dl+03H
0AF1 AA00        R     MOV     R2,k_d_c_dl+02H
0AF3 A900        R     MOV     R1,k_d_c_dl+01H
0AF5 A800        R     MOV     R0,k_d_c_dl
0AF7 120000      E     LCALL   ?C?LMUL
0AFA 7810              MOV     R0,#010H
0AFC 120000      E     LCALL   ?C?SLSHR
0AFF E500        R     MOV     A,pwm_input+03H
0B01 2F                ADD     A,R7
0B02 F500        R     MOV     pwm_input+03H,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 68  

0B04 E500        R     MOV     A,pwm_input+02H
0B06 3E                ADDC    A,R6
0B07 F500        R     MOV     pwm_input+02H,A
0B09 E500        R     MOV     A,pwm_input+01H
0B0B 3D                ADDC    A,R5
0B0C F500        R     MOV     pwm_input+01H,A
0B0E E500        R     MOV     A,pwm_input
0B10 3C                ADDC    A,R4
0B11 F500        R     MOV     pwm_input,A
0B13         ?C0100:
                                           ; SOURCE LINE # 678
0B13 74FF              MOV     A,#0FFH
0B15 7F9C              MOV     R7,#09CH
0B17 FE                MOV     R6,A
0B18 FD                MOV     R5,A
0B19 FC                MOV     R4,A
0B1A AB00        R     MOV     R3,pwm_input+03H
0B1C AA00        R     MOV     R2,pwm_input+02H
0B1E A900        R     MOV     R1,pwm_input+01H
0B20 A800        R     MOV     R0,pwm_input
0B22 C3                CLR     C
0B23 120000      E     LCALL   ?C?SLCMP
0B26 500D              JNC     ?C0101
                                           ; SOURCE LINE # 679
0B28 74FF              MOV     A,#0FFH
0B2A 75009C      R     MOV     pwm_input+03H,#09CH
0B2D F500        R     MOV     pwm_input+02H,A
0B2F F500        R     MOV     pwm_input+01H,A
0B31 F500        R     MOV     pwm_input,A
0B33 801E              SJMP    ?C0102
0B35         ?C0101:
                                           ; SOURCE LINE # 680
                                           ; SOURCE LINE # 681
0B35 E4                CLR     A
0B36 7F64              MOV     R7,#064H
0B38 FE                MOV     R6,A
0B39 FD                MOV     R5,A
0B3A FC                MOV     R4,A
0B3B AB00        R     MOV     R3,pwm_input+03H
0B3D AA00        R     MOV     R2,pwm_input+02H
0B3F A900        R     MOV     R1,pwm_input+01H
0B41 A800        R     MOV     R0,pwm_input
0B43 D3                SETB    C
0B44 120000      E     LCALL   ?C?SLCMP
0B47 400A              JC      ?C0102
                                           ; SOURCE LINE # 682
0B49 E4                CLR     A
0B4A 750064      R     MOV     pwm_input+03H,#064H
0B4D F500        R     MOV     pwm_input+02H,A
0B4F F500        R     MOV     pwm_input+01H,A
0B51 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 683
0B53         ?C0102:
                                           ; SOURCE LINE # 686
0B53 AF00        R     MOV     R7,curr_error+03H
0B55 AE00        R     MOV     R6,curr_error+02H
0B57 AD00        R     MOV     R5,curr_error+01H
0B59 AC00        R     MOV     R4,curr_error
0B5B 900000      R     MOV     DPTR,#prev_curr_err
0B5E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 688
0B61 020000      R     LJMP    ?C0082
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 69  

                                           ; SOURCE LINE # 691
0B64         ?C0104:
                                           ; SOURCE LINE # 692
0B64 900000      E     MOV     DPTR,#g_meas
0B67 E0                MOVX    A,@DPTR
0B68 F8                MOV     R0,A
0B69 A3                INC     DPTR
0B6A E0                MOVX    A,@DPTR
0B6B F9                MOV     R1,A
0B6C A3                INC     DPTR
0B6D E0                MOVX    A,@DPTR
0B6E FA                MOV     R2,A
0B6F A3                INC     DPTR
0B70 E0                MOVX    A,@DPTR
0B71 FB                MOV     R3,A
0B72 900000      E     MOV     DPTR,#g_ref
0B75 E0                MOVX    A,@DPTR
0B76 FC                MOV     R4,A
0B77 A3                INC     DPTR
0B78 E0                MOVX    A,@DPTR
0B79 FD                MOV     R5,A
0B7A A3                INC     DPTR
0B7B E0                MOVX    A,@DPTR
0B7C FE                MOV     R6,A
0B7D A3                INC     DPTR
0B7E E0                MOVX    A,@DPTR
0B7F C3                CLR     C
0B80 9B                SUBB    A,R3
0B81 F500        R     MOV     pos_error+03H,A
0B83 EE                MOV     A,R6
0B84 9A                SUBB    A,R2
0B85 F500        R     MOV     pos_error+02H,A
0B87 ED                MOV     A,R5
0B88 99                SUBB    A,R1
0B89 F500        R     MOV     pos_error+01H,A
0B8B EC                MOV     A,R4
0B8C 98                SUBB    A,R0
0B8D F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 694
0B8F 900000      R     MOV     DPTR,#pos_error_sum
0B92 E0                MOVX    A,@DPTR
0B93 FC                MOV     R4,A
0B94 A3                INC     DPTR
0B95 E0                MOVX    A,@DPTR
0B96 FD                MOV     R5,A
0B97 A3                INC     DPTR
0B98 E0                MOVX    A,@DPTR
0B99 FE                MOV     R6,A
0B9A A3                INC     DPTR
0B9B E0                MOVX    A,@DPTR
0B9C 2500        R     ADD     A,pos_error+03H
0B9E FF                MOV     R7,A
0B9F EE                MOV     A,R6
0BA0 3500        R     ADDC    A,pos_error+02H
0BA2 FE                MOV     R6,A
0BA3 ED                MOV     A,R5
0BA4 3500        R     ADDC    A,pos_error+01H
0BA6 FD                MOV     R5,A
0BA7 EC                MOV     A,R4
0BA8 3500        R     ADDC    A,pos_error
0BAA FC                MOV     R4,A
0BAB 900000      R     MOV     DPTR,#pos_error_sum
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 70  

0BAE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 697
0BB1 E4                CLR     A
0BB2 7FE8              MOV     R7,#0E8H
0BB4 7E03              MOV     R6,#03H
0BB6 FD                MOV     R5,A
0BB7 FC                MOV     R4,A
0BB8 900000      R     MOV     DPTR,#pos_error_sum
0BBB E0                MOVX    A,@DPTR
0BBC F8                MOV     R0,A
0BBD A3                INC     DPTR
0BBE E0                MOVX    A,@DPTR
0BBF F9                MOV     R1,A
0BC0 A3                INC     DPTR
0BC1 E0                MOVX    A,@DPTR
0BC2 FA                MOV     R2,A
0BC3 A3                INC     DPTR
0BC4 E0                MOVX    A,@DPTR
0BC5 FB                MOV     R3,A
0BC6 D3                SETB    C
0BC7 120000      E     LCALL   ?C?SLCMP
0BCA 400F              JC      ?C0105
                                           ; SOURCE LINE # 698
0BCC E4                CLR     A
0BCD 7FE8              MOV     R7,#0E8H
0BCF 7E03              MOV     R6,#03H
0BD1 FD                MOV     R5,A
0BD2 FC                MOV     R4,A
0BD3 900000      R     MOV     DPTR,#pos_error_sum
0BD6 120000      E     LCALL   ?C?LSTXDATA
0BD9 802A              SJMP    ?C0106
0BDB         ?C0105:
                                           ; SOURCE LINE # 699
                                           ; SOURCE LINE # 700
0BDB 7F18              MOV     R7,#018H
0BDD 7EFC              MOV     R6,#0FCH
0BDF 7DFF              MOV     R5,#0FFH
0BE1 7CFF              MOV     R4,#0FFH
0BE3 900000      R     MOV     DPTR,#pos_error_sum
0BE6 E0                MOVX    A,@DPTR
0BE7 F8                MOV     R0,A
0BE8 A3                INC     DPTR
0BE9 E0                MOVX    A,@DPTR
0BEA F9                MOV     R1,A
0BEB A3                INC     DPTR
0BEC E0                MOVX    A,@DPTR
0BED FA                MOV     R2,A
0BEE A3                INC     DPTR
0BEF E0                MOVX    A,@DPTR
0BF0 FB                MOV     R3,A
0BF1 C3                CLR     C
0BF2 120000      E     LCALL   ?C?SLCMP
0BF5 500E              JNC     ?C0106
                                           ; SOURCE LINE # 701
0BF7 7F18              MOV     R7,#018H
0BF9 7EFC              MOV     R6,#0FCH
0BFB 7DFF              MOV     R5,#0FFH
0BFD 7CFF              MOV     R4,#0FFH
0BFF 900000      R     MOV     DPTR,#pos_error_sum
0C02 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 702
0C05         ?C0106:
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 71  

                                           ; SOURCE LINE # 705
0C05 E4                CLR     A
0C06 FF                MOV     R7,A
0C07 FE                MOV     R6,A
0C08 FD                MOV     R5,A
0C09 FC                MOV     R4,A
0C0A AB00        R     MOV     R3,k_p+03H
0C0C AA00        R     MOV     R2,k_p+02H
0C0E A900        R     MOV     R1,k_p+01H
0C10 A800        R     MOV     R0,k_p
0C12 C3                CLR     C
0C13 120000      E     LCALL   ?C?SLCMP
0C16 601A              JZ      ?C0108
                                           ; SOURCE LINE # 706
0C18 AF00        R     MOV     R7,pos_error+03H
0C1A AE00        R     MOV     R6,pos_error+02H
0C1C AD00        R     MOV     R5,pos_error+01H
0C1E AC00        R     MOV     R4,pos_error
0C20 A800        R     MOV     R0,k_p
0C22 120000      E     LCALL   ?C?LMUL
0C25 7810              MOV     R0,#010H
0C27 120000      E     LCALL   ?C?SLSHR
0C2A 8F00        R     MOV     pwm_input+03H,R7
0C2C 8E00        R     MOV     pwm_input+02H,R6
0C2E 8D00        R     MOV     pwm_input+01H,R5
0C30 8C00        R     MOV     pwm_input,R4
0C32         ?C0108:
                                           ; SOURCE LINE # 710
0C32 E4                CLR     A
0C33 FF                MOV     R7,A
0C34 FE                MOV     R6,A
0C35 FD                MOV     R5,A
0C36 FC                MOV     R4,A
0C37 AB00        R     MOV     R3,k_i+03H
0C39 AA00        R     MOV     R2,k_i+02H
0C3B A900        R     MOV     R1,k_i+01H
0C3D A800        R     MOV     R0,k_i
0C3F C3                CLR     C
0C40 120000      E     LCALL   ?C?SLCMP
0C43 602C              JZ      ?C0109
                                           ; SOURCE LINE # 711
0C45 900000      R     MOV     DPTR,#pos_error_sum
0C48 E0                MOVX    A,@DPTR
0C49 FC                MOV     R4,A
0C4A A3                INC     DPTR
0C4B E0                MOVX    A,@DPTR
0C4C FD                MOV     R5,A
0C4D A3                INC     DPTR
0C4E E0                MOVX    A,@DPTR
0C4F FE                MOV     R6,A
0C50 A3                INC     DPTR
0C51 E0                MOVX    A,@DPTR
0C52 FF                MOV     R7,A
0C53 A800        R     MOV     R0,k_i
0C55 120000      E     LCALL   ?C?LMUL
0C58 7810              MOV     R0,#010H
0C5A 120000      E     LCALL   ?C?SLSHR
0C5D E500        R     MOV     A,pwm_input+03H
0C5F 2F                ADD     A,R7
0C60 F500        R     MOV     pwm_input+03H,A
0C62 E500        R     MOV     A,pwm_input+02H
0C64 3E                ADDC    A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 72  

0C65 F500        R     MOV     pwm_input+02H,A
0C67 E500        R     MOV     A,pwm_input+01H
0C69 3D                ADDC    A,R5
0C6A F500        R     MOV     pwm_input+01H,A
0C6C E500        R     MOV     A,pwm_input
0C6E 3C                ADDC    A,R4
0C6F F500        R     MOV     pwm_input,A
0C71         ?C0109:
                                           ; SOURCE LINE # 715
0C71 E4                CLR     A
0C72 FF                MOV     R7,A
0C73 FE                MOV     R6,A
0C74 FD                MOV     R5,A
0C75 FC                MOV     R4,A
0C76 AB00        R     MOV     R3,k_d+03H
0C78 AA00        R     MOV     R2,k_d+02H
0C7A A900        R     MOV     R1,k_d+01H
0C7C A800        R     MOV     R0,k_d
0C7E C3                CLR     C
0C7F 120000      E     LCALL   ?C?SLCMP
0C82 6043              JZ      ?C0110
                                           ; SOURCE LINE # 716
0C84 900000      R     MOV     DPTR,#prev_pos_err
0C87 E0                MOVX    A,@DPTR
0C88 F8                MOV     R0,A
0C89 A3                INC     DPTR
0C8A E0                MOVX    A,@DPTR
0C8B F9                MOV     R1,A
0C8C A3                INC     DPTR
0C8D E0                MOVX    A,@DPTR
0C8E FA                MOV     R2,A
0C8F A3                INC     DPTR
0C90 E0                MOVX    A,@DPTR
0C91 FB                MOV     R3,A
0C92 C3                CLR     C
0C93 E500        R     MOV     A,pos_error+03H
0C95 9B                SUBB    A,R3
0C96 FF                MOV     R7,A
0C97 E500        R     MOV     A,pos_error+02H
0C99 9A                SUBB    A,R2
0C9A FE                MOV     R6,A
0C9B E500        R     MOV     A,pos_error+01H
0C9D 99                SUBB    A,R1
0C9E FD                MOV     R5,A
0C9F E500        R     MOV     A,pos_error
0CA1 98                SUBB    A,R0
0CA2 FC                MOV     R4,A
0CA3 AB00        R     MOV     R3,k_d+03H
0CA5 AA00        R     MOV     R2,k_d+02H
0CA7 A900        R     MOV     R1,k_d+01H
0CA9 A800        R     MOV     R0,k_d
0CAB 120000      E     LCALL   ?C?LMUL
0CAE 7810              MOV     R0,#010H
0CB0 120000      E     LCALL   ?C?SLSHR
0CB3 E500        R     MOV     A,pwm_input+03H
0CB5 2F                ADD     A,R7
0CB6 F500        R     MOV     pwm_input+03H,A
0CB8 E500        R     MOV     A,pwm_input+02H
0CBA 3E                ADDC    A,R6
0CBB F500        R     MOV     pwm_input+02H,A
0CBD E500        R     MOV     A,pwm_input+01H
0CBF 3D                ADDC    A,R5
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 73  

0CC0 F500        R     MOV     pwm_input+01H,A
0CC2 E500        R     MOV     A,pwm_input
0CC4 3C                ADDC    A,R4
0CC5 F500        R     MOV     pwm_input,A
0CC7         ?C0110:
                                           ; SOURCE LINE # 720
0CC7 AF00        R     MOV     R7,pos_error+03H
0CC9 AE00        R     MOV     R6,pos_error+02H
0CCB AD00        R     MOV     R5,pos_error+01H
0CCD AC00        R     MOV     R4,pos_error
0CCF 900000      R     MOV     DPTR,#prev_pos_err
0CD2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 722
0CD5 E4                CLR     A
0CD6 FF                MOV     R7,A
0CD7 FE                MOV     R6,A
0CD8 FD                MOV     R5,A
0CD9 FC                MOV     R4,A
0CDA AB00        R     MOV     R3,pwm_input+03H
0CDC AA00        R     MOV     R2,pwm_input+02H
0CDE A900        R     MOV     R1,pwm_input+01H
0CE0 A800        R     MOV     R0,pwm_input
0CE2 D3                SETB    C
0CE3 120000      E     LCALL   ?C?SLCMP
0CE6 4005              JC      ?C0111
                                           ; SOURCE LINE # 723
0CE8 D200        R     SETB    motor_dir
0CEA 020000      R     LJMP    ?C0082
0CED         ?C0111:
                                           ; SOURCE LINE # 725
0CED C200        R     CLR     motor_dir
                                           ; SOURCE LINE # 727
0CEF 020000      R     LJMP    ?C0082
                                           ; SOURCE LINE # 730
0CF2         ?C0113:
                                           ; SOURCE LINE # 731
0CF2 900000      E     MOV     DPTR,#g_ref+018H
0CF5 E0                MOVX    A,@DPTR
0CF6 7003              JNZ     $ + 5H
0CF8 020000      R     LJMP    ?C0082
0CFB 200003      E     JB      tension_valid,$ + 6H
0CFE 020000      R     LJMP    ?C0082
                                           ; SOURCE LINE # 733
0D01 900000      E     MOV     DPTR,#g_ref+08H
0D04 E0                MOVX    A,@DPTR
0D05 FC                MOV     R4,A
0D06 A3                INC     DPTR
0D07 E0                MOVX    A,@DPTR
0D08 FD                MOV     R5,A
0D09 A3                INC     DPTR
0D0A E0                MOVX    A,@DPTR
0D0B FE                MOV     R6,A
0D0C A3                INC     DPTR
0D0D E0                MOVX    A,@DPTR
0D0E F500        R     MOV     i_ref+03H,A
0D10 8E00        R     MOV     i_ref+02H,R6
0D12 8D00        R     MOV     i_ref+01H,R5
0D14 8C00        R     MOV     i_ref,R4
                                           ; SOURCE LINE # 735
0D16 900000      E     MOV     DPTR,#c_mem+069H
0D19 E0                MOVX    A,@DPTR
0D1A FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 74  

0D1B A3                INC     DPTR
0D1C E0                MOVX    A,@DPTR
0D1D FF                MOV     R7,A
0D1E EE                MOV     A,R6
0D1F 33                RLC     A
0D20 95E0              SUBB    A,ACC
0D22 FD                MOV     R5,A
0D23 FC                MOV     R4,A
0D24 AB00        R     MOV     R3,i_ref+03H
0D26 AA00        R     MOV     R2,i_ref+02H
0D28 A900        R     MOV     R1,i_ref+01H
0D2A A800        R     MOV     R0,i_ref
0D2C D3                SETB    C
0D2D 120000      E     LCALL   ?C?SLCMP
0D30 4016              JC      ?C0115
                                           ; SOURCE LINE # 736
0D32 900000      E     MOV     DPTR,#c_mem+069H
0D35 E0                MOVX    A,@DPTR
0D36 FE                MOV     R6,A
0D37 A3                INC     DPTR
0D38 E0                MOVX    A,@DPTR
0D39 FF                MOV     R7,A
0D3A EE                MOV     A,R6
0D3B 33                RLC     A
0D3C 95E0              SUBB    A,ACC
0D3E 8F00        R     MOV     i_ref+03H,R7
0D40 8E00        R     MOV     i_ref+02H,R6
0D42 F500        R     MOV     i_ref+01H,A
0D44 F500        R     MOV     i_ref,A
0D46 803C              SJMP    ?C0116
0D48         ?C0115:
                                           ; SOURCE LINE # 737
                                           ; SOURCE LINE # 738
0D48 900000      E     MOV     DPTR,#c_mem+069H
0D4B E0                MOVX    A,@DPTR
0D4C FE                MOV     R6,A
0D4D A3                INC     DPTR
0D4E E0                MOVX    A,@DPTR
0D4F FF                MOV     R7,A
0D50 C3                CLR     C
0D51 E4                CLR     A
0D52 9F                SUBB    A,R7
0D53 FF                MOV     R7,A
0D54 E4                CLR     A
0D55 9E                SUBB    A,R6
0D56 FE                MOV     R6,A
0D57 33                RLC     A
0D58 95E0              SUBB    A,ACC
0D5A FD                MOV     R5,A
0D5B FC                MOV     R4,A
0D5C AB00        R     MOV     R3,i_ref+03H
0D5E AA00        R     MOV     R2,i_ref+02H
0D60 A900        R     MOV     R1,i_ref+01H
0D62 A800        R     MOV     R0,i_ref
0D64 C3                CLR     C
0D65 120000      E     LCALL   ?C?SLCMP
0D68 501A              JNC     ?C0116
                                           ; SOURCE LINE # 739
0D6A 900000      E     MOV     DPTR,#c_mem+069H
0D6D E0                MOVX    A,@DPTR
0D6E FE                MOV     R6,A
0D6F A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 75  

0D70 E0                MOVX    A,@DPTR
0D71 FF                MOV     R7,A
0D72 C3                CLR     C
0D73 E4                CLR     A
0D74 9F                SUBB    A,R7
0D75 FF                MOV     R7,A
0D76 E4                CLR     A
0D77 9E                SUBB    A,R6
0D78 FE                MOV     R6,A
0D79 33                RLC     A
0D7A 95E0              SUBB    A,ACC
0D7C 8F00        R     MOV     i_ref+03H,R7
0D7E 8E00        R     MOV     i_ref+02H,R6
0D80 F500        R     MOV     i_ref+01H,A
0D82 F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 740
0D84         ?C0116:
                                           ; SOURCE LINE # 743
0D84 900000      E     MOV     DPTR,#g_meas+0CH
0D87 E0                MOVX    A,@DPTR
0D88 F8                MOV     R0,A
0D89 A3                INC     DPTR
0D8A E0                MOVX    A,@DPTR
0D8B F9                MOV     R1,A
0D8C A3                INC     DPTR
0D8D E0                MOVX    A,@DPTR
0D8E FA                MOV     R2,A
0D8F A3                INC     DPTR
0D90 E0                MOVX    A,@DPTR
0D91 FB                MOV     R3,A
0D92 C3                CLR     C
0D93 E500        R     MOV     A,i_ref+03H
0D95 9B                SUBB    A,R3
0D96 F500        R     MOV     curr_error+03H,A
0D98 E500        R     MOV     A,i_ref+02H
0D9A 9A                SUBB    A,R2
0D9B F500        R     MOV     curr_error+02H,A
0D9D E500        R     MOV     A,i_ref+01H
0D9F 99                SUBB    A,R1
0DA0 F500        R     MOV     curr_error+01H,A
0DA2 E500        R     MOV     A,i_ref
0DA4 98                SUBB    A,R0
0DA5 F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 744
0DA7 900000      R     MOV     DPTR,#curr_error_sum
0DAA E0                MOVX    A,@DPTR
0DAB FC                MOV     R4,A
0DAC A3                INC     DPTR
0DAD E0                MOVX    A,@DPTR
0DAE FD                MOV     R5,A
0DAF A3                INC     DPTR
0DB0 E0                MOVX    A,@DPTR
0DB1 FE                MOV     R6,A
0DB2 A3                INC     DPTR
0DB3 E0                MOVX    A,@DPTR
0DB4 2500        R     ADD     A,curr_error+03H
0DB6 FF                MOV     R7,A
0DB7 EE                MOV     A,R6
0DB8 3500        R     ADDC    A,curr_error+02H
0DBA FE                MOV     R6,A
0DBB ED                MOV     A,R5
0DBC 3500        R     ADDC    A,curr_error+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 76  

0DBE FD                MOV     R5,A
0DBF EC                MOV     A,R4
0DC0 3500        R     ADDC    A,curr_error
0DC2 FC                MOV     R4,A
0DC3 900000      R     MOV     DPTR,#curr_error_sum
0DC6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 746
0DC9 7FA0              MOV     R7,#0A0H
0DCB 7E86              MOV     R6,#086H
0DCD 7D01              MOV     R5,#01H
0DCF 7C00              MOV     R4,#00H
0DD1 900000      R     MOV     DPTR,#curr_error_sum
0DD4 E0                MOVX    A,@DPTR
0DD5 F8                MOV     R0,A
0DD6 A3                INC     DPTR
0DD7 E0                MOVX    A,@DPTR
0DD8 F9                MOV     R1,A
0DD9 A3                INC     DPTR
0DDA E0                MOVX    A,@DPTR
0DDB FA                MOV     R2,A
0DDC A3                INC     DPTR
0DDD E0                MOVX    A,@DPTR
0DDE FB                MOV     R3,A
0DDF D3                SETB    C
0DE0 120000      E     LCALL   ?C?SLCMP
0DE3 4010              JC      ?C0118
                                           ; SOURCE LINE # 747
0DE5 7FA0              MOV     R7,#0A0H
0DE7 7E86              MOV     R6,#086H
0DE9 7D01              MOV     R5,#01H
0DEB 7C00              MOV     R4,#00H
0DED 900000      R     MOV     DPTR,#curr_error_sum
0DF0 120000      E     LCALL   ?C?LSTXDATA
0DF3 802A              SJMP    ?C0119
0DF5         ?C0118:
                                           ; SOURCE LINE # 748
                                           ; SOURCE LINE # 749
0DF5 7F60              MOV     R7,#060H
0DF7 7E79              MOV     R6,#079H
0DF9 7DFE              MOV     R5,#0FEH
0DFB 7CFF              MOV     R4,#0FFH
0DFD 900000      R     MOV     DPTR,#curr_error_sum
0E00 E0                MOVX    A,@DPTR
0E01 F8                MOV     R0,A
0E02 A3                INC     DPTR
0E03 E0                MOVX    A,@DPTR
0E04 F9                MOV     R1,A
0E05 A3                INC     DPTR
0E06 E0                MOVX    A,@DPTR
0E07 FA                MOV     R2,A
0E08 A3                INC     DPTR
0E09 E0                MOVX    A,@DPTR
0E0A FB                MOV     R3,A
0E0B C3                CLR     C
0E0C 120000      E     LCALL   ?C?SLCMP
0E0F 500E              JNC     ?C0119
                                           ; SOURCE LINE # 750
0E11 7F60              MOV     R7,#060H
0E13 7E79              MOV     R6,#079H
0E15 7DFE              MOV     R5,#0FEH
0E17 7CFF              MOV     R4,#0FFH
0E19 900000      R     MOV     DPTR,#curr_error_sum
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 77  

0E1C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 751
0E1F         ?C0119:
                                           ; SOURCE LINE # 753
0E1F E4                CLR     A
0E20 F500        R     MOV     pwm_input+03H,A
0E22 F500        R     MOV     pwm_input+02H,A
0E24 F500        R     MOV     pwm_input+01H,A
0E26 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 756
0E28 FF                MOV     R7,A
0E29 FE                MOV     R6,A
0E2A FD                MOV     R5,A
0E2B FC                MOV     R4,A
0E2C AB00        R     MOV     R3,k_p_c+03H
0E2E AA00        R     MOV     R2,k_p_c+02H
0E30 A900        R     MOV     R1,k_p_c+01H
0E32 A800        R     MOV     R0,k_p_c
0E34 C3                CLR     C
0E35 120000      E     LCALL   ?C?SLCMP
0E38 6026              JZ      ?C0121
                                           ; SOURCE LINE # 757
0E3A AF00        R     MOV     R7,curr_error+03H
0E3C AE00        R     MOV     R6,curr_error+02H
0E3E AD00        R     MOV     R5,curr_error+01H
0E40 AC00        R     MOV     R4,curr_error
0E42 A800        R     MOV     R0,k_p_c
0E44 120000      E     LCALL   ?C?LMUL
0E47 7810              MOV     R0,#010H
0E49 120000      E     LCALL   ?C?SLSHR
0E4C E500        R     MOV     A,pwm_input+03H
0E4E 2F                ADD     A,R7
0E4F F500        R     MOV     pwm_input+03H,A
0E51 E500        R     MOV     A,pwm_input+02H
0E53 3E                ADDC    A,R6
0E54 F500        R     MOV     pwm_input+02H,A
0E56 E500        R     MOV     A,pwm_input+01H
0E58 3D                ADDC    A,R5
0E59 F500        R     MOV     pwm_input+01H,A
0E5B E500        R     MOV     A,pwm_input
0E5D 3C                ADDC    A,R4
0E5E F500        R     MOV     pwm_input,A
0E60         ?C0121:
                                           ; SOURCE LINE # 760
0E60 E4                CLR     A
0E61 FF                MOV     R7,A
0E62 FE                MOV     R6,A
0E63 FD                MOV     R5,A
0E64 FC                MOV     R4,A
0E65 AB00        R     MOV     R3,k_i_c+03H
0E67 AA00        R     MOV     R2,k_i_c+02H
0E69 A900        R     MOV     R1,k_i_c+01H
0E6B A800        R     MOV     R0,k_i_c
0E6D C3                CLR     C
0E6E 120000      E     LCALL   ?C?SLCMP
0E71 602C              JZ      ?C0122
                                           ; SOURCE LINE # 761
0E73 900000      R     MOV     DPTR,#curr_error_sum
0E76 E0                MOVX    A,@DPTR
0E77 FC                MOV     R4,A
0E78 A3                INC     DPTR
0E79 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 78  

0E7A FD                MOV     R5,A
0E7B A3                INC     DPTR
0E7C E0                MOVX    A,@DPTR
0E7D FE                MOV     R6,A
0E7E A3                INC     DPTR
0E7F E0                MOVX    A,@DPTR
0E80 FF                MOV     R7,A
0E81 A800        R     MOV     R0,k_i_c
0E83 120000      E     LCALL   ?C?LMUL
0E86 7810              MOV     R0,#010H
0E88 120000      E     LCALL   ?C?SLSHR
0E8B E500        R     MOV     A,pwm_input+03H
0E8D 2F                ADD     A,R7
0E8E F500        R     MOV     pwm_input+03H,A
0E90 E500        R     MOV     A,pwm_input+02H
0E92 3E                ADDC    A,R6
0E93 F500        R     MOV     pwm_input+02H,A
0E95 E500        R     MOV     A,pwm_input+01H
0E97 3D                ADDC    A,R5
0E98 F500        R     MOV     pwm_input+01H,A
0E9A E500        R     MOV     A,pwm_input
0E9C 3C                ADDC    A,R4
0E9D F500        R     MOV     pwm_input,A
0E9F         ?C0122:
                                           ; SOURCE LINE # 764
0E9F E4                CLR     A
0EA0 FF                MOV     R7,A
0EA1 FE                MOV     R6,A
0EA2 FD                MOV     R5,A
0EA3 FC                MOV     R4,A
0EA4 AB00        R     MOV     R3,k_d_c+03H
0EA6 AA00        R     MOV     R2,k_d_c+02H
0EA8 A900        R     MOV     R1,k_d_c+01H
0EAA A800        R     MOV     R0,k_d_c
0EAC C3                CLR     C
0EAD 120000      E     LCALL   ?C?SLCMP
0EB0 6043              JZ      ?C0123
                                           ; SOURCE LINE # 765
0EB2 900000      R     MOV     DPTR,#prev_curr_err
0EB5 E0                MOVX    A,@DPTR
0EB6 F8                MOV     R0,A
0EB7 A3                INC     DPTR
0EB8 E0                MOVX    A,@DPTR
0EB9 F9                MOV     R1,A
0EBA A3                INC     DPTR
0EBB E0                MOVX    A,@DPTR
0EBC FA                MOV     R2,A
0EBD A3                INC     DPTR
0EBE E0                MOVX    A,@DPTR
0EBF FB                MOV     R3,A
0EC0 C3                CLR     C
0EC1 E500        R     MOV     A,curr_error+03H
0EC3 9B                SUBB    A,R3
0EC4 FF                MOV     R7,A
0EC5 E500        R     MOV     A,curr_error+02H
0EC7 9A                SUBB    A,R2
0EC8 FE                MOV     R6,A
0EC9 E500        R     MOV     A,curr_error+01H
0ECB 99                SUBB    A,R1
0ECC FD                MOV     R5,A
0ECD E500        R     MOV     A,curr_error
0ECF 98                SUBB    A,R0
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 79  

0ED0 FC                MOV     R4,A
0ED1 AB00        R     MOV     R3,k_d_c+03H
0ED3 AA00        R     MOV     R2,k_d_c+02H
0ED5 A900        R     MOV     R1,k_d_c+01H
0ED7 A800        R     MOV     R0,k_d_c
0ED9 120000      E     LCALL   ?C?LMUL
0EDC 7810              MOV     R0,#010H
0EDE 120000      E     LCALL   ?C?SLSHR
0EE1 E500        R     MOV     A,pwm_input+03H
0EE3 2F                ADD     A,R7
0EE4 F500        R     MOV     pwm_input+03H,A
0EE6 E500        R     MOV     A,pwm_input+02H
0EE8 3E                ADDC    A,R6
0EE9 F500        R     MOV     pwm_input+02H,A
0EEB E500        R     MOV     A,pwm_input+01H
0EED 3D                ADDC    A,R5
0EEE F500        R     MOV     pwm_input+01H,A
0EF0 E500        R     MOV     A,pwm_input
0EF2 3C                ADDC    A,R4
0EF3 F500        R     MOV     pwm_input,A
0EF5         ?C0123:
                                           ; SOURCE LINE # 767
0EF5 AF00        R     MOV     R7,curr_error+03H
0EF7 AE00        R     MOV     R6,curr_error+02H
0EF9 AD00        R     MOV     R5,curr_error+01H
0EFB AC00        R     MOV     R4,curr_error
0EFD 900000      R     MOV     DPTR,#prev_curr_err
0F00 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 769
0F03 E4                CLR     A
0F04 FF                MOV     R7,A
0F05 FE                MOV     R6,A
0F06 FD                MOV     R5,A
0F07 FC                MOV     R4,A
0F08 AB00        R     MOV     R3,pwm_input+03H
0F0A AA00        R     MOV     R2,pwm_input+02H
0F0C A900        R     MOV     R1,pwm_input+01H
0F0E A800        R     MOV     R0,pwm_input
0F10 C3                CLR     C
0F11 120000      E     LCALL   ?C?SLCMP
0F14 4005              JC      ?C0124
                                           ; SOURCE LINE # 770
0F16 D200        R     SETB    motor_dir
0F18 020000      R     LJMP    ?C0082
0F1B         ?C0124:
                                           ; SOURCE LINE # 772
0F1B C200        R     CLR     motor_dir
                                           ; SOURCE LINE # 773
                                           ; SOURCE LINE # 774
0F1D 020000      R     LJMP    ?C0082
                                           ; SOURCE LINE # 777
0F20         ?C0126:
                                           ; SOURCE LINE # 779
0F20 900000      E     MOV     DPTR,#g_ref+010H
0F23 E0                MOVX    A,@DPTR
0F24 FC                MOV     R4,A
0F25 A3                INC     DPTR
0F26 E0                MOVX    A,@DPTR
0F27 FD                MOV     R5,A
0F28 A3                INC     DPTR
0F29 E0                MOVX    A,@DPTR
0F2A FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 80  

0F2B A3                INC     DPTR
0F2C E0                MOVX    A,@DPTR
0F2D F500        R     MOV     pwm_input+03H,A
0F2F 8E00        R     MOV     pwm_input+02H,R6
0F31 8D00        R     MOV     pwm_input+01H,R5
0F33 8C00        R     MOV     pwm_input,R4
                                           ; SOURCE LINE # 781
0F35 E4                CLR     A
0F36 FF                MOV     R7,A
0F37 FE                MOV     R6,A
0F38 FD                MOV     R5,A
0F39 FC                MOV     R4,A
0F3A AB00        R     MOV     R3,pwm_input+03H
0F3C AA00        R     MOV     R2,pwm_input+02H
0F3E A900        R     MOV     R1,pwm_input+01H
0F40 A800        R     MOV     R0,pwm_input
0F42 D3                SETB    C
0F43 120000      E     LCALL   ?C?SLCMP
0F46 4004              JC      ?C0127
                                           ; SOURCE LINE # 782
0F48 D200        R     SETB    motor_dir
0F4A 8002              SJMP    ?C0128
0F4C         ?C0127:
                                           ; SOURCE LINE # 784
0F4C C200        R     CLR     motor_dir
0F4E         ?C0128:
                                           ; SOURCE LINE # 788
0F4E 74FF              MOV     A,#0FFH
0F50 7F9C              MOV     R7,#09CH
0F52 FE                MOV     R6,A
0F53 FD                MOV     R5,A
0F54 FC                MOV     R4,A
0F55 AB00        R     MOV     R3,pwm_input+03H
0F57 AA00        R     MOV     R2,pwm_input+02H
0F59 A900        R     MOV     R1,pwm_input+01H
0F5B A800        R     MOV     R0,pwm_input
0F5D C3                CLR     C
0F5E 120000      E     LCALL   ?C?SLCMP
0F61 500E              JNC     ?C0129
                                           ; SOURCE LINE # 789
0F63 74FF              MOV     A,#0FFH
0F65 75009C      R     MOV     pwm_input+03H,#09CH
0F68 F500        R     MOV     pwm_input+02H,A
0F6A F500        R     MOV     pwm_input+01H,A
0F6C F500        R     MOV     pwm_input,A
0F6E 020000      R     LJMP    ?C0082
0F71         ?C0129:
                                           ; SOURCE LINE # 790
                                           ; SOURCE LINE # 791
0F71 E4                CLR     A
0F72 7F64              MOV     R7,#064H
0F74 FE                MOV     R6,A
0F75 FD                MOV     R5,A
0F76 FC                MOV     R4,A
0F77 AB00        R     MOV     R3,pwm_input+03H
0F79 AA00        R     MOV     R2,pwm_input+02H
0F7B A900        R     MOV     R1,pwm_input+01H
0F7D A800        R     MOV     R0,pwm_input
0F7F D3                SETB    C
0F80 120000      E     LCALL   ?C?SLCMP
0F83 5003              JNC     $ + 5H
0F85 020000      R     LJMP    ?C0082
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 81  

                                           ; SOURCE LINE # 792
0F88 E4                CLR     A
0F89 750064      R     MOV     pwm_input+03H,#064H
0F8C F500        R     MOV     pwm_input+02H,A
0F8E F500        R     MOV     pwm_input+01H,A
0F90 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 793
                                           ; SOURCE LINE # 795
0F92 020000      R     LJMP    ?C0082
                                           ; SOURCE LINE # 798
0F95         ?C0132:
                                           ; SOURCE LINE # 800
0F95 900000      E     MOV     DPTR,#rest_enabled
0F98 E0                MOVX    A,@DPTR
0F99 B40114            CJNE    A,#01H,?C0133
                                           ; SOURCE LINE # 802
0F9C 900000      E     MOV     DPTR,#rest_pos_curr_ref
0F9F E0                MOVX    A,@DPTR
0FA0 FC                MOV     R4,A
0FA1 A3                INC     DPTR
0FA2 E0                MOVX    A,@DPTR
0FA3 FD                MOV     R5,A
0FA4 A3                INC     DPTR
0FA5 E0                MOVX    A,@DPTR
0FA6 FE                MOV     R6,A
0FA7 A3                INC     DPTR
0FA8 E0                MOVX    A,@DPTR
0FA9 FF                MOV     R7,A
0FAA 900000      E     MOV     DPTR,#g_ref
0FAD 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 803
0FB0         ?C0133:
                                           ; SOURCE LINE # 805
0FB0 900000      E     MOV     DPTR,#forced_open
0FB3 E0                MOVX    A,@DPTR
0FB4 6401              XRL     A,#01H
0FB6 6003              JZ      $ + 5H
0FB8 020000      R     LJMP    ?C0134
                                           ; SOURCE LINE # 807
0FBB FF                MOV     R7,A
0FBC FE                MOV     R6,A
0FBD FD                MOV     R5,A
0FBE FC                MOV     R4,A
0FBF AB00        R     MOV     R3,err_emg_2+03H
0FC1 AA00        R     MOV     R2,err_emg_2+02H
0FC3 A900        R     MOV     R1,err_emg_2+01H
0FC5 A800        R     MOV     R0,err_emg_2
0FC7 D3                SETB    C
0FC8 120000      E     LCALL   ?C?SLCMP
0FCB 405D              JC      ?C0135
                                           ; SOURCE LINE # 808
0FCD 900000      E     MOV     DPTR,#g_mem+096H
0FD0 E0                MOVX    A,@DPTR
0FD1 FC                MOV     R4,A
0FD2 A3                INC     DPTR
0FD3 E0                MOVX    A,@DPTR
0FD4 FD                MOV     R5,A
0FD5 A3                INC     DPTR
0FD6 E0                MOVX    A,@DPTR
0FD7 FE                MOV     R6,A
0FD8 A3                INC     DPTR
0FD9 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 82  

0FDA FF                MOV     R7,A
0FDB A800        R     MOV     R0,err_emg_2
0FDD 120000      E     LCALL   ?C?LMUL
0FE0 C006              PUSH    AR6
0FE2 C007              PUSH    AR7
0FE4 900000      E     MOV     DPTR,#c_mem+06DH
0FE7 E0                MOVX    A,@DPTR
0FE8 FE                MOV     R6,A
0FE9 A3                INC     DPTR
0FEA E0                MOVX    A,@DPTR
0FEB FF                MOV     R7,A
0FEC C3                CLR     C
0FED E4                CLR     A
0FEE 9F                SUBB    A,R7
0FEF FF                MOV     R7,A
0FF0 7404              MOV     A,#04H
0FF2 9E                SUBB    A,R6
0FF3 FE                MOV     R6,A
0FF4 AB07              MOV     R3,AR7
0FF6 FA                MOV     R2,A
0FF7 E4                CLR     A
0FF8 F9                MOV     R1,A
0FF9 F8                MOV     R0,A
0FFA D007              POP     AR7
0FFC D006              POP     AR6
0FFE 120000      E     LCALL   ?C?SLDIV
1001 A804              MOV     R0,AR4
1003 A905              MOV     R1,AR5
1005 AA06              MOV     R2,AR6
1007 AB07              MOV     R3,AR7
1009 900000      E     MOV     DPTR,#g_mem+096H
100C E0                MOVX    A,@DPTR
100D FC                MOV     R4,A
100E A3                INC     DPTR
100F E0                MOVX    A,@DPTR
1010 FD                MOV     R5,A
1011 A3                INC     DPTR
1012 E0                MOVX    A,@DPTR
1013 FE                MOV     R6,A
1014 A3                INC     DPTR
1015 E0                MOVX    A,@DPTR
1016 C3                CLR     C
1017 9B                SUBB    A,R3
1018 FF                MOV     R7,A
1019 EE                MOV     A,R6
101A 9A                SUBB    A,R2
101B FE                MOV     R6,A
101C ED                MOV     A,R5
101D 99                SUBB    A,R1
101E FD                MOV     R5,A
101F EC                MOV     A,R4
1020 98                SUBB    A,R0
1021 FC                MOV     R4,A
1022 900000      E     MOV     DPTR,#g_ref
1025 120000      E     LCALL   ?C?LSTXDATA
1028 8019              SJMP    ?C0134
102A         ?C0135:
                                           ; SOURCE LINE # 809
                                           ; SOURCE LINE # 810
102A 900000      E     MOV     DPTR,#g_mem+096H
102D E0                MOVX    A,@DPTR
102E FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 83  

102F A3                INC     DPTR
1030 E0                MOVX    A,@DPTR
1031 FD                MOV     R5,A
1032 A3                INC     DPTR
1033 E0                MOVX    A,@DPTR
1034 FE                MOV     R6,A
1035 A3                INC     DPTR
1036 E0                MOVX    A,@DPTR
1037 FF                MOV     R7,A
1038 900000      E     MOV     DPTR,#g_ref
103B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 811
103E E4                CLR     A
103F 900000      E     MOV     DPTR,#forced_open
1042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 812
                                           ; SOURCE LINE # 813
1043         ?C0134:
                                           ; SOURCE LINE # 816
1043 900000      E     MOV     DPTR,#g_meas
1046 E0                MOVX    A,@DPTR
1047 F8                MOV     R0,A
1048 A3                INC     DPTR
1049 E0                MOVX    A,@DPTR
104A F9                MOV     R1,A
104B A3                INC     DPTR
104C E0                MOVX    A,@DPTR
104D FA                MOV     R2,A
104E A3                INC     DPTR
104F E0                MOVX    A,@DPTR
1050 FB                MOV     R3,A
1051 900000      E     MOV     DPTR,#g_ref
1054 E0                MOVX    A,@DPTR
1055 FC                MOV     R4,A
1056 A3                INC     DPTR
1057 E0                MOVX    A,@DPTR
1058 FD                MOV     R5,A
1059 A3                INC     DPTR
105A E0                MOVX    A,@DPTR
105B FE                MOV     R6,A
105C A3                INC     DPTR
105D E0                MOVX    A,@DPTR
105E C3                CLR     C
105F 9B                SUBB    A,R3
1060 F500        R     MOV     pos_error+03H,A
1062 EE                MOV     A,R6
1063 9A                SUBB    A,R2
1064 F500        R     MOV     pos_error+02H,A
1066 ED                MOV     A,R5
1067 99                SUBB    A,R1
1068 F500        R     MOV     pos_error+01H,A
106A EC                MOV     A,R4
106B 98                SUBB    A,R0
106C F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 818
106E 900000      R     MOV     DPTR,#pos_error_sum
1071 E0                MOVX    A,@DPTR
1072 FC                MOV     R4,A
1073 A3                INC     DPTR
1074 E0                MOVX    A,@DPTR
1075 FD                MOV     R5,A
1076 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 84  

1077 E0                MOVX    A,@DPTR
1078 FE                MOV     R6,A
1079 A3                INC     DPTR
107A E0                MOVX    A,@DPTR
107B 2500        R     ADD     A,pos_error+03H
107D FF                MOV     R7,A
107E EE                MOV     A,R6
107F 3500        R     ADDC    A,pos_error+02H
1081 FE                MOV     R6,A
1082 ED                MOV     A,R5
1083 3500        R     ADDC    A,pos_error+01H
1085 FD                MOV     R5,A
1086 EC                MOV     A,R4
1087 3500        R     ADDC    A,pos_error
1089 FC                MOV     R4,A
108A 900000      R     MOV     DPTR,#pos_error_sum
108D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 821
1090 E4                CLR     A
1091 7FE8              MOV     R7,#0E8H
1093 7E03              MOV     R6,#03H
1095 FD                MOV     R5,A
1096 FC                MOV     R4,A
1097 900000      R     MOV     DPTR,#pos_error_sum
109A E0                MOVX    A,@DPTR
109B F8                MOV     R0,A
109C A3                INC     DPTR
109D E0                MOVX    A,@DPTR
109E F9                MOV     R1,A
109F A3                INC     DPTR
10A0 E0                MOVX    A,@DPTR
10A1 FA                MOV     R2,A
10A2 A3                INC     DPTR
10A3 E0                MOVX    A,@DPTR
10A4 FB                MOV     R3,A
10A5 D3                SETB    C
10A6 120000      E     LCALL   ?C?SLCMP
10A9 400F              JC      ?C0137
                                           ; SOURCE LINE # 822
10AB E4                CLR     A
10AC 7FE8              MOV     R7,#0E8H
10AE 7E03              MOV     R6,#03H
10B0 FD                MOV     R5,A
10B1 FC                MOV     R4,A
10B2 900000      R     MOV     DPTR,#pos_error_sum
10B5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 823
10B8 802A              SJMP    ?C0138
10BA         ?C0137:
10BA 7F18              MOV     R7,#018H
10BC 7EFC              MOV     R6,#0FCH
10BE 7DFF              MOV     R5,#0FFH
10C0 7CFF              MOV     R4,#0FFH
10C2 900000      R     MOV     DPTR,#pos_error_sum
10C5 E0                MOVX    A,@DPTR
10C6 F8                MOV     R0,A
10C7 A3                INC     DPTR
10C8 E0                MOVX    A,@DPTR
10C9 F9                MOV     R1,A
10CA A3                INC     DPTR
10CB E0                MOVX    A,@DPTR
10CC FA                MOV     R2,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 85  

10CD A3                INC     DPTR
10CE E0                MOVX    A,@DPTR
10CF FB                MOV     R3,A
10D0 C3                CLR     C
10D1 120000      E     LCALL   ?C?SLCMP
10D4 500E              JNC     ?C0138
                                           ; SOURCE LINE # 824
10D6 7F18              MOV     R7,#018H
10D8 7EFC              MOV     R6,#0FCH
10DA 7DFF              MOV     R5,#0FFH
10DC 7CFF              MOV     R4,#0FFH
10DE 900000      R     MOV     DPTR,#pos_error_sum
10E1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 825
10E4         ?C0138:
                                           ; SOURCE LINE # 828
10E4 E4                CLR     A
10E5 FF                MOV     R7,A
10E6 FE                MOV     R6,A
10E7 FD                MOV     R5,A
10E8 FC                MOV     R4,A
10E9 AB00        R     MOV     R3,k_p+03H
10EB AA00        R     MOV     R2,k_p+02H
10ED A900        R     MOV     R1,k_p+01H
10EF A800        R     MOV     R0,k_p
10F1 C3                CLR     C
10F2 120000      E     LCALL   ?C?SLCMP
10F5 601A              JZ      ?C0140
                                           ; SOURCE LINE # 829
10F7 AF00        R     MOV     R7,pos_error+03H
10F9 AE00        R     MOV     R6,pos_error+02H
10FB AD00        R     MOV     R5,pos_error+01H
10FD AC00        R     MOV     R4,pos_error
10FF A800        R     MOV     R0,k_p
1101 120000      E     LCALL   ?C?LMUL
1104 7810              MOV     R0,#010H
1106 120000      E     LCALL   ?C?SLSHR
1109 8F00        R     MOV     pwm_input+03H,R7
110B 8E00        R     MOV     pwm_input+02H,R6
110D 8D00        R     MOV     pwm_input+01H,R5
110F 8C00        R     MOV     pwm_input,R4
1111         ?C0140:
                                           ; SOURCE LINE # 833
1111 E4                CLR     A
1112 FF                MOV     R7,A
1113 FE                MOV     R6,A
1114 FD                MOV     R5,A
1115 FC                MOV     R4,A
1116 AB00        R     MOV     R3,k_i+03H
1118 AA00        R     MOV     R2,k_i+02H
111A A900        R     MOV     R1,k_i+01H
111C A800        R     MOV     R0,k_i
111E C3                CLR     C
111F 120000      E     LCALL   ?C?SLCMP
1122 602C              JZ      ?C0141
                                           ; SOURCE LINE # 834
1124 900000      R     MOV     DPTR,#pos_error_sum
1127 E0                MOVX    A,@DPTR
1128 FC                MOV     R4,A
1129 A3                INC     DPTR
112A E0                MOVX    A,@DPTR
112B FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 86  

112C A3                INC     DPTR
112D E0                MOVX    A,@DPTR
112E FE                MOV     R6,A
112F A3                INC     DPTR
1130 E0                MOVX    A,@DPTR
1131 FF                MOV     R7,A
1132 A800        R     MOV     R0,k_i
1134 120000      E     LCALL   ?C?LMUL
1137 7810              MOV     R0,#010H
1139 120000      E     LCALL   ?C?SLSHR
113C E500        R     MOV     A,pwm_input+03H
113E 2F                ADD     A,R7
113F F500        R     MOV     pwm_input+03H,A
1141 E500        R     MOV     A,pwm_input+02H
1143 3E                ADDC    A,R6
1144 F500        R     MOV     pwm_input+02H,A
1146 E500        R     MOV     A,pwm_input+01H
1148 3D                ADDC    A,R5
1149 F500        R     MOV     pwm_input+01H,A
114B E500        R     MOV     A,pwm_input
114D 3C                ADDC    A,R4
114E F500        R     MOV     pwm_input,A
1150         ?C0141:
                                           ; SOURCE LINE # 838
1150 E4                CLR     A
1151 FF                MOV     R7,A
1152 FE                MOV     R6,A
1153 FD                MOV     R5,A
1154 FC                MOV     R4,A
1155 AB00        R     MOV     R3,k_d+03H
1157 AA00        R     MOV     R2,k_d+02H
1159 A900        R     MOV     R1,k_d+01H
115B A800        R     MOV     R0,k_d
115D C3                CLR     C
115E 120000      E     LCALL   ?C?SLCMP
1161 6043              JZ      ?C0142
                                           ; SOURCE LINE # 839
1163 900000      R     MOV     DPTR,#prev_pos_err
1166 E0                MOVX    A,@DPTR
1167 F8                MOV     R0,A
1168 A3                INC     DPTR
1169 E0                MOVX    A,@DPTR
116A F9                MOV     R1,A
116B A3                INC     DPTR
116C E0                MOVX    A,@DPTR
116D FA                MOV     R2,A
116E A3                INC     DPTR
116F E0                MOVX    A,@DPTR
1170 FB                MOV     R3,A
1171 C3                CLR     C
1172 E500        R     MOV     A,pos_error+03H
1174 9B                SUBB    A,R3
1175 FF                MOV     R7,A
1176 E500        R     MOV     A,pos_error+02H
1178 9A                SUBB    A,R2
1179 FE                MOV     R6,A
117A E500        R     MOV     A,pos_error+01H
117C 99                SUBB    A,R1
117D FD                MOV     R5,A
117E E500        R     MOV     A,pos_error
1180 98                SUBB    A,R0
1181 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 87  

1182 AB00        R     MOV     R3,k_d+03H
1184 AA00        R     MOV     R2,k_d+02H
1186 A900        R     MOV     R1,k_d+01H
1188 A800        R     MOV     R0,k_d
118A 120000      E     LCALL   ?C?LMUL
118D 7810              MOV     R0,#010H
118F 120000      E     LCALL   ?C?SLSHR
1192 E500        R     MOV     A,pwm_input+03H
1194 2F                ADD     A,R7
1195 F500        R     MOV     pwm_input+03H,A
1197 E500        R     MOV     A,pwm_input+02H
1199 3E                ADDC    A,R6
119A F500        R     MOV     pwm_input+02H,A
119C E500        R     MOV     A,pwm_input+01H
119E 3D                ADDC    A,R5
119F F500        R     MOV     pwm_input+01H,A
11A1 E500        R     MOV     A,pwm_input
11A3 3C                ADDC    A,R4
11A4 F500        R     MOV     pwm_input,A
11A6         ?C0142:
                                           ; SOURCE LINE # 843
11A6 AF00        R     MOV     R7,pos_error+03H
11A8 AE00        R     MOV     R6,pos_error+02H
11AA AD00        R     MOV     R5,pos_error+01H
11AC AC00        R     MOV     R4,pos_error
11AE 900000      R     MOV     DPTR,#prev_pos_err
11B1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 845
11B4 E4                CLR     A
11B5 FF                MOV     R7,A
11B6 FE                MOV     R6,A
11B7 FD                MOV     R5,A
11B8 FC                MOV     R4,A
11B9 AB00        R     MOV     R3,pwm_input+03H
11BB AA00        R     MOV     R2,pwm_input+02H
11BD A900        R     MOV     R1,pwm_input+01H
11BF A800        R     MOV     R0,pwm_input
11C1 D3                SETB    C
11C2 120000      E     LCALL   ?C?SLCMP
11C5 4004              JC      ?C0143
                                           ; SOURCE LINE # 846
11C7 D200        R     SETB    motor_dir
11C9 8002              SJMP    ?C0082
11CB         ?C0143:
                                           ; SOURCE LINE # 848
11CB C200        R     CLR     motor_dir
                                           ; SOURCE LINE # 850
                                           ; SOURCE LINE # 851
11CD         ?C0082:
                                           ; SOURCE LINE # 855
11CD E4                CLR     A
11CE 7F64              MOV     R7,#064H
11D0 FE                MOV     R6,A
11D1 FD                MOV     R5,A
11D2 FC                MOV     R4,A
11D3 AB00        R     MOV     R3,pwm_input+03H
11D5 AA00        R     MOV     R2,pwm_input+02H
11D7 A900        R     MOV     R1,pwm_input+01H
11D9 A800        R     MOV     R0,pwm_input
11DB D3                SETB    C
11DC 120000      E     LCALL   ?C?SLCMP
11DF 400A              JC      ?C0145
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 88  

                                           ; SOURCE LINE # 856
11E1 E4                CLR     A
11E2 750064      R     MOV     pwm_input+03H,#064H
11E5 F500        R     MOV     pwm_input+02H,A
11E7 F500        R     MOV     pwm_input+01H,A
11E9 F500        R     MOV     pwm_input,A
11EB         ?C0145:
                                           ; SOURCE LINE # 857
11EB 74FF              MOV     A,#0FFH
11ED 7F9C              MOV     R7,#09CH
11EF FE                MOV     R6,A
11F0 FD                MOV     R5,A
11F1 FC                MOV     R4,A
11F2 AB00        R     MOV     R3,pwm_input+03H
11F4 AA00        R     MOV     R2,pwm_input+02H
11F6 A900        R     MOV     R1,pwm_input+01H
11F8 A800        R     MOV     R0,pwm_input
11FA C3                CLR     C
11FB 120000      E     LCALL   ?C?SLCMP
11FE 500B              JNC     ?C0146
                                           ; SOURCE LINE # 858
1200 74FF              MOV     A,#0FFH
1202 75009C      R     MOV     pwm_input+03H,#09CH
1205 F500        R     MOV     pwm_input+02H,A
1207 F500        R     MOV     pwm_input+01H,A
1209 F500        R     MOV     pwm_input,A
120B         ?C0146:
                                           ; SOURCE LINE # 861
120B 900000      E     MOV     DPTR,#c_mem+034H
120E E0                MOVX    A,@DPTR
120F 6401              XRL     A,#01H
1211 6037              JZ      ?C0147
                                           ; SOURCE LINE # 862
1213 AF00        R     MOV     R7,pwm_input+03H
1215 AE00        R     MOV     R6,pwm_input+02H
1217 AD00        R     MOV     R5,pwm_input+01H
1219 AC00        R     MOV     R4,pwm_input
121B 780A              MOV     R0,#0AH
121D 120000      E     LCALL   ?C?LSHL
1220 E4                CLR     A
1221 7B64              MOV     R3,#064H
1223 FA                MOV     R2,A
1224 F9                MOV     R1,A
1225 F8                MOV     R0,A
1226 120000      E     LCALL   ?C?SLDIV
1229 A804              MOV     R0,AR4
122B A905              MOV     R1,AR5
122D AA06              MOV     R2,AR6
122F AB07              MOV     R3,AR7
1231 900000      E     MOV     DPTR,#dev_pwm_limit
1234 E0                MOVX    A,@DPTR
1235 FF                MOV     R7,A
1236 E4                CLR     A
1237 FC                MOV     R4,A
1238 FD                MOV     R5,A
1239 FE                MOV     R6,A
123A 120000      E     LCALL   ?C?LMUL
123D 780A              MOV     R0,#0AH
123F 120000      E     LCALL   ?C?SLSHR
1242 8F00        R     MOV     pwm_input+03H,R7
1244 8E00        R     MOV     pwm_input+02H,R6
1246 8D00        R     MOV     pwm_input+01H,R5
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 89  

1248 8C00        R     MOV     pwm_input,R4
124A         ?C0147:
                                           ; SOURCE LINE # 865
124A E4                CLR     A
124B FF                MOV     R7,A
124C FE                MOV     R6,A
124D FD                MOV     R5,A
124E FC                MOV     R4,A
124F AB00        R     MOV     R3,pwm_input+03H
1251 AA00        R     MOV     R2,pwm_input+02H
1253 A900        R     MOV     R1,pwm_input+01H
1255 A800        R     MOV     R0,pwm_input
1257 C3                CLR     C
1258 120000      E     LCALL   ?C?SLCMP
125B 4004              JC      ?C0148
125D 7F01              MOV     R7,#01H
125F 8002              SJMP    ?C0149
1261         ?C0148:
1261 7FFF              MOV     R7,#0FFH
1263         ?C0149:
1263 900000      E     MOV     DPTR,#pwm_sign
1266 EF                MOV     A,R7
1267 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 867
1268 300007            JNB     motor_dir,?C0150
                                           ; SOURCE LINE # 868
126B 7F01              MOV     R7,#01H
126D 120000      E     LCALL   _MOTOR_DIR_Write
1270 8005              SJMP    ?C0151
1272         ?C0150:
                                           ; SOURCE LINE # 870
1272 E4                CLR     A
1273 FF                MOV     R7,A
1274 120000      E     LCALL   _MOTOR_DIR_Write
1277         ?C0151:
                                           ; SOURCE LINE # 872
1277 AE00        R     MOV     R6,pwm_input+02H
1279 AF00        R     MOV     R7,pwm_input+03H
127B 120000      E     LCALL   _abs
127E 120000      E     LCALL   _PWM_MOTORS_WriteCompare1
                                           ; SOURCE LINE # 873
1281 22                RET     
             ; FUNCTION motor_control (END)

             ; FUNCTION _encoder_reading (BEGIN)
                                           ; SOURCE LINE # 879
;---- Variable 'idx' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 881
0000 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 890
0002 E4                CLR     A
0003 FF                MOV     R7,A
0004 FE                MOV     R6,A
0005 FD                MOV     R5,A
0006 FC                MOV     R4,A
0007 900000      R     MOV     DPTR,#init_rot
000A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 909
000D E500        R     MOV     A,index
000F C3                CLR     C
0010 9403              SUBB    A,#03H
0012 4003              JC      $ + 5H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 90  

0014 020000      R     LJMP    ?C0154
0017         ?C0153:
                                           ; SOURCE LINE # 912
0017 300022            JNB     reset_last_value_flag,?C0155
                                           ; SOURCE LINE # 913
;---- Variable 'jj' assigned to Register 'R3' ----
001A 7B03              MOV     R3,#03H
001C         ?C0156:
001C AF03              MOV     R7,AR3
001E 1B                DEC     R3
001F EF                MOV     A,R7
0020 6018              JZ      ?C0157
                                           ; SOURCE LINE # 914
0022 E4                CLR     A
0023 FF                MOV     R7,A
0024 FE                MOV     R6,A
0025 FD                MOV     R5,A
0026 FC                MOV     R4,A
0027 EB                MOV     A,R3
0028 25E0              ADD     A,ACC
002A 25E0              ADD     A,ACC
002C 2400        R     ADD     A,#LOW last_value_encoder
002E F582              MOV     DPL,A
0030 E4                CLR     A
0031 3400        R     ADDC    A,#HIGH last_value_encoder
0033 F583              MOV     DPH,A
0035 120000      E     LCALL   ?C?LSTXDATA
0038 80E2              SJMP    ?C0156
003A         ?C0157:
                                           ; SOURCE LINE # 916
003A C200        E     CLR     reset_last_value_flag
                                           ; SOURCE LINE # 917
003C         ?C0155:
                                           ; SOURCE LINE # 921
003C E500        R     MOV     A,index
003E 7018              JNZ     ?C0158
                                           ; SOURCE LINE # 922
0040 120000      E     LCALL   SHIFTREG_ENC_1_ReadData
0043 7801              MOV     R0,#01H
0045 120000      E     LCALL   ?C?ULSHR
0048 EF                MOV     A,R7
0049 EE                MOV     A,R6
004A ED                MOV     A,R5
004B 5403              ANL     A,#03H
004D FD                MOV     R5,A
004E E4                CLR     A
004F FC                MOV     R4,A
0050 900000      R     MOV     DPTR,#data_encoder
0053 120000      E     LCALL   ?C?LSTXDATA
0056 8033              SJMP    ?C0159
0058         ?C0158:
                                           ; SOURCE LINE # 923
                                           ; SOURCE LINE # 924
0058 E500        R     MOV     A,index
005A B40118            CJNE    A,#01H,?C0160
                                           ; SOURCE LINE # 925
005D 120000      E     LCALL   SHIFTREG_ENC_2_ReadData
0060 7801              MOV     R0,#01H
0062 120000      E     LCALL   ?C?ULSHR
0065 EF                MOV     A,R7
0066 EE                MOV     A,R6
0067 ED                MOV     A,R5
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 91  

0068 5403              ANL     A,#03H
006A FD                MOV     R5,A
006B E4                CLR     A
006C FC                MOV     R4,A
006D 900000      R     MOV     DPTR,#data_encoder
0070 120000      E     LCALL   ?C?LSTXDATA
0073 8016              SJMP    ?C0159
0075         ?C0160:
                                           ; SOURCE LINE # 927
0075 120000      E     LCALL   SHIFTREG_ENC_3_ReadData
0078 7801              MOV     R0,#01H
007A 120000      E     LCALL   ?C?ULSHR
007D EF                MOV     A,R7
007E EE                MOV     A,R6
007F ED                MOV     A,R5
0080 5403              ANL     A,#03H
0082 FD                MOV     R5,A
0083 E4                CLR     A
0084 FC                MOV     R4,A
0085 900000      R     MOV     DPTR,#data_encoder
0088 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 928
008B         ?C0159:
                                           ; SOURCE LINE # 931
008B 7B01              MOV     R3,#01H
008D 7A00        R     MOV     R2,#HIGH data_encoder
008F 7900        R     MOV     R1,#LOW data_encoder
0091 120000      E     LCALL   _check_enc_data
0094 4003              JC      $ + 5H
0096 020000      R     LJMP    ?C0162
                                           ; SOURCE LINE # 933
0099 900000      R     MOV     DPTR,#data_encoder
009C E0                MOVX    A,@DPTR
009D FC                MOV     R4,A
009E A3                INC     DPTR
009F E0                MOVX    A,@DPTR
00A0 FD                MOV     R5,A
00A1 A3                INC     DPTR
00A2 E0                MOVX    A,@DPTR
00A3 FE                MOV     R6,A
00A4 A3                INC     DPTR
00A5 E0                MOVX    A,@DPTR
00A6 54C0              ANL     A,#0C0H
00A8 FF                MOV     R7,A
00A9 EE                MOV     A,R6
00AA ED                MOV     A,R5
00AB 5403              ANL     A,#03H
00AD FD                MOV     R5,A
00AE E4                CLR     A
00AF 2F                ADD     A,R7
00B0 FF                MOV     R7,A
00B1 E4                CLR     A
00B2 3E                ADDC    A,R6
00B3 FE                MOV     R6,A
00B4 ED                MOV     A,R5
00B5 34FE              ADDC    A,#0FEH
00B7 FD                MOV     R5,A
00B8 E4                CLR     A
00B9 34FF              ADDC    A,#0FFH
00BB FC                MOV     R4,A
00BC 7802              MOV     R0,#02H
00BE 120000      E     LCALL   ?C?ULSHR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 92  

00C1 EE                MOV     A,R6
00C2 33                RLC     A
00C3 95E0              SUBB    A,ACC
00C5 FD                MOV     R5,A
00C6 FC                MOV     R4,A
00C7 E500        R     MOV     A,index
00C9 25E0              ADD     A,ACC
00CB 25E0              ADD     A,ACC
00CD 2400        E     ADD     A,#LOW g_mem+038H
00CF F582              MOV     DPL,A
00D1 E4                CLR     A
00D2 3400        E     ADDC    A,#HIGH g_mem+038H
00D4 F583              MOV     DPH,A
00D6 E0                MOVX    A,@DPTR
00D7 F8                MOV     R0,A
00D8 A3                INC     DPTR
00D9 E0                MOVX    A,@DPTR
00DA F9                MOV     R1,A
00DB A3                INC     DPTR
00DC E0                MOVX    A,@DPTR
00DD FA                MOV     R2,A
00DE A3                INC     DPTR
00DF E0                MOVX    A,@DPTR
00E0 2F                ADD     A,R7
00E1 FF                MOV     R7,A
00E2 EA                MOV     A,R2
00E3 3E                ADDC    A,R6
00E4 FE                MOV     R6,A
00E5 E9                MOV     A,R1
00E6 3D                ADDC    A,R5
00E7 FD                MOV     R5,A
00E8 E8                MOV     A,R0
00E9 3C                ADDC    A,R4
00EA FC                MOV     R4,A
00EB 900000      R     MOV     DPTR,#value_encoder
00EE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 940
00F1 300027            JNB     only_first_time,?C0163
                                           ; SOURCE LINE # 941
00F4 900000      R     MOV     DPTR,#value_encoder
00F7 E0                MOVX    A,@DPTR
00F8 FC                MOV     R4,A
00F9 A3                INC     DPTR
00FA E0                MOVX    A,@DPTR
00FB FD                MOV     R5,A
00FC A3                INC     DPTR
00FD E0                MOVX    A,@DPTR
00FE FE                MOV     R6,A
00FF A3                INC     DPTR
0100 E0                MOVX    A,@DPTR
0101 FF                MOV     R7,A
0102 E500        R     MOV     A,index
0104 25E0              ADD     A,ACC
0106 25E0              ADD     A,ACC
0108 2400        R     ADD     A,#LOW last_value_encoder
010A F582              MOV     DPL,A
010C E4                CLR     A
010D 3400        R     ADDC    A,#HIGH last_value_encoder
010F F583              MOV     DPH,A
0111 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 942
0114 E500        R     MOV     A,index
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 93  

0116 B40202            CJNE    A,#02H,?C0163
                                           ; SOURCE LINE # 943
0119 C200        R     CLR     only_first_time
                                           ; SOURCE LINE # 944
011B         ?C0163:
                                           ; SOURCE LINE # 947
011B E500        R     MOV     A,index
011D 25E0              ADD     A,ACC
011F 25E0              ADD     A,ACC
0121 2400        R     ADD     A,#LOW last_value_encoder
0123 F582              MOV     DPL,A
0125 E4                CLR     A
0126 3400        R     ADDC    A,#HIGH last_value_encoder
0128 F583              MOV     DPH,A
012A E0                MOVX    A,@DPTR
012B F8                MOV     R0,A
012C A3                INC     DPTR
012D E0                MOVX    A,@DPTR
012E F9                MOV     R1,A
012F A3                INC     DPTR
0130 E0                MOVX    A,@DPTR
0131 FA                MOV     R2,A
0132 A3                INC     DPTR
0133 E0                MOVX    A,@DPTR
0134 FB                MOV     R3,A
0135 900000      R     MOV     DPTR,#value_encoder
0138 E0                MOVX    A,@DPTR
0139 FC                MOV     R4,A
013A A3                INC     DPTR
013B E0                MOVX    A,@DPTR
013C FD                MOV     R5,A
013D A3                INC     DPTR
013E E0                MOVX    A,@DPTR
013F FE                MOV     R6,A
0140 A3                INC     DPTR
0141 E0                MOVX    A,@DPTR
0142 C3                CLR     C
0143 9B                SUBB    A,R3
0144 FF                MOV     R7,A
0145 EE                MOV     A,R6
0146 9A                SUBB    A,R2
0147 FE                MOV     R6,A
0148 ED                MOV     A,R5
0149 99                SUBB    A,R1
014A FD                MOV     R5,A
014B EC                MOV     A,R4
014C 98                SUBB    A,R0
014D FC                MOV     R4,A
014E 900000      R     MOV     DPTR,#aux
0151 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 967
0154 E4                CLR     A
0155 FF                MOV     R7,A
0156 7EC0              MOV     R6,#0C0H
0158 FD                MOV     R5,A
0159 FC                MOV     R4,A
015A 900000      R     MOV     DPTR,#aux
015D E0                MOVX    A,@DPTR
015E F8                MOV     R0,A
015F A3                INC     DPTR
0160 E0                MOVX    A,@DPTR
0161 F9                MOV     R1,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 94  

0162 A3                INC     DPTR
0163 E0                MOVX    A,@DPTR
0164 FA                MOV     R2,A
0165 A3                INC     DPTR
0166 E0                MOVX    A,@DPTR
0167 FB                MOV     R3,A
0168 D3                SETB    C
0169 120000      E     LCALL   ?C?SLCMP
016C 4010              JC      ?C0165
                                           ; SOURCE LINE # 968
016E 7400        E     MOV     A,#LOW g_meas+014H
0170 2500        R     ADD     A,index
0172 F582              MOV     DPL,A
0174 E4                CLR     A
0175 3400        E     ADDC    A,#HIGH g_meas+014H
0177 F583              MOV     DPH,A
0179 E0                MOVX    A,@DPTR
017A 14                DEC     A
017B F0                MOVX    @DPTR,A
017C 8068              SJMP    ?C0166
017E         ?C0165:
                                           ; SOURCE LINE # 969
                                           ; SOURCE LINE # 970
017E 7F00              MOV     R7,#00H
0180 7E40              MOV     R6,#040H
0182 7DFF              MOV     R5,#0FFH
0184 7CFF              MOV     R4,#0FFH
0186 900000      R     MOV     DPTR,#aux
0189 E0                MOVX    A,@DPTR
018A F8                MOV     R0,A
018B A3                INC     DPTR
018C E0                MOVX    A,@DPTR
018D F9                MOV     R1,A
018E A3                INC     DPTR
018F E0                MOVX    A,@DPTR
0190 FA                MOV     R2,A
0191 A3                INC     DPTR
0192 E0                MOVX    A,@DPTR
0193 FB                MOV     R3,A
0194 C3                CLR     C
0195 120000      E     LCALL   ?C?SLCMP
0198 5010              JNC     ?C0167
                                           ; SOURCE LINE # 971
019A 7400        E     MOV     A,#LOW g_meas+014H
019C 2500        R     ADD     A,index
019E F582              MOV     DPL,A
01A0 E4                CLR     A
01A1 3400        E     ADDC    A,#HIGH g_meas+014H
01A3 F583              MOV     DPH,A
01A5 E0                MOVX    A,@DPTR
01A6 04                INC     A
01A7 F0                MOVX    @DPTR,A
01A8 803C              SJMP    ?C0166
01AA         ?C0167:
                                           ; SOURCE LINE # 972
                                           ; SOURCE LINE # 973
01AA 900000      R     MOV     DPTR,#aux
01AD E0                MOVX    A,@DPTR
01AE A3                INC     DPTR
01AF E0                MOVX    A,@DPTR
01B0 A3                INC     DPTR
01B1 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 95  

01B2 FE                MOV     R6,A
01B3 A3                INC     DPTR
01B4 E0                MOVX    A,@DPTR
01B5 FF                MOV     R7,A
01B6 120000      E     LCALL   _abs
01B9 D3                SETB    C
01BA EF                MOV     A,R7
01BB 9400              SUBB    A,#00H
01BD EE                MOV     A,R6
01BE 6480              XRL     A,#080H
01C0 94C0              SUBB    A,#0C0H
01C2 4022              JC      ?C0166
                                           ; SOURCE LINE # 974
01C4 7400        R     MOV     A,#LOW error
01C6 2500        R     ADD     A,index
01C8 F582              MOV     DPL,A
01CA E4                CLR     A
01CB 3400        R     ADDC    A,#HIGH error
01CD F583              MOV     DPH,A
01CF E0                MOVX    A,@DPTR
01D0 04                INC     A
01D1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 975
01D2 7400        R     MOV     A,#LOW error
01D4 2500        R     ADD     A,index
01D6 F582              MOV     DPL,A
01D8 E4                CLR     A
01D9 3400        R     ADDC    A,#HIGH error
01DB F583              MOV     DPH,A
01DD E0                MOVX    A,@DPTR
01DE C3                CLR     C
01DF 940A              SUBB    A,#0AH
01E1 5003              JNC     $ + 5H
01E3 020000      R     LJMP    ?C0154
01E6         ?C0170:
                                           ; SOURCE LINE # 978
                                           ; SOURCE LINE # 979
                                           ; SOURCE LINE # 980
01E6         ?C0166:
                                           ; SOURCE LINE # 982
01E6 7400        R     MOV     A,#LOW error
01E8 2500        R     ADD     A,index
01EA F582              MOV     DPL,A
01EC E4                CLR     A
01ED 3400        R     ADDC    A,#HIGH error
01EF F583              MOV     DPH,A
01F1 E4                CLR     A
01F2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 984
01F3 900000      R     MOV     DPTR,#value_encoder
01F6 E0                MOVX    A,@DPTR
01F7 FC                MOV     R4,A
01F8 A3                INC     DPTR
01F9 E0                MOVX    A,@DPTR
01FA FD                MOV     R5,A
01FB A3                INC     DPTR
01FC E0                MOVX    A,@DPTR
01FD FE                MOV     R6,A
01FE A3                INC     DPTR
01FF E0                MOVX    A,@DPTR
0200 FF                MOV     R7,A
0201 E500        R     MOV     A,index
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 96  

0203 25E0              ADD     A,ACC
0205 25E0              ADD     A,ACC
0207 2400        R     ADD     A,#LOW last_value_encoder
0209 F582              MOV     DPL,A
020B E4                CLR     A
020C 3400        R     ADDC    A,#HIGH last_value_encoder
020E F583              MOV     DPH,A
0210 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 986
0213 900000      R     MOV     DPTR,#value_encoder
0216 E0                MOVX    A,@DPTR
0217 F8                MOV     R0,A
0218 A3                INC     DPTR
0219 E0                MOVX    A,@DPTR
021A F9                MOV     R1,A
021B A3                INC     DPTR
021C E0                MOVX    A,@DPTR
021D FA                MOV     R2,A
021E A3                INC     DPTR
021F E0                MOVX    A,@DPTR
0220 FB                MOV     R3,A
0221 C000              PUSH    AR0
0223 7400        E     MOV     A,#LOW g_meas+014H
0225 2500        R     ADD     A,index
0227 F582              MOV     DPL,A
0229 E4                CLR     A
022A 3400        E     ADDC    A,#HIGH g_meas+014H
022C F583              MOV     DPH,A
022E E0                MOVX    A,@DPTR
022F FF                MOV     R7,A
0230 33                RLC     A
0231 95E0              SUBB    A,ACC
0233 FE                MOV     R6,A
0234 FD                MOV     R5,A
0235 FC                MOV     R4,A
0236 7810              MOV     R0,#010H
0238 120000      E     LCALL   ?C?LSHL
023B D000              POP     AR0
023D EB                MOV     A,R3
023E 2F                ADD     A,R7
023F FF                MOV     R7,A
0240 EA                MOV     A,R2
0241 3E                ADDC    A,R6
0242 FE                MOV     R6,A
0243 E9                MOV     A,R1
0244 3D                ADDC    A,R5
0245 FD                MOV     R5,A
0246 E8                MOV     A,R0
0247 3C                ADDC    A,R4
0248 FC                MOV     R4,A
0249 900000      R     MOV     DPTR,#value_encoder
024C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 988
024F E500        R     MOV     A,index
0251 25E0              ADD     A,ACC
0253 25E0              ADD     A,ACC
0255 2400        E     ADD     A,#LOW c_mem+044H
0257 F582              MOV     DPL,A
0259 E4                CLR     A
025A 3400        E     ADDC    A,#HIGH c_mem+044H
025C F583              MOV     DPH,A
025E E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 97  

025F FC                MOV     R4,A
0260 A3                INC     DPTR
0261 E0                MOVX    A,@DPTR
0262 FD                MOV     R5,A
0263 A3                INC     DPTR
0264 E0                MOVX    A,@DPTR
0265 FE                MOV     R6,A
0266 A3                INC     DPTR
0267 E0                MOVX    A,@DPTR
0268 FF                MOV     R7,A
0269 E4                CLR     A
026A FB                MOV     R3,A
026B FA                MOV     R2,A
026C 7980              MOV     R1,#080H
026E 783F              MOV     R0,#03FH
0270 120000      E     LCALL   ?C?FPCMP3
0273 6038              JZ      ?C0171
                                           ; SOURCE LINE # 989
0275 900000      R     MOV     DPTR,#value_encoder
0278 E0                MOVX    A,@DPTR
0279 FC                MOV     R4,A
027A A3                INC     DPTR
027B E0                MOVX    A,@DPTR
027C FD                MOV     R5,A
027D A3                INC     DPTR
027E E0                MOVX    A,@DPTR
027F FE                MOV     R6,A
0280 A3                INC     DPTR
0281 E0                MOVX    A,@DPTR
0282 FF                MOV     R7,A
0283 EC                MOV     A,R4
0284 120000      E     LCALL   ?C?FCASTL
0287 E500        R     MOV     A,index
0289 25E0              ADD     A,ACC
028B 25E0              ADD     A,ACC
028D 2400        E     ADD     A,#LOW c_mem+044H
028F F582              MOV     DPL,A
0291 E4                CLR     A
0292 3400        E     ADDC    A,#HIGH c_mem+044H
0294 F583              MOV     DPH,A
0296 E0                MOVX    A,@DPTR
0297 F8                MOV     R0,A
0298 A3                INC     DPTR
0299 E0                MOVX    A,@DPTR
029A F9                MOV     R1,A
029B A3                INC     DPTR
029C E0                MOVX    A,@DPTR
029D FA                MOV     R2,A
029E A3                INC     DPTR
029F E0                MOVX    A,@DPTR
02A0 FB                MOV     R3,A
02A1 120000      E     LCALL   ?C?FPMUL
02A4 120000      E     LCALL   ?C?CASTF
02A7 900000      R     MOV     DPTR,#value_encoder
02AA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 990
02AD         ?C0171:
                                           ; SOURCE LINE # 992
02AD 900000      R     MOV     DPTR,#value_encoder
02B0 E0                MOVX    A,@DPTR
02B1 FC                MOV     R4,A
02B2 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 98  

02B3 E0                MOVX    A,@DPTR
02B4 FD                MOV     R5,A
02B5 A3                INC     DPTR
02B6 E0                MOVX    A,@DPTR
02B7 FE                MOV     R6,A
02B8 A3                INC     DPTR
02B9 E0                MOVX    A,@DPTR
02BA FF                MOV     R7,A
02BB E500        R     MOV     A,index
02BD 25E0              ADD     A,ACC
02BF 25E0              ADD     A,ACC
02C1 2400        E     ADD     A,#LOW g_meas
02C3 F582              MOV     DPL,A
02C5 E4                CLR     A
02C6 3400        E     ADDC    A,#HIGH g_meas
02C8 F583              MOV     DPH,A
02CA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 993
02CD         ?C0162:
                                           ; SOURCE LINE # 995
02CD E500        R     MOV     A,index
02CF 14                DEC     A
02D0 7003              JNZ     $ + 5H
02D2 020000      R     LJMP    ?C0174
02D5 14                DEC     A
02D6 7003              JNZ     $ + 5H
02D8 020000      R     LJMP    ?C0175
02DB 2402              ADD     A,#02H
02DD 6003              JZ      $ + 5H
02DF 020000      R     LJMP    ?C0172
                                           ; SOURCE LINE # 996
02E2         ?C0173:
                                           ; SOURCE LINE # 997
02E2 E4                CLR     A
02E3 7F12              MOV     R7,#012H
02E5 FE                MOV     R6,A
02E6 FD                MOV     R5,A
02E7 FC                MOV     R4,A
02E8 900000      R     MOV     DPTR,#v_value
02EB E0                MOVX    A,@DPTR
02EC F8                MOV     R0,A
02ED A3                INC     DPTR
02EE E0                MOVX    A,@DPTR
02EF F9                MOV     R1,A
02F0 A3                INC     DPTR
02F1 E0                MOVX    A,@DPTR
02F2 FA                MOV     R2,A
02F3 A3                INC     DPTR
02F4 E0                MOVX    A,@DPTR
02F5 FB                MOV     R3,A
02F6 120000      E     LCALL   ?C?LMUL
02F9 C004              PUSH    AR4
02FB C005              PUSH    AR5
02FD C006              PUSH    AR6
02FF C007              PUSH    AR7
0301 E4                CLR     A
0302 7F0B              MOV     R7,#0BH
0304 FE                MOV     R6,A
0305 FD                MOV     R5,A
0306 FC                MOV     R4,A
0307 900000      R     MOV     DPTR,#value_encoder
030A E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 99  

030B F8                MOV     R0,A
030C A3                INC     DPTR
030D E0                MOVX    A,@DPTR
030E F9                MOV     R1,A
030F A3                INC     DPTR
0310 E0                MOVX    A,@DPTR
0311 FA                MOV     R2,A
0312 A3                INC     DPTR
0313 E0                MOVX    A,@DPTR
0314 FB                MOV     R3,A
0315 120000      E     LCALL   ?C?LMUL
0318 D003              POP     AR3
031A D002              POP     AR2
031C D001              POP     AR1
031E D000              POP     AR0
0320 C3                CLR     C
0321 EF                MOV     A,R7
0322 9B                SUBB    A,R3
0323 FF                MOV     R7,A
0324 EE                MOV     A,R6
0325 9A                SUBB    A,R2
0326 FE                MOV     R6,A
0327 ED                MOV     A,R5
0328 99                SUBB    A,R1
0329 FD                MOV     R5,A
032A EC                MOV     A,R4
032B 98                SUBB    A,R0
032C FC                MOV     R4,A
032D C004              PUSH    AR4
032F C005              PUSH    AR5
0331 C006              PUSH    AR6
0333 C007              PUSH    AR7
0335 E4                CLR     A
0336 7F09              MOV     R7,#09H
0338 FE                MOV     R6,A
0339 FD                MOV     R5,A
033A FC                MOV     R4,A
033B 900000      R     MOV     DPTR,#vv_value
033E E0                MOVX    A,@DPTR
033F F8                MOV     R0,A
0340 A3                INC     DPTR
0341 E0                MOVX    A,@DPTR
0342 F9                MOV     R1,A
0343 A3                INC     DPTR
0344 E0                MOVX    A,@DPTR
0345 FA                MOV     R2,A
0346 A3                INC     DPTR
0347 E0                MOVX    A,@DPTR
0348 FB                MOV     R3,A
0349 120000      E     LCALL   ?C?LMUL
034C D003              POP     AR3
034E D002              POP     AR2
0350 D001              POP     AR1
0352 D000              POP     AR0
0354 EF                MOV     A,R7
0355 2B                ADD     A,R3
0356 FF                MOV     R7,A
0357 EE                MOV     A,R6
0358 3A                ADDC    A,R2
0359 FE                MOV     R6,A
035A ED                MOV     A,R5
035B 39                ADDC    A,R1
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 100 

035C FD                MOV     R5,A
035D EC                MOV     A,R4
035E 38                ADDC    A,R0
035F FC                MOV     R4,A
0360 C004              PUSH    AR4
0362 C005              PUSH    AR5
0364 C006              PUSH    AR6
0366 C007              PUSH    AR7
0368 E4                CLR     A
0369 7F02              MOV     R7,#02H
036B FE                MOV     R6,A
036C FD                MOV     R5,A
036D FC                MOV     R4,A
036E 900000      R     MOV     DPTR,#vvv_value
0371 E0                MOVX    A,@DPTR
0372 F8                MOV     R0,A
0373 A3                INC     DPTR
0374 E0                MOVX    A,@DPTR
0375 F9                MOV     R1,A
0376 A3                INC     DPTR
0377 E0                MOVX    A,@DPTR
0378 FA                MOV     R2,A
0379 A3                INC     DPTR
037A E0                MOVX    A,@DPTR
037B FB                MOV     R3,A
037C 120000      E     LCALL   ?C?LMUL
037F A804              MOV     R0,AR4
0381 A905              MOV     R1,AR5
0383 AA06              MOV     R2,AR6
0385 AB07              MOV     R3,AR7
0387 D007              POP     AR7
0389 D006              POP     AR6
038B D005              POP     AR5
038D D004              POP     AR4
038F C3                CLR     C
0390 EF                MOV     A,R7
0391 9B                SUBB    A,R3
0392 FF                MOV     R7,A
0393 EE                MOV     A,R6
0394 9A                SUBB    A,R2
0395 FE                MOV     R6,A
0396 ED                MOV     A,R5
0397 99                SUBB    A,R1
0398 FD                MOV     R5,A
0399 EC                MOV     A,R4
039A 98                SUBB    A,R0
039B FC                MOV     R4,A
039C 120000      E     LCALL   _filter_vel_1
039F EE                MOV     A,R6
03A0 33                RLC     A
03A1 95E0              SUBB    A,ACC
03A3 FD                MOV     R5,A
03A4 FC                MOV     R4,A
03A5 900000      R     MOV     DPTR,#speed_encoder
03A8 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 998
03AB 020000      R     LJMP    ?C0172
                                           ; SOURCE LINE # 1000
03AE         ?C0174:
                                           ; SOURCE LINE # 1001
03AE E4                CLR     A
03AF 7F12              MOV     R7,#012H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 101 

03B1 FE                MOV     R6,A
03B2 FD                MOV     R5,A
03B3 FC                MOV     R4,A
03B4 900000      R     MOV     DPTR,#v_value+04H
03B7 E0                MOVX    A,@DPTR
03B8 F8                MOV     R0,A
03B9 A3                INC     DPTR
03BA E0                MOVX    A,@DPTR
03BB F9                MOV     R1,A
03BC A3                INC     DPTR
03BD E0                MOVX    A,@DPTR
03BE FA                MOV     R2,A
03BF A3                INC     DPTR
03C0 E0                MOVX    A,@DPTR
03C1 FB                MOV     R3,A
03C2 120000      E     LCALL   ?C?LMUL
03C5 C004              PUSH    AR4
03C7 C005              PUSH    AR5
03C9 C006              PUSH    AR6
03CB C007              PUSH    AR7
03CD E4                CLR     A
03CE 7F0B              MOV     R7,#0BH
03D0 FE                MOV     R6,A
03D1 FD                MOV     R5,A
03D2 FC                MOV     R4,A
03D3 900000      R     MOV     DPTR,#value_encoder
03D6 E0                MOVX    A,@DPTR
03D7 F8                MOV     R0,A
03D8 A3                INC     DPTR
03D9 E0                MOVX    A,@DPTR
03DA F9                MOV     R1,A
03DB A3                INC     DPTR
03DC E0                MOVX    A,@DPTR
03DD FA                MOV     R2,A
03DE A3                INC     DPTR
03DF E0                MOVX    A,@DPTR
03E0 FB                MOV     R3,A
03E1 120000      E     LCALL   ?C?LMUL
03E4 D003              POP     AR3
03E6 D002              POP     AR2
03E8 D001              POP     AR1
03EA D000              POP     AR0
03EC C3                CLR     C
03ED EF                MOV     A,R7
03EE 9B                SUBB    A,R3
03EF FF                MOV     R7,A
03F0 EE                MOV     A,R6
03F1 9A                SUBB    A,R2
03F2 FE                MOV     R6,A
03F3 ED                MOV     A,R5
03F4 99                SUBB    A,R1
03F5 FD                MOV     R5,A
03F6 EC                MOV     A,R4
03F7 98                SUBB    A,R0
03F8 FC                MOV     R4,A
03F9 C004              PUSH    AR4
03FB C005              PUSH    AR5
03FD C006              PUSH    AR6
03FF C007              PUSH    AR7
0401 E4                CLR     A
0402 7F09              MOV     R7,#09H
0404 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 102 

0405 FD                MOV     R5,A
0406 FC                MOV     R4,A
0407 900000      R     MOV     DPTR,#vv_value+04H
040A E0                MOVX    A,@DPTR
040B F8                MOV     R0,A
040C A3                INC     DPTR
040D E0                MOVX    A,@DPTR
040E F9                MOV     R1,A
040F A3                INC     DPTR
0410 E0                MOVX    A,@DPTR
0411 FA                MOV     R2,A
0412 A3                INC     DPTR
0413 E0                MOVX    A,@DPTR
0414 FB                MOV     R3,A
0415 120000      E     LCALL   ?C?LMUL
0418 D003              POP     AR3
041A D002              POP     AR2
041C D001              POP     AR1
041E D000              POP     AR0
0420 EF                MOV     A,R7
0421 2B                ADD     A,R3
0422 FF                MOV     R7,A
0423 EE                MOV     A,R6
0424 3A                ADDC    A,R2
0425 FE                MOV     R6,A
0426 ED                MOV     A,R5
0427 39                ADDC    A,R1
0428 FD                MOV     R5,A
0429 EC                MOV     A,R4
042A 38                ADDC    A,R0
042B FC                MOV     R4,A
042C C004              PUSH    AR4
042E C005              PUSH    AR5
0430 C006              PUSH    AR6
0432 C007              PUSH    AR7
0434 E4                CLR     A
0435 7F02              MOV     R7,#02H
0437 FE                MOV     R6,A
0438 FD                MOV     R5,A
0439 FC                MOV     R4,A
043A 900000      R     MOV     DPTR,#vvv_value+04H
043D E0                MOVX    A,@DPTR
043E F8                MOV     R0,A
043F A3                INC     DPTR
0440 E0                MOVX    A,@DPTR
0441 F9                MOV     R1,A
0442 A3                INC     DPTR
0443 E0                MOVX    A,@DPTR
0444 FA                MOV     R2,A
0445 A3                INC     DPTR
0446 E0                MOVX    A,@DPTR
0447 FB                MOV     R3,A
0448 120000      E     LCALL   ?C?LMUL
044B A804              MOV     R0,AR4
044D A905              MOV     R1,AR5
044F AA06              MOV     R2,AR6
0451 AB07              MOV     R3,AR7
0453 D007              POP     AR7
0455 D006              POP     AR6
0457 D005              POP     AR5
0459 D004              POP     AR4
045B C3                CLR     C
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 103 

045C EF                MOV     A,R7
045D 9B                SUBB    A,R3
045E FF                MOV     R7,A
045F EE                MOV     A,R6
0460 9A                SUBB    A,R2
0461 FE                MOV     R6,A
0462 ED                MOV     A,R5
0463 99                SUBB    A,R1
0464 FD                MOV     R5,A
0465 EC                MOV     A,R4
0466 98                SUBB    A,R0
0467 FC                MOV     R4,A
0468 120000      E     LCALL   _filter_vel_2
046B EE                MOV     A,R6
046C 33                RLC     A
046D 95E0              SUBB    A,ACC
046F FD                MOV     R5,A
0470 FC                MOV     R4,A
0471 900000      R     MOV     DPTR,#speed_encoder
0474 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1002
0477 020000      R     LJMP    ?C0172
                                           ; SOURCE LINE # 1004
047A         ?C0175:
                                           ; SOURCE LINE # 1005
047A E4                CLR     A
047B 7F12              MOV     R7,#012H
047D FE                MOV     R6,A
047E FD                MOV     R5,A
047F FC                MOV     R4,A
0480 900000      R     MOV     DPTR,#v_value+08H
0483 E0                MOVX    A,@DPTR
0484 F8                MOV     R0,A
0485 A3                INC     DPTR
0486 E0                MOVX    A,@DPTR
0487 F9                MOV     R1,A
0488 A3                INC     DPTR
0489 E0                MOVX    A,@DPTR
048A FA                MOV     R2,A
048B A3                INC     DPTR
048C E0                MOVX    A,@DPTR
048D FB                MOV     R3,A
048E 120000      E     LCALL   ?C?LMUL
0491 C004              PUSH    AR4
0493 C005              PUSH    AR5
0495 C006              PUSH    AR6
0497 C007              PUSH    AR7
0499 E4                CLR     A
049A 7F0B              MOV     R7,#0BH
049C FE                MOV     R6,A
049D FD                MOV     R5,A
049E FC                MOV     R4,A
049F 900000      R     MOV     DPTR,#value_encoder
04A2 E0                MOVX    A,@DPTR
04A3 F8                MOV     R0,A
04A4 A3                INC     DPTR
04A5 E0                MOVX    A,@DPTR
04A6 F9                MOV     R1,A
04A7 A3                INC     DPTR
04A8 E0                MOVX    A,@DPTR
04A9 FA                MOV     R2,A
04AA A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 104 

04AB E0                MOVX    A,@DPTR
04AC FB                MOV     R3,A
04AD 120000      E     LCALL   ?C?LMUL
04B0 D003              POP     AR3
04B2 D002              POP     AR2
04B4 D001              POP     AR1
04B6 D000              POP     AR0
04B8 C3                CLR     C
04B9 EF                MOV     A,R7
04BA 9B                SUBB    A,R3
04BB FF                MOV     R7,A
04BC EE                MOV     A,R6
04BD 9A                SUBB    A,R2
04BE FE                MOV     R6,A
04BF ED                MOV     A,R5
04C0 99                SUBB    A,R1
04C1 FD                MOV     R5,A
04C2 EC                MOV     A,R4
04C3 98                SUBB    A,R0
04C4 FC                MOV     R4,A
04C5 C004              PUSH    AR4
04C7 C005              PUSH    AR5
04C9 C006              PUSH    AR6
04CB C007              PUSH    AR7
04CD E4                CLR     A
04CE 7F09              MOV     R7,#09H
04D0 FE                MOV     R6,A
04D1 FD                MOV     R5,A
04D2 FC                MOV     R4,A
04D3 900000      R     MOV     DPTR,#vv_value+08H
04D6 E0                MOVX    A,@DPTR
04D7 F8                MOV     R0,A
04D8 A3                INC     DPTR
04D9 E0                MOVX    A,@DPTR
04DA F9                MOV     R1,A
04DB A3                INC     DPTR
04DC E0                MOVX    A,@DPTR
04DD FA                MOV     R2,A
04DE A3                INC     DPTR
04DF E0                MOVX    A,@DPTR
04E0 FB                MOV     R3,A
04E1 120000      E     LCALL   ?C?LMUL
04E4 D003              POP     AR3
04E6 D002              POP     AR2
04E8 D001              POP     AR1
04EA D000              POP     AR0
04EC EF                MOV     A,R7
04ED 2B                ADD     A,R3
04EE FF                MOV     R7,A
04EF EE                MOV     A,R6
04F0 3A                ADDC    A,R2
04F1 FE                MOV     R6,A
04F2 ED                MOV     A,R5
04F3 39                ADDC    A,R1
04F4 FD                MOV     R5,A
04F5 EC                MOV     A,R4
04F6 38                ADDC    A,R0
04F7 FC                MOV     R4,A
04F8 C004              PUSH    AR4
04FA C005              PUSH    AR5
04FC C006              PUSH    AR6
04FE C007              PUSH    AR7
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 105 

0500 E4                CLR     A
0501 7F02              MOV     R7,#02H
0503 FE                MOV     R6,A
0504 FD                MOV     R5,A
0505 FC                MOV     R4,A
0506 900000      R     MOV     DPTR,#vvv_value+08H
0509 E0                MOVX    A,@DPTR
050A F8                MOV     R0,A
050B A3                INC     DPTR
050C E0                MOVX    A,@DPTR
050D F9                MOV     R1,A
050E A3                INC     DPTR
050F E0                MOVX    A,@DPTR
0510 FA                MOV     R2,A
0511 A3                INC     DPTR
0512 E0                MOVX    A,@DPTR
0513 FB                MOV     R3,A
0514 120000      E     LCALL   ?C?LMUL
0517 A804              MOV     R0,AR4
0519 A905              MOV     R1,AR5
051B AA06              MOV     R2,AR6
051D AB07              MOV     R3,AR7
051F D007              POP     AR7
0521 D006              POP     AR6
0523 D005              POP     AR5
0525 D004              POP     AR4
0527 C3                CLR     C
0528 EF                MOV     A,R7
0529 9B                SUBB    A,R3
052A FF                MOV     R7,A
052B EE                MOV     A,R6
052C 9A                SUBB    A,R2
052D FE                MOV     R6,A
052E ED                MOV     A,R5
052F 99                SUBB    A,R1
0530 FD                MOV     R5,A
0531 EC                MOV     A,R4
0532 98                SUBB    A,R0
0533 FC                MOV     R4,A
0534 120000      E     LCALL   _filter_vel_3
0537 EE                MOV     A,R6
0538 33                RLC     A
0539 95E0              SUBB    A,ACC
053B FD                MOV     R5,A
053C FC                MOV     R4,A
053D 900000      R     MOV     DPTR,#speed_encoder
0540 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1006
                                           ; SOURCE LINE # 1007
0543         ?C0172:
                                           ; SOURCE LINE # 1009
0543 E4                CLR     A
0544 FF                MOV     R7,A
0545 FE                MOV     R6,A
0546 7DC0              MOV     R5,#0C0H
0548 7C40              MOV     R4,#040H
054A 900000      E     MOV     DPTR,#cycle_time
054D E0                MOVX    A,@DPTR
054E F8                MOV     R0,A
054F A3                INC     DPTR
0550 E0                MOVX    A,@DPTR
0551 F9                MOV     R1,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 106 

0552 A3                INC     DPTR
0553 E0                MOVX    A,@DPTR
0554 FA                MOV     R2,A
0555 A3                INC     DPTR
0556 E0                MOVX    A,@DPTR
0557 FB                MOV     R3,A
0558 120000      E     LCALL   ?C?FPMUL
055B C004              PUSH    AR4
055D C005              PUSH    AR5
055F C006              PUSH    AR6
0561 C007              PUSH    AR7
0563 900000      R     MOV     DPTR,#speed_encoder
0566 E0                MOVX    A,@DPTR
0567 FC                MOV     R4,A
0568 A3                INC     DPTR
0569 E0                MOVX    A,@DPTR
056A FD                MOV     R5,A
056B A3                INC     DPTR
056C E0                MOVX    A,@DPTR
056D FE                MOV     R6,A
056E A3                INC     DPTR
056F E0                MOVX    A,@DPTR
0570 FF                MOV     R7,A
0571 EC                MOV     A,R4
0572 120000      E     LCALL   ?C?FCASTL
0575 D003              POP     AR3
0577 D002              POP     AR2
0579 D001              POP     AR1
057B D000              POP     AR0
057D 120000      E     LCALL   ?C?FPDIV
0580 120000      E     LCALL   ?C?CASTF
0583 900000      R     MOV     DPTR,#speed_encoder
0586 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1010
0589 900000      R     MOV     DPTR,#speed_encoder
058C E0                MOVX    A,@DPTR
058D FC                MOV     R4,A
058E A3                INC     DPTR
058F E0                MOVX    A,@DPTR
0590 FD                MOV     R5,A
0591 A3                INC     DPTR
0592 E0                MOVX    A,@DPTR
0593 FE                MOV     R6,A
0594 A3                INC     DPTR
0595 E0                MOVX    A,@DPTR
0596 FF                MOV     R7,A
0597 E500        R     MOV     A,index
0599 25E0              ADD     A,ACC
059B 25E0              ADD     A,ACC
059D 2400        E     ADD     A,#LOW g_meas+01FH
059F F582              MOV     DPL,A
05A1 E4                CLR     A
05A2 3400        E     ADDC    A,#HIGH g_meas+01FH
05A4 F583              MOV     DPH,A
05A6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1032
05A9 E500        R     MOV     A,index
05AB 25E0              ADD     A,ACC
05AD 25E0              ADD     A,ACC
05AF 2400        R     ADD     A,#LOW vv_value
05B1 F582              MOV     DPL,A
05B3 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 107 

05B4 3400        R     ADDC    A,#HIGH vv_value
05B6 F583              MOV     DPH,A
05B8 E0                MOVX    A,@DPTR
05B9 FC                MOV     R4,A
05BA A3                INC     DPTR
05BB E0                MOVX    A,@DPTR
05BC FD                MOV     R5,A
05BD A3                INC     DPTR
05BE E0                MOVX    A,@DPTR
05BF FE                MOV     R6,A
05C0 A3                INC     DPTR
05C1 E0                MOVX    A,@DPTR
05C2 FF                MOV     R7,A
05C3 E500        R     MOV     A,index
05C5 25E0              ADD     A,ACC
05C7 25E0              ADD     A,ACC
05C9 2400        R     ADD     A,#LOW vvv_value
05CB F582              MOV     DPL,A
05CD E4                CLR     A
05CE 3400        R     ADDC    A,#HIGH vvv_value
05D0 F583              MOV     DPH,A
05D2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1033
05D5 E500        R     MOV     A,index
05D7 25E0              ADD     A,ACC
05D9 25E0              ADD     A,ACC
05DB 2400        R     ADD     A,#LOW v_value
05DD F582              MOV     DPL,A
05DF E4                CLR     A
05E0 3400        R     ADDC    A,#HIGH v_value
05E2 F583              MOV     DPH,A
05E4 E0                MOVX    A,@DPTR
05E5 FC                MOV     R4,A
05E6 A3                INC     DPTR
05E7 E0                MOVX    A,@DPTR
05E8 FD                MOV     R5,A
05E9 A3                INC     DPTR
05EA E0                MOVX    A,@DPTR
05EB FE                MOV     R6,A
05EC A3                INC     DPTR
05ED E0                MOVX    A,@DPTR
05EE FF                MOV     R7,A
05EF E500        R     MOV     A,index
05F1 25E0              ADD     A,ACC
05F3 25E0              ADD     A,ACC
05F5 2400        R     ADD     A,#LOW vv_value
05F7 F582              MOV     DPL,A
05F9 E4                CLR     A
05FA 3400        R     ADDC    A,#HIGH vv_value
05FC F583              MOV     DPH,A
05FE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1034
0601 900000      R     MOV     DPTR,#value_encoder
0604 E0                MOVX    A,@DPTR
0605 FC                MOV     R4,A
0606 A3                INC     DPTR
0607 E0                MOVX    A,@DPTR
0608 FD                MOV     R5,A
0609 A3                INC     DPTR
060A E0                MOVX    A,@DPTR
060B FE                MOV     R6,A
060C A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 108 

060D E0                MOVX    A,@DPTR
060E FF                MOV     R7,A
060F E500        R     MOV     A,index
0611 25E0              ADD     A,ACC
0613 25E0              ADD     A,ACC
0615 2400        R     ADD     A,#LOW v_value
0617 F582              MOV     DPL,A
0619 E4                CLR     A
061A 3400        R     ADDC    A,#HIGH v_value
061C F583              MOV     DPH,A
061E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1044
0621 300003      R     JNB     pos_reconstruct,$ + 6H
0624 020000      R     LJMP    ?C0154
                                           ; SOURCE LINE # 1045
0627 900000      R     MOV     DPTR,#one_time_execute
062A E0                MOVX    A,@DPTR
062B C3                CLR     C
062C 9422              SUBB    A,#022H
062E 5004              JNC     ?C0177
                                           ; SOURCE LINE # 1046
0630 E0                MOVX    A,@DPTR
0631 04                INC     A
0632 F0                MOVX    @DPTR,A
0633 22                RET     
0634         ?C0177:
                                           ; SOURCE LINE # 1047
                                           ; SOURCE LINE # 1049
0634 900000      E     MOV     DPTR,#c_mem+079H
0637 E0                MOVX    A,@DPTR
0638 606E              JZ      ?C0179
                                           ; SOURCE LINE # 1051
063A 900000      E     MOV     DPTR,#g_meas+04H
063D E0                MOVX    A,@DPTR
063E FC                MOV     R4,A
063F A3                INC     DPTR
0640 E0                MOVX    A,@DPTR
0641 FD                MOV     R5,A
0642 A3                INC     DPTR
0643 E0                MOVX    A,@DPTR
0644 FE                MOV     R6,A
0645 A3                INC     DPTR
0646 E0                MOVX    A,@DPTR
0647 FF                MOV     R7,A
0648 900000      E     MOV     DPTR,#?_calc_turns_fcn?BYTE+04H
064B 120000      E     LCALL   ?C?LSTXDATA
064E 900000      E     MOV     DPTR,#g_meas
0651 E0                MOVX    A,@DPTR
0652 FC                MOV     R4,A
0653 A3                INC     DPTR
0654 E0                MOVX    A,@DPTR
0655 FD                MOV     R5,A
0656 A3                INC     DPTR
0657 E0                MOVX    A,@DPTR
0658 FE                MOV     R6,A
0659 A3                INC     DPTR
065A E0                MOVX    A,@DPTR
065B FF                MOV     R7,A
065C 120000      E     LCALL   _calc_turns_fcn
065F EE                MOV     A,R6
0660 33                RLC     A
0661 95E0              SUBB    A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 109 

0663 FD                MOV     R5,A
0664 FC                MOV     R4,A
0665 900000      R     MOV     DPTR,#init_rot
0668 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1053
066B E4                CLR     A
066C FF                MOV     R7,A
066D FE                MOV     R6,A
066E FD                MOV     R5,A
066F FC                MOV     R4,A
0670 900000      E     MOV     DPTR,#c_mem+044H
0673 E0                MOVX    A,@DPTR
0674 F8                MOV     R0,A
0675 A3                INC     DPTR
0676 E0                MOVX    A,@DPTR
0677 F9                MOV     R1,A
0678 A3                INC     DPTR
0679 E0                MOVX    A,@DPTR
067A FA                MOV     R2,A
067B A3                INC     DPTR
067C E0                MOVX    A,@DPTR
067D FB                MOV     R3,A
067E 120000      E     LCALL   ?C?FPCMP3
0681 5017              JNC     ?C0180
                                           ; SOURCE LINE # 1054
0683 900000      R     MOV     DPTR,#init_rot
0686 E0                MOVX    A,@DPTR
0687 FC                MOV     R4,A
0688 A3                INC     DPTR
0689 E0                MOVX    A,@DPTR
068A FD                MOV     R5,A
068B A3                INC     DPTR
068C E0                MOVX    A,@DPTR
068D FE                MOV     R6,A
068E A3                INC     DPTR
068F E0                MOVX    A,@DPTR
0690 FF                MOV     R7,A
0691 120000      E     LCALL   ?C?LNEG
0694 900000      R     MOV     DPTR,#init_rot
0697 120000      E     LCALL   ?C?LSTXDATA
069A         ?C0180:
                                           ; SOURCE LINE # 1056
069A 900000      R     MOV     DPTR,#init_rot
069D E0                MOVX    A,@DPTR
069E A3                INC     DPTR
069F E0                MOVX    A,@DPTR
06A0 A3                INC     DPTR
06A1 E0                MOVX    A,@DPTR
06A2 A3                INC     DPTR
06A3 E0                MOVX    A,@DPTR
06A4 900000      E     MOV     DPTR,#g_meas+014H
06A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1058
06A8         ?C0179:
                                           ; SOURCE LINE # 1060
06A8 7400        E     MOV     A,#LOW c_mem+044H
06AA 6401              XRL     A,#01H
06AC 4400        E     ORL     A,#HIGH c_mem+044H
06AE 602C              JZ      ?C0181
                                           ; SOURCE LINE # 1061
06B0 900000      E     MOV     DPTR,#g_meas
06B3 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 110 

06B4 FC                MOV     R4,A
06B5 A3                INC     DPTR
06B6 E0                MOVX    A,@DPTR
06B7 FD                MOV     R5,A
06B8 A3                INC     DPTR
06B9 E0                MOVX    A,@DPTR
06BA FE                MOV     R6,A
06BB A3                INC     DPTR
06BC E0                MOVX    A,@DPTR
06BD FF                MOV     R7,A
06BE EC                MOV     A,R4
06BF 120000      E     LCALL   ?C?FCASTL
06C2 900000      E     MOV     DPTR,#c_mem+044H
06C5 E0                MOVX    A,@DPTR
06C6 F8                MOV     R0,A
06C7 A3                INC     DPTR
06C8 E0                MOVX    A,@DPTR
06C9 F9                MOV     R1,A
06CA A3                INC     DPTR
06CB E0                MOVX    A,@DPTR
06CC FA                MOV     R2,A
06CD A3                INC     DPTR
06CE E0                MOVX    A,@DPTR
06CF FB                MOV     R3,A
06D0 120000      E     LCALL   ?C?FPDIV
06D3 120000      E     LCALL   ?C?CASTF
06D6 900000      E     MOV     DPTR,#g_meas
06D9 120000      E     LCALL   ?C?LSTXDATA
06DC         ?C0181:
                                           ; SOURCE LINE # 1063
06DC 900000      E     MOV     DPTR,#g_meas
06DF E0                MOVX    A,@DPTR
06E0 F8                MOV     R0,A
06E1 A3                INC     DPTR
06E2 E0                MOVX    A,@DPTR
06E3 F9                MOV     R1,A
06E4 A3                INC     DPTR
06E5 E0                MOVX    A,@DPTR
06E6 FA                MOV     R2,A
06E7 A3                INC     DPTR
06E8 E0                MOVX    A,@DPTR
06E9 FB                MOV     R3,A
06EA C000              PUSH    AR0
06EC 900000      R     MOV     DPTR,#init_rot
06EF E0                MOVX    A,@DPTR
06F0 FC                MOV     R4,A
06F1 A3                INC     DPTR
06F2 E0                MOVX    A,@DPTR
06F3 FD                MOV     R5,A
06F4 A3                INC     DPTR
06F5 E0                MOVX    A,@DPTR
06F6 FE                MOV     R6,A
06F7 A3                INC     DPTR
06F8 E0                MOVX    A,@DPTR
06F9 FF                MOV     R7,A
06FA 7810              MOV     R0,#010H
06FC 120000      E     LCALL   ?C?LSHL
06FF D000              POP     AR0
0701 EB                MOV     A,R3
0702 2F                ADD     A,R7
0703 FF                MOV     R7,A
0704 EA                MOV     A,R2
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 111 

0705 3E                ADDC    A,R6
0706 FE                MOV     R6,A
0707 E9                MOV     A,R1
0708 3D                ADDC    A,R5
0709 FD                MOV     R5,A
070A E8                MOV     A,R0
070B 3C                ADDC    A,R4
070C FC                MOV     R4,A
070D 900000      E     MOV     DPTR,#g_meas
0710 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1065
0713 7400        E     MOV     A,#LOW c_mem+044H
0715 6401              XRL     A,#01H
0717 4400        E     ORL     A,#HIGH c_mem+044H
0719 602C              JZ      ?C0182
                                           ; SOURCE LINE # 1066
071B 900000      E     MOV     DPTR,#g_meas
071E E0                MOVX    A,@DPTR
071F FC                MOV     R4,A
0720 A3                INC     DPTR
0721 E0                MOVX    A,@DPTR
0722 FD                MOV     R5,A
0723 A3                INC     DPTR
0724 E0                MOVX    A,@DPTR
0725 FE                MOV     R6,A
0726 A3                INC     DPTR
0727 E0                MOVX    A,@DPTR
0728 FF                MOV     R7,A
0729 EC                MOV     A,R4
072A 120000      E     LCALL   ?C?FCASTL
072D 900000      E     MOV     DPTR,#c_mem+044H
0730 E0                MOVX    A,@DPTR
0731 F8                MOV     R0,A
0732 A3                INC     DPTR
0733 E0                MOVX    A,@DPTR
0734 F9                MOV     R1,A
0735 A3                INC     DPTR
0736 E0                MOVX    A,@DPTR
0737 FA                MOV     R2,A
0738 A3                INC     DPTR
0739 E0                MOVX    A,@DPTR
073A FB                MOV     R3,A
073B 120000      E     LCALL   ?C?FPMUL
073E 120000      E     LCALL   ?C?CASTF
0741 900000      E     MOV     DPTR,#g_meas
0744 120000      E     LCALL   ?C?LSTXDATA
0747         ?C0182:
                                           ; SOURCE LINE # 1069
0747 900000      E     MOV     DPTR,#g_meas
074A E0                MOVX    A,@DPTR
074B FC                MOV     R4,A
074C A3                INC     DPTR
074D E0                MOVX    A,@DPTR
074E FD                MOV     R5,A
074F A3                INC     DPTR
0750 E0                MOVX    A,@DPTR
0751 FE                MOV     R6,A
0752 A3                INC     DPTR
0753 E0                MOVX    A,@DPTR
0754 FF                MOV     R7,A
0755 900000      E     MOV     DPTR,#g_refNew
0758 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 112 

                                           ; SOURCE LINE # 1071
075B 900000      E     MOV     DPTR,#g_ref+018H
075E E0                MOVX    A,@DPTR
075F FF                MOV     R7,A
0760 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1073
0763 D200        R     SETB    pos_reconstruct
                                           ; SOURCE LINE # 1074
                                           ; SOURCE LINE # 1075
                                           ; SOURCE LINE # 1076
0765         ?C0154:
0765 22                RET     
             ; FUNCTION _encoder_reading (END)

             ; FUNCTION analog_read_end (BEGIN)
                                           ; SOURCE LINE # 1082
0000         ?C0183:
                                           ; SOURCE LINE # 1117
0000 120000      E     LCALL   ADC_STATUS_Read
0003 EF                MOV     A,R7
0004 700A              JNZ     ?C0184
                                           ; SOURCE LINE # 1118
0006 3000F7            JNB     interrupt_flag,?C0183
                                           ; SOURCE LINE # 1119
0009 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1120
000B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1121
                                           ; SOURCE LINE # 1122
000E 80F0              SJMP    ?C0183
0010         ?C0184:
                                           ; SOURCE LINE # 1125
0010 900000      E     MOV     DPTR,#ADC_buf+01H
0013 E0                MOVX    A,@DPTR
0014 249A              ADD     A,#09AH
0016 FF                MOV     R7,A
0017 900000      E     MOV     DPTR,#ADC_buf
001A E0                MOVX    A,@DPTR
001B 34F9              ADDC    A,#0F9H
001D FE                MOV     R6,A
001E 33                RLC     A
001F 95E0              SUBB    A,ACC
0021 FD                MOV     R5,A
0022 FC                MOV     R4,A
0023 E4                CLR     A
0024 7BA0              MOV     R3,#0A0H
0026 7A07              MOV     R2,#07H
0028 F9                MOV     R1,A
0029 F8                MOV     R0,A
002A 120000      E     LCALL   ?C?LMUL
002D 7807              MOV     R0,#07H
002F 120000      E     LCALL   ?C?SLSHR
0032 900000      E     MOV     DPTR,#dev_tension
0035 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1127
0038 300005            JNB     interrupt_flag,?C0186
                                           ; SOURCE LINE # 1128
003B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1129
003D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1130
0040         ?C0186:
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 113 

                                           ; SOURCE LINE # 1131
0040 900000      R     MOV     DPTR,#first_tension_valid
0043 E0                MOVX    A,@DPTR
0044 6077              JZ      ?C0187
0046 300074            JNB     tension_valid,?C0187
                                           ; SOURCE LINE # 1132
0049 900000      R     MOV     DPTR,#count
004C E0                MOVX    A,@DPTR
004D 04                INC     A
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1134
004F E0                MOVX    A,@DPTR
0050 64E8              XRL     A,#0E8H
0052 7002              JNZ     ?C0268
0054 7403              MOV     A,#03H
0056         ?C0268:
0056 7065              JNZ     ?C0187
                                           ; SOURCE LINE # 1135
0058 7F28              MOV     R7,#028H
005A 7E23              MOV     R6,#023H
005C FD                MOV     R5,A
005D FC                MOV     R4,A
005E 900000      E     MOV     DPTR,#dev_tension
0061 E0                MOVX    A,@DPTR
0062 F8                MOV     R0,A
0063 A3                INC     DPTR
0064 E0                MOVX    A,@DPTR
0065 F9                MOV     R1,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FA                MOV     R2,A
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B FB                MOV     R3,A
006C C3                CLR     C
006D 120000      E     LCALL   ?C?SLCMP
0070 500F              JNC     ?C0189
                                           ; SOURCE LINE # 1136
0072 E4                CLR     A
0073 7F40              MOV     R7,#040H
0075 7E1F              MOV     R6,#01FH
0077 FD                MOV     R5,A
0078 FC                MOV     R4,A
0079 900000      R     MOV     DPTR,#pow_tension
007C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1137
007F 8037              SJMP    ?C0190
0081         ?C0189:
                                           ; SOURCE LINE # 1138
                                           ; SOURCE LINE # 1139
0081 E4                CLR     A
0082 7FC8              MOV     R7,#0C8H
0084 7E32              MOV     R6,#032H
0086 FD                MOV     R5,A
0087 FC                MOV     R4,A
0088 900000      E     MOV     DPTR,#dev_tension
008B E0                MOVX    A,@DPTR
008C F8                MOV     R0,A
008D A3                INC     DPTR
008E E0                MOVX    A,@DPTR
008F F9                MOV     R1,A
0090 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 114 

0091 E0                MOVX    A,@DPTR
0092 FA                MOV     R2,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FB                MOV     R3,A
0096 C3                CLR     C
0097 120000      E     LCALL   ?C?SLCMP
009A 500F              JNC     ?C0191
                                           ; SOURCE LINE # 1140
009C E4                CLR     A
009D 7FE0              MOV     R7,#0E0H
009F 7E2E              MOV     R6,#02EH
00A1 FD                MOV     R5,A
00A2 FC                MOV     R4,A
00A3 900000      R     MOV     DPTR,#pow_tension
00A6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1141
00A9 800D              SJMP    ?C0190
00AB         ?C0191:
                                           ; SOURCE LINE # 1143
00AB E4                CLR     A
00AC 7FC0              MOV     R7,#0C0H
00AE 7E5D              MOV     R6,#05DH
00B0 FD                MOV     R5,A
00B1 FC                MOV     R4,A
00B2 900000      R     MOV     DPTR,#pow_tension
00B5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1144
00B8         ?C0190:
                                           ; SOURCE LINE # 1146
00B8 E4                CLR     A
00B9 900000      R     MOV     DPTR,#first_tension_valid
00BC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1147
                                           ; SOURCE LINE # 1148
00BD         ?C0187:
                                           ; SOURCE LINE # 1152
00BD E4                CLR     A
00BE 7F58              MOV     R7,#058H
00C0 7E1B              MOV     R6,#01BH
00C2 FD                MOV     R5,A
00C3 FC                MOV     R4,A
00C4 900000      E     MOV     DPTR,#dev_tension
00C7 E0                MOVX    A,@DPTR
00C8 F8                MOV     R0,A
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB F9                MOV     R1,A
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE FA                MOV     R2,A
00CF A3                INC     DPTR
00D0 E0                MOVX    A,@DPTR
00D1 FB                MOV     R3,A
00D2 D3                SETB    C
00D3 120000      E     LCALL   ?C?SLCMP
00D6 5003              JNC     $ + 5H
00D8 020000      R     LJMP    ?C0193
                                           ; SOURCE LINE # 1155
00DB E4                CLR     A
00DC 7FE8              MOV     R7,#0E8H
00DE 7E03              MOV     R6,#03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 115 

00E0 FD                MOV     R5,A
00E1 FC                MOV     R4,A
00E2 900000      R     MOV     DPTR,#count2
00E5 E0                MOVX    A,@DPTR
00E6 F8                MOV     R0,A
00E7 A3                INC     DPTR
00E8 E0                MOVX    A,@DPTR
00E9 F9                MOV     R1,A
00EA A3                INC     DPTR
00EB E0                MOVX    A,@DPTR
00EC FA                MOV     R2,A
00ED A3                INC     DPTR
00EE E0                MOVX    A,@DPTR
00EF FB                MOV     R3,A
00F0 120000      E     LCALL   ?C?ULCMP
00F3 7004              JNZ     ?C0194
                                           ; SOURCE LINE # 1156
00F5 D200        E     SETB    tension_valid
                                           ; SOURCE LINE # 1157
00F7 8036              SJMP    ?C0195
00F9         ?C0194:
                                           ; SOURCE LINE # 1158
                                           ; SOURCE LINE # 1159
00F9 900000      R     MOV     DPTR,#count2
00FC E0                MOVX    A,@DPTR
00FD FC                MOV     R4,A
00FE A3                INC     DPTR
00FF E0                MOVX    A,@DPTR
0100 FD                MOV     R5,A
0101 A3                INC     DPTR
0102 E0                MOVX    A,@DPTR
0103 FE                MOV     R6,A
0104 A3                INC     DPTR
0105 E0                MOVX    A,@DPTR
0106 2401              ADD     A,#01H
0108 FF                MOV     R7,A
0109 E4                CLR     A
010A 3E                ADDC    A,R6
010B FE                MOV     R6,A
010C E4                CLR     A
010D 3D                ADDC    A,R5
010E FD                MOV     R5,A
010F E4                CLR     A
0110 3C                ADDC    A,R4
0111 FC                MOV     R4,A
0112 900000      R     MOV     DPTR,#count2
0115 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1160
0118 900000      E     MOV     DPTR,#dev_tension
011B E0                MOVX    A,@DPTR
011C FC                MOV     R4,A
011D A3                INC     DPTR
011E E0                MOVX    A,@DPTR
011F FD                MOV     R5,A
0120 A3                INC     DPTR
0121 E0                MOVX    A,@DPTR
0122 FE                MOV     R6,A
0123 A3                INC     DPTR
0124 E0                MOVX    A,@DPTR
0125 FF                MOV     R7,A
0126 120000      E     LCALL   _filter_voltage
0129 900000      E     MOV     DPTR,#dev_tension_f
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 116 

012C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1161
012F         ?C0195:
                                           ; SOURCE LINE # 1163
012F 900000      E     MOV     DPTR,#g_mem+07BH
0132 E0                MOVX    A,@DPTR
0133 6003              JZ      ?C0196
                                           ; SOURCE LINE # 1164
0135 120000      R     LCALL   pwm_limit_search
0138         ?C0196:
                                           ; SOURCE LINE # 1167
0138 900000      E     MOV     DPTR,#ADC_buf+03H
013B E0                MOVX    A,@DPTR
013C 249A              ADD     A,#09AH
013E FF                MOV     R7,A
013F 900000      E     MOV     DPTR,#ADC_buf+02H
0142 E0                MOVX    A,@DPTR
0143 34F9              ADDC    A,#0F9H
0145 FE                MOV     R6,A
0146 33                RLC     A
0147 95E0              SUBB    A,ACC
0149 FD                MOV     R5,A
014A FC                MOV     R4,A
014B E4                CLR     A
014C 7BAB              MOV     R3,#0ABH
014E 7A64              MOV     R2,#064H
0150 F9                MOV     R1,A
0151 F8                MOV     R0,A
0152 120000      E     LCALL   ?C?LMUL
0155 780D              MOV     R0,#0DH
0157 120000      E     LCALL   ?C?SLSHR
015A 900000      E     MOV     DPTR,#pwm_sign
015D E0                MOVX    A,@DPTR
015E FD                MOV     R5,A
015F 33                RLC     A
0160 95E0              SUBB    A,ACC
0162 FC                MOV     R4,A
0163 120000      E     LCALL   ?C?IMUL
0166 EE                MOV     A,R6
0167 33                RLC     A
0168 95E0              SUBB    A,ACC
016A FD                MOV     R5,A
016B FC                MOV     R4,A
016C 120000      E     LCALL   _filter_i1
016F 900000      E     MOV     DPTR,#g_meas+0CH
0172 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1170
0175 900000      E     MOV     DPTR,#g_meas
0178 E0                MOVX    A,@DPTR
0179 FC                MOV     R4,A
017A A3                INC     DPTR
017B E0                MOVX    A,@DPTR
017C FD                MOV     R5,A
017D A3                INC     DPTR
017E E0                MOVX    A,@DPTR
017F FE                MOV     R6,A
0180 A3                INC     DPTR
0181 E0                MOVX    A,@DPTR
0182 FF                MOV     R7,A
0183 900000      E     MOV     DPTR,#g_mem+035H
0186 E0                MOVX    A,@DPTR
0187 F9                MOV     R1,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 117 

0188 F8                MOV     R0,A
0189 120000      E     LCALL   ?C?SLSHR
018C C004              PUSH    AR4
018E C005              PUSH    AR5
0190 C006              PUSH    AR6
0192 C007              PUSH    AR7
0194 900000      E     MOV     DPTR,#g_meas+01FH
0197 E0                MOVX    A,@DPTR
0198 FC                MOV     R4,A
0199 A3                INC     DPTR
019A E0                MOVX    A,@DPTR
019B FD                MOV     R5,A
019C A3                INC     DPTR
019D E0                MOVX    A,@DPTR
019E FE                MOV     R6,A
019F A3                INC     DPTR
01A0 E0                MOVX    A,@DPTR
01A1 FF                MOV     R7,A
01A2 900000      E     MOV     DPTR,#g_mem+035H
01A5 E0                MOVX    A,@DPTR
01A6 F8                MOV     R0,A
01A7 120000      E     LCALL   ?C?SLSHR
01AA 900000      E     MOV     DPTR,#?_curr_estim?BYTE+04H
01AD 120000      E     LCALL   ?C?LSTXDATA
01B0 900000      E     MOV     DPTR,#g_ref
01B3 E0                MOVX    A,@DPTR
01B4 FC                MOV     R4,A
01B5 A3                INC     DPTR
01B6 E0                MOVX    A,@DPTR
01B7 FD                MOV     R5,A
01B8 A3                INC     DPTR
01B9 E0                MOVX    A,@DPTR
01BA FE                MOV     R6,A
01BB A3                INC     DPTR
01BC E0                MOVX    A,@DPTR
01BD FF                MOV     R7,A
01BE A801              MOV     R0,AR1
01C0 120000      E     LCALL   ?C?SLSHR
01C3 900000      E     MOV     DPTR,#?_curr_estim?BYTE+08H
01C6 120000      E     LCALL   ?C?LSTXDATA
01C9 D007              POP     AR7
01CB D006              POP     AR6
01CD D005              POP     AR5
01CF D004              POP     AR4
01D1 120000      E     LCALL   _curr_estim
01D4 A804              MOV     R0,AR4
01D6 A905              MOV     R1,AR5
01D8 AA06              MOV     R2,AR6
01DA AB07              MOV     R3,AR7
01DC 900000      E     MOV     DPTR,#g_meas+0CH
01DF E0                MOVX    A,@DPTR
01E0 FC                MOV     R4,A
01E1 A3                INC     DPTR
01E2 E0                MOVX    A,@DPTR
01E3 FD                MOV     R5,A
01E4 A3                INC     DPTR
01E5 E0                MOVX    A,@DPTR
01E6 FE                MOV     R6,A
01E7 A3                INC     DPTR
01E8 E0                MOVX    A,@DPTR
01E9 C3                CLR     C
01EA 9B                SUBB    A,R3
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 118 

01EB FF                MOV     R7,A
01EC EE                MOV     A,R6
01ED 9A                SUBB    A,R2
01EE FE                MOV     R6,A
01EF ED                MOV     A,R5
01F0 99                SUBB    A,R1
01F1 FD                MOV     R5,A
01F2 EC                MOV     A,R4
01F3 98                SUBB    A,R0
01F4 FC                MOV     R4,A
01F5 120000      E     LCALL   _filter_curr_diff
01F8 EE                MOV     A,R6
01F9 33                RLC     A
01FA 95E0              SUBB    A,ACC
01FC FD                MOV     R5,A
01FD FC                MOV     R4,A
01FE 900000      E     MOV     DPTR,#g_meas+010H
0201 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1174
0204 300005            JNB     interrupt_flag,?C0197
                                           ; SOURCE LINE # 1175
0207 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1176
0209 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1177
020C         ?C0197:
                                           ; SOURCE LINE # 1180
020C 900000      E     MOV     DPTR,#g_mem+06FH
020F E0                MOVX    A,@DPTR
0210 7004              JNZ     ?C0198
                                           ; SOURCE LINE # 1181
0212 F500        R     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1182
0214 F500        R     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1183
0216         ?C0198:
                                           ; SOURCE LINE # 1188
0216 E500        R     MOV     A,emg_1_status
0218 14                DEC     A
0219 7003              JNZ     $ + 5H
021B 020000      R     LJMP    ?C0206
021E 14                DEC     A
021F 7003              JNZ     $ + 5H
0221 020000      R     LJMP    ?C0207
0224 14                DEC     A
0225 7003              JNZ     $ + 5H
0227 020000      R     LJMP    ?C0210
022A 2403              ADD     A,#03H
022C 6003              JZ      $ + 5H
022E 020000      R     LJMP    ?C0199
                                           ; SOURCE LINE # 1189
0231         ?C0200:
                                           ; SOURCE LINE # 1190
0231 900000      E     MOV     DPTR,#ADC_buf+04H
0234 E0                MOVX    A,@DPTR
0235 FE                MOV     R6,A
0236 A3                INC     DPTR
0237 E0                MOVX    A,@DPTR
0238 FF                MOV     R7,A
0239 EE                MOV     A,R6
023A 33                RLC     A
023B 95E0              SUBB    A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 119 

023D 8F00        R     MOV     i_aux+03H,R7
023F 8E00        R     MOV     i_aux+02H,R6
0241 F500        R     MOV     i_aux+01H,A
0243 F500        R     MOV     i_aux,A
                                           ; SOURCE LINE # 1191
0245 AF00        R     MOV     R7,i_aux+03H
0247 AE00        R     MOV     R6,i_aux+02H
0249 FD                MOV     R5,A
024A AC00        R     MOV     R4,i_aux
024C 120000      E     LCALL   _filter_ch1
024F 8F00        R     MOV     i_aux+03H,R7
0251 8E00        R     MOV     i_aux+02H,R6
0253 8D00        R     MOV     i_aux+01H,R5
0255 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1192
0257 780A              MOV     R0,#0AH
0259 120000      E     LCALL   ?C?LSHL
025C 900000      E     MOV     DPTR,#g_mem+070H
025F E0                MOVX    A,@DPTR
0260 F8                MOV     R0,A
0261 A3                INC     DPTR
0262 E0                MOVX    A,@DPTR
0263 F9                MOV     R1,A
0264 A3                INC     DPTR
0265 E0                MOVX    A,@DPTR
0266 FA                MOV     R2,A
0267 A3                INC     DPTR
0268 E0                MOVX    A,@DPTR
0269 FB                MOV     R3,A
026A 120000      E     LCALL   ?C?ULDIV
026D 8F00        R     MOV     i_aux+03H,R7
026F 8E00        R     MOV     i_aux+02H,R6
0271 8D00        R     MOV     i_aux+01H,R5
0273 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1194
0275 300005            JNB     interrupt_flag,?C0201
                                           ; SOURCE LINE # 1195
0278 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1196
027A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1197
027D         ?C0201:
                                           ; SOURCE LINE # 1199
027D E4                CLR     A
027E FF                MOV     R7,A
027F FE                MOV     R6,A
0280 FD                MOV     R5,A
0281 FC                MOV     R4,A
0282 AB00        R     MOV     R3,i_aux+03H
0284 AA00        R     MOV     R2,i_aux+02H
0286 A900        R     MOV     R1,i_aux+01H
0288 A800        R     MOV     R0,i_aux
028A C3                CLR     C
028B 120000      E     LCALL   ?C?SLCMP
028E 500B              JNC     ?C0202
                                           ; SOURCE LINE # 1200
0290 E4                CLR     A
0291 F500        R     MOV     i_aux+03H,A
0293 F500        R     MOV     i_aux+02H,A
0295 F500        R     MOV     i_aux+01H,A
0297 F500        R     MOV     i_aux,A
0299 801E              SJMP    ?C0203
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 120 

029B         ?C0202:
                                           ; SOURCE LINE # 1202
029B E4                CLR     A
029C FF                MOV     R7,A
029D 7E04              MOV     R6,#04H
029F FD                MOV     R5,A
02A0 FC                MOV     R4,A
02A1 AB00        R     MOV     R3,i_aux+03H
02A3 AA00        R     MOV     R2,i_aux+02H
02A5 A900        R     MOV     R1,i_aux+01H
02A7 A800        R     MOV     R0,i_aux
02A9 D3                SETB    C
02AA 120000      E     LCALL   ?C?SLCMP
02AD 400A              JC      ?C0203
                                           ; SOURCE LINE # 1203
02AF E4                CLR     A
02B0 F500        R     MOV     i_aux+03H,A
02B2 750004      R     MOV     i_aux+02H,#04H
02B5 F500        R     MOV     i_aux+01H,A
02B7 F500        R     MOV     i_aux,A
02B9         ?C0203:
                                           ; SOURCE LINE # 1205
02B9 AF00        R     MOV     R7,i_aux+03H
02BB AE00        R     MOV     R6,i_aux+02H
02BD AD00        R     MOV     R5,i_aux+01H
02BF AC00        R     MOV     R4,i_aux
02C1 900000      E     MOV     DPTR,#g_meas+017H
02C4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1207
02C7 200003      E     JB      interrupt_flag,$ + 6H
02CA 020000      R     LJMP    ?C0199
                                           ; SOURCE LINE # 1208
02CD C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1209
02CF 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1210
                                           ; SOURCE LINE # 1212
02D2 020000      R     LJMP    ?C0199
                                           ; SOURCE LINE # 1214
02D5         ?C0206:
                                           ; SOURCE LINE # 1215
02D5 E4                CLR     A
02D6 900000      R     MOV     DPTR,#emg_counter_1
02D9 F0                MOVX    @DPTR,A
02DA A3                INC     DPTR
02DB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1216
02DC FF                MOV     R7,A
02DD FE                MOV     R6,A
02DE FD                MOV     R5,A
02DF FC                MOV     R4,A
02E0 900000      E     MOV     DPTR,#g_mem+070H
02E3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1217
02E6 750002      R     MOV     emg_1_status,#02H
                                           ; SOURCE LINE # 1219
02E9 020000      R     LJMP    ?C0199
                                           ; SOURCE LINE # 1221
02EC         ?C0207:
                                           ; SOURCE LINE # 1222
02EC 900000      R     MOV     DPTR,#emg_counter_1+01H
02EF E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 121 

02F0 04                INC     A
02F1 F0                MOVX    @DPTR,A
02F2 7006              JNZ     ?C0269
02F4 900000      R     MOV     DPTR,#emg_counter_1
02F7 E0                MOVX    A,@DPTR
02F8 04                INC     A
02F9 F0                MOVX    @DPTR,A
02FA         ?C0269:
                                           ; SOURCE LINE # 1223
02FA 900000      R     MOV     DPTR,#emg_counter_1
02FD E0                MOVX    A,@DPTR
02FE 6401              XRL     A,#01H
0300 7004              JNZ     ?C0270
0302 A3                INC     DPTR
0303 E0                MOVX    A,@DPTR
0304 64F4              XRL     A,#0F4H
0306         ?C0270:
0306 6003              JZ      $ + 5H
0308 020000      R     LJMP    ?C0199
                                           ; SOURCE LINE # 1224
030B 900000      R     MOV     DPTR,#emg_counter_1
030E F0                MOVX    @DPTR,A
030F A3                INC     DPTR
0310 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1226
0311 7F01              MOV     R7,#01H
0313 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1227
0316 E4                CLR     A
0317 FF                MOV     R7,A
0318 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1229
031B 300005            JNB     interrupt_flag,?C0209
                                           ; SOURCE LINE # 1230
031E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1231
0320 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1232
0323         ?C0209:
                                           ; SOURCE LINE # 1234
0323 750003      R     MOV     emg_1_status,#03H
                                           ; SOURCE LINE # 1235
                                           ; SOURCE LINE # 1236
0326 020000      R     LJMP    ?C0199
                                           ; SOURCE LINE # 1238
0329         ?C0210:
                                           ; SOURCE LINE # 1240
0329 900000      R     MOV     DPTR,#emg_counter_1+01H
032C E0                MOVX    A,@DPTR
032D 04                INC     A
032E F0                MOVX    @DPTR,A
032F 7006              JNZ     ?C0271
0331 900000      R     MOV     DPTR,#emg_counter_1
0334 E0                MOVX    A,@DPTR
0335 04                INC     A
0336 F0                MOVX    @DPTR,A
0337         ?C0271:
                                           ; SOURCE LINE # 1241
0337 900000      E     MOV     DPTR,#g_mem+070H
033A E0                MOVX    A,@DPTR
033B F8                MOV     R0,A
033C A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 122 

033D E0                MOVX    A,@DPTR
033E F9                MOV     R1,A
033F A3                INC     DPTR
0340 E0                MOVX    A,@DPTR
0341 FA                MOV     R2,A
0342 A3                INC     DPTR
0343 E0                MOVX    A,@DPTR
0344 FB                MOV     R3,A
0345 C000              PUSH    AR0
0347 C001              PUSH    AR1
0349 C002              PUSH    AR2
034B C003              PUSH    AR3
034D 900000      E     MOV     DPTR,#ADC_buf+04H
0350 E0                MOVX    A,@DPTR
0351 FE                MOV     R6,A
0352 A3                INC     DPTR
0353 E0                MOVX    A,@DPTR
0354 FF                MOV     R7,A
0355 EE                MOV     A,R6
0356 33                RLC     A
0357 95E0              SUBB    A,ACC
0359 FD                MOV     R5,A
035A FC                MOV     R4,A
035B 120000      E     LCALL   _filter_ch1
035E D003              POP     AR3
0360 D002              POP     AR2
0362 D001              POP     AR1
0364 D000              POP     AR0
0366 EB                MOV     A,R3
0367 2F                ADD     A,R7
0368 FF                MOV     R7,A
0369 EA                MOV     A,R2
036A 3E                ADDC    A,R6
036B FE                MOV     R6,A
036C E9                MOV     A,R1
036D 3D                ADDC    A,R5
036E FD                MOV     R5,A
036F E8                MOV     A,R0
0370 3C                ADDC    A,R4
0371 FC                MOV     R4,A
0372 900000      E     MOV     DPTR,#g_mem+070H
0375 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1243
0378 300005            JNB     interrupt_flag,?C0211
                                           ; SOURCE LINE # 1244
037B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1245
037D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1246
0380         ?C0211:
                                           ; SOURCE LINE # 1248
0380 900000      R     MOV     DPTR,#emg_counter_1
0383 E0                MOVX    A,@DPTR
0384 6403              XRL     A,#03H
0386 7004              JNZ     ?C0272
0388 A3                INC     DPTR
0389 E0                MOVX    A,@DPTR
038A 64E8              XRL     A,#0E8H
038C         ?C0272:
038C 7039              JNZ     ?C0199
                                           ; SOURCE LINE # 1249
038E 900000      E     MOV     DPTR,#g_mem+070H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 123 

0391 E0                MOVX    A,@DPTR
0392 FC                MOV     R4,A
0393 A3                INC     DPTR
0394 E0                MOVX    A,@DPTR
0395 FD                MOV     R5,A
0396 A3                INC     DPTR
0397 E0                MOVX    A,@DPTR
0398 FE                MOV     R6,A
0399 A3                INC     DPTR
039A E0                MOVX    A,@DPTR
039B FF                MOV     R7,A
039C E4                CLR     A
039D 7BE8              MOV     R3,#0E8H
039F 7A03              MOV     R2,#03H
03A1 F9                MOV     R1,A
03A2 F8                MOV     R0,A
03A3 120000      E     LCALL   ?C?ULDIV
03A6 900000      E     MOV     DPTR,#g_mem+070H
03A9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1251
03AC 300005            JNB     interrupt_flag,?C0213
                                           ; SOURCE LINE # 1252
03AF C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1253
03B1 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1254
03B4         ?C0213:
                                           ; SOURCE LINE # 1256
03B4 E4                CLR     A
03B5 FF                MOV     R7,A
03B6 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1257
03B9 E4                CLR     A
03BA FF                MOV     R7,A
03BB 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1259
03BE E4                CLR     A
03BF 900000      R     MOV     DPTR,#emg_counter_1
03C2 F0                MOVX    @DPTR,A
03C3 A3                INC     DPTR
03C4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1261
03C5 F500        R     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1262
                                           ; SOURCE LINE # 1263
                                           ; SOURCE LINE # 1265
                                           ; SOURCE LINE # 1266
                                           ; SOURCE LINE # 1267
03C7         ?C0199:
                                           ; SOURCE LINE # 1269
03C7 300005            JNB     interrupt_flag,?C0215
                                           ; SOURCE LINE # 1270
03CA C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1271
03CC 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1272
03CF         ?C0215:
                                           ; SOURCE LINE # 1274
03CF E500        R     MOV     A,emg_2_status
03D1 14                DEC     A
03D2 7003              JNZ     $ + 5H
03D4 020000      R     LJMP    ?C0222
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 124 

03D7 14                DEC     A
03D8 7003              JNZ     $ + 5H
03DA 020000      R     LJMP    ?C0224
03DD 14                DEC     A
03DE 7003              JNZ     $ + 5H
03E0 020000      R     LJMP    ?C0227
03E3 14                DEC     A
03E4 7003              JNZ     $ + 5H
03E6 020000      R     LJMP    ?C0231
03E9 14                DEC     A
03EA 7003              JNZ     $ + 5H
03EC 020000      R     LJMP    ?C0233
03EF 2405              ADD     A,#05H
03F1 6003              JZ      $ + 5H
03F3 020000      R     LJMP    ?C0216
                                           ; SOURCE LINE # 1275
03F6         ?C0217:
                                           ; SOURCE LINE # 1276
03F6 900000      E     MOV     DPTR,#ADC_buf+06H
03F9 E0                MOVX    A,@DPTR
03FA FE                MOV     R6,A
03FB A3                INC     DPTR
03FC E0                MOVX    A,@DPTR
03FD FF                MOV     R7,A
03FE EE                MOV     A,R6
03FF 33                RLC     A
0400 95E0              SUBB    A,ACC
0402 8F00        R     MOV     i_aux+03H,R7
0404 8E00        R     MOV     i_aux+02H,R6
0406 F500        R     MOV     i_aux+01H,A
0408 F500        R     MOV     i_aux,A
                                           ; SOURCE LINE # 1277
040A AF00        R     MOV     R7,i_aux+03H
040C AE00        R     MOV     R6,i_aux+02H
040E FD                MOV     R5,A
040F AC00        R     MOV     R4,i_aux
0411 120000      E     LCALL   _filter_ch2
0414 8F00        R     MOV     i_aux+03H,R7
0416 8E00        R     MOV     i_aux+02H,R6
0418 8D00        R     MOV     i_aux+01H,R5
041A 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1278
041C 780A              MOV     R0,#0AH
041E 120000      E     LCALL   ?C?LSHL
0421 900000      E     MOV     DPTR,#g_mem+074H
0424 E0                MOVX    A,@DPTR
0425 F8                MOV     R0,A
0426 A3                INC     DPTR
0427 E0                MOVX    A,@DPTR
0428 F9                MOV     R1,A
0429 A3                INC     DPTR
042A E0                MOVX    A,@DPTR
042B FA                MOV     R2,A
042C A3                INC     DPTR
042D E0                MOVX    A,@DPTR
042E FB                MOV     R3,A
042F 120000      E     LCALL   ?C?ULDIV
0432 8F00        R     MOV     i_aux+03H,R7
0434 8E00        R     MOV     i_aux+02H,R6
0436 8D00        R     MOV     i_aux+01H,R5
0438 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1280
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 125 

043A 300005            JNB     interrupt_flag,?C0218
                                           ; SOURCE LINE # 1281
043D C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1282
043F 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1283
0442         ?C0218:
                                           ; SOURCE LINE # 1285
0442 E4                CLR     A
0443 FF                MOV     R7,A
0444 FE                MOV     R6,A
0445 FD                MOV     R5,A
0446 FC                MOV     R4,A
0447 AB00        R     MOV     R3,i_aux+03H
0449 AA00        R     MOV     R2,i_aux+02H
044B A900        R     MOV     R1,i_aux+01H
044D A800        R     MOV     R0,i_aux
044F C3                CLR     C
0450 120000      E     LCALL   ?C?SLCMP
0453 500B              JNC     ?C0219
                                           ; SOURCE LINE # 1286
0455 E4                CLR     A
0456 F500        R     MOV     i_aux+03H,A
0458 F500        R     MOV     i_aux+02H,A
045A F500        R     MOV     i_aux+01H,A
045C F500        R     MOV     i_aux,A
045E 801E              SJMP    ?C0220
0460         ?C0219:
                                           ; SOURCE LINE # 1288
0460 E4                CLR     A
0461 FF                MOV     R7,A
0462 7E04              MOV     R6,#04H
0464 FD                MOV     R5,A
0465 FC                MOV     R4,A
0466 AB00        R     MOV     R3,i_aux+03H
0468 AA00        R     MOV     R2,i_aux+02H
046A A900        R     MOV     R1,i_aux+01H
046C A800        R     MOV     R0,i_aux
046E D3                SETB    C
046F 120000      E     LCALL   ?C?SLCMP
0472 400A              JC      ?C0220
                                           ; SOURCE LINE # 1289
0474 E4                CLR     A
0475 F500        R     MOV     i_aux+03H,A
0477 750004      R     MOV     i_aux+02H,#04H
047A F500        R     MOV     i_aux+01H,A
047C F500        R     MOV     i_aux,A
047E         ?C0220:
                                           ; SOURCE LINE # 1291
047E AF00        R     MOV     R7,i_aux+03H
0480 AE00        R     MOV     R6,i_aux+02H
0482 AD00        R     MOV     R5,i_aux+01H
0484 AC00        R     MOV     R4,i_aux
0486 900000      E     MOV     DPTR,#g_meas+01BH
0489 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1293
048C 020000      R     LJMP    ?C0216
                                           ; SOURCE LINE # 1295
048F         ?C0222:
                                           ; SOURCE LINE # 1296
048F E4                CLR     A
0490 900000      R     MOV     DPTR,#emg_counter_2
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 126 

0493 F0                MOVX    @DPTR,A
0494 A3                INC     DPTR
0495 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1297
0496 FF                MOV     R7,A
0497 FE                MOV     R6,A
0498 FD                MOV     R5,A
0499 FC                MOV     R4,A
049A 900000      E     MOV     DPTR,#g_mem+074H
049D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1299
04A0 300005            JNB     interrupt_flag,?C0223
                                           ; SOURCE LINE # 1300
04A3 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1301
04A5 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1302
04A8         ?C0223:
                                           ; SOURCE LINE # 1304
04A8 750004      R     MOV     emg_2_status,#04H
                                           ; SOURCE LINE # 1305
04AB 020000      R     LJMP    ?C0216
                                           ; SOURCE LINE # 1307
04AE         ?C0224:
                                           ; SOURCE LINE # 1308
04AE 900000      R     MOV     DPTR,#emg_counter_2+01H
04B1 E0                MOVX    A,@DPTR
04B2 04                INC     A
04B3 F0                MOVX    @DPTR,A
04B4 7006              JNZ     ?C0273
04B6 900000      R     MOV     DPTR,#emg_counter_2
04B9 E0                MOVX    A,@DPTR
04BA 04                INC     A
04BB F0                MOVX    @DPTR,A
04BC         ?C0273:
                                           ; SOURCE LINE # 1309
04BC 900000      R     MOV     DPTR,#emg_counter_2
04BF E0                MOVX    A,@DPTR
04C0 6401              XRL     A,#01H
04C2 7004              JNZ     ?C0274
04C4 A3                INC     DPTR
04C5 E0                MOVX    A,@DPTR
04C6 64F4              XRL     A,#0F4H
04C8         ?C0274:
04C8 6003              JZ      $ + 5H
04CA 020000      R     LJMP    ?C0216
                                           ; SOURCE LINE # 1310
04CD 900000      R     MOV     DPTR,#emg_counter_2
04D0 F0                MOVX    @DPTR,A
04D1 A3                INC     DPTR
04D2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1312
04D3 7F01              MOV     R7,#01H
04D5 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1313
04D8 E4                CLR     A
04D9 FF                MOV     R7,A
04DA 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1315
04DD 300005            JNB     interrupt_flag,?C0226
                                           ; SOURCE LINE # 1316
04E0 C200        E     CLR     interrupt_flag
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 127 

                                           ; SOURCE LINE # 1317
04E2 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1318
04E5         ?C0226:
                                           ; SOURCE LINE # 1320
04E5 750003      R     MOV     emg_2_status,#03H
                                           ; SOURCE LINE # 1321
                                           ; SOURCE LINE # 1322
04E8 020000      R     LJMP    ?C0216
                                           ; SOURCE LINE # 1324
04EB         ?C0227:
                                           ; SOURCE LINE # 1326
04EB 900000      R     MOV     DPTR,#emg_counter_2+01H
04EE E0                MOVX    A,@DPTR
04EF 04                INC     A
04F0 F0                MOVX    @DPTR,A
04F1 7006              JNZ     ?C0275
04F3 900000      R     MOV     DPTR,#emg_counter_2
04F6 E0                MOVX    A,@DPTR
04F7 04                INC     A
04F8 F0                MOVX    @DPTR,A
04F9         ?C0275:
                                           ; SOURCE LINE # 1327
04F9 900000      E     MOV     DPTR,#g_mem+074H
04FC E0                MOVX    A,@DPTR
04FD F8                MOV     R0,A
04FE A3                INC     DPTR
04FF E0                MOVX    A,@DPTR
0500 F9                MOV     R1,A
0501 A3                INC     DPTR
0502 E0                MOVX    A,@DPTR
0503 FA                MOV     R2,A
0504 A3                INC     DPTR
0505 E0                MOVX    A,@DPTR
0506 FB                MOV     R3,A
0507 C000              PUSH    AR0
0509 C001              PUSH    AR1
050B C002              PUSH    AR2
050D C003              PUSH    AR3
050F 900000      E     MOV     DPTR,#ADC_buf+06H
0512 E0                MOVX    A,@DPTR
0513 FE                MOV     R6,A
0514 A3                INC     DPTR
0515 E0                MOVX    A,@DPTR
0516 FF                MOV     R7,A
0517 EE                MOV     A,R6
0518 33                RLC     A
0519 95E0              SUBB    A,ACC
051B FD                MOV     R5,A
051C FC                MOV     R4,A
051D 120000      E     LCALL   _filter_ch2
0520 D003              POP     AR3
0522 D002              POP     AR2
0524 D001              POP     AR1
0526 D000              POP     AR0
0528 EB                MOV     A,R3
0529 2F                ADD     A,R7
052A FF                MOV     R7,A
052B EA                MOV     A,R2
052C 3E                ADDC    A,R6
052D FE                MOV     R6,A
052E E9                MOV     A,R1
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 128 

052F 3D                ADDC    A,R5
0530 FD                MOV     R5,A
0531 E8                MOV     A,R0
0532 3C                ADDC    A,R4
0533 FC                MOV     R4,A
0534 900000      E     MOV     DPTR,#g_mem+074H
0537 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1329
053A 300005            JNB     interrupt_flag,?C0228
                                           ; SOURCE LINE # 1330
053D C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1331
053F 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1332
0542         ?C0228:
                                           ; SOURCE LINE # 1334
0542 900000      R     MOV     DPTR,#emg_counter_2
0545 E0                MOVX    A,@DPTR
0546 6403              XRL     A,#03H
0548 7004              JNZ     ?C0276
054A A3                INC     DPTR
054B E0                MOVX    A,@DPTR
054C 64E8              XRL     A,#0E8H
054E         ?C0276:
054E 6003              JZ      $ + 5H
0550 020000      R     LJMP    ?C0216
                                           ; SOURCE LINE # 1335
0553 900000      E     MOV     DPTR,#g_mem+074H
0556 E0                MOVX    A,@DPTR
0557 FC                MOV     R4,A
0558 A3                INC     DPTR
0559 E0                MOVX    A,@DPTR
055A FD                MOV     R5,A
055B A3                INC     DPTR
055C E0                MOVX    A,@DPTR
055D FE                MOV     R6,A
055E A3                INC     DPTR
055F E0                MOVX    A,@DPTR
0560 FF                MOV     R7,A
0561 E4                CLR     A
0562 7BE8              MOV     R3,#0E8H
0564 7A03              MOV     R2,#03H
0566 F9                MOV     R1,A
0567 F8                MOV     R0,A
0568 120000      E     LCALL   ?C?ULDIV
056B 900000      E     MOV     DPTR,#g_mem+074H
056E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1337
0571 E4                CLR     A
0572 FF                MOV     R7,A
0573 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1338
0576 E4                CLR     A
0577 FF                MOV     R7,A
0578 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1340
057B E4                CLR     A
057C 900000      R     MOV     DPTR,#emg_counter_2
057F F0                MOVX    @DPTR,A
0580 A3                INC     DPTR
0581 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1342
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 129 

0582 300005            JNB     interrupt_flag,?C0230
                                           ; SOURCE LINE # 1343
0585 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1344
0587 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1345
058A         ?C0230:
                                           ; SOURCE LINE # 1347
058A 750005      R     MOV     emg_2_status,#05H
                                           ; SOURCE LINE # 1348
                                           ; SOURCE LINE # 1349
058D 020000      R     LJMP    ?C0216
                                           ; SOURCE LINE # 1351
0590         ?C0231:
                                           ; SOURCE LINE # 1352
0590 E500        R     MOV     A,emg_1_status
0592 6003              JZ      $ + 5H
0594 020000      R     LJMP    ?C0216
                                           ; SOURCE LINE # 1353
0597 750002      R     MOV     emg_2_status,#02H
                                           ; SOURCE LINE # 1354
059A 807E              SJMP    ?C0216
                                           ; SOURCE LINE # 1356
059C         ?C0233:
                                           ; SOURCE LINE # 1357
059C 900000      R     MOV     DPTR,#emg_counter_2+01H
059F E0                MOVX    A,@DPTR
05A0 04                INC     A
05A1 F0                MOVX    @DPTR,A
05A2 7006              JNZ     ?C0277
05A4 900000      R     MOV     DPTR,#emg_counter_2
05A7 E0                MOVX    A,@DPTR
05A8 04                INC     A
05A9 F0                MOVX    @DPTR,A
05AA         ?C0277:
                                           ; SOURCE LINE # 1358
05AA 900000      R     MOV     DPTR,#emg_counter_2
05AD E0                MOVX    A,@DPTR
05AE 6401              XRL     A,#01H
05B0 7004              JNZ     ?C0278
05B2 A3                INC     DPTR
05B3 E0                MOVX    A,@DPTR
05B4 64F4              XRL     A,#0F4H
05B6         ?C0278:
05B6 7062              JNZ     ?C0216
                                           ; SOURCE LINE # 1359
05B8 900000      R     MOV     DPTR,#emg_counter_2
05BB F0                MOVX    @DPTR,A
05BC A3                INC     DPTR
05BD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1361
05BE 300005            JNB     interrupt_flag,?C0235
                                           ; SOURCE LINE # 1362
05C1 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1363
05C3 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1364
05C6         ?C0235:
                                           ; SOURCE LINE # 1367
05C6 900000      E     MOV     DPTR,#c_mem+033H
05C9 E0                MOVX    A,@DPTR
05CA FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 130 

05CB 6402              XRL     A,#02H
05CD 600E              JZ      ?C0237
05CF EF                MOV     A,R7
05D0 6403              XRL     A,#03H
05D2 6009              JZ      ?C0237
05D4 EF                MOV     A,R7
05D5 6404              XRL     A,#04H
05D7 6004              JZ      ?C0237
05D9 EF                MOV     A,R7
05DA B4053A            CJNE    A,#05H,?C0236
05DD         ?C0237:
                                           ; SOURCE LINE # 1370
                                           ; SOURCE LINE # 1371
05DD 900000      E     MOV     DPTR,#c_mem+034H
05E0 E0                MOVX    A,@DPTR
05E1 7028              JNZ     ?C0238
                                           ; SOURCE LINE # 1372
05E3 900000      E     MOV     DPTR,#g_meas
05E6 E0                MOVX    A,@DPTR
05E7 FC                MOV     R4,A
05E8 A3                INC     DPTR
05E9 E0                MOVX    A,@DPTR
05EA FD                MOV     R5,A
05EB A3                INC     DPTR
05EC E0                MOVX    A,@DPTR
05ED FE                MOV     R6,A
05EE A3                INC     DPTR
05EF E0                MOVX    A,@DPTR
05F0 FF                MOV     R7,A
05F1 900000      E     MOV     DPTR,#g_ref
05F4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1373
05F7 900000      E     MOV     DPTR,#g_meas+04H
05FA E0                MOVX    A,@DPTR
05FB FC                MOV     R4,A
05FC A3                INC     DPTR
05FD E0                MOVX    A,@DPTR
05FE FD                MOV     R5,A
05FF A3                INC     DPTR
0600 E0                MOVX    A,@DPTR
0601 FE                MOV     R6,A
0602 A3                INC     DPTR
0603 E0                MOVX    A,@DPTR
0604 FF                MOV     R7,A
0605 900000      E     MOV     DPTR,#g_ref+04H
0608 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1374
060B         ?C0238:
                                           ; SOURCE LINE # 1375
060B 900000      E     MOV     DPTR,#c_mem+032H
060E E0                MOVX    A,@DPTR
060F FF                MOV     R7,A
0610 900000      E     MOV     DPTR,#g_ref+018H
0613 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1376
0614 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1377
0617         ?C0236:
                                           ; SOURCE LINE # 1379
0617 E4                CLR     A
0618 F500        R     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1380
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 131 

                                           ; SOURCE LINE # 1381
                                           ; SOURCE LINE # 1383
                                           ; SOURCE LINE # 1384
                                           ; SOURCE LINE # 1385
061A         ?C0216:
                                           ; SOURCE LINE # 1387
061A 300068            JNB     interrupt_flag,?C0241
                                           ; SOURCE LINE # 1388
061D C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1389
061F 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1390
                                           ; SOURCE LINE # 1391
0622 8061              SJMP    ?C0241
0624         ?C0193:
                                           ; SOURCE LINE # 1392
                                           ; SOURCE LINE # 1394
0624 750001      R     MOV     emg_1_status,#01H
                                           ; SOURCE LINE # 1395
0627 750001      R     MOV     emg_2_status,#01H
                                           ; SOURCE LINE # 1397
062A C200        E     CLR     tension_valid
                                           ; SOURCE LINE # 1399
062C 7F01              MOV     R7,#01H
062E 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1401
0631 E4                CLR     A
0632 FF                MOV     R7,A
0633 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1403
0636 300005            JNB     interrupt_flag,?C0242
                                           ; SOURCE LINE # 1404
0639 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1405
063B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1406
063E         ?C0242:
                                           ; SOURCE LINE # 1408
063E 900000      E     MOV     DPTR,#c_mem+06FH
0641 E0                MOVX    A,@DPTR
0642 6020              JZ      ?C0243
                                           ; SOURCE LINE # 1409
0644 900000      E     MOV     DPTR,#c_mem+033H
0647 E0                MOVX    A,@DPTR
0648 FF                MOV     R7,A
0649 6402              XRL     A,#02H
064B 600E              JZ      ?C0245
064D EF                MOV     A,R7
064E 6403              XRL     A,#03H
0650 6009              JZ      ?C0245
0652 EF                MOV     A,R7
0653 6404              XRL     A,#04H
0655 6004              JZ      ?C0245
0657 EF                MOV     A,R7
0658 B40509            CJNE    A,#05H,?C0243
065B         ?C0245:
                                           ; SOURCE LINE # 1412
                                           ; SOURCE LINE # 1413
065B E4                CLR     A
065C 900000      E     MOV     DPTR,#g_ref+018H
065F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1414
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 132 

0660 FF                MOV     R7,A
0661 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1415
                                           ; SOURCE LINE # 1416
0664         ?C0243:
                                           ; SOURCE LINE # 1419
0664 E4                CLR     A
0665 FF                MOV     R7,A
0666 FE                MOV     R6,A
0667 FD                MOV     R5,A
0668 FC                MOV     R4,A
0669 900000      E     MOV     DPTR,#g_meas+0CH
066C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1422
066F E4                CLR     A
0670 FF                MOV     R7,A
0671 FE                MOV     R6,A
0672 FD                MOV     R5,A
0673 FC                MOV     R4,A
0674 900000      E     MOV     DPTR,#g_meas+017H
0677 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1423
067A E4                CLR     A
067B FF                MOV     R7,A
067C FE                MOV     R6,A
067D FD                MOV     R5,A
067E FC                MOV     R4,A
067F 900000      E     MOV     DPTR,#g_meas+01BH
0682 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1425
0685         ?C0241:
                                           ; SOURCE LINE # 1427
0685 900000      R     MOV     DPTR,#first_tension_valid
0688 E0                MOVX    A,@DPTR
0689 6003              JZ      $ + 5H
068B 020000      R     LJMP    ?C0246
068E 200003      E     JB      tension_valid,$ + 6H
0691 020000      R     LJMP    ?C0246
0694 E500        R     MOV     A,emg_1_status
0696 6003              JZ      $ + 5H
0698 020000      R     LJMP    ?C0246
069B E500        R     MOV     A,emg_2_status
069D 6003              JZ      $ + 5H
069F 020000      R     LJMP    ?C0246
                                           ; SOURCE LINE # 1428
06A2 900000      E     MOV     DPTR,#dev_tension
06A5 E0                MOVX    A,@DPTR
06A6 FC                MOV     R4,A
06A7 A3                INC     DPTR
06A8 E0                MOVX    A,@DPTR
06A9 FD                MOV     R5,A
06AA A3                INC     DPTR
06AB E0                MOVX    A,@DPTR
06AC FE                MOV     R6,A
06AD A3                INC     DPTR
06AE E0                MOVX    A,@DPTR
06AF FF                MOV     R7,A
06B0 120000      E     LCALL   _filter_voltage
06B3 900000      E     MOV     DPTR,#dev_tension_f
06B6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1429
06B9 900000      R     MOV     DPTR,#pow_tension
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 133 

06BC E0                MOVX    A,@DPTR
06BD FC                MOV     R4,A
06BE A3                INC     DPTR
06BF E0                MOVX    A,@DPTR
06C0 FD                MOV     R5,A
06C1 A3                INC     DPTR
06C2 E0                MOVX    A,@DPTR
06C3 FE                MOV     R6,A
06C4 A3                INC     DPTR
06C5 E0                MOVX    A,@DPTR
06C6 FF                MOV     R7,A
06C7 EC                MOV     A,R4
06C8 120000      E     LCALL   ?C?FCASTL
06CB 7B1F              MOV     R3,#01FH
06CD 7A85              MOV     R2,#085H
06CF 796B              MOV     R1,#06BH
06D1 783F              MOV     R0,#03FH
06D3 120000      E     LCALL   ?C?FPMUL
06D6 C004              PUSH    AR4
06D8 C005              PUSH    AR5
06DA C006              PUSH    AR6
06DC C007              PUSH    AR7
06DE 900000      E     MOV     DPTR,#dev_tension_f
06E1 E0                MOVX    A,@DPTR
06E2 FC                MOV     R4,A
06E3 A3                INC     DPTR
06E4 E0                MOVX    A,@DPTR
06E5 FD                MOV     R5,A
06E6 A3                INC     DPTR
06E7 E0                MOVX    A,@DPTR
06E8 FE                MOV     R6,A
06E9 A3                INC     DPTR
06EA E0                MOVX    A,@DPTR
06EB FF                MOV     R7,A
06EC EC                MOV     A,R4
06ED 120000      E     LCALL   ?C?FCASTL
06F0 A804              MOV     R0,AR4
06F2 A905              MOV     R1,AR5
06F4 AA06              MOV     R2,AR6
06F6 AB07              MOV     R3,AR7
06F8 D007              POP     AR7
06FA D006              POP     AR6
06FC D005              POP     AR5
06FE D004              POP     AR4
0700 120000      E     LCALL   ?C?FPCMP3
0703 600E              JZ      ?C0247
0705 400C              JC      ?C0247
                                           ; SOURCE LINE # 1431
0707 7F01              MOV     R7,#01H
0709 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1434
070C E4                CLR     A
070D FF                MOV     R7,A
070E 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1435
0711 8013              SJMP    ?C0246
0713         ?C0247:
                                           ; SOURCE LINE # 1436
                                           ; SOURCE LINE # 1438
0713 E4                CLR     A
0714 FF                MOV     R7,A
0715 120000      E     LCALL   _LED_CTRL_Write
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 134 

                                           ; SOURCE LINE # 1441
0718 7F01              MOV     R7,#01H
071A 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1444
071D E4                CLR     A
071E 900000      E     MOV     DPTR,#g_refNew+018H
0721 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1445
0722 FF                MOV     R7,A
0723 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1446
                                           ; SOURCE LINE # 1447
0726         ?C0246:
                                           ; SOURCE LINE # 1449
0726 300005            JNB     interrupt_flag,?C0250
                                           ; SOURCE LINE # 1450
0729 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1451
072B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1452
                                           ; SOURCE LINE # 1453
072E         ?C0250:
072E 22                RET     
             ; FUNCTION analog_read_end (END)

             ; FUNCTION overcurrent_control (BEGIN)
                                           ; SOURCE LINE # 1459
                                           ; SOURCE LINE # 1460
0000 900000      E     MOV     DPTR,#c_mem+069H
0003 E0                MOVX    A,@DPTR
0004 FE                MOV     R6,A
0005 A3                INC     DPTR
0006 E0                MOVX    A,@DPTR
0007 FF                MOV     R7,A
0008 4E                ORL     A,R6
0009 606B              JZ      ?C0258
                                           ; SOURCE LINE # 1462
000B EE                MOV     A,R6
000C 33                RLC     A
000D 95E0              SUBB    A,ACC
000F FD                MOV     R5,A
0010 FC                MOV     R4,A
0011 900000      E     MOV     DPTR,#g_meas+0CH
0014 E0                MOVX    A,@DPTR
0015 F8                MOV     R0,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 F9                MOV     R1,A
0019 A3                INC     DPTR
001A E0                MOVX    A,@DPTR
001B FA                MOV     R2,A
001C A3                INC     DPTR
001D E0                MOVX    A,@DPTR
001E FB                MOV     R3,A
001F D3                SETB    C
0020 120000      E     LCALL   ?C?SLCMP
0023 4008              JC      ?C0252
                                           ; SOURCE LINE # 1464
0025 900000      E     MOV     DPTR,#dev_pwm_limit
0028 E0                MOVX    A,@DPTR
0029 14                DEC     A
002A F0                MOVX    @DPTR,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 135 

                                           ; SOURCE LINE # 1466
002B 802D              SJMP    ?C0253
002D         ?C0252:
002D 900000      E     MOV     DPTR,#c_mem+06AH
0030 E0                MOVX    A,@DPTR
0031 24F6              ADD     A,#0F6H
0033 FF                MOV     R7,A
0034 900000      E     MOV     DPTR,#c_mem+069H
0037 E0                MOVX    A,@DPTR
0038 34FF              ADDC    A,#0FFH
003A FE                MOV     R6,A
003B 33                RLC     A
003C 95E0              SUBB    A,ACC
003E FD                MOV     R5,A
003F FC                MOV     R4,A
0040 900000      E     MOV     DPTR,#g_meas+0CH
0043 E0                MOVX    A,@DPTR
0044 F8                MOV     R0,A
0045 A3                INC     DPTR
0046 E0                MOVX    A,@DPTR
0047 F9                MOV     R1,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FA                MOV     R2,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D FB                MOV     R3,A
004E C3                CLR     C
004F 120000      E     LCALL   ?C?SLCMP
0052 5006              JNC     ?C0253
                                           ; SOURCE LINE # 1468
0054 900000      E     MOV     DPTR,#dev_pwm_limit
0057 E0                MOVX    A,@DPTR
0058 04                INC     A
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1469
005A         ?C0253:
                                           ; SOURCE LINE # 1472
005A 900000      E     MOV     DPTR,#dev_pwm_limit
005D E0                MOVX    A,@DPTR
005E FF                MOV     R7,A
005F C3                CLR     C
0060 9400              SUBB    A,#00H
0062 5003              JNC     ?C0255
                                           ; SOURCE LINE # 1473
0064 E4                CLR     A
0065 F0                MOVX    @DPTR,A
0066 22                RET     
0067         ?C0255:
                                           ; SOURCE LINE # 1475
0067 900000      E     MOV     DPTR,#dev_pwm_sat
006A E0                MOVX    A,@DPTR
006B FE                MOV     R6,A
006C EF                MOV     A,R7
006D D3                SETB    C
006E 9E                SUBB    A,R6
006F 4005              JC      ?C0258
                                           ; SOURCE LINE # 1476
0071 900000      E     MOV     DPTR,#dev_pwm_limit
0074 EE                MOV     A,R6
0075 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1477
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 136 

                                           ; SOURCE LINE # 1478
0076         ?C0258:
0076 22                RET     
             ; FUNCTION overcurrent_control (END)

             ; FUNCTION pwm_limit_search (BEGIN)
                                           ; SOURCE LINE # 1484
                                           ; SOURCE LINE # 1488
0000 E4                CLR     A
0001 7F9C              MOV     R7,#09CH
0003 7E63              MOV     R6,#063H
0005 FD                MOV     R5,A
0006 FC                MOV     R4,A
0007 900000      E     MOV     DPTR,#dev_tension
000A E0                MOVX    A,@DPTR
000B F8                MOV     R0,A
000C A3                INC     DPTR
000D E0                MOVX    A,@DPTR
000E F9                MOV     R1,A
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011 FA                MOV     R2,A
0012 A3                INC     DPTR
0013 E0                MOVX    A,@DPTR
0014 FB                MOV     R3,A
0015 D3                SETB    C
0016 120000      E     LCALL   ?C?SLCMP
0019 4006              JC      ?C0259
                                           ; SOURCE LINE # 1489
001B E4                CLR     A
001C 900000      E     MOV     DPTR,#dev_pwm_sat
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1490
0020 22                RET     
0021         ?C0259:
0021 E4                CLR     A
0022 7FEC              MOV     R7,#0ECH
0024 7E2C              MOV     R6,#02CH
0026 FD                MOV     R5,A
0027 FC                MOV     R4,A
0028 900000      E     MOV     DPTR,#dev_tension
002B E0                MOVX    A,@DPTR
002C F8                MOV     R0,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F F9                MOV     R1,A
0030 A3                INC     DPTR
0031 E0                MOVX    A,@DPTR
0032 FA                MOV     R2,A
0033 A3                INC     DPTR
0034 E0                MOVX    A,@DPTR
0035 FB                MOV     R3,A
0036 C3                CLR     C
0037 120000      E     LCALL   ?C?SLCMP
003A 5007              JNC     ?C0261
                                           ; SOURCE LINE # 1491
003C 900000      E     MOV     DPTR,#dev_pwm_sat
003F 7464              MOV     A,#064H
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1492
0042 22                RET     
0043         ?C0261:
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/13/2017 11:30:51 PAGE 137 

                                           ; SOURCE LINE # 1493
0043 900000      E     MOV     DPTR,#dev_tension
0046 E0                MOVX    A,@DPTR
0047 FC                MOV     R4,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FD                MOV     R5,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D FE                MOV     R6,A
004E A3                INC     DPTR
004F E0                MOVX    A,@DPTR
0050 2414              ADD     A,#014H
0052 FF                MOV     R7,A
0053 EE                MOV     A,R6
0054 34D3              ADDC    A,#0D3H
0056 FE                MOV     R6,A
0057 ED                MOV     A,R5
0058 34FF              ADDC    A,#0FFH
005A FD                MOV     R5,A
005B EC                MOV     A,R4
005C 34FF              ADDC    A,#0FFH
005E FC                MOV     R4,A
005F 7809              MOV     R0,#09H
0061 120000      E     LCALL   ?C?SLSHR
0064 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 1494
0066 7400        R     MOV     A,#LOW pwm_preload_values
0068 2F                ADD     A,R7
0069 F582              MOV     DPL,A
006B E4                CLR     A
006C 3400        R     ADDC    A,#HIGH pwm_preload_values
006E F583              MOV     DPH,A
0070 E0                MOVX    A,@DPTR
0071 900000      E     MOV     DPTR,#dev_pwm_sat
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1495
                                           ; SOURCE LINE # 1496
0075         ?C0263:
0075 22                RET     
             ; FUNCTION pwm_limit_search (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   9351    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    242      20
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8      84
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE INTERRUPTIONS
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Release\interruptions.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.3\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\interruptions.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(NDEBUG) WL(2) PR(.\DP80
                    -51_Keil_951\Release/interruptions.lst) CD OT(8,SPEED) OJ(.\DP8051_Keil_951\Release\interruptions.obj)

line level    source

*** MESSAGE C286 IN LINE 0 OF (null): license limits optimization to level 5
   1          // ----------------------------------------------------------------------------
   2          // BSD 3-Clause License
   3          
   4          // Copyright (c) 2016, qbrobotics
   5          // Copyright (c) 2017, Centro "E.Piaggio"
   6          // All rights reserved.
   7          
   8          // Redistribution and use in source and binary forms, with or without
   9          // modification, are permitted provided that the following conditions are met:
  10          
  11          // * Redistributions of source code must retain the above copyright notice, this
  12          //   list of conditions and the following disclaimer.
  13          
  14          // * Redistributions in binary form must reproduce the above copyright notice,
  15          //   this list of conditions and the following disclaimer in the documentation
  16          //   and/or other materials provided with the distribution.
  17          
  18          // * Neither the name of the copyright holder nor the names of its
  19          //   contributors may be used to endorse or promote products derived from
  20          //   this software without specific prior written permission.
  21          
  22          // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  23          // AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  24          // IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  25          // DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
  26          // FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  27          // DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
  28          // SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
  29          // CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  30          // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  31          // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  32          // POSSIBILITY OF SUCH DAMAGE.
  33          // ----------------------------------------------------------------------------
  34          
  35          /**
  36          * \file         interruptions.c
  37          *
  38          * \brief        Interruption handling and firmware core functions
  39          * \date         June 06, 2016
  40          * \author       _qbrobotics_
  41          * \copyright    (C) 2012-2016 qbrobotics. All rights reserved.
  42          * \copyright    (C) 2017 Centro "E.Piaggio". All rights reserved.
  43          */
  44          
  45          
  46          //=================================================================     includes
  47          #include <interruptions.h>
  48          #include <command_processing.h>
  49          #include <globals.h>
  50          #include <utils.h>
  51          
  52          
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 2   

  53          //==============================================================================
  54          //                                                            RS485 RX INTERRUPT
  55          //==============================================================================
  56          // Processing RS-485 data frame:
  57          //
  58          // - 0:     Waits for beggining characters
  59          // - 1:     Waits for ID;
  60          // - 2:     Data length;
  61          // - 3:     Receive all bytes;
  62          // - 4:     Wait for another device end of transmission;
  63          //
  64          //==============================================================================
  65          
  66          // PWM values needed to obtain 11.5 V given a certain input tension
  67          // Numbers are sperimentally calculated //[index] (millivolts)
  68          static const uint8 pwm_preload_values[29] = {100,    //0 (11500)
  69                                                        83,
  70                                                        78,
  71                                                        76,
  72                                                        74,
  73                                                        72,    //5 (14000)
  74                                                        70,
  75                                                        68,
  76                                                        67,
  77                                                        65,
  78                                                        64,    //10 (16500)
  79                                                        63,
  80                                                        62,
  81                                                        61,
  82                                                        60,
  83                                                        59,    //15 (19000)
  84                                                        58,
  85                                                        57,
  86                                                        56,
  87                                                        56,
  88                                                        55,    //20 (21500)
  89                                                        54,
  90                                                        54,
  91                                                        53,
  92                                                        52,
  93                                                        52,    //25 (24000)
  94                                                        52,
  95                                                        51,
  96                                                        51};   //28 (25500)
  97          
  98          //==============================================================================
  99          //                                                            WATCHDOG INTERRUPT
 100          //==============================================================================
 101          
 102          CY_ISR(ISR_WATCHDOG_Handler){
 103   1      
 104   1          // Set WDT flag
 105   1          
 106   1          watchdog_flag = TRUE;
 107   1      
 108   1      }
 109          
 110          //==============================================================================
 111          //                                                            RS485 RX INTERRUPT
 112          //==============================================================================
 113          
 114          CY_ISR(ISR_RS485_RX_ExInterrupt) {
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 3   

 115   1      
 116   1          // Set RS485 flag
 117   1          
 118   1          interrupt_flag = TRUE;
 119   1           
 120   1      }
 121          
 122          //==============================================================================
 123          //                                                             INTERRUPT MANAGER
 124          //==============================================================================
 125          // Manage interrupt from RS485 
 126          //==============================================================================
 127          // Processing RS-485 data frame:
 128          //
 129          // - WAIT_START:    Waits for beginning characters;
 130          // - WAIT_ID:       Waits for ID;
 131          // - WAIT_LENGTH:   Data length;
 132          // - RECEIVE:       Receive all bytes;
 133          // - UNLOAD:        Wait for another device end of transmission;
 134          //
 135          //==============================================================================
 136          
 137          void interrupt_manager(){
 138   1      
 139   1          
 140   1          //===========================================     local variables definition
 141   1      
 142   1          static uint8 CYDATA state = WAIT_START;                      // state
 143   1          
 144   1          //------------------------------------------------- local data packet
 145   1          static uint8 CYDATA data_packet_index;
 146   1          static uint8 CYDATA data_packet_length;
 147   1          static uint8 data_packet_buffer[128];                     
 148   1          static uint8 CYDATA rx_queue[3];                    // last 2 bytes received
 149   1          //-------------------------------------------------
 150   1      
 151   1          uint8 CYDATA    rx_data;                            // RS485 UART rx data
 152   1          CYBIT           rx_data_type;                       // my id?
 153   1          uint8 CYDATA    package_count = 0;                     
 154   1      
 155   1          //======================================================     receive routine
 156   1          
 157   1          // Get data until buffer is not empty 
 158   1          
 159   1          while(UART_RS485_GetRxBufferSize() && (package_count < 6)){  
 160   2              // 6 stima di numero massimo di pacchetti che riesco a leggere senza bloccare l'esecuzione del fir
             -mware
 161   2              
 162   2              // Get next char
 163   2              rx_data = UART_RS485_GetChar();
 164   2              
 165   2              switch (state) {
 166   3                  //-----     wait for frame start     -------------------------------
 167   3                  case WAIT_START:
 168   3                  
 169   3                      rx_queue[0] = rx_queue[1];
 170   3                      rx_queue[1] = rx_queue[2];
 171   3                      rx_queue[2] = rx_data;
 172   3                      
 173   3                      // Check for header configuration package
 174   3                      if ((rx_queue[1] == 58) && (rx_queue[2] == 58)) {
 175   4                          rx_queue[0] = 0;
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 4   

 176   4                          rx_queue[1] = 0;
 177   4                          rx_queue[2] = 0;
 178   4                          state       = WAIT_ID;                    
 179   4                      }else
 180   3                          if ((rx_queue[0] == 63) &&      //ASCII - ?
 181   3                              (rx_queue[1] == 13) &&      //ASCII - CR
 182   3                              (rx_queue[2] == 10))        //ASCII - LF)
 183   3                              infoGet(INFO_ALL);
 184   3                      break;
 185   3      
 186   3                  //-----     wait for id     ----------------------------------------
 187   3                  case  WAIT_ID:
 188   3      
 189   3                      // packet is for my ID or is broadcast
 190   3                      if (rx_data == c_mem.id || rx_data == 0)
 191   3                          rx_data_type = FALSE;
 192   3                      else                //packet is for others
 193   3                          rx_data_type = TRUE;
 194   3                      
 195   3                      data_packet_length = 0;
 196   3                      state = WAIT_LENGTH;
 197   3                      break;
 198   3      
 199   3                  //-----     wait for length     ------------------------------------
 200   3                  case  WAIT_LENGTH:
 201   3      
 202   3       
 203   3                      data_packet_length = rx_data;
 204   3                      // check validity of pack length
 205   3                      if (data_packet_length <= 1) {
 206   4                          data_packet_length = 0;
 207   4                          state = WAIT_START;
 208   4                      } else if (data_packet_length > 128) {
 209   4                          data_packet_length = 0;
 210   4                          state = WAIT_START;
 211   4                      } else {
 212   4                          data_packet_index = 0;
 213   4                          
 214   4                          if(rx_data_type == FALSE)
 215   4                              state = RECEIVE;          // packet for me or broadcast
 216   4                          else
 217   4                              state = UNLOAD;           // packet for others
 218   4                      }
 219   3                      break;
 220   3      
 221   3                  //-----     receiving     -------------------------------------------
 222   3                  case RECEIVE:
 223   3      
 224   3                      data_packet_buffer[data_packet_index] = rx_data;
 225   3                      data_packet_index++;
 226   3                      
 227   3                      // check end of transmission
 228   3                      if (data_packet_index >= data_packet_length) {
 229   4                          // verify if frame ID corresponded to the device ID
 230   4                          if (rx_data_type == FALSE) {
 231   5                              // copying data from buffer to global packet
 232   5                              memcpy(g_rx.buffer, data_packet_buffer, data_packet_length);
 233   5                              g_rx.length = data_packet_length;
 234   5                              g_rx.ready  = 1;
 235   5                              commProcess();
 236   5                          }
 237   4                          
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 5   

 238   4                          data_packet_index  = 0;
 239   4                          data_packet_length = 0;
 240   4                          state              = WAIT_START;
 241   4                          package_count++;
 242   4                      
 243   4                      }
 244   3                      break;
 245   3      
 246   3                  //-----     other device is receving     ---------------------------
 247   3                  case UNLOAD:
 248   3                      if (!(--data_packet_length)) {
 249   4                          data_packet_index  = 0;
 250   4                          data_packet_length = 0;
 251   4                          RS485_CTS_Write(1);
 252   4                          RS485_CTS_Write(0);
 253   4                          state              = WAIT_START;
 254   4                          package_count++;
 255   4                      }
 256   3                      break;
 257   3              }
 258   2          }
 259   1      }
 260          //==============================================================================
 261          //                                                            FUNCTION SCHEDULER
 262          //==============================================================================
 263          // Call all the function with the right frequency
 264          //==============================================================================
 265          // Base frequency 1000 Hz
 266          //==============================================================================
 267          
 268          void function_scheduler(void) {
 269   1       
 270   1          static uint16 counter_calibration = DIV_INIT_VALUE;
 271   1      
 272   1          timer_value0 = (uint32)MY_TIMER_ReadCounter();
 273   1      
 274   1          // Start ADC Conversion, SOC = 1
 275   1      
 276   1          ADC_SOC_Write(0x01); 
 277   1          
 278   1          // Check Interrupt 
 279   1      
 280   1          if (interrupt_flag){
 281   2              interrupt_flag = FALSE;
 282   2              interrupt_manager();
 283   2          }
 284   1        
 285   1          //---------------------------------- Get Encoders
 286   1      
 287   1          encoder_reading(0); 
 288   1          
 289   1          // Check Interrupt     
 290   1          
 291   1          if (interrupt_flag){
 292   2              interrupt_flag = FALSE;
 293   2              interrupt_manager();
 294   2          }   
 295   1          
 296   1          encoder_reading(1);
 297   1          
 298   1          // Check Interrupt 
 299   1          
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 6   

 300   1          if (interrupt_flag){
 301   2              interrupt_flag = FALSE;
 302   2              interrupt_manager();
 303   2          }
 304   1          
 305   1          encoder_reading(2);
 306   1          
 307   1          // Check Interrupt 
 308   1          
 309   1          if (interrupt_flag){
 310   2              interrupt_flag = FALSE;
 311   2              interrupt_manager();
 312   2          }
 313   1      
 314   1          //---------------------------------- Control Motor
 315   1         
 316   1          motor_control();
 317   1      
 318   1          // Check Interrupt 
 319   1      
 320   1          if (interrupt_flag){
 321   2              interrupt_flag = FALSE;
 322   2              interrupt_manager();
 323   2          }
 324   1      
 325   1          //---------------------------------- Read conversion buffer - LOCK function
 326   1      
 327   1          analog_read_end();
 328   1      
 329   1          if (interrupt_flag){
 330   2              interrupt_flag = FALSE;
 331   2              interrupt_manager();
 332   2          }
 333   1      
 334   1          //---------------------------------- Control Overcurrent
 335   1      
 336   1          overcurrent_control();
 337   1          
 338   1          // Check Interrupt 
 339   1          
 340   1          if (interrupt_flag){
 341   2              interrupt_flag = FALSE;
 342   2              interrupt_manager();
 343   2          }
 344   1      
 345   1          //---------------------------------- Calibration 
 346   1      
 347   1          // Divider 10, freq = 500 Hz
 348   1          if (calib.enabled == TRUE) {
 349   2              if (counter_calibration == CALIBRATION_DIV) {
 350   3                  calibration();
 351   3                  counter_calibration = 0;
 352   3              }
 353   2              counter_calibration++;
 354   2          }
 355   1      
 356   1          // Check Interrupt 
 357   1          
 358   1          if (interrupt_flag){
 359   2              interrupt_flag = FALSE;
 360   2              interrupt_manager();
 361   2          }
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 7   

 362   1         
 363   1          //---------------------------------- Update States
 364   1          
 365   1          // Load k-1 state
 366   1          memcpy( &g_measOld, &g_meas, sizeof(g_meas) );
 367   1          memcpy( &g_refOld, &g_ref, sizeof(g_ref) );
 368   1      
 369   1          // Load k+1 state
 370   1          memcpy( &g_ref, &g_refNew, sizeof(g_ref) );
 371   1      
 372   1          if (interrupt_flag){
 373   2              interrupt_flag = FALSE;
 374   2              interrupt_manager();
 375   2          }
 376   1      
 377   1          timer_value = (uint32)MY_TIMER_ReadCounter();
 378   1          cycle_time = (float)((timer_value0 - timer_value)/1000000.0);
 379   1          MY_TIMER_WriteCounter(5000000);
 380   1      
 381   1      }
 382          
 383          //==============================================================================
 384          //                                                                MOTORS CONTROL
 385          //==============================================================================
 386          
 387          void motor_control() {
 388   1      
 389   1          int32 CYDATA pwm_input = 0;
 390   1      
 391   1          int32 CYDATA pos_error;         // position error
 392   1          int32 CYDATA curr_error;        // current error
 393   1      
 394   1          int32 CYDATA i_ref;             // current reference
 395   1          int32 CYDATA handle_value;
 396   1      
 397   1          int32 CYDATA err_emg_1, err_emg_2;
 398   1      
 399   1          int32 CYDATA k_p = c_mem.k_p;  
 400   1          int32 CYDATA k_i = c_mem.k_i; 
 401   1          int32 CYDATA k_d = c_mem.k_d; 
 402   1      
 403   1          int32 CYDATA k_p_c = c_mem.k_p_c;  
 404   1          int32 CYDATA k_i_c = c_mem.k_i_c; 
 405   1          int32 CYDATA k_d_c = c_mem.k_d_c;   
 406   1      
 407   1          int32 CYDATA k_p_dl = c_mem.k_p_dl;  
 408   1          int32 CYDATA k_i_dl = c_mem.k_i_dl; 
 409   1          int32 CYDATA k_d_dl = c_mem.k_d_dl;
 410   1          
 411   1          int32 CYDATA k_p_c_dl = c_mem.k_p_c_dl;  
 412   1          int32 CYDATA k_i_c_dl = c_mem.k_i_c_dl; 
 413   1          int32 CYDATA k_d_c_dl = c_mem.k_d_c_dl;   
 414   1      
 415   1          // Static Variables
 416   1      
 417   1          static int32 pos_error_sum;     // position error sum for integral
 418   1          static int32 curr_error_sum;    // current error sum for integral
 419   1          
 420   1          static int32 prev_pos_err;      // previous position error for deriv. control
 421   1          static int32 prev_curr_err;     // previous current error for deriv. control
 422   1      
 423   1          static CYBIT motor_dir = FALSE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 8   

 424   1      
 425   1          static uint8 current_emg = 0;   // 0 NONE
 426   1                                          // 1 EMG 1
 427   1                                          // 2 EMG 2
 428   1                                          // wait for both to get down
 429   1      
 430   1          err_emg_1 = g_meas.emg[0] - c_mem.emg_threshold[0];
 431   1          err_emg_2 = g_meas.emg[1] - c_mem.emg_threshold[1];
 432   1      
 433   1          // =========================== POSITION INPUT ==============================
 434   1          switch(c_mem.input_mode) {
 435   2      
 436   2              case INPUT_MODE_ENCODER3:
 437   2      
 438   2                  // Calculate handle value based on position of handle in the
 439   2                  // sensor chain and multiplication factor between handle and motor position
 440   2                  if (c_mem.double_encoder_on_off) 
 441   2                      handle_value = g_meas.pos[2] * c_mem.motor_handle_ratio;
 442   2                  else
 443   2                      handle_value = g_meas.pos[1] * c_mem.motor_handle_ratio;
 444   2                  
 445   2      
 446   2                  // Read handle and use it as reference for the motor
 447   2                  if (((handle_value - g_ref.pos[0]) > c_mem.max_step_pos) && (c_mem.max_step_pos != 0))
 448   2                      g_ref.pos[0] += c_mem.max_step_pos;
 449   2                  else {
 450   3                      if (((handle_value - g_ref.pos[0]) < c_mem.max_step_neg) && (c_mem.max_step_neg != 0))
 451   3                          g_ref.pos[0] += c_mem.max_step_neg;
 452   3                      else
 453   3                          g_ref.pos[0] = handle_value;
 454   3                  }
 455   2                  
 456   2                  if (normally_closed_mode == 1)
 457   2                      g_ref.pos[0] = g_mem.pos_lim_sup[0] - g_ref.pos[0];
 458   2      
 459   2      
 460   2                              if (h_status == H_WAIT){                               
 461   3                      if (c_mem.switch_mode == PULL) {
 462   4                          if (normally_closed_mode == 0)
 463   4                              g_ref.pos[0] = c_mem.pos_lim_sup[0];
 464   4                          else
 465   4                              g_ref.pos[0] = c_mem.pos_lim_inf[0];
 466   4                      }
 467   3                      
 468   3                      if (c_mem.switch_mode == PUSH) {
 469   4                          if (normally_closed_mode == 0)
 470   4                              g_ref.pos[0] = c_mem.pos_lim_inf[0];
 471   4                          else
 472   4                              g_ref.pos[0] = c_mem.pos_lim_sup[0];
 473   4                      }
 474   3      
 475   3                              }
 476   2                  
 477   2                  break;
 478   2      
 479   2              case INPUT_MODE_EMG_PROPORTIONAL:
 480   2                  if (err_emg_1 > 0)
 481   2                      g_ref.pos[0] = (err_emg_1 * g_mem.pos_lim_sup[0]) / (1024 - c_mem.emg_threshold[0]);
 482   2                  else
 483   2                      g_ref.pos[0] = 0;
 484   2                  break;
 485   2      
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 9   

 486   2              case INPUT_MODE_EMG_INTEGRAL:
 487   2                  g_ref.pos[0] = g_refOld.pos[0];
 488   2                  if (err_emg_1 > 0) {
 489   3                      g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * (int)g_mem.emg_speed * 2) / (1024 - c_mem.em
             -g_threshold[0]);
 490   3                  }
 491   2                  if (err_emg_2 > 0) {
 492   3                      g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * (int)g_mem.emg_speed * 2) / (1024 - c_mem.em
             -g_threshold[1]);
 493   3                  }
 494   2                  break;
 495   2      
 496   2              case INPUT_MODE_EMG_FCFS:
 497   2                  g_ref.pos[0] = g_refOld.pos[0];
 498   2                  switch (current_emg) {
 499   3                      case 0:
 500   3                          // Look for the first EMG passing the threshold
 501   3                          if (err_emg_1 > 0) {
 502   4                              current_emg = 1;
 503   4                              break;
 504   4                          }
 505   3                          if (err_emg_2 > 0) {
 506   4                              current_emg = 2;
 507   4                              break;
 508   4                          }
 509   3                          break;
 510   3      
 511   3                      case 1:
 512   3                          // EMG 1 is first
 513   3                          if (err_emg_1 < 0) {
 514   4                              current_emg = 0;
 515   4                              break;
 516   4                          }
 517   3                          g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * g_mem.emg_speed * 2) / (1024 - c_mem.emg
             -_threshold[0]);
 518   3                          break;
 519   3      
 520   3                      case 2:
 521   3                          // EMG 2 is first
 522   3                          if (err_emg_2 < 0) {
 523   4                              current_emg = 0;
 524   4                              break;
 525   4                          }
 526   3                          g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * g_mem.emg_speed * 2) / (1024 - c_mem.emg
             -_threshold[1]);
 527   3                          break;
 528   3      
 529   3                      default:
 530   3                          break;
 531   3                  }
 532   2      
 533   2                  break;
 534   2      
 535   2              case INPUT_MODE_EMG_FCFS_ADV:
 536   2                  g_ref.pos[0] = g_refOld.pos[0];
 537   2                  switch (current_emg) {
 538   3                      // Look for the first EMG passing the threshold
 539   3                      case 0:
 540   3                          if (err_emg_1 > 0) {
 541   4                              current_emg = 1;
 542   4                              break;
 543   4                          }
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 10  

 544   3                          if (err_emg_2 > 0) {
 545   4                              current_emg = 2;
 546   4                              break;
 547   4                          }
 548   3                          break;
 549   3      
 550   3                      // EMG 1 is first
 551   3                      case 1:
 552   3                          // If both signals are under threshold go back to status 0
 553   3                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 554   4                              current_emg = 0;
 555   4                              break;
 556   4                          }
 557   3                          // but if the current signal come back over threshold, continue using it
 558   3                          if (err_emg_1 > 0) 
 559   3                              g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * g_mem.emg_speed << 2) / (1024 - c_me
             -m.emg_threshold[0]);
 560   3                          
 561   3                          break;
 562   3      
 563   3                      // EMG 2 is first
 564   3                      case 2:
 565   3                          // If both signals are under threshold go back to status 0
 566   3                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 567   4                              current_emg = 0;
 568   4                              break;
 569   4                          }
 570   3                          // but if the current signal come back over threshold, continue using it
 571   3                          if (err_emg_2 > 0) {
 572   4                              g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * c_mem.emg_speed << 2) / (1024 - c_me
             -m.emg_threshold[1]);
 573   4                          }
 574   3                          break;
 575   3      
 576   3                      default:
 577   3                          break;
 578   3                  }
 579   2      
 580   2              default:
 581   2                  break;
 582   2          }
 583   1      
 584   1          // Position limit saturation
 585   1          if (c_mem.pos_lim_flag) {
 586   2              if (g_ref.pos[0] < c_mem.pos_lim_inf[0]) 
 587   2                  g_ref.pos[0] = c_mem.pos_lim_inf[0];
 588   2              if (g_ref.pos[0] > c_mem.pos_lim_sup[0]) 
 589   2                  g_ref.pos[0] = c_mem.pos_lim_sup[0];
 590   2          }
 591   1      
 592   1          switch(c_mem.control_mode) {
 593   2              // ======================= CURRENT AND POSITION CONTROL =======================
 594   2              case CURR_AND_POS_CONTROL:
 595   2                  pos_error = g_ref.pos[0] - g_meas.pos[0];
 596   2      
 597   2                  pos_error_sum += pos_error;
 598   2      
 599   2                  // error_sum saturation
 600   2                  if (pos_error_sum > POS_INTEGRAL_SAT_LIMIT)
 601   2                      pos_error_sum = POS_INTEGRAL_SAT_LIMIT;
 602   2                  else {
 603   3                      if (pos_error_sum < -POS_INTEGRAL_SAT_LIMIT) 
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 11  

 604   3                          pos_error_sum = -POS_INTEGRAL_SAT_LIMIT;
 605   3                  }
 606   2                  
 607   2                  // ------ position PID control ------
 608   2      
 609   2                  i_ref = 0;
 610   2                  
 611   2                  // Proportional
 612   2                  if (k_p_dl != 0)
 613   2                      i_ref += (int32)(k_p_dl * pos_error) >> 16;
 614   2      
 615   2                  // Integral
 616   2                  if (k_i_dl != 0)
 617   2                      i_ref += (int32)(k_i_dl * pos_error_sum) >> 16;
 618   2      
 619   2                  // Derivative
 620   2                  if (k_d_dl != 0)
 621   2                      i_ref += (int32)(k_d_dl * (pos_error - prev_pos_err)) >> 16;
 622   2                              
 623   2                  // Update previous position
 624   2                  prev_pos_err = pos_error;
 625   2      
 626   2                  // // current set through position reference
 627   2                  // i_ref = g_ref.pos[0] >> g_mem.res[0];
 628   2      
 629   2                  // motor direction depends on i_ref
 630   2                  if (i_ref >= 0)
 631   2                      motor_dir = TRUE;
 632   2                  else
 633   2                      motor_dir = FALSE;
 634   2      
 635   2                  // current ref must be positive
 636   2                  //i_ref = abs(i_ref);
 637   2      
 638   2                  // saturate max current
 639   2                  if (i_ref > c_mem.current_limit)
 640   2                      i_ref = c_mem.current_limit;
 641   2                  else {
 642   3                      if (i_ref < -c_mem.current_limit)
 643   3                          i_ref = -c_mem.current_limit;
 644   3                      }
 645   2      
 646   2                  // saturate min current
 647   2                  /*if (i_ref < MIN_CURR_SAT_LIMIT && i_ref > 0) {
 648   2                      i_ref = MIN_CURR_SAT_LIMIT;
 649   2                  }*/
 650   2      
 651   2                  // // write i_ref on meas curr 2 for DEBUG
 652   2                  //g_meas.curr[1] = i_ref;
 653   2      
 654   2                  // current error and curr error sum
 655   2                  curr_error = i_ref - g_meas.curr[0];
 656   2                  curr_error_sum += curr_error;
 657   2                  
 658   2                  if (curr_error_sum > CURR_INTEGRAL_SAT_LIMIT)
 659   2                      curr_error_sum = CURR_INTEGRAL_SAT_LIMIT;
 660   2                  else {
 661   3                      if (curr_error_sum < -CURR_INTEGRAL_SAT_LIMIT)
 662   3                          curr_error_sum = -CURR_INTEGRAL_SAT_LIMIT;
 663   3                  }
 664   2      
 665   2                  // ----- current PID control -----
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 12  

 666   2      
 667   2                  pwm_input = 0;
 668   2      
 669   2                  // Proportional
 670   2                  if (k_p_c_dl != 0)
 671   2                      pwm_input += (int32)(k_p_c_dl * curr_error) >> 16;
 672   2      
 673   2                  // Integral
 674   2                  if (k_i_c_dl != 0)
 675   2                      pwm_input += (int32)(k_i_c_dl * curr_error_sum) >> 16;
 676   2      
 677   2                  // Derivative
 678   2                  if (k_d_c_dl != 0)
 679   2                      pwm_input += (int32)(k_d_c_dl * (curr_error - prev_curr_err)) >> 16;
 680   2      
 681   2                  // pwm_input saturation
 682   2                  if (pwm_input < -PWM_MAX_VALUE) 
 683   2                      pwm_input = -PWM_MAX_VALUE;
 684   2                  else {
 685   3                      if (pwm_input > PWM_MAX_VALUE)
 686   3                          pwm_input = PWM_MAX_VALUE;
 687   3                  }
 688   2      
 689   2                  // Update previous current
 690   2                  prev_curr_err = curr_error;
 691   2      
 692   2              break;
 693   2      
 694   2              // ============================== POSITION CONTROL =====================
 695   2              case CONTROL_ANGLE:
 696   2                  pos_error = g_ref.pos[0] - g_meas.pos[0];
 697   2      
 698   2                  pos_error_sum += pos_error;
 699   2      
 700   2                  // anti-windup (for integral control)
 701   2                  if (pos_error_sum > ANTI_WINDUP)
 702   2                      pos_error_sum = ANTI_WINDUP;
 703   2                  else {
 704   3                                      if (pos_error_sum < -ANTI_WINDUP)
 705   3                              pos_error_sum = -ANTI_WINDUP;
 706   3                  }
 707   2      
 708   2                  // Proportional
 709   2                  if (k_p != 0) 
 710   2                      pwm_input = (int32)(k_p * pos_error) >> 16;
 711   2                  
 712   2      
 713   2                  // Integral
 714   2                  if (k_i != 0) 
 715   2                      pwm_input += (int32)(k_i * pos_error_sum) >> 16;
 716   2                  
 717   2      
 718   2                  // Derivative
 719   2                  if (k_d != 0) 
 720   2                      pwm_input += (int32)(k_d * (pos_error - prev_pos_err)) >> 16;
 721   2                  
 722   2      
 723   2                  // Update measure
 724   2                  prev_pos_err = pos_error;
 725   2      
 726   2                  if (pwm_input > 0)
 727   2                      motor_dir = TRUE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 13  

 728   2                  else
 729   2                      motor_dir = FALSE;
 730   2      
 731   2              break;
 732   2      
 733   2              // ========================== CURRENT CONTROL ==========================
 734   2              case CONTROL_CURRENT:
 735   2                  if(g_ref.onoff && tension_valid) {
 736   3                      
 737   3                      i_ref = g_ref.curr[0];
 738   3      
 739   3                      if (i_ref > c_mem.current_limit) 
 740   3                          i_ref = c_mem.current_limit;
 741   3                      else {
 742   4                          if (i_ref < -c_mem.current_limit)
 743   4                              i_ref = -c_mem.current_limit;
 744   4                      }
 745   3                      
 746   3                      // current error
 747   3                      curr_error = i_ref - g_meas.curr[0];            
 748   3                      curr_error_sum += curr_error;
 749   3                      
 750   3                      if (curr_error_sum > CURR_INTEGRAL_SAT_LIMIT)
 751   3                          curr_error_sum = CURR_INTEGRAL_SAT_LIMIT;
 752   3                      else {
 753   4                          if (curr_error_sum < -CURR_INTEGRAL_SAT_LIMIT) 
 754   4                              curr_error_sum = -CURR_INTEGRAL_SAT_LIMIT;
 755   4                      }
 756   3      
 757   3                      pwm_input = 0;
 758   3      
 759   3                      // Proportional
 760   3                      if (k_p_c != 0)
 761   3                          pwm_input += (int32)(k_p_c * curr_error) >> 16;
 762   3      
 763   3                      // Integral
 764   3                      if (k_i_c != 0)
 765   3                          pwm_input += (int32)(k_i_c * curr_error_sum) >> 16;
 766   3      
 767   3                      // Derivative
 768   3                      if (k_d_c != 0)
 769   3                          pwm_input += (int32)(k_d_c * (curr_error - prev_curr_err)) >> 16;
 770   3                      
 771   3                      prev_curr_err = curr_error;
 772   3                      
 773   3                      if (pwm_input >= 0) 
 774   3                          motor_dir = TRUE;
 775   3                      else
 776   3                          motor_dir = FALSE;
 777   3                  }
 778   2              break;
 779   2              
 780   2              // ================= DIRECT PWM CONTROL ================================
 781   2              case CONTROL_PWM:
 782   2      
 783   2                  pwm_input = g_ref.pwm[0];
 784   2      
 785   2                  if (pwm_input > 0) 
 786   2                      motor_dir = TRUE;
 787   2                  else 
 788   2                      motor_dir = FALSE;
 789   2                  
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 14  

 790   2      
 791   2                  // pwm_input saturation
 792   2                  if (pwm_input < -PWM_MAX_VALUE) 
 793   2                      pwm_input = -PWM_MAX_VALUE;
 794   2                  else {
 795   3                                      if (pwm_input > PWM_MAX_VALUE) 
 796   3                              pwm_input = PWM_MAX_VALUE;
 797   3                      }
 798   2      
 799   2              break;
 800   2          }
 801   1      
 802   1          ////////////////////////////////////////////////////////////////////////////
 803   1      
 804   1          if(pwm_input >  PWM_MAX_VALUE) 
 805   1              pwm_input =  PWM_MAX_VALUE;
 806   1          if(pwm_input < -PWM_MAX_VALUE) 
 807   1              pwm_input = -PWM_MAX_VALUE;
 808   1      
 809   1      
 810   1          if (c_mem.control_mode != CONTROL_PWM) 
 811   1              pwm_input = (((pwm_input << 10) / PWM_MAX_VALUE) * dev_pwm_limit) >> 10;
 812   1          
 813   1      
 814   1          pwm_sign = SIGN(pwm_input);
 815   1      
 816   1          if (motor_dir)
 817   1              MOTOR_DIR_Write(0x01);
 818   1          else
 819   1              MOTOR_DIR_Write(0x00);
 820   1      
 821   1          PWM_MOTORS_WriteCompare1(abs(pwm_input));
 822   1      }
 823          
 824          //==============================================================================
 825          //                                                                   ENCODER READING
 826          //==============================================================================
 827          
 828          void encoder_reading(const uint8 idx) {
 829   1      
 830   1          uint8 CYDATA index = idx;
 831   1          
 832   1          uint8 jj;
 833   1          
 834   1          uint32 data_encoder;
 835   1          int32 value_encoder;
 836   1          int32 speed_encoder;
 837   1          //int32 accel_encoder;
 838   1          int32 aux;
 839   1              int32 init_rot = 0;
 840   1      
 841   1          static int32 last_value_encoder[NUM_OF_SENSORS];
 842   1      
 843   1          static uint8 error[NUM_OF_SENSORS];
 844   1          
 845   1          static CYBIT only_first_time = TRUE;
 846   1      
 847   1          static uint8 one_time_execute = 0;
 848   1          static CYBIT pos_reconstruct = FALSE;
 849   1      
 850   1          static int32 v_value[NUM_OF_SENSORS];   //last value for velocity
 851   1          static int32 vv_value[NUM_OF_SENSORS];  //last last value for velocity
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 15  

 852   1          static int32 vvv_value[NUM_OF_SENSORS];  //last last last value for velocity
 853   1          
 854   1          //static int32 a_value[NUM_OF_SENSORS];   //last value for acceleration
 855   1          //static int32 aa_value[NUM_OF_SENSORS];  //last last value for acceleration
 856   1          //static int32 aaa_value[NUM_OF_SENSORS];  //last last last value for acceleration
 857   1          
 858   1          static uint8 handle_index = 2;
 859   1          int32 handle_pos;
 860   1          static handle_status CYDATA h_status = H_NORMAL; 
 861   1          static uint8 wait_for_switch = 0;
 862   1      
 863   1          if (index >= NUM_OF_SENSORS)
 864   1              return;
 865   1          
 866   1          if (reset_last_value_flag) {
 867   2              for (jj = NUM_OF_SENSORS; jj--;) 
 868   2                  last_value_encoder[jj] = 0;
 869   2              
 870   2              reset_last_value_flag = 0;
 871   2          }
 872   1      
 873   1          //======================================================     reading sensors
 874   1              // Shift 1 right to erase Dummy bit of chain
 875   1          if (index == 0)
 876   1                  data_encoder = (SHIFTREG_ENC_1_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 877   1          else {
 878   2              if (index == 1)
 879   2                  data_encoder = (SHIFTREG_ENC_2_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 880   2              else // index == 2
 881   2                  data_encoder = (SHIFTREG_ENC_3_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 882   2          }
 883   1             
 884   1      
 885   1          if (check_enc_data(&data_encoder)) {
 886   2      
 887   2              value_encoder = (int16) (((data_encoder & 0x3FFC0) - 0x20000) >> 2 ) + g_mem.m_off[index];
 888   2                                                          // reset last 6 bit 
 889   2                                                          // -> |:|:|id|dim|CMD|CHK|(data---
 890   2                                                          // subtract half of max value
 891   2                                                          // and shift to have 16 bit val
 892   2      
 893   2              // Initialize last_value_encoder
 894   2              if (only_first_time) {
 895   3                  last_value_encoder[index] = value_encoder;
 896   3                  if (index == 2)
 897   3                      only_first_time = 0;
 898   3              }
 899   2      
 900   2              // Take care of rotations
 901   2              aux = value_encoder - last_value_encoder[index];
 902   2      
 903   2              // ====================== 1 TURN ======================
 904   2              // -32768                    0                    32767 -32768                   0                
             -     32767
 905   2              // |-------------------------|-------------------------|-------------------------|----------------
             ----------|
 906   2              //              |                         |      |           |      |                         |
 907   2              //           -16384                     16383    |           |   -16384                     16383
 908   2              //                                               |           |
 909   2              //                                           24575           -24576
 910   2              //                                               |___________|
 911   2              //                                                   49152
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 16  

 912   2      
 913   2              // if we are in the right interval, take care of rotation
 914   2              // and update the variable only if the difference between
 915   2              // one measure and another is less than 1/4 of turn
 916   2      
 917   2              // Considering we are sampling at 1kHz, this means that our shaft needs
 918   2              // to go slower than 1/4 turn every ms -> 1 turn every 4ms
 919   2              // equal to 250 turn/s -> 15000 RPM
 920   2      
 921   2              if (aux > 49152)
 922   2                  g_meas.rot[index]--;
 923   2              else{ 
 924   3                  if (aux < -49152)
 925   3                      g_meas.rot[index]++;
 926   3                  else{
 927   4                      if (abs(aux) > 16384) { // if two measure are too far
 928   5                          error[index]++;
 929   5                          if (error[index] < 10)
 930   5                              // Discard
 931   5                              return;
 932   5                      }
 933   4                  }
 934   3              }
 935   2      
 936   2              error[index] = 0;
 937   2      
 938   2              last_value_encoder[index] = value_encoder;
 939   2      
 940   2              value_encoder += (int32)g_meas.rot[index] << 16;
 941   2      
 942   2              if (c_mem.m_mult[index] != 1.0) {
 943   3                  value_encoder *= c_mem.m_mult[index];
 944   3              }
 945   2      
 946   2              g_meas.pos[index] = value_encoder;
 947   2      
 948   2              // KOREA mod. version
 949   2              if (c_mem.double_encoder_on_off) 
 950   2                  handle_index = 2;
 951   2              else
 952   2                  handle_index = 1;
 953   2      
 954   2              if (index == handle_index && c_mem.input_mode == INPUT_MODE_ENCODER3) {
 955   3                  handle_pos = g_meas.pos[handle_index] >> g_mem.res[handle_index];
 956   3              
 957   3                  switch (h_status) {
 958   4                      case H_NORMAL:
 959   4                          if (c_mem.switch_mode == PULL && handle_pos > c_mem.activation_lever_thr){       //(bo
             -wden)
 960   5                              h_status = H_WAIT;
 961   5                          }
 962   4                          if (c_mem.switch_mode == PUSH && handle_pos < c_mem.switch_limit_inf){       //(korea)
             - -80
 963   5                              h_status = H_WAIT;
 964   5                          }
 965   4                          break;
 966   4                      case H_WAIT:                    
 967   4      
 968   4                          if (c_mem.switch_mode == PULL && handle_pos < 40){                               //(bo
             -wden)
 969   5                              // Change mode
 970   5                              if (normally_closed_mode == 0)
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 17  

 971   5                                  normally_closed_mode = 1;
 972   5                              else
 973   5                                  normally_closed_mode = 0;
 974   5                              
 975   5                              h_status = H_NORMAL;
 976   5                          }
 977   4                          
 978   4                          if (c_mem.switch_mode == PUSH  && handle_pos > c_mem.switch_limit_sup) {       //(kore
             -a) -40
 979   5                              // Button released                       
 980   5                              if (normally_closed_mode == 1) {    // NC
 981   6                                  if (handle_pos > 900) {
 982   7                                      normally_closed_mode = 0;
 983   7                                      wait_for_switch = 0;
 984   7                                  }
 985   6                                  else
 986   6                                      wait_for_switch = 1;
 987   6                              }
 988   5                              else {  ///NO
 989   6                                  normally_closed_mode = 1; 
 990   6                                  wait_for_switch = 0;                            
 991   6                              }
 992   5                              
 993   5                          
 994   5                              if (wait_for_switch == 0)
 995   5                                  h_status = H_NORMAL;
 996   5                          }
 997   4        
 998   4                          break;
 999   4                  }
1000   3              }
1001   2          }
1002   1          
1003   1          switch(index) {
1004   2              case 0:
1005   2                  speed_encoder = (int16)filter_vel_1((11*value_encoder - 18* v_value[0] + 9 * vv_value[0] -2 * 
             -vvv_value[0]));
1006   2              break;
1007   2       
1008   2              case 1:
1009   2                  speed_encoder = (int16)filter_vel_2((11*value_encoder - 18* v_value[1] + 9 * vv_value[1] -2 * 
             -vvv_value[1]));
1010   2              break;
1011   2          
1012   2              case 2:
1013   2                  speed_encoder = (int16)filter_vel_3((11*value_encoder - 18* v_value[2] + 9 * vv_value[2] -2 * 
             -vvv_value[2]));
1014   2              break;
1015   2          }
1016   1          //Update current speed
1017   1          speed_encoder = speed_encoder / (6*cycle_time);
1018   1          g_meas.vel[index] = speed_encoder;
1019   1          
1020   1          /*
1021   1          //Encoder rotational acceleration calculation
1022   1          switch(index) {
1023   1              case 0:
1024   1                  accel_encoder = (int16)filter_acc_1((11*speed_encoder - 18* a_value[0] + 9 * aa_value[0] -2* a
             -aa_value[0] ));
1025   1                  break;
1026   1              
1027   1              case 1:
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 18  

1028   1                  accel_encoder = (int16)filter_acc_2((11*speed_encoder - 18* a_value[1] + 9 * aa_value[1] -2* a
             -aa_value[1] ));
1029   1                  break;
1030   1              
1031   1              case 2:
1032   1                  accel_encoder = (int16)filter_acc_3((11*speed_encoder - 18* a_value[2] + 9 * aa_value[2] -2* a
             -aa_value[2] ));
1033   1                  break;
1034   1          }
1035   1          //Update current acceleration
1036   1          g_meas.acc[index] = accel_encoder / (6*cycle_time);
1037   1          */
1038   1      
1039   1          // update old velocity and acceleration values
1040   1          vvv_value[index] = vv_value[index];
1041   1          vv_value[index] = v_value[index];
1042   1          v_value[index] = value_encoder;
1043   1      
1044   1          /*
1045   1          aaa_value[index] = aa_value[index];
1046   1          aa_value[index] = a_value[index];
1047   1          a_value[index] = speed_encoder;
1048   1          */
1049   1      
1050   1      
1051   1          // wait at least 3 * max_num_of_error (10) + 5 = 35 cycles to reconstruct the right turn
1052   1          if (pos_reconstruct == FALSE){
1053   2              if (one_time_execute < 34) 
1054   2                  one_time_execute++;
1055   2              else {
1056   3                  //Double encoder translation
1057   3                  if (c_mem.double_encoder_on_off){
1058   4      
1059   4                      init_rot = calc_turns_fcn(g_meas.pos[0],g_meas.pos[1]);
1060   4                      
1061   4                      if (c_mem.m_mult[0] < 0)
1062   4                          init_rot = -init_rot;
1063   4                      
1064   4                      g_meas.rot[0] = (int8)init_rot;
1065   4      
1066   4                  }
1067   3      
1068   3      
1069   3                  if (c_mem.m_mult != 1.0)
1070   3                      g_meas.pos[0] /= c_mem.m_mult[0];
1071   3                  
1072   3                  g_meas.pos[0] += (int32)(init_rot << 16);
1073   3                  
1074   3                  if (c_mem.m_mult != 1.0)
1075   3                      g_meas.pos[0] *= c_mem.m_mult[0];
1076   3                          
1077   3                  // If necessary activate motors
1078   3                  g_refNew.pos[0] = g_meas.pos[0];
1079   3      
1080   3                  MOTOR_ON_OFF_Write(g_ref.onoff);
1081   3                  
1082   3                  pos_reconstruct = TRUE;
1083   3              }
1084   2          }
1085   1      }
1086          
1087          //==============================================================================
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 19  

1088          //                                                           ANALOG MEASUREMENTS
1089          //==============================================================================
1090          
1091          void analog_read_end() {
1092   1      
1093   1          /* =========================================================================
1094   1          /   Ideal formulation to calculate tension and current
1095   1          /
1096   1          /   tension = ((read_value_mV - offset) * 101) / gain -> [mV]
1097   1          /   current = ((read_value_mV - offset) * 375) / (gain * resistor) -> [mA]
1098   1          /
1099   1          /   Definition:
1100   1          /   read_value_mV = counts_read / 0.819 -> conversion from counts to mV
1101   1          /   offset = 2000 -> hardware amplifier bias in mV
1102   1          /   gain = 8.086 -> amplifier gain
1103   1          /   resistor = 18 -> resistor of voltage divider in KOhm 
1104   1          /
1105   1          /   Real formulation: tradeoff in good performance and accurancy, ADC_buf[] 
1106   1          /   and offset unit of measurment is counts, instead dev_tension and
1107   1          /   g_meas.curr[] are converted in properly unit.
1108   1          /  =========================================================================
1109   1          */
1110   1      
1111   1          int32 CYDATA i_aux;
1112   1      
1113   1          static emg_status CYDATA emg_1_status = RESET; 
1114   1          static emg_status CYDATA emg_2_status = RESET;                                             
1115   1          
1116   1          static uint16 emg_counter_1 = 0;
1117   1          static uint16 emg_counter_2 = 0;
1118   1      
1119   1          // Wait for conversion end
1120   1          
1121   1          while(!ADC_STATUS_Read()){
1122   2              if (interrupt_flag){
1123   3                  interrupt_flag = FALSE;
1124   3                  interrupt_manager();
1125   3              }
1126   2          }
1127   1          
1128   1          // Convert tension read
1129   1          dev_tension = ((int32)(ADC_buf[0] - 1638) * 1952) >> 7;
1130   1          
1131   1          if (interrupt_flag){
1132   2              interrupt_flag = FALSE;
1133   2              interrupt_manager();
1134   2          }
1135   1      
1136   1          // Until there is no valid input tension repeat this measurement
1137   1          
1138   1          if (dev_tension > 0) {
1139   2              // Set tension valid bit to TRUE
1140   2      
1141   2              tension_valid = TRUE;
1142   2      
1143   2              if(g_mem.activate_pwm_rescaling)        //pwm rescaling is activated
1144   2                  pwm_limit_search();                 //only for 12V motors
1145   2      
1146   2              // Filter and Set currents
1147   2              g_meas.curr[0] = filter_i1((int16) (((int32)(ADC_buf[1] - 1638) * 25771) >> 13) * pwm_sign);
1148   2              
1149   2                      // Calculate current estimation and put it in the second part of the current measurement array;
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 20  

1150   2                      g_meas.curr[1] = (int16) filter_curr_diff(((int32) g_meas.curr[0]) - curr_estim(g_meas.pos[0] >> g_mem.r
             -es[0], g_meas.vel[0] >> g_mem.res[0], g_ref.pos[0] >> g_mem.res[0]));
1151   2      
1152   2              // Check Interrupt 
1153   2          
1154   2              if (interrupt_flag){
1155   3                  interrupt_flag = FALSE;
1156   3                  interrupt_manager();
1157   3              }
1158   2      
1159   2              // if calibration is not needed go to "normal execution"
1160   2              if (!g_mem.emg_calibration_flag){
1161   3                  emg_1_status = NORMAL; // normal execution
1162   3                  emg_2_status = NORMAL; // normal execution
1163   3              }
1164   2      
1165   2              // EMG 1 calibration state machine
1166   2              
1167   2              // Calibration state machine
1168   2              switch(emg_1_status) {
1169   3                  case NORMAL: // normal execution
1170   3                      i_aux = filter_ch1(ADC_buf[2]);
1171   3                      i_aux = (i_aux << 10) / g_mem.emg_max_value[0];
1172   3          
1173   3                      if (interrupt_flag){
1174   4                          interrupt_flag = FALSE;
1175   4                          interrupt_manager();
1176   4                      }
1177   3                      //Saturation
1178   3                      if (i_aux < 0)
1179   3                          i_aux = 0;
1180   3                      else 
1181   3                          if (i_aux > 1024) 
1182   3                              i_aux = 1024;
1183   3                      
1184   3                      g_meas.emg[0] = i_aux;
1185   3          
1186   3                      if (interrupt_flag){
1187   4                          interrupt_flag = FALSE;
1188   4                          interrupt_manager();
1189   4                      }
1190   3                      
1191   3                      break;
1192   3      
1193   3                  case RESET: // reset variables
1194   3                      emg_counter_1 = 0;
1195   3                      g_mem.emg_max_value[0] = 0;
1196   3                      emg_1_status = DISCARD; // goto next status
1197   3                      
1198   3                      break;
1199   3      
1200   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1201   3                      emg_counter_1++;
1202   3                      if (emg_counter_1 == EMG_SAMPLE_TO_DISCARD) {
1203   4                          emg_counter_1 = 0;          // reset counter
1204   4                          LED_REG_Write(0x01);        // turn on LED
1205   4                              
1206   4                          if (interrupt_flag){
1207   5                              interrupt_flag = FALSE;
1208   5                              interrupt_manager();
1209   5                          }
1210   4                          
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 21  

1211   4                          emg_1_status = SUM_AND_MEAN;           // sum and mean status
1212   4                      }
1213   3                      break;
1214   3      
1215   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1216   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1217   3                      emg_counter_1++;
1218   3                      g_mem.emg_max_value[0] += filter_ch1(ADC_buf[2]);
1219   3                      
1220   3                      if (interrupt_flag){
1221   4                          interrupt_flag = FALSE;
1222   4                          interrupt_manager();
1223   4                      }
1224   3                      
1225   3                      if (emg_counter_1 == SAMPLES_FOR_EMG_MEAN) {
1226   4                          g_mem.emg_max_value[0] = g_mem.emg_max_value[0] / SAMPLES_FOR_EMG_MEAN; // calc mean
1227   4          
1228   4                          if (interrupt_flag){
1229   5                              interrupt_flag = FALSE;
1230   5                              interrupt_manager();
1231   5                          }                    
1232   4                          
1233   4                          LED_REG_Write(0x00);        // led OFF
1234   4                          emg_counter_1 = 0;          // reset counter
1235   4      
1236   4                          emg_1_status = NORMAL;           // goto normal execution
1237   4                      }
1238   3                      break;
1239   3      
1240   3                  default:
1241   3                      break;
1242   3              }
1243   2          
1244   2              if (interrupt_flag){
1245   3                  interrupt_flag = FALSE;
1246   3                  interrupt_manager();
1247   3              }
1248   2              // EMG 2 calibration state machine
1249   2              switch(emg_2_status) {
1250   3                  case NORMAL: // normal execution
1251   3                      i_aux = filter_ch2(ADC_buf[3]);
1252   3                      i_aux = (i_aux << 10) / g_mem.emg_max_value[1];
1253   3          
1254   3                      if (interrupt_flag){
1255   4                          interrupt_flag = FALSE;
1256   4                          interrupt_manager();
1257   4                      }
1258   3                      
1259   3                      if (i_aux < 0) 
1260   3                          i_aux = 0;
1261   3                      else 
1262   3                          if (i_aux > 1024)
1263   3                              i_aux = 1024;
1264   3                      
1265   3                      g_meas.emg[1] = i_aux;
1266   3      
1267   3                      break;
1268   3      
1269   3                  case RESET: // reset variables
1270   3                      emg_counter_2 = 0;
1271   3                      g_mem.emg_max_value[1] = 0;
1272   3          
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 22  

1273   3                      if (interrupt_flag){
1274   4                          interrupt_flag = FALSE;
1275   4                          interrupt_manager();
1276   4                      }
1277   3                      
1278   3                      emg_2_status = WAIT; // wait for EMG 1 calibration
1279   3                      break;
1280   3      
1281   3                  case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1282   3                      emg_counter_2++;
1283   3                      if (emg_counter_2 == EMG_SAMPLE_TO_DISCARD) {
1284   4                          emg_counter_2 = 0;          // reset counter
1285   4                          LED_REG_Write(0x01);        // turn on LED
1286   4          
1287   4                          if (interrupt_flag){
1288   5                              interrupt_flag = FALSE;
1289   5                              interrupt_manager();
1290   5                          }
1291   4                          
1292   4                          emg_2_status = SUM_AND_MEAN;           // sum and mean status
1293   4                      }
1294   3                      break;
1295   3      
1296   3                  case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1297   3                      // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1298   3                      emg_counter_2++;
1299   3                      g_mem.emg_max_value[1] += filter_ch2(ADC_buf[3]);
1300   3          
1301   3                      if (interrupt_flag){
1302   4                          interrupt_flag = FALSE;
1303   4                          interrupt_manager();
1304   4                      }
1305   3                      
1306   3                      if (emg_counter_2 == SAMPLES_FOR_EMG_MEAN) {
1307   4                          g_mem.emg_max_value[1] = g_mem.emg_max_value[1] / SAMPLES_FOR_EMG_MEAN; // calc mean
1308   4                          LED_REG_Write(0x00);        // led OFF
1309   4                          emg_counter_2 = 0;          // reset counter
1310   4                      
1311   4                          if (interrupt_flag){
1312   5                              interrupt_flag = FALSE;
1313   5                              interrupt_manager();
1314   5                          }
1315   4                          
1316   4                          // if EMG control mode active, activate motors accordingly with startup value
1317   4                          if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
1318   4                              (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1319   4                              (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1320   4                              (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1321   5                              if (c_mem.control_mode == CONTROL_ANGLE) {
1322   6                                  g_ref.pos[0] = g_meas.pos[0];
1323   6                                  g_ref.pos[1] = g_meas.pos[1];
1324   6                              }
1325   5                              g_ref.onoff = c_mem.activ;
1326   5                              MOTOR_ON_OFF_Write(g_ref.onoff);
1327   5                          }
1328   4                          emg_2_status = NORMAL;           // goto normal execution
1329   4                      }
1330   3                      break;
1331   3      
1332   3                  case WAIT: // wait for EMG calibration to be done
1333   3                      if (emg_1_status == NORMAL)
1334   3                          emg_2_status = DISCARD;           // goto discard sample
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 23  

1335   3                      break;
1336   3      
1337   3                  default:
1338   3                      break;
1339   3              }
1340   2                  
1341   2              if (interrupt_flag){
1342   3                  interrupt_flag = FALSE;
1343   3                  interrupt_manager();
1344   3              }
1345   2          }
1346   1          else {
1347   2      
1348   2              emg_1_status = RESET; 
1349   2              emg_2_status = RESET;
1350   2      
1351   2              tension_valid = FALSE;
1352   2                  
1353   2              if (interrupt_flag){
1354   3                  interrupt_flag = FALSE;
1355   3                  interrupt_manager();
1356   3              }
1357   2              
1358   2              if (c_mem.emg_calibration_flag) {
1359   3                  if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
1360   3                      (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1361   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1362   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1363   4                      g_ref.onoff = 0x00;
1364   4                      MOTOR_ON_OFF_Write(g_ref.onoff);
1365   4                  }
1366   3              }
1367   2      
1368   2              // Reset current
1369   2              g_meas.curr[0] = 0;
1370   2      
1371   2              // Reset emg
1372   2              g_meas.emg[0] = 0;
1373   2              g_meas.emg[1] = 0;
1374   2      
1375   2          }
1376   1              
1377   1          if (interrupt_flag){
1378   2              interrupt_flag = FALSE;
1379   2              interrupt_manager();
1380   2          }
1381   1      }
1382          
1383          //==============================================================================
1384          //                                                           OVERCURRENT CONTROL
1385          //==============================================================================
1386          
1387          void overcurrent_control() {
1388   1          if (c_mem.current_limit != 0) {
1389   2              // if the current is over the limit
1390   2              if (g_meas.curr[0] > c_mem.current_limit) {
1391   3                  //decrese pwm_limit
1392   3                  dev_pwm_limit--;
1393   3              // if the current is in the safe zone
1394   3              } else if (g_meas.curr[0] < (c_mem.current_limit - CURRENT_HYSTERESIS)) {
1395   3                  //increase pwm_limit
1396   3                  dev_pwm_limit++;
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 24  

1397   3              }
1398   2      
1399   2              // Bound pwm_limit
1400   2              if (dev_pwm_limit < 0) 
1401   2                  dev_pwm_limit = 0;
1402   2              else 
1403   2                  if (dev_pwm_limit > 100) 
1404   2                      dev_pwm_limit = 100;
1405   2          }
1406   1      }
1407          
1408          //==============================================================================
1409          //                                                              PWM_LIMIT_SEARCH
1410          //==============================================================================
1411          
1412          void pwm_limit_search() {
1413   1      
1414   1          uint8 CYDATA index;
1415   1      
1416   1          if (dev_tension > 25500) {
1417   2              dev_pwm_limit = 0;
1418   2          } else if (dev_tension < 11500) {
1419   2              dev_pwm_limit = 100;
1420   2          } else {
1421   2              index = (uint8)((dev_tension - 11500) >> 9);
1422   2              dev_pwm_limit = pwm_preload_values[index];
1423   2          }
1424   1      }
1425          /* [] END OF FILE */
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 25  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION ISR_WATCHDOG_Handler (BEGIN)
                                           ; SOURCE LINE # 102
                                           ; SOURCE LINE # 106
0000 D200        E     SETB    watchdog_flag
                                           ; SOURCE LINE # 108
0002 32                RETI    
             ; FUNCTION ISR_WATCHDOG_Handler (END)

             ; FUNCTION ISR_RS485_RX_ExInterrupt (BEGIN)
                                           ; SOURCE LINE # 114
                                           ; SOURCE LINE # 118
0000 D200        E     SETB    interrupt_flag
                                           ; SOURCE LINE # 120
0002 32                RETI    
             ; FUNCTION ISR_RS485_RX_ExInterrupt (END)

             ; FUNCTION interrupt_manager (BEGIN)
                                           ; SOURCE LINE # 137
                                           ; SOURCE LINE # 153
0000 E4                CLR     A
0001 F500        R     MOV     package_count,A
0003         ?C0003:
                                           ; SOURCE LINE # 159
0003 120000      E     LCALL   UART_RS485_GetRxBufferSize
0006 EF                MOV     A,R7
0007 7003              JNZ     $ + 5H
0009 020000      R     LJMP    ?C0026
000C E500        R     MOV     A,package_count
000E C3                CLR     C
000F 9406              SUBB    A,#06H
0011 4003              JC      $ + 5H
0013 020000      R     LJMP    ?C0026
                                           ; SOURCE LINE # 163
0016 120000      E     LCALL   UART_RS485_GetChar
0019 8F00        R     MOV     rx_data,R7
                                           ; SOURCE LINE # 165
001B E500        R     MOV     A,state
001D 14                DEC     A
001E 6049              JZ      ?C0010
0020 14                DEC     A
0021 6060              JZ      ?C0014
0023 14                DEC     A
0024 7003              JNZ     $ + 5H
0026 020000      R     LJMP    ?C0021
0029 14                DEC     A
002A 7003              JNZ     $ + 5H
002C 020000      R     LJMP    ?C0024
002F 2404              ADD     A,#04H
0031 70D0              JNZ     ?C0003
                                           ; SOURCE LINE # 167
0033         ?C0006:
                                           ; SOURCE LINE # 169
0033 850000      R     MOV     rx_queue,rx_queue+01H
                                           ; SOURCE LINE # 170
0036 850000      R     MOV     rx_queue+01H,rx_queue+02H
                                           ; SOURCE LINE # 171
0039 850000      R     MOV     rx_queue+02H,rx_data
                                           ; SOURCE LINE # 174
003C E500        R     MOV     A,rx_queue+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 26  

003E B43A11            CJNE    A,#03AH,?C0007
0041 E500        R     MOV     A,rx_queue+02H
0043 B43A0C            CJNE    A,#03AH,?C0007
                                           ; SOURCE LINE # 175
0046 E4                CLR     A
0047 F500        R     MOV     rx_queue,A
                                           ; SOURCE LINE # 176
0049 F500        R     MOV     rx_queue+01H,A
                                           ; SOURCE LINE # 177
004B F500        R     MOV     rx_queue+02H,A
                                           ; SOURCE LINE # 178
004D 750001      R     MOV     state,#01H
                                           ; SOURCE LINE # 179
0050 80B1              SJMP    ?C0003
0052         ?C0007:
                                           ; SOURCE LINE # 180
0052 E500        R     MOV     A,rx_queue
0054 B43FAC            CJNE    A,#03FH,?C0003
0057 E500        R     MOV     A,rx_queue+01H
0059 B40DA7            CJNE    A,#0DH,?C0003
005C E500        R     MOV     A,rx_queue+02H
005E 640A              XRL     A,#0AH
0060 70A1              JNZ     ?C0003
                                           ; SOURCE LINE # 183
0062 FF                MOV     R7,A
0063 FE                MOV     R6,A
0064 120000      E     LCALL   _infoGet
                                           ; SOURCE LINE # 184
0067 809A              SJMP    ?C0003
                                           ; SOURCE LINE # 187
0069         ?C0010:
                                           ; SOURCE LINE # 190
0069 900000      E     MOV     DPTR,#c_mem+01H
006C E0                MOVX    A,@DPTR
006D 6500        R     XRL     A,rx_data
006F 6004              JZ      ?C0012
0071 E500        R     MOV     A,rx_data
0073 7004              JNZ     ?C0011
0075         ?C0012:
                                           ; SOURCE LINE # 191
0075 C200        R     CLR     rx_data_type
0077 8002              SJMP    ?C0013
0079         ?C0011:
                                           ; SOURCE LINE # 193
0079 D200        R     SETB    rx_data_type
007B         ?C0013:
                                           ; SOURCE LINE # 195
007B E4                CLR     A
007C F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 196
007E 750002      R     MOV     state,#02H
                                           ; SOURCE LINE # 197
0081 8080              SJMP    ?C0003
                                           ; SOURCE LINE # 200
0083         ?C0014:
                                           ; SOURCE LINE # 203
0083 850000      R     MOV     data_packet_length,rx_data
                                           ; SOURCE LINE # 205
0086 E500        R     MOV     A,data_packet_length
0088 D3                SETB    C
0089 9401              SUBB    A,#01H
008B 5008              JNC     ?C0015
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 27  

                                           ; SOURCE LINE # 206
008D E4                CLR     A
008E F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 207
0090 F500        R     MOV     state,A
                                           ; SOURCE LINE # 208
0092 020000      R     LJMP    ?C0003
0095         ?C0015:
0095 E500        R     MOV     A,data_packet_length
0097 D3                SETB    C
0098 9480              SUBB    A,#080H
009A 4008              JC      ?C0017
                                           ; SOURCE LINE # 209
009C E4                CLR     A
009D F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 210
009F F500        R     MOV     state,A
                                           ; SOURCE LINE # 211
00A1 020000      R     LJMP    ?C0003
00A4         ?C0017:
                                           ; SOURCE LINE # 212
00A4 E4                CLR     A
00A5 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 214
00A7 200006            JB      rx_data_type,?C0019
                                           ; SOURCE LINE # 215
00AA 750003      R     MOV     state,#03H
00AD 020000      R     LJMP    ?C0003
00B0         ?C0019:
                                           ; SOURCE LINE # 217
00B0 750004      R     MOV     state,#04H
                                           ; SOURCE LINE # 218
                                           ; SOURCE LINE # 219
00B3 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 222
00B6         ?C0021:
                                           ; SOURCE LINE # 224
00B6 7400        R     MOV     A,#LOW data_packet_buffer
00B8 2500        R     ADD     A,data_packet_index
00BA F582              MOV     DPL,A
00BC E4                CLR     A
00BD 3400        R     ADDC    A,#HIGH data_packet_buffer
00BF F583              MOV     DPH,A
00C1 E500        R     MOV     A,rx_data
00C3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 225
00C4 0500        R     INC     data_packet_index
                                           ; SOURCE LINE # 228
00C6 E500        R     MOV     A,data_packet_index
00C8 C3                CLR     C
00C9 9500        R     SUBB    A,data_packet_length
00CB 5003              JNC     $ + 5H
00CD 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 230
00D0 200025            JB      rx_data_type,?C0023
                                           ; SOURCE LINE # 232
00D3 AF00        R     MOV     R7,data_packet_length
00D5 7E00              MOV     R6,#00H
00D7 7800        E     MOV     R0,#LOW g_rx
00D9 7C00        E     MOV     R4,#HIGH g_rx
00DB 7D01              MOV     R5,#01H
00DD 7B01              MOV     R3,#01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 28  

00DF 7A00        R     MOV     R2,#HIGH data_packet_buffer
00E1 7900        R     MOV     R1,#LOW data_packet_buffer
00E3 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 233
00E6 900000      E     MOV     DPTR,#g_rx+080H
00E9 E4                CLR     A
00EA F0                MOVX    @DPTR,A
00EB A3                INC     DPTR
00EC E500        R     MOV     A,data_packet_length
00EE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 234
00EF 900000      E     MOV     DPTR,#g_rx+084H
00F2 7401              MOV     A,#01H
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 235
00F5 120000      E     LCALL   commProcess
                                           ; SOURCE LINE # 236
00F8         ?C0023:
                                           ; SOURCE LINE # 238
00F8 E4                CLR     A
00F9 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 239
00FB F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 240
00FD F500        R     MOV     state,A
                                           ; SOURCE LINE # 241
00FF 0500        R     INC     package_count
                                           ; SOURCE LINE # 243
                                           ; SOURCE LINE # 244
0101 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 247
0104         ?C0024:
                                           ; SOURCE LINE # 248
0104 1500        R     DEC     data_packet_length
0106 E500        R     MOV     A,data_packet_length
0108 6003              JZ      $ + 5H
010A 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 249
010D F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 250
010F F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 251
0111 7F01              MOV     R7,#01H
0113 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 252
0116 E4                CLR     A
0117 FF                MOV     R7,A
0118 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 253
011B E4                CLR     A
011C F500        R     MOV     state,A
                                           ; SOURCE LINE # 254
011E 0500        R     INC     package_count
                                           ; SOURCE LINE # 255
                                           ; SOURCE LINE # 256
0120 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 257
                                           ; SOURCE LINE # 258
0123 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 259
0126         ?C0026:
0126 22                RET     
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 29  

             ; FUNCTION interrupt_manager (END)

             ; FUNCTION function_scheduler (BEGIN)
                                           ; SOURCE LINE # 268
                                           ; SOURCE LINE # 272
0000 120000      E     LCALL   MY_TIMER_ReadCounter
0003 900000      E     MOV     DPTR,#timer_value0
0006 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 276
0009 7F01              MOV     R7,#01H
000B 120000      E     LCALL   _ADC_SOC_Write
                                           ; SOURCE LINE # 280
000E 300005            JNB     interrupt_flag,?C0027
                                           ; SOURCE LINE # 281
0011 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 282
0013 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 283
0016         ?C0027:
                                           ; SOURCE LINE # 287
0016 E4                CLR     A
0017 FF                MOV     R7,A
0018 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 291
001B 300005            JNB     interrupt_flag,?C0028
                                           ; SOURCE LINE # 292
001E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 293
0020 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 294
0023         ?C0028:
                                           ; SOURCE LINE # 296
0023 7F01              MOV     R7,#01H
0025 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 300
0028 300005            JNB     interrupt_flag,?C0029
                                           ; SOURCE LINE # 301
002B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 302
002D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 303
0030         ?C0029:
                                           ; SOURCE LINE # 305
0030 7F02              MOV     R7,#02H
0032 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 309
0035 300005            JNB     interrupt_flag,?C0030
                                           ; SOURCE LINE # 310
0038 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 311
003A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 312
003D         ?C0030:
                                           ; SOURCE LINE # 316
003D 120000      R     LCALL   motor_control
                                           ; SOURCE LINE # 320
0040 300005            JNB     interrupt_flag,?C0031
                                           ; SOURCE LINE # 321
0043 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 322
0045 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 323
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 30  

0048         ?C0031:
                                           ; SOURCE LINE # 327
0048 120000      R     LCALL   analog_read_end
                                           ; SOURCE LINE # 329
004B 300005            JNB     interrupt_flag,?C0032
                                           ; SOURCE LINE # 330
004E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 331
0050 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 332
0053         ?C0032:
                                           ; SOURCE LINE # 336
0053 120000      R     LCALL   overcurrent_control
                                           ; SOURCE LINE # 340
0056 300005            JNB     interrupt_flag,?C0033
                                           ; SOURCE LINE # 341
0059 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 342
005B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 343
005E         ?C0033:
                                           ; SOURCE LINE # 348
005E 900000      E     MOV     DPTR,#calib
0061 E0                MOVX    A,@DPTR
0062 B40124            CJNE    A,#01H,?C0034
                                           ; SOURCE LINE # 349
0065 900000      R     MOV     DPTR,#counter_calibration
0068 E0                MOVX    A,@DPTR
0069 7004              JNZ     ?C0259
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D 640A              XRL     A,#0AH
006F         ?C0259:
006F 700A              JNZ     ?C0035
                                           ; SOURCE LINE # 350
0071 120000      E     LCALL   calibration
                                           ; SOURCE LINE # 351
0074 E4                CLR     A
0075 900000      R     MOV     DPTR,#counter_calibration
0078 F0                MOVX    @DPTR,A
0079 A3                INC     DPTR
007A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 352
007B         ?C0035:
                                           ; SOURCE LINE # 353
007B 900000      R     MOV     DPTR,#counter_calibration+01H
007E E0                MOVX    A,@DPTR
007F 04                INC     A
0080 F0                MOVX    @DPTR,A
0081 7006              JNZ     ?C0260
0083 900000      R     MOV     DPTR,#counter_calibration
0086 E0                MOVX    A,@DPTR
0087 04                INC     A
0088 F0                MOVX    @DPTR,A
0089         ?C0260:
                                           ; SOURCE LINE # 354
0089         ?C0034:
                                           ; SOURCE LINE # 358
0089 300005            JNB     interrupt_flag,?C0036
                                           ; SOURCE LINE # 359
008C C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 360
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 31  

008E 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 361
0091         ?C0036:
                                           ; SOURCE LINE # 366
0091 7800        E     MOV     R0,#LOW g_measOld
0093 7C00        E     MOV     R4,#HIGH g_measOld
0095 7D01              MOV     R5,#01H
0097 7B01              MOV     R3,#01H
0099 7A00        E     MOV     R2,#HIGH g_meas
009B 7900        E     MOV     R1,#LOW g_meas
009D 7E00              MOV     R6,#00H
009F 7F37              MOV     R7,#037H
00A1 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 367
00A4 7800        E     MOV     R0,#LOW g_refOld
00A6 7C00        E     MOV     R4,#HIGH g_refOld
00A8 7D01              MOV     R5,#01H
00AA 7B01              MOV     R3,#01H
00AC 7A00        E     MOV     R2,#HIGH g_ref
00AE 7900        E     MOV     R1,#LOW g_ref
00B0 7E00              MOV     R6,#00H
00B2 7F19              MOV     R7,#019H
00B4 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 370
00B7 7800        E     MOV     R0,#LOW g_ref
00B9 7C00        E     MOV     R4,#HIGH g_ref
00BB 7D01              MOV     R5,#01H
00BD 7B01              MOV     R3,#01H
00BF 7A00        E     MOV     R2,#HIGH g_refNew
00C1 7900        E     MOV     R1,#LOW g_refNew
00C3 7E00              MOV     R6,#00H
00C5 7F19              MOV     R7,#019H
00C7 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 372
00CA 300005            JNB     interrupt_flag,?C0037
                                           ; SOURCE LINE # 373
00CD C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 374
00CF 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 375
00D2         ?C0037:
                                           ; SOURCE LINE # 377
00D2 120000      E     LCALL   MY_TIMER_ReadCounter
00D5 900000      E     MOV     DPTR,#timer_value
00D8 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 378
00DB 900000      E     MOV     DPTR,#timer_value
00DE E0                MOVX    A,@DPTR
00DF F8                MOV     R0,A
00E0 A3                INC     DPTR
00E1 E0                MOVX    A,@DPTR
00E2 F9                MOV     R1,A
00E3 A3                INC     DPTR
00E4 E0                MOVX    A,@DPTR
00E5 FA                MOV     R2,A
00E6 A3                INC     DPTR
00E7 E0                MOVX    A,@DPTR
00E8 FB                MOV     R3,A
00E9 900000      E     MOV     DPTR,#timer_value0
00EC E0                MOVX    A,@DPTR
00ED FC                MOV     R4,A
00EE A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 32  

00EF E0                MOVX    A,@DPTR
00F0 FD                MOV     R5,A
00F1 A3                INC     DPTR
00F2 E0                MOVX    A,@DPTR
00F3 FE                MOV     R6,A
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6 C3                CLR     C
00F7 9B                SUBB    A,R3
00F8 FF                MOV     R7,A
00F9 EE                MOV     A,R6
00FA 9A                SUBB    A,R2
00FB FE                MOV     R6,A
00FC ED                MOV     A,R5
00FD 99                SUBB    A,R1
00FE FD                MOV     R5,A
00FF EC                MOV     A,R4
0100 98                SUBB    A,R0
0101 FC                MOV     R4,A
0102 E4                CLR     A
0103 120000      E     LCALL   ?C?FCASTL
0106 7B00              MOV     R3,#00H
0108 7A24              MOV     R2,#024H
010A 7974              MOV     R1,#074H
010C 7849              MOV     R0,#049H
010E 120000      E     LCALL   ?C?FPDIV
0111 900000      E     MOV     DPTR,#cycle_time
0114 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 379
0117 7F40              MOV     R7,#040H
0119 7E4B              MOV     R6,#04BH
011B 7D4C              MOV     R5,#04CH
011D 7C00              MOV     R4,#00H
011F 120000      E     LCALL   _MY_TIMER_WriteCounter
                                           ; SOURCE LINE # 381
0122 22                RET     
             ; FUNCTION function_scheduler (END)

             ; FUNCTION motor_control (BEGIN)
                                           ; SOURCE LINE # 387
                                           ; SOURCE LINE # 389
0000 E4                CLR     A
0001 F500        R     MOV     pwm_input+03H,A
0003 F500        R     MOV     pwm_input+02H,A
0005 F500        R     MOV     pwm_input+01H,A
0007 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 399
0009 900000      E     MOV     DPTR,#c_mem+02H
000C E0                MOVX    A,@DPTR
000D FC                MOV     R4,A
000E A3                INC     DPTR
000F E0                MOVX    A,@DPTR
0010 FD                MOV     R5,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 FE                MOV     R6,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 F500        R     MOV     k_p+03H,A
0018 8E00        R     MOV     k_p+02H,R6
001A 8D00        R     MOV     k_p+01H,R5
001C 8C00        R     MOV     k_p,R4
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 33  

                                           ; SOURCE LINE # 400
001E A3                INC     DPTR
001F E0                MOVX    A,@DPTR
0020 FC                MOV     R4,A
0021 A3                INC     DPTR
0022 E0                MOVX    A,@DPTR
0023 FD                MOV     R5,A
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 FE                MOV     R6,A
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 F500        R     MOV     k_i+03H,A
002B 8E00        R     MOV     k_i+02H,R6
002D 8D00        R     MOV     k_i+01H,R5
002F 8C00        R     MOV     k_i,R4
                                           ; SOURCE LINE # 401
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 FC                MOV     R4,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 FD                MOV     R5,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FE                MOV     R6,A
003A A3                INC     DPTR
003B E0                MOVX    A,@DPTR
003C F500        R     MOV     k_d+03H,A
003E 8E00        R     MOV     k_d+02H,R6
0040 8D00        R     MOV     k_d+01H,R5
0042 8C00        R     MOV     k_d,R4
                                           ; SOURCE LINE # 403
0044 A3                INC     DPTR
0045 E0                MOVX    A,@DPTR
0046 FC                MOV     R4,A
0047 A3                INC     DPTR
0048 E0                MOVX    A,@DPTR
0049 FD                MOV     R5,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C FE                MOV     R6,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F F500        R     MOV     k_p_c+03H,A
0051 8E00        R     MOV     k_p_c+02H,R6
0053 8D00        R     MOV     k_p_c+01H,R5
0055 8C00        R     MOV     k_p_c,R4
                                           ; SOURCE LINE # 404
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FC                MOV     R4,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
005C FD                MOV     R5,A
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F FE                MOV     R6,A
0060 A3                INC     DPTR
0061 E0                MOVX    A,@DPTR
0062 F500        R     MOV     k_i_c+03H,A
0064 8E00        R     MOV     k_i_c+02H,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 34  

0066 8D00        R     MOV     k_i_c+01H,R5
0068 8C00        R     MOV     k_i_c,R4
                                           ; SOURCE LINE # 405
006A A3                INC     DPTR
006B E0                MOVX    A,@DPTR
006C FC                MOV     R4,A
006D A3                INC     DPTR
006E E0                MOVX    A,@DPTR
006F FD                MOV     R5,A
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 FE                MOV     R6,A
0073 A3                INC     DPTR
0074 E0                MOVX    A,@DPTR
0075 F500        R     MOV     k_d_c+03H,A
0077 8E00        R     MOV     k_d_c+02H,R6
0079 8D00        R     MOV     k_d_c+01H,R5
007B 8C00        R     MOV     k_d_c,R4
                                           ; SOURCE LINE # 407
007D A3                INC     DPTR
007E E0                MOVX    A,@DPTR
007F FC                MOV     R4,A
0080 A3                INC     DPTR
0081 E0                MOVX    A,@DPTR
0082 FD                MOV     R5,A
0083 A3                INC     DPTR
0084 E0                MOVX    A,@DPTR
0085 FE                MOV     R6,A
0086 A3                INC     DPTR
0087 E0                MOVX    A,@DPTR
0088 F500        R     MOV     k_p_dl+03H,A
008A 8E00        R     MOV     k_p_dl+02H,R6
008C 8D00        R     MOV     k_p_dl+01H,R5
008E 8C00        R     MOV     k_p_dl,R4
                                           ; SOURCE LINE # 408
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FC                MOV     R4,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FD                MOV     R5,A
0096 A3                INC     DPTR
0097 E0                MOVX    A,@DPTR
0098 FE                MOV     R6,A
0099 A3                INC     DPTR
009A E0                MOVX    A,@DPTR
009B F500        R     MOV     k_i_dl+03H,A
009D 8E00        R     MOV     k_i_dl+02H,R6
009F 8D00        R     MOV     k_i_dl+01H,R5
00A1 8C00        R     MOV     k_i_dl,R4
                                           ; SOURCE LINE # 409
00A3 A3                INC     DPTR
00A4 E0                MOVX    A,@DPTR
00A5 FC                MOV     R4,A
00A6 A3                INC     DPTR
00A7 E0                MOVX    A,@DPTR
00A8 FD                MOV     R5,A
00A9 A3                INC     DPTR
00AA E0                MOVX    A,@DPTR
00AB FE                MOV     R6,A
00AC A3                INC     DPTR
00AD E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 35  

00AE F500        R     MOV     k_d_dl+03H,A
00B0 8E00        R     MOV     k_d_dl+02H,R6
00B2 8D00        R     MOV     k_d_dl+01H,R5
00B4 8C00        R     MOV     k_d_dl,R4
                                           ; SOURCE LINE # 411
00B6 A3                INC     DPTR
00B7 E0                MOVX    A,@DPTR
00B8 FC                MOV     R4,A
00B9 A3                INC     DPTR
00BA E0                MOVX    A,@DPTR
00BB FD                MOV     R5,A
00BC A3                INC     DPTR
00BD E0                MOVX    A,@DPTR
00BE FE                MOV     R6,A
00BF A3                INC     DPTR
00C0 E0                MOVX    A,@DPTR
00C1 F500        R     MOV     k_p_c_dl+03H,A
00C3 8E00        R     MOV     k_p_c_dl+02H,R6
00C5 8D00        R     MOV     k_p_c_dl+01H,R5
00C7 8C00        R     MOV     k_p_c_dl,R4
                                           ; SOURCE LINE # 412
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB FC                MOV     R4,A
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE FD                MOV     R5,A
00CF A3                INC     DPTR
00D0 E0                MOVX    A,@DPTR
00D1 FE                MOV     R6,A
00D2 A3                INC     DPTR
00D3 E0                MOVX    A,@DPTR
00D4 F500        R     MOV     k_i_c_dl+03H,A
00D6 8E00        R     MOV     k_i_c_dl+02H,R6
00D8 8D00        R     MOV     k_i_c_dl+01H,R5
00DA 8C00        R     MOV     k_i_c_dl,R4
                                           ; SOURCE LINE # 413
00DC A3                INC     DPTR
00DD E0                MOVX    A,@DPTR
00DE FC                MOV     R4,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 FD                MOV     R5,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 FE                MOV     R6,A
00E5 A3                INC     DPTR
00E6 E0                MOVX    A,@DPTR
00E7 F500        R     MOV     k_d_c_dl+03H,A
00E9 8E00        R     MOV     k_d_c_dl+02H,R6
00EB 8D00        R     MOV     k_d_c_dl+01H,R5
00ED 8C00        R     MOV     k_d_c_dl,R4
                                           ; SOURCE LINE # 430
00EF 900000      E     MOV     DPTR,#c_mem+06BH
00F2 E0                MOVX    A,@DPTR
00F3 FE                MOV     R6,A
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6 FF                MOV     R7,A
00F7 FB                MOV     R3,A
00F8 AA06              MOV     R2,AR6
00FA E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 36  

00FB 900000      E     MOV     DPTR,#g_meas+017H
00FE E0                MOVX    A,@DPTR
00FF FC                MOV     R4,A
0100 A3                INC     DPTR
0101 E0                MOVX    A,@DPTR
0102 FD                MOV     R5,A
0103 A3                INC     DPTR
0104 E0                MOVX    A,@DPTR
0105 FE                MOV     R6,A
0106 A3                INC     DPTR
0107 E0                MOVX    A,@DPTR
0108 C3                CLR     C
0109 9B                SUBB    A,R3
010A F500        R     MOV     err_emg_1+03H,A
010C EE                MOV     A,R6
010D 9A                SUBB    A,R2
010E F500        R     MOV     err_emg_1+02H,A
0110 ED                MOV     A,R5
0111 9400              SUBB    A,#00H
0113 F500        R     MOV     err_emg_1+01H,A
0115 EC                MOV     A,R4
0116 9400              SUBB    A,#00H
0118 F500        R     MOV     err_emg_1,A
                                           ; SOURCE LINE # 431
011A 900000      E     MOV     DPTR,#c_mem+06DH
011D E0                MOVX    A,@DPTR
011E FE                MOV     R6,A
011F A3                INC     DPTR
0120 E0                MOVX    A,@DPTR
0121 FF                MOV     R7,A
0122 FB                MOV     R3,A
0123 AA06              MOV     R2,AR6
0125 E4                CLR     A
0126 900000      E     MOV     DPTR,#g_meas+01BH
0129 E0                MOVX    A,@DPTR
012A FC                MOV     R4,A
012B A3                INC     DPTR
012C E0                MOVX    A,@DPTR
012D FD                MOV     R5,A
012E A3                INC     DPTR
012F E0                MOVX    A,@DPTR
0130 FE                MOV     R6,A
0131 A3                INC     DPTR
0132 E0                MOVX    A,@DPTR
0133 C3                CLR     C
0134 9B                SUBB    A,R3
0135 F500        R     MOV     err_emg_2+03H,A
0137 EE                MOV     A,R6
0138 9A                SUBB    A,R2
0139 F500        R     MOV     err_emg_2+02H,A
013B ED                MOV     A,R5
013C 9400              SUBB    A,#00H
013E F500        R     MOV     err_emg_2+01H,A
0140 EC                MOV     A,R4
0141 9400              SUBB    A,#00H
0143 F500        R     MOV     err_emg_2,A
                                           ; SOURCE LINE # 434
0145 900000      E     MOV     DPTR,#c_mem+033H
0148 E0                MOVX    A,@DPTR
0149 24FE              ADD     A,#0FEH
014B 7003              JNZ     $ + 5H
014D 020000      R     LJMP    ?C0055
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 37  

0150 14                DEC     A
0151 7003              JNZ     $ + 5H
0153 020000      R     LJMP    ?C0058
0156 14                DEC     A
0157 7003              JNZ     $ + 5H
0159 020000      R     LJMP    ?C0061
015C 14                DEC     A
015D 7003              JNZ     $ + 5H
015F 020000      R     LJMP    ?C0071
0162 2404              ADD     A,#04H
0164 6003              JZ      $ + 5H
0166 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 436
0169         ?C0040:
                                           ; SOURCE LINE # 440
0169 900000      E     MOV     DPTR,#c_mem+079H
016C E0                MOVX    A,@DPTR
016D 6024              JZ      ?C0041
                                           ; SOURCE LINE # 441
016F A3                INC     DPTR
0170 E0                MOVX    A,@DPTR
0171 FF                MOV     R7,A
0172 33                RLC     A
0173 95E0              SUBB    A,ACC
0175 FE                MOV     R6,A
0176 FD                MOV     R5,A
0177 FC                MOV     R4,A
0178 900000      E     MOV     DPTR,#g_meas+08H
017B E0                MOVX    A,@DPTR
017C F8                MOV     R0,A
017D A3                INC     DPTR
017E E0                MOVX    A,@DPTR
017F F9                MOV     R1,A
0180 A3                INC     DPTR
0181 E0                MOVX    A,@DPTR
0182 FA                MOV     R2,A
0183 A3                INC     DPTR
0184 E0                MOVX    A,@DPTR
0185 FB                MOV     R3,A
0186 120000      E     LCALL   ?C?LMUL
0189 8F00        R     MOV     handle_value+03H,R7
018B 8E00        R     MOV     handle_value+02H,R6
018D 8D00        R     MOV     handle_value+01H,R5
018F 8C00        R     MOV     handle_value,R4
0191 8024              SJMP    ?C0042
0193         ?C0041:
                                           ; SOURCE LINE # 443
0193 900000      E     MOV     DPTR,#c_mem+07AH
0196 E0                MOVX    A,@DPTR
0197 FF                MOV     R7,A
0198 33                RLC     A
0199 95E0              SUBB    A,ACC
019B FE                MOV     R6,A
019C FD                MOV     R5,A
019D FC                MOV     R4,A
019E 900000      E     MOV     DPTR,#g_meas+04H
01A1 E0                MOVX    A,@DPTR
01A2 F8                MOV     R0,A
01A3 A3                INC     DPTR
01A4 E0                MOVX    A,@DPTR
01A5 F9                MOV     R1,A
01A6 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 38  

01A7 E0                MOVX    A,@DPTR
01A8 FA                MOV     R2,A
01A9 A3                INC     DPTR
01AA E0                MOVX    A,@DPTR
01AB FB                MOV     R3,A
01AC 120000      E     LCALL   ?C?LMUL
01AF 8F00        R     MOV     handle_value+03H,R7
01B1 8E00        R     MOV     handle_value+02H,R6
01B3 8D00        R     MOV     handle_value+01H,R5
01B5 8C00        R     MOV     handle_value,R4
01B7         ?C0042:
                                           ; SOURCE LINE # 447
01B7 900000      E     MOV     DPTR,#g_ref
01BA E0                MOVX    A,@DPTR
01BB F8                MOV     R0,A
01BC A3                INC     DPTR
01BD E0                MOVX    A,@DPTR
01BE F9                MOV     R1,A
01BF A3                INC     DPTR
01C0 E0                MOVX    A,@DPTR
01C1 FA                MOV     R2,A
01C2 A3                INC     DPTR
01C3 E0                MOVX    A,@DPTR
01C4 FB                MOV     R3,A
01C5 C3                CLR     C
01C6 E500        R     MOV     A,handle_value+03H
01C8 9B                SUBB    A,R3
01C9 FF                MOV     R7,A
01CA E500        R     MOV     A,handle_value+02H
01CC 9A                SUBB    A,R2
01CD FE                MOV     R6,A
01CE E500        R     MOV     A,handle_value+01H
01D0 99                SUBB    A,R1
01D1 FD                MOV     R5,A
01D2 E500        R     MOV     A,handle_value
01D4 98                SUBB    A,R0
01D5 FC                MOV     R4,A
01D6 900000      E     MOV     DPTR,#c_mem+061H
01D9 E0                MOVX    A,@DPTR
01DA F8                MOV     R0,A
01DB A3                INC     DPTR
01DC E0                MOVX    A,@DPTR
01DD F9                MOV     R1,A
01DE A3                INC     DPTR
01DF E0                MOVX    A,@DPTR
01E0 FA                MOV     R2,A
01E1 A3                INC     DPTR
01E2 E0                MOVX    A,@DPTR
01E3 FB                MOV     R3,A
01E4 C3                CLR     C
01E5 120000      E     LCALL   ?C?SLCMP
01E8 5044              JNC     ?C0043
01EA E4                CLR     A
01EB FF                MOV     R7,A
01EC FE                MOV     R6,A
01ED FD                MOV     R5,A
01EE FC                MOV     R4,A
01EF 900000      E     MOV     DPTR,#c_mem+061H
01F2 E0                MOVX    A,@DPTR
01F3 F8                MOV     R0,A
01F4 A3                INC     DPTR
01F5 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 39  

01F6 A3                INC     DPTR
01F7 E0                MOVX    A,@DPTR
01F8 A3                INC     DPTR
01F9 E0                MOVX    A,@DPTR
01FA C3                CLR     C
01FB 120000      E     LCALL   ?C?SLCMP
01FE 602E              JZ      ?C0043
                                           ; SOURCE LINE # 448
0200 900000      E     MOV     DPTR,#g_ref
0203 E0                MOVX    A,@DPTR
0204 FC                MOV     R4,A
0205 A3                INC     DPTR
0206 E0                MOVX    A,@DPTR
0207 FD                MOV     R5,A
0208 A3                INC     DPTR
0209 E0                MOVX    A,@DPTR
020A FE                MOV     R6,A
020B A3                INC     DPTR
020C E0                MOVX    A,@DPTR
020D FF                MOV     R7,A
020E 900000      E     MOV     DPTR,#c_mem+061H
0211 E0                MOVX    A,@DPTR
0212 F8                MOV     R0,A
0213 A3                INC     DPTR
0214 E0                MOVX    A,@DPTR
0215 A3                INC     DPTR
0216 E0                MOVX    A,@DPTR
0217 A3                INC     DPTR
0218 E0                MOVX    A,@DPTR
0219 EF                MOV     A,R7
021A 2B                ADD     A,R3
021B FF                MOV     R7,A
021C EE                MOV     A,R6
021D 3A                ADDC    A,R2
021E FE                MOV     R6,A
021F ED                MOV     A,R5
0220 39                ADDC    A,R1
0221 FD                MOV     R5,A
0222 EC                MOV     A,R4
0223 38                ADDC    A,R0
0224 FC                MOV     R4,A
0225 900000      E     MOV     DPTR,#g_ref
0228 120000      E     LCALL   ?C?LSTXDATA
022B 020000      R     LJMP    ?C0044
022E         ?C0043:
                                           ; SOURCE LINE # 449
                                           ; SOURCE LINE # 450
022E 900000      E     MOV     DPTR,#g_ref
0231 E0                MOVX    A,@DPTR
0232 F8                MOV     R0,A
0233 A3                INC     DPTR
0234 E0                MOVX    A,@DPTR
0235 F9                MOV     R1,A
0236 A3                INC     DPTR
0237 E0                MOVX    A,@DPTR
0238 FA                MOV     R2,A
0239 A3                INC     DPTR
023A E0                MOVX    A,@DPTR
023B FB                MOV     R3,A
023C C3                CLR     C
023D E500        R     MOV     A,handle_value+03H
023F 9B                SUBB    A,R3
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 40  

0240 FF                MOV     R7,A
0241 E500        R     MOV     A,handle_value+02H
0243 9A                SUBB    A,R2
0244 FE                MOV     R6,A
0245 E500        R     MOV     A,handle_value+01H
0247 99                SUBB    A,R1
0248 FD                MOV     R5,A
0249 E500        R     MOV     A,handle_value
024B 98                SUBB    A,R0
024C FC                MOV     R4,A
024D 900000      E     MOV     DPTR,#c_mem+065H
0250 E0                MOVX    A,@DPTR
0251 F8                MOV     R0,A
0252 A3                INC     DPTR
0253 E0                MOVX    A,@DPTR
0254 F9                MOV     R1,A
0255 A3                INC     DPTR
0256 E0                MOVX    A,@DPTR
0257 FA                MOV     R2,A
0258 A3                INC     DPTR
0259 E0                MOVX    A,@DPTR
025A FB                MOV     R3,A
025B D3                SETB    C
025C 120000      E     LCALL   ?C?SLCMP
025F 4042              JC      ?C0045
0261 E4                CLR     A
0262 FF                MOV     R7,A
0263 FE                MOV     R6,A
0264 FD                MOV     R5,A
0265 FC                MOV     R4,A
0266 900000      E     MOV     DPTR,#c_mem+065H
0269 E0                MOVX    A,@DPTR
026A F8                MOV     R0,A
026B A3                INC     DPTR
026C E0                MOVX    A,@DPTR
026D A3                INC     DPTR
026E E0                MOVX    A,@DPTR
026F A3                INC     DPTR
0270 E0                MOVX    A,@DPTR
0271 120000      E     LCALL   ?C?SLCMP
0274 602D              JZ      ?C0045
                                           ; SOURCE LINE # 451
0276 900000      E     MOV     DPTR,#g_ref
0279 E0                MOVX    A,@DPTR
027A FC                MOV     R4,A
027B A3                INC     DPTR
027C E0                MOVX    A,@DPTR
027D FD                MOV     R5,A
027E A3                INC     DPTR
027F E0                MOVX    A,@DPTR
0280 FE                MOV     R6,A
0281 A3                INC     DPTR
0282 E0                MOVX    A,@DPTR
0283 FF                MOV     R7,A
0284 900000      E     MOV     DPTR,#c_mem+065H
0287 E0                MOVX    A,@DPTR
0288 F8                MOV     R0,A
0289 A3                INC     DPTR
028A E0                MOVX    A,@DPTR
028B A3                INC     DPTR
028C E0                MOVX    A,@DPTR
028D A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 41  

028E E0                MOVX    A,@DPTR
028F EF                MOV     A,R7
0290 2B                ADD     A,R3
0291 FF                MOV     R7,A
0292 EE                MOV     A,R6
0293 3A                ADDC    A,R2
0294 FE                MOV     R6,A
0295 ED                MOV     A,R5
0296 39                ADDC    A,R1
0297 FD                MOV     R5,A
0298 EC                MOV     A,R4
0299 38                ADDC    A,R0
029A FC                MOV     R4,A
029B 900000      E     MOV     DPTR,#g_ref
029E 120000      E     LCALL   ?C?LSTXDATA
02A1 800E              SJMP    ?C0044
02A3         ?C0045:
                                           ; SOURCE LINE # 453
02A3 AF00        R     MOV     R7,handle_value+03H
02A5 AE00        R     MOV     R6,handle_value+02H
02A7 AD00        R     MOV     R5,handle_value+01H
02A9 AC00        R     MOV     R4,handle_value
02AB 900000      E     MOV     DPTR,#g_ref
02AE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 454
02B1         ?C0044:
                                           ; SOURCE LINE # 456
02B1 900000      E     MOV     DPTR,#normally_closed_mode
02B4 E0                MOVX    A,@DPTR
02B5 B4012D            CJNE    A,#01H,?C0047
                                           ; SOURCE LINE # 457
02B8 900000      E     MOV     DPTR,#g_ref
02BB E0                MOVX    A,@DPTR
02BC F8                MOV     R0,A
02BD A3                INC     DPTR
02BE E0                MOVX    A,@DPTR
02BF F9                MOV     R1,A
02C0 A3                INC     DPTR
02C1 E0                MOVX    A,@DPTR
02C2 FA                MOV     R2,A
02C3 A3                INC     DPTR
02C4 E0                MOVX    A,@DPTR
02C5 FB                MOV     R3,A
02C6 900000      E     MOV     DPTR,#g_mem+059H
02C9 E0                MOVX    A,@DPTR
02CA FC                MOV     R4,A
02CB A3                INC     DPTR
02CC E0                MOVX    A,@DPTR
02CD FD                MOV     R5,A
02CE A3                INC     DPTR
02CF E0                MOVX    A,@DPTR
02D0 FE                MOV     R6,A
02D1 A3                INC     DPTR
02D2 E0                MOVX    A,@DPTR
02D3 C3                CLR     C
02D4 9B                SUBB    A,R3
02D5 FF                MOV     R7,A
02D6 EE                MOV     A,R6
02D7 9A                SUBB    A,R2
02D8 FE                MOV     R6,A
02D9 ED                MOV     A,R5
02DA 99                SUBB    A,R1
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 42  

02DB FD                MOV     R5,A
02DC EC                MOV     A,R4
02DD 98                SUBB    A,R0
02DE FC                MOV     R4,A
02DF 900000      E     MOV     DPTR,#g_ref
02E2 120000      E     LCALL   ?C?LSTXDATA
02E5         ?C0047:
                                           ; SOURCE LINE # 460
02E5 E500        E     MOV     A,h_status
02E7 6401              XRL     A,#01H
02E9 6003              JZ      $ + 5H
02EB 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 461
02EE 900000      E     MOV     DPTR,#c_mem+09AH
02F1 E0                MOVX    A,@DPTR
02F2 7030              JNZ     ?C0049
                                           ; SOURCE LINE # 462
02F4 900000      E     MOV     DPTR,#normally_closed_mode
02F7 E0                MOVX    A,@DPTR
02F8 7016              JNZ     ?C0050
                                           ; SOURCE LINE # 463
02FA 900000      E     MOV     DPTR,#c_mem+059H
02FD E0                MOVX    A,@DPTR
02FE FC                MOV     R4,A
02FF A3                INC     DPTR
0300 E0                MOVX    A,@DPTR
0301 FD                MOV     R5,A
0302 A3                INC     DPTR
0303 E0                MOVX    A,@DPTR
0304 FE                MOV     R6,A
0305 A3                INC     DPTR
0306 E0                MOVX    A,@DPTR
0307 FF                MOV     R7,A
0308 900000      E     MOV     DPTR,#g_ref
030B 120000      E     LCALL   ?C?LSTXDATA
030E 8014              SJMP    ?C0049
0310         ?C0050:
                                           ; SOURCE LINE # 465
0310 900000      E     MOV     DPTR,#c_mem+051H
0313 E0                MOVX    A,@DPTR
0314 FC                MOV     R4,A
0315 A3                INC     DPTR
0316 E0                MOVX    A,@DPTR
0317 FD                MOV     R5,A
0318 A3                INC     DPTR
0319 E0                MOVX    A,@DPTR
031A FE                MOV     R6,A
031B A3                INC     DPTR
031C E0                MOVX    A,@DPTR
031D FF                MOV     R7,A
031E 900000      E     MOV     DPTR,#g_ref
0321 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 466
0324         ?C0049:
                                           ; SOURCE LINE # 468
0324 900000      E     MOV     DPTR,#c_mem+09AH
0327 E0                MOVX    A,@DPTR
0328 6401              XRL     A,#01H
032A 6003              JZ      $ + 5H
032C 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 469
032F 900000      E     MOV     DPTR,#normally_closed_mode
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 43  

0332 E0                MOVX    A,@DPTR
0333 7017              JNZ     ?C0053
                                           ; SOURCE LINE # 470
0335 900000      E     MOV     DPTR,#c_mem+051H
0338 E0                MOVX    A,@DPTR
0339 FC                MOV     R4,A
033A A3                INC     DPTR
033B E0                MOVX    A,@DPTR
033C FD                MOV     R5,A
033D A3                INC     DPTR
033E E0                MOVX    A,@DPTR
033F FE                MOV     R6,A
0340 A3                INC     DPTR
0341 E0                MOVX    A,@DPTR
0342 FF                MOV     R7,A
0343 900000      E     MOV     DPTR,#g_ref
0346 120000      E     LCALL   ?C?LSTXDATA
0349 020000      R     LJMP    ?C0039
034C         ?C0053:
                                           ; SOURCE LINE # 472
034C 900000      E     MOV     DPTR,#c_mem+059H
034F E0                MOVX    A,@DPTR
0350 FC                MOV     R4,A
0351 A3                INC     DPTR
0352 E0                MOVX    A,@DPTR
0353 FD                MOV     R5,A
0354 A3                INC     DPTR
0355 E0                MOVX    A,@DPTR
0356 FE                MOV     R6,A
0357 A3                INC     DPTR
0358 E0                MOVX    A,@DPTR
0359 FF                MOV     R7,A
035A 900000      E     MOV     DPTR,#g_ref
035D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 473
                                           ; SOURCE LINE # 475
                                           ; SOURCE LINE # 477
0360 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 479
0363         ?C0055:
                                           ; SOURCE LINE # 480
0363 E4                CLR     A
0364 FF                MOV     R7,A
0365 FE                MOV     R6,A
0366 FD                MOV     R5,A
0367 FC                MOV     R4,A
0368 AB00        R     MOV     R3,err_emg_1+03H
036A AA00        R     MOV     R2,err_emg_1+02H
036C A900        R     MOV     R1,err_emg_1+01H
036E A800        R     MOV     R0,err_emg_1
0370 D3                SETB    C
0371 120000      E     LCALL   ?C?SLCMP
0374 403D              JC      ?C0056
                                           ; SOURCE LINE # 481
0376 900000      E     MOV     DPTR,#g_mem+059H
0379 E0                MOVX    A,@DPTR
037A FC                MOV     R4,A
037B A3                INC     DPTR
037C E0                MOVX    A,@DPTR
037D FD                MOV     R5,A
037E A3                INC     DPTR
037F E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 44  

0380 FE                MOV     R6,A
0381 A3                INC     DPTR
0382 E0                MOVX    A,@DPTR
0383 FF                MOV     R7,A
0384 A800        R     MOV     R0,err_emg_1
0386 120000      E     LCALL   ?C?LMUL
0389 C006              PUSH    AR6
038B C007              PUSH    AR7
038D 900000      E     MOV     DPTR,#c_mem+06BH
0390 E0                MOVX    A,@DPTR
0391 FE                MOV     R6,A
0392 A3                INC     DPTR
0393 E0                MOVX    A,@DPTR
0394 FF                MOV     R7,A
0395 C3                CLR     C
0396 E4                CLR     A
0397 9F                SUBB    A,R7
0398 FF                MOV     R7,A
0399 7404              MOV     A,#04H
039B 9E                SUBB    A,R6
039C FE                MOV     R6,A
039D AB07              MOV     R3,AR7
039F FA                MOV     R2,A
03A0 E4                CLR     A
03A1 F9                MOV     R1,A
03A2 F8                MOV     R0,A
03A3 D007              POP     AR7
03A5 D006              POP     AR6
03A7 120000      E     LCALL   ?C?SLDIV
03AA 900000      E     MOV     DPTR,#g_ref
03AD 120000      E     LCALL   ?C?LSTXDATA
03B0 020000      R     LJMP    ?C0039
03B3         ?C0056:
                                           ; SOURCE LINE # 483
03B3 E4                CLR     A
03B4 FF                MOV     R7,A
03B5 FE                MOV     R6,A
03B6 FD                MOV     R5,A
03B7 FC                MOV     R4,A
03B8 900000      E     MOV     DPTR,#g_ref
03BB 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 484
03BE 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 486
03C1         ?C0058:
                                           ; SOURCE LINE # 487
03C1 900000      E     MOV     DPTR,#g_refOld
03C4 E0                MOVX    A,@DPTR
03C5 FC                MOV     R4,A
03C6 A3                INC     DPTR
03C7 E0                MOVX    A,@DPTR
03C8 FD                MOV     R5,A
03C9 A3                INC     DPTR
03CA E0                MOVX    A,@DPTR
03CB FE                MOV     R6,A
03CC A3                INC     DPTR
03CD E0                MOVX    A,@DPTR
03CE FF                MOV     R7,A
03CF 900000      E     MOV     DPTR,#g_ref
03D2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 488
03D5 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 45  

03D6 FF                MOV     R7,A
03D7 FE                MOV     R6,A
03D8 FD                MOV     R5,A
03D9 FC                MOV     R4,A
03DA AB00        R     MOV     R3,err_emg_1+03H
03DC AA00        R     MOV     R2,err_emg_1+02H
03DE A900        R     MOV     R1,err_emg_1+01H
03E0 A800        R     MOV     R0,err_emg_1
03E2 D3                SETB    C
03E3 120000      E     LCALL   ?C?SLCMP
03E6 4056              JC      ?C0059
                                           ; SOURCE LINE # 489
03E8 900000      E     MOV     DPTR,#g_mem+078H
03EB E0                MOVX    A,@DPTR
03EC FF                MOV     R7,A
03ED E4                CLR     A
03EE FC                MOV     R4,A
03EF FD                MOV     R5,A
03F0 FE                MOV     R6,A
03F1 A800        R     MOV     R0,err_emg_1
03F3 120000      E     LCALL   ?C?LMUL
03F6 E4                CLR     A
03F7 7B02              MOV     R3,#02H
03F9 FA                MOV     R2,A
03FA F9                MOV     R1,A
03FB F8                MOV     R0,A
03FC 120000      E     LCALL   ?C?LMUL
03FF C006              PUSH    AR6
0401 C007              PUSH    AR7
0403 900000      E     MOV     DPTR,#c_mem+06BH
0406 E0                MOVX    A,@DPTR
0407 FE                MOV     R6,A
0408 A3                INC     DPTR
0409 E0                MOVX    A,@DPTR
040A FF                MOV     R7,A
040B C3                CLR     C
040C E4                CLR     A
040D 9F                SUBB    A,R7
040E FF                MOV     R7,A
040F 7404              MOV     A,#04H
0411 9E                SUBB    A,R6
0412 FE                MOV     R6,A
0413 AB07              MOV     R3,AR7
0415 FA                MOV     R2,A
0416 E4                CLR     A
0417 F9                MOV     R1,A
0418 F8                MOV     R0,A
0419 D007              POP     AR7
041B D006              POP     AR6
041D 120000      E     LCALL   ?C?SLDIV
0420 900000      E     MOV     DPTR,#g_refOld
0423 E0                MOVX    A,@DPTR
0424 F8                MOV     R0,A
0425 A3                INC     DPTR
0426 E0                MOVX    A,@DPTR
0427 F9                MOV     R1,A
0428 A3                INC     DPTR
0429 E0                MOVX    A,@DPTR
042A FA                MOV     R2,A
042B A3                INC     DPTR
042C E0                MOVX    A,@DPTR
042D 2F                ADD     A,R7
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 46  

042E FF                MOV     R7,A
042F EA                MOV     A,R2
0430 3E                ADDC    A,R6
0431 FE                MOV     R6,A
0432 E9                MOV     A,R1
0433 3D                ADDC    A,R5
0434 FD                MOV     R5,A
0435 E8                MOV     A,R0
0436 3C                ADDC    A,R4
0437 FC                MOV     R4,A
0438 900000      E     MOV     DPTR,#g_ref
043B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 490
043E         ?C0059:
                                           ; SOURCE LINE # 491
043E E4                CLR     A
043F FF                MOV     R7,A
0440 FE                MOV     R6,A
0441 FD                MOV     R5,A
0442 FC                MOV     R4,A
0443 AB00        R     MOV     R3,err_emg_2+03H
0445 AA00        R     MOV     R2,err_emg_2+02H
0447 A900        R     MOV     R1,err_emg_2+01H
0449 A800        R     MOV     R0,err_emg_2
044B D3                SETB    C
044C 120000      E     LCALL   ?C?SLCMP
044F 5003              JNC     $ + 5H
0451 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 492
0454 900000      E     MOV     DPTR,#g_mem+078H
0457 E0                MOVX    A,@DPTR
0458 FF                MOV     R7,A
0459 E4                CLR     A
045A FC                MOV     R4,A
045B FD                MOV     R5,A
045C FE                MOV     R6,A
045D A800        R     MOV     R0,err_emg_2
045F 120000      E     LCALL   ?C?LMUL
0462 E4                CLR     A
0463 7B02              MOV     R3,#02H
0465 FA                MOV     R2,A
0466 F9                MOV     R1,A
0467 F8                MOV     R0,A
0468 120000      E     LCALL   ?C?LMUL
046B C006              PUSH    AR6
046D C007              PUSH    AR7
046F 900000      E     MOV     DPTR,#c_mem+06DH
0472 E0                MOVX    A,@DPTR
0473 FE                MOV     R6,A
0474 A3                INC     DPTR
0475 E0                MOVX    A,@DPTR
0476 FF                MOV     R7,A
0477 C3                CLR     C
0478 E4                CLR     A
0479 9F                SUBB    A,R7
047A FF                MOV     R7,A
047B 7404              MOV     A,#04H
047D 9E                SUBB    A,R6
047E FE                MOV     R6,A
047F AB07              MOV     R3,AR7
0481 FA                MOV     R2,A
0482 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 47  

0483 F9                MOV     R1,A
0484 F8                MOV     R0,A
0485 D007              POP     AR7
0487 D006              POP     AR6
0489 120000      E     LCALL   ?C?SLDIV
048C A804              MOV     R0,AR4
048E A905              MOV     R1,AR5
0490 AA06              MOV     R2,AR6
0492 AB07              MOV     R3,AR7
0494 900000      E     MOV     DPTR,#g_refOld
0497 E0                MOVX    A,@DPTR
0498 FC                MOV     R4,A
0499 A3                INC     DPTR
049A E0                MOVX    A,@DPTR
049B FD                MOV     R5,A
049C A3                INC     DPTR
049D E0                MOVX    A,@DPTR
049E FE                MOV     R6,A
049F A3                INC     DPTR
04A0 E0                MOVX    A,@DPTR
04A1 C3                CLR     C
04A2 9B                SUBB    A,R3
04A3 FF                MOV     R7,A
04A4 EE                MOV     A,R6
04A5 9A                SUBB    A,R2
04A6 FE                MOV     R6,A
04A7 ED                MOV     A,R5
04A8 99                SUBB    A,R1
04A9 FD                MOV     R5,A
04AA EC                MOV     A,R4
04AB 98                SUBB    A,R0
04AC FC                MOV     R4,A
04AD 900000      E     MOV     DPTR,#g_ref
04B0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 493
                                           ; SOURCE LINE # 494
04B3 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 496
04B6         ?C0061:
                                           ; SOURCE LINE # 497
04B6 900000      E     MOV     DPTR,#g_refOld
04B9 E0                MOVX    A,@DPTR
04BA FC                MOV     R4,A
04BB A3                INC     DPTR
04BC E0                MOVX    A,@DPTR
04BD FD                MOV     R5,A
04BE A3                INC     DPTR
04BF E0                MOVX    A,@DPTR
04C0 FE                MOV     R6,A
04C1 A3                INC     DPTR
04C2 E0                MOVX    A,@DPTR
04C3 FF                MOV     R7,A
04C4 900000      E     MOV     DPTR,#g_ref
04C7 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 498
04CA 900000      R     MOV     DPTR,#current_emg
04CD E0                MOVX    A,@DPTR
04CE 14                DEC     A
04CF 6048              JZ      ?C0066
04D1 14                DEC     A
04D2 7003              JNZ     $ + 5H
04D4 020000      R     LJMP    ?C0068
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 48  

04D7 2402              ADD     A,#02H
04D9 6003              JZ      $ + 5H
04DB 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 499
04DE         ?C0063:
                                           ; SOURCE LINE # 501
04DE E4                CLR     A
04DF FF                MOV     R7,A
04E0 FE                MOV     R6,A
04E1 FD                MOV     R5,A
04E2 FC                MOV     R4,A
04E3 AB00        R     MOV     R3,err_emg_1+03H
04E5 AA00        R     MOV     R2,err_emg_1+02H
04E7 A900        R     MOV     R1,err_emg_1+01H
04E9 A800        R     MOV     R0,err_emg_1
04EB D3                SETB    C
04EC 120000      E     LCALL   ?C?SLCMP
04EF 4009              JC      ?C0064
                                           ; SOURCE LINE # 502
04F1 900000      R     MOV     DPTR,#current_emg
04F4 7401              MOV     A,#01H
04F6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 503
04F7 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 504
04FA         ?C0064:
                                           ; SOURCE LINE # 505
04FA E4                CLR     A
04FB FF                MOV     R7,A
04FC FE                MOV     R6,A
04FD FD                MOV     R5,A
04FE FC                MOV     R4,A
04FF AB00        R     MOV     R3,err_emg_2+03H
0501 AA00        R     MOV     R2,err_emg_2+02H
0503 A900        R     MOV     R1,err_emg_2+01H
0505 A800        R     MOV     R0,err_emg_2
0507 D3                SETB    C
0508 120000      E     LCALL   ?C?SLCMP
050B 5003              JNC     $ + 5H
050D 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 506
0510 900000      R     MOV     DPTR,#current_emg
0513 7402              MOV     A,#02H
0515 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 507
0516 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 508
                                           ; SOURCE LINE # 509
                                           ; SOURCE LINE # 511
0519         ?C0066:
                                           ; SOURCE LINE # 513
0519 E4                CLR     A
051A FF                MOV     R7,A
051B FE                MOV     R6,A
051C FD                MOV     R5,A
051D FC                MOV     R4,A
051E AB00        R     MOV     R3,err_emg_1+03H
0520 AA00        R     MOV     R2,err_emg_1+02H
0522 A900        R     MOV     R1,err_emg_1+01H
0524 A800        R     MOV     R0,err_emg_1
0526 C3                CLR     C
0527 120000      E     LCALL   ?C?SLCMP
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 49  

052A 5008              JNC     ?C0067
                                           ; SOURCE LINE # 514
052C E4                CLR     A
052D 900000      R     MOV     DPTR,#current_emg
0530 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 515
0531 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 516
0534         ?C0067:
                                           ; SOURCE LINE # 517
0534 900000      E     MOV     DPTR,#g_mem+078H
0537 E0                MOVX    A,@DPTR
0538 FF                MOV     R7,A
0539 E4                CLR     A
053A FC                MOV     R4,A
053B FD                MOV     R5,A
053C FE                MOV     R6,A
053D AB00        R     MOV     R3,err_emg_1+03H
053F AA00        R     MOV     R2,err_emg_1+02H
0541 A900        R     MOV     R1,err_emg_1+01H
0543 A800        R     MOV     R0,err_emg_1
0545 120000      E     LCALL   ?C?LMUL
0548 E4                CLR     A
0549 7B02              MOV     R3,#02H
054B FA                MOV     R2,A
054C F9                MOV     R1,A
054D F8                MOV     R0,A
054E 120000      E     LCALL   ?C?LMUL
0551 C006              PUSH    AR6
0553 C007              PUSH    AR7
0555 900000      E     MOV     DPTR,#c_mem+06BH
0558 E0                MOVX    A,@DPTR
0559 FE                MOV     R6,A
055A A3                INC     DPTR
055B E0                MOVX    A,@DPTR
055C FF                MOV     R7,A
055D C3                CLR     C
055E E4                CLR     A
055F 9F                SUBB    A,R7
0560 FF                MOV     R7,A
0561 7404              MOV     A,#04H
0563 9E                SUBB    A,R6
0564 FE                MOV     R6,A
0565 AB07              MOV     R3,AR7
0567 FA                MOV     R2,A
0568 E4                CLR     A
0569 F9                MOV     R1,A
056A F8                MOV     R0,A
056B D007              POP     AR7
056D D006              POP     AR6
056F 120000      E     LCALL   ?C?SLDIV
0572 900000      E     MOV     DPTR,#g_refOld
0575 E0                MOVX    A,@DPTR
0576 F8                MOV     R0,A
0577 A3                INC     DPTR
0578 E0                MOVX    A,@DPTR
0579 F9                MOV     R1,A
057A A3                INC     DPTR
057B E0                MOVX    A,@DPTR
057C FA                MOV     R2,A
057D A3                INC     DPTR
057E E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 50  

057F 2F                ADD     A,R7
0580 FF                MOV     R7,A
0581 EA                MOV     A,R2
0582 3E                ADDC    A,R6
0583 FE                MOV     R6,A
0584 E9                MOV     A,R1
0585 3D                ADDC    A,R5
0586 FD                MOV     R5,A
0587 E8                MOV     A,R0
0588 3C                ADDC    A,R4
0589 FC                MOV     R4,A
058A 900000      E     MOV     DPTR,#g_ref
058D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 518
0590 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 520
0593         ?C0068:
                                           ; SOURCE LINE # 522
0593 E4                CLR     A
0594 FF                MOV     R7,A
0595 FE                MOV     R6,A
0596 FD                MOV     R5,A
0597 FC                MOV     R4,A
0598 AB00        R     MOV     R3,err_emg_2+03H
059A AA00        R     MOV     R2,err_emg_2+02H
059C A900        R     MOV     R1,err_emg_2+01H
059E A800        R     MOV     R0,err_emg_2
05A0 C3                CLR     C
05A1 120000      E     LCALL   ?C?SLCMP
05A4 5008              JNC     ?C0069
                                           ; SOURCE LINE # 523
05A6 E4                CLR     A
05A7 900000      R     MOV     DPTR,#current_emg
05AA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 524
05AB 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 525
05AE         ?C0069:
                                           ; SOURCE LINE # 526
05AE 900000      E     MOV     DPTR,#g_mem+078H
05B1 E0                MOVX    A,@DPTR
05B2 FF                MOV     R7,A
05B3 E4                CLR     A
05B4 FC                MOV     R4,A
05B5 FD                MOV     R5,A
05B6 FE                MOV     R6,A
05B7 AB00        R     MOV     R3,err_emg_2+03H
05B9 AA00        R     MOV     R2,err_emg_2+02H
05BB A900        R     MOV     R1,err_emg_2+01H
05BD A800        R     MOV     R0,err_emg_2
05BF 120000      E     LCALL   ?C?LMUL
05C2 E4                CLR     A
05C3 7B02              MOV     R3,#02H
05C5 FA                MOV     R2,A
05C6 F9                MOV     R1,A
05C7 F8                MOV     R0,A
05C8 120000      E     LCALL   ?C?LMUL
05CB C006              PUSH    AR6
05CD C007              PUSH    AR7
05CF 900000      E     MOV     DPTR,#c_mem+06DH
05D2 E0                MOVX    A,@DPTR
05D3 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 51  

05D4 A3                INC     DPTR
05D5 E0                MOVX    A,@DPTR
05D6 FF                MOV     R7,A
05D7 C3                CLR     C
05D8 E4                CLR     A
05D9 9F                SUBB    A,R7
05DA FF                MOV     R7,A
05DB 7404              MOV     A,#04H
05DD 9E                SUBB    A,R6
05DE FE                MOV     R6,A
05DF AB07              MOV     R3,AR7
05E1 FA                MOV     R2,A
05E2 E4                CLR     A
05E3 F9                MOV     R1,A
05E4 F8                MOV     R0,A
05E5 D007              POP     AR7
05E7 D006              POP     AR6
05E9 120000      E     LCALL   ?C?SLDIV
05EC A804              MOV     R0,AR4
05EE A905              MOV     R1,AR5
05F0 AA06              MOV     R2,AR6
05F2 AB07              MOV     R3,AR7
05F4 900000      E     MOV     DPTR,#g_refOld
05F7 E0                MOVX    A,@DPTR
05F8 FC                MOV     R4,A
05F9 A3                INC     DPTR
05FA E0                MOVX    A,@DPTR
05FB FD                MOV     R5,A
05FC A3                INC     DPTR
05FD E0                MOVX    A,@DPTR
05FE FE                MOV     R6,A
05FF A3                INC     DPTR
0600 E0                MOVX    A,@DPTR
0601 C3                CLR     C
0602 9B                SUBB    A,R3
0603 FF                MOV     R7,A
0604 EE                MOV     A,R6
0605 9A                SUBB    A,R2
0606 FE                MOV     R6,A
0607 ED                MOV     A,R5
0608 99                SUBB    A,R1
0609 FD                MOV     R5,A
060A EC                MOV     A,R4
060B 98                SUBB    A,R0
060C FC                MOV     R4,A
060D 900000      E     MOV     DPTR,#g_ref
0610 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 527
0613 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 529
                                           ; SOURCE LINE # 530
                                           ; SOURCE LINE # 531
                                           ; SOURCE LINE # 533
0616 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 535
0619         ?C0071:
                                           ; SOURCE LINE # 536
0619 900000      E     MOV     DPTR,#g_refOld
061C E0                MOVX    A,@DPTR
061D FC                MOV     R4,A
061E A3                INC     DPTR
061F E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 52  

0620 FD                MOV     R5,A
0621 A3                INC     DPTR
0622 E0                MOVX    A,@DPTR
0623 FE                MOV     R6,A
0624 A3                INC     DPTR
0625 E0                MOVX    A,@DPTR
0626 FF                MOV     R7,A
0627 900000      E     MOV     DPTR,#g_ref
062A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 537
062D 900000      R     MOV     DPTR,#current_emg
0630 E0                MOVX    A,@DPTR
0631 14                DEC     A
0632 6048              JZ      ?C0076
0634 14                DEC     A
0635 7003              JNZ     $ + 5H
0637 020000      R     LJMP    ?C0079
063A 2402              ADD     A,#02H
063C 6003              JZ      $ + 5H
063E 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 539
0641         ?C0073:
                                           ; SOURCE LINE # 540
0641 E4                CLR     A
0642 FF                MOV     R7,A
0643 FE                MOV     R6,A
0644 FD                MOV     R5,A
0645 FC                MOV     R4,A
0646 AB00        R     MOV     R3,err_emg_1+03H
0648 AA00        R     MOV     R2,err_emg_1+02H
064A A900        R     MOV     R1,err_emg_1+01H
064C A800        R     MOV     R0,err_emg_1
064E D3                SETB    C
064F 120000      E     LCALL   ?C?SLCMP
0652 4009              JC      ?C0074
                                           ; SOURCE LINE # 541
0654 900000      R     MOV     DPTR,#current_emg
0657 7401              MOV     A,#01H
0659 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 542
065A 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 543
065D         ?C0074:
                                           ; SOURCE LINE # 544
065D E4                CLR     A
065E FF                MOV     R7,A
065F FE                MOV     R6,A
0660 FD                MOV     R5,A
0661 FC                MOV     R4,A
0662 AB00        R     MOV     R3,err_emg_2+03H
0664 AA00        R     MOV     R2,err_emg_2+02H
0666 A900        R     MOV     R1,err_emg_2+01H
0668 A800        R     MOV     R0,err_emg_2
066A D3                SETB    C
066B 120000      E     LCALL   ?C?SLCMP
066E 5003              JNC     $ + 5H
0670 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 545
0673 900000      R     MOV     DPTR,#current_emg
0676 7402              MOV     A,#02H
0678 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 546
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 53  

0679 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 547
                                           ; SOURCE LINE # 548
                                           ; SOURCE LINE # 551
067C         ?C0076:
                                           ; SOURCE LINE # 553
067C E4                CLR     A
067D FF                MOV     R7,A
067E FE                MOV     R6,A
067F FD                MOV     R5,A
0680 FC                MOV     R4,A
0681 AB00        R     MOV     R3,err_emg_1+03H
0683 AA00        R     MOV     R2,err_emg_1+02H
0685 A900        R     MOV     R1,err_emg_1+01H
0687 A800        R     MOV     R0,err_emg_1
0689 C3                CLR     C
068A 120000      E     LCALL   ?C?SLCMP
068D 501B              JNC     ?C0077
068F E4                CLR     A
0690 FF                MOV     R7,A
0691 FE                MOV     R6,A
0692 FD                MOV     R5,A
0693 FC                MOV     R4,A
0694 AB00        R     MOV     R3,err_emg_2+03H
0696 AA00        R     MOV     R2,err_emg_2+02H
0698 A900        R     MOV     R1,err_emg_2+01H
069A A800        R     MOV     R0,err_emg_2
069C C3                CLR     C
069D 120000      E     LCALL   ?C?SLCMP
06A0 5008              JNC     ?C0077
                                           ; SOURCE LINE # 554
06A2 E4                CLR     A
06A3 900000      R     MOV     DPTR,#current_emg
06A6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 555
06A7 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 556
06AA         ?C0077:
                                           ; SOURCE LINE # 558
06AA E4                CLR     A
06AB FF                MOV     R7,A
06AC FE                MOV     R6,A
06AD FD                MOV     R5,A
06AE FC                MOV     R4,A
06AF AB00        R     MOV     R3,err_emg_1+03H
06B1 AA00        R     MOV     R2,err_emg_1+02H
06B3 A900        R     MOV     R1,err_emg_1+01H
06B5 A800        R     MOV     R0,err_emg_1
06B7 D3                SETB    C
06B8 120000      E     LCALL   ?C?SLCMP
06BB 5003              JNC     $ + 5H
06BD 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 559
06C0 900000      E     MOV     DPTR,#g_mem+078H
06C3 E0                MOVX    A,@DPTR
06C4 FF                MOV     R7,A
06C5 E4                CLR     A
06C6 FC                MOV     R4,A
06C7 FD                MOV     R5,A
06C8 FE                MOV     R6,A
06C9 A800        R     MOV     R0,err_emg_1
06CB 120000      E     LCALL   ?C?LMUL
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 54  

06CE 7802              MOV     R0,#02H
06D0 120000      E     LCALL   ?C?LSHL
06D3 C006              PUSH    AR6
06D5 C007              PUSH    AR7
06D7 900000      E     MOV     DPTR,#c_mem+06BH
06DA E0                MOVX    A,@DPTR
06DB FE                MOV     R6,A
06DC A3                INC     DPTR
06DD E0                MOVX    A,@DPTR
06DE FF                MOV     R7,A
06DF C3                CLR     C
06E0 E4                CLR     A
06E1 9F                SUBB    A,R7
06E2 FF                MOV     R7,A
06E3 7404              MOV     A,#04H
06E5 9E                SUBB    A,R6
06E6 FE                MOV     R6,A
06E7 AB07              MOV     R3,AR7
06E9 FA                MOV     R2,A
06EA E4                CLR     A
06EB F9                MOV     R1,A
06EC F8                MOV     R0,A
06ED D007              POP     AR7
06EF D006              POP     AR6
06F1 120000      E     LCALL   ?C?SLDIV
06F4 900000      E     MOV     DPTR,#g_refOld
06F7 E0                MOVX    A,@DPTR
06F8 F8                MOV     R0,A
06F9 A3                INC     DPTR
06FA E0                MOVX    A,@DPTR
06FB F9                MOV     R1,A
06FC A3                INC     DPTR
06FD E0                MOVX    A,@DPTR
06FE FA                MOV     R2,A
06FF A3                INC     DPTR
0700 E0                MOVX    A,@DPTR
0701 2F                ADD     A,R7
0702 FF                MOV     R7,A
0703 EA                MOV     A,R2
0704 3E                ADDC    A,R6
0705 FE                MOV     R6,A
0706 E9                MOV     A,R1
0707 3D                ADDC    A,R5
0708 FD                MOV     R5,A
0709 E8                MOV     A,R0
070A 3C                ADDC    A,R4
070B FC                MOV     R4,A
070C 900000      E     MOV     DPTR,#g_ref
070F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 561
0712 020000      R     LJMP    ?C0039
                                           ; SOURCE LINE # 564
0715         ?C0079:
                                           ; SOURCE LINE # 566
0715 E4                CLR     A
0716 FF                MOV     R7,A
0717 FE                MOV     R6,A
0718 FD                MOV     R5,A
0719 FC                MOV     R4,A
071A AB00        R     MOV     R3,err_emg_1+03H
071C AA00        R     MOV     R2,err_emg_1+02H
071E A900        R     MOV     R1,err_emg_1+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 55  

0720 A800        R     MOV     R0,err_emg_1
0722 C3                CLR     C
0723 120000      E     LCALL   ?C?SLCMP
0726 501A              JNC     ?C0080
0728 E4                CLR     A
0729 FF                MOV     R7,A
072A FE                MOV     R6,A
072B FD                MOV     R5,A
072C FC                MOV     R4,A
072D AB00        R     MOV     R3,err_emg_2+03H
072F AA00        R     MOV     R2,err_emg_2+02H
0731 A900        R     MOV     R1,err_emg_2+01H
0733 A800        R     MOV     R0,err_emg_2
0735 C3                CLR     C
0736 120000      E     LCALL   ?C?SLCMP
0739 5007              JNC     ?C0080
                                           ; SOURCE LINE # 567
073B E4                CLR     A
073C 900000      R     MOV     DPTR,#current_emg
073F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 568
0740 806E              SJMP    ?C0039
                                           ; SOURCE LINE # 569
0742         ?C0080:
                                           ; SOURCE LINE # 571
0742 E4                CLR     A
0743 FF                MOV     R7,A
0744 FE                MOV     R6,A
0745 FD                MOV     R5,A
0746 FC                MOV     R4,A
0747 AB00        R     MOV     R3,err_emg_2+03H
0749 AA00        R     MOV     R2,err_emg_2+02H
074B A900        R     MOV     R1,err_emg_2+01H
074D A800        R     MOV     R0,err_emg_2
074F D3                SETB    C
0750 120000      E     LCALL   ?C?SLCMP
0753 405B              JC      ?C0039
                                           ; SOURCE LINE # 572
0755 900000      E     MOV     DPTR,#c_mem+078H
0758 E0                MOVX    A,@DPTR
0759 FF                MOV     R7,A
075A E4                CLR     A
075B FC                MOV     R4,A
075C FD                MOV     R5,A
075D FE                MOV     R6,A
075E A800        R     MOV     R0,err_emg_2
0760 120000      E     LCALL   ?C?LMUL
0763 7802              MOV     R0,#02H
0765 120000      E     LCALL   ?C?LSHL
0768 C006              PUSH    AR6
076A C007              PUSH    AR7
076C 900000      E     MOV     DPTR,#c_mem+06DH
076F E0                MOVX    A,@DPTR
0770 FE                MOV     R6,A
0771 A3                INC     DPTR
0772 E0                MOVX    A,@DPTR
0773 FF                MOV     R7,A
0774 C3                CLR     C
0775 E4                CLR     A
0776 9F                SUBB    A,R7
0777 FF                MOV     R7,A
0778 7404              MOV     A,#04H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 56  

077A 9E                SUBB    A,R6
077B FE                MOV     R6,A
077C AB07              MOV     R3,AR7
077E FA                MOV     R2,A
077F E4                CLR     A
0780 F9                MOV     R1,A
0781 F8                MOV     R0,A
0782 D007              POP     AR7
0784 D006              POP     AR6
0786 120000      E     LCALL   ?C?SLDIV
0789 A804              MOV     R0,AR4
078B A905              MOV     R1,AR5
078D AA06              MOV     R2,AR6
078F AB07              MOV     R3,AR7
0791 900000      E     MOV     DPTR,#g_refOld
0794 E0                MOVX    A,@DPTR
0795 FC                MOV     R4,A
0796 A3                INC     DPTR
0797 E0                MOVX    A,@DPTR
0798 FD                MOV     R5,A
0799 A3                INC     DPTR
079A E0                MOVX    A,@DPTR
079B FE                MOV     R6,A
079C A3                INC     DPTR
079D E0                MOVX    A,@DPTR
079E C3                CLR     C
079F 9B                SUBB    A,R3
07A0 FF                MOV     R7,A
07A1 EE                MOV     A,R6
07A2 9A                SUBB    A,R2
07A3 FE                MOV     R6,A
07A4 ED                MOV     A,R5
07A5 99                SUBB    A,R1
07A6 FD                MOV     R5,A
07A7 EC                MOV     A,R4
07A8 98                SUBB    A,R0
07A9 FC                MOV     R4,A
07AA 900000      E     MOV     DPTR,#g_ref
07AD 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 573
                                           ; SOURCE LINE # 574
                                           ; SOURCE LINE # 576
                                           ; SOURCE LINE # 577
                                           ; SOURCE LINE # 578
                                           ; SOURCE LINE # 580
                                           ; SOURCE LINE # 581
                                           ; SOURCE LINE # 582
07B0         ?C0039:
                                           ; SOURCE LINE # 585
07B0 900000      E     MOV     DPTR,#c_mem+050H
07B3 E0                MOVX    A,@DPTR
07B4 606A              JZ      ?C0084
                                           ; SOURCE LINE # 586
07B6 A3                INC     DPTR
07B7 E0                MOVX    A,@DPTR
07B8 FC                MOV     R4,A
07B9 A3                INC     DPTR
07BA E0                MOVX    A,@DPTR
07BB FD                MOV     R5,A
07BC A3                INC     DPTR
07BD E0                MOVX    A,@DPTR
07BE FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 57  

07BF A3                INC     DPTR
07C0 E0                MOVX    A,@DPTR
07C1 FF                MOV     R7,A
07C2 900000      E     MOV     DPTR,#g_ref
07C5 E0                MOVX    A,@DPTR
07C6 F8                MOV     R0,A
07C7 A3                INC     DPTR
07C8 E0                MOVX    A,@DPTR
07C9 F9                MOV     R1,A
07CA A3                INC     DPTR
07CB E0                MOVX    A,@DPTR
07CC FA                MOV     R2,A
07CD A3                INC     DPTR
07CE E0                MOVX    A,@DPTR
07CF FB                MOV     R3,A
07D0 C3                CLR     C
07D1 120000      E     LCALL   ?C?SLCMP
07D4 5014              JNC     ?C0085
                                           ; SOURCE LINE # 587
07D6 900000      E     MOV     DPTR,#c_mem+051H
07D9 E0                MOVX    A,@DPTR
07DA FC                MOV     R4,A
07DB A3                INC     DPTR
07DC E0                MOVX    A,@DPTR
07DD FD                MOV     R5,A
07DE A3                INC     DPTR
07DF E0                MOVX    A,@DPTR
07E0 FE                MOV     R6,A
07E1 A3                INC     DPTR
07E2 E0                MOVX    A,@DPTR
07E3 FF                MOV     R7,A
07E4 900000      E     MOV     DPTR,#g_ref
07E7 120000      E     LCALL   ?C?LSTXDATA
07EA         ?C0085:
                                           ; SOURCE LINE # 588
07EA 900000      E     MOV     DPTR,#c_mem+059H
07ED E0                MOVX    A,@DPTR
07EE FC                MOV     R4,A
07EF A3                INC     DPTR
07F0 E0                MOVX    A,@DPTR
07F1 FD                MOV     R5,A
07F2 A3                INC     DPTR
07F3 E0                MOVX    A,@DPTR
07F4 FE                MOV     R6,A
07F5 A3                INC     DPTR
07F6 E0                MOVX    A,@DPTR
07F7 FF                MOV     R7,A
07F8 900000      E     MOV     DPTR,#g_ref
07FB E0                MOVX    A,@DPTR
07FC F8                MOV     R0,A
07FD A3                INC     DPTR
07FE E0                MOVX    A,@DPTR
07FF F9                MOV     R1,A
0800 A3                INC     DPTR
0801 E0                MOVX    A,@DPTR
0802 FA                MOV     R2,A
0803 A3                INC     DPTR
0804 E0                MOVX    A,@DPTR
0805 FB                MOV     R3,A
0806 D3                SETB    C
0807 120000      E     LCALL   ?C?SLCMP
080A 4014              JC      ?C0084
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 58  

                                           ; SOURCE LINE # 589
080C 900000      E     MOV     DPTR,#c_mem+059H
080F E0                MOVX    A,@DPTR
0810 FC                MOV     R4,A
0811 A3                INC     DPTR
0812 E0                MOVX    A,@DPTR
0813 FD                MOV     R5,A
0814 A3                INC     DPTR
0815 E0                MOVX    A,@DPTR
0816 FE                MOV     R6,A
0817 A3                INC     DPTR
0818 E0                MOVX    A,@DPTR
0819 FF                MOV     R7,A
081A 900000      E     MOV     DPTR,#g_ref
081D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 590
0820         ?C0084:
                                           ; SOURCE LINE # 592
0820 900000      E     MOV     DPTR,#c_mem+034H
0823 E0                MOVX    A,@DPTR
0824 7003              JNZ     $ + 5H
0826 020000      R     LJMP    ?C0109
0829 14                DEC     A
082A 7003              JNZ     $ + 5H
082C 020000      R     LJMP    ?C0131
082F 14                DEC     A
0830 7003              JNZ     $ + 5H
0832 020000      R     LJMP    ?C0118
0835 14                DEC     A
0836 6003              JZ      $ + 5H
0838 020000      R     LJMP    ?C0087
                                           ; SOURCE LINE # 594
083B         ?C0088:
                                           ; SOURCE LINE # 595
083B 900000      E     MOV     DPTR,#g_meas
083E E0                MOVX    A,@DPTR
083F F8                MOV     R0,A
0840 A3                INC     DPTR
0841 E0                MOVX    A,@DPTR
0842 F9                MOV     R1,A
0843 A3                INC     DPTR
0844 E0                MOVX    A,@DPTR
0845 FA                MOV     R2,A
0846 A3                INC     DPTR
0847 E0                MOVX    A,@DPTR
0848 FB                MOV     R3,A
0849 900000      E     MOV     DPTR,#g_ref
084C E0                MOVX    A,@DPTR
084D FC                MOV     R4,A
084E A3                INC     DPTR
084F E0                MOVX    A,@DPTR
0850 FD                MOV     R5,A
0851 A3                INC     DPTR
0852 E0                MOVX    A,@DPTR
0853 FE                MOV     R6,A
0854 A3                INC     DPTR
0855 E0                MOVX    A,@DPTR
0856 C3                CLR     C
0857 9B                SUBB    A,R3
0858 F500        R     MOV     pos_error+03H,A
085A EE                MOV     A,R6
085B 9A                SUBB    A,R2
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 59  

085C F500        R     MOV     pos_error+02H,A
085E ED                MOV     A,R5
085F 99                SUBB    A,R1
0860 F500        R     MOV     pos_error+01H,A
0862 EC                MOV     A,R4
0863 98                SUBB    A,R0
0864 F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 597
0866 900000      R     MOV     DPTR,#pos_error_sum
0869 E0                MOVX    A,@DPTR
086A FC                MOV     R4,A
086B A3                INC     DPTR
086C E0                MOVX    A,@DPTR
086D FD                MOV     R5,A
086E A3                INC     DPTR
086F E0                MOVX    A,@DPTR
0870 FE                MOV     R6,A
0871 A3                INC     DPTR
0872 E0                MOVX    A,@DPTR
0873 2500        R     ADD     A,pos_error+03H
0875 FF                MOV     R7,A
0876 EE                MOV     A,R6
0877 3500        R     ADDC    A,pos_error+02H
0879 FE                MOV     R6,A
087A ED                MOV     A,R5
087B 3500        R     ADDC    A,pos_error+01H
087D FD                MOV     R5,A
087E EC                MOV     A,R4
087F 3500        R     ADDC    A,pos_error
0881 FC                MOV     R4,A
0882 900000      R     MOV     DPTR,#pos_error_sum
0885 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 600
0888 7F80              MOV     R7,#080H
088A 7EF0              MOV     R6,#0F0H
088C 7DFA              MOV     R5,#0FAH
088E 7C02              MOV     R4,#02H
0890 900000      R     MOV     DPTR,#pos_error_sum
0893 E0                MOVX    A,@DPTR
0894 F8                MOV     R0,A
0895 A3                INC     DPTR
0896 E0                MOVX    A,@DPTR
0897 F9                MOV     R1,A
0898 A3                INC     DPTR
0899 E0                MOVX    A,@DPTR
089A FA                MOV     R2,A
089B A3                INC     DPTR
089C E0                MOVX    A,@DPTR
089D FB                MOV     R3,A
089E D3                SETB    C
089F 120000      E     LCALL   ?C?SLCMP
08A2 4010              JC      ?C0089
                                           ; SOURCE LINE # 601
08A4 7F80              MOV     R7,#080H
08A6 7EF0              MOV     R6,#0F0H
08A8 7DFA              MOV     R5,#0FAH
08AA 7C02              MOV     R4,#02H
08AC 900000      R     MOV     DPTR,#pos_error_sum
08AF 120000      E     LCALL   ?C?LSTXDATA
08B2 802A              SJMP    ?C0090
08B4         ?C0089:
                                           ; SOURCE LINE # 602
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 60  

                                           ; SOURCE LINE # 603
08B4 7F80              MOV     R7,#080H
08B6 7E0F              MOV     R6,#0FH
08B8 7D05              MOV     R5,#05H
08BA 7CFD              MOV     R4,#0FDH
08BC 900000      R     MOV     DPTR,#pos_error_sum
08BF E0                MOVX    A,@DPTR
08C0 F8                MOV     R0,A
08C1 A3                INC     DPTR
08C2 E0                MOVX    A,@DPTR
08C3 F9                MOV     R1,A
08C4 A3                INC     DPTR
08C5 E0                MOVX    A,@DPTR
08C6 FA                MOV     R2,A
08C7 A3                INC     DPTR
08C8 E0                MOVX    A,@DPTR
08C9 FB                MOV     R3,A
08CA C3                CLR     C
08CB 120000      E     LCALL   ?C?SLCMP
08CE 500E              JNC     ?C0090
                                           ; SOURCE LINE # 604
08D0 7F80              MOV     R7,#080H
08D2 7E0F              MOV     R6,#0FH
08D4 7D05              MOV     R5,#05H
08D6 7CFD              MOV     R4,#0FDH
08D8 900000      R     MOV     DPTR,#pos_error_sum
08DB 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 605
08DE         ?C0090:
                                           ; SOURCE LINE # 609
08DE E4                CLR     A
08DF F500        R     MOV     i_ref+03H,A
08E1 F500        R     MOV     i_ref+02H,A
08E3 F500        R     MOV     i_ref+01H,A
08E5 F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 612
08E7 FF                MOV     R7,A
08E8 FE                MOV     R6,A
08E9 FD                MOV     R5,A
08EA FC                MOV     R4,A
08EB AB00        R     MOV     R3,k_p_dl+03H
08ED AA00        R     MOV     R2,k_p_dl+02H
08EF A900        R     MOV     R1,k_p_dl+01H
08F1 A800        R     MOV     R0,k_p_dl
08F3 C3                CLR     C
08F4 120000      E     LCALL   ?C?SLCMP
08F7 6026              JZ      ?C0092
                                           ; SOURCE LINE # 613
08F9 AF00        R     MOV     R7,pos_error+03H
08FB AE00        R     MOV     R6,pos_error+02H
08FD AD00        R     MOV     R5,pos_error+01H
08FF AC00        R     MOV     R4,pos_error
0901 A800        R     MOV     R0,k_p_dl
0903 120000      E     LCALL   ?C?LMUL
0906 7810              MOV     R0,#010H
0908 120000      E     LCALL   ?C?SLSHR
090B E500        R     MOV     A,i_ref+03H
090D 2F                ADD     A,R7
090E F500        R     MOV     i_ref+03H,A
0910 E500        R     MOV     A,i_ref+02H
0912 3E                ADDC    A,R6
0913 F500        R     MOV     i_ref+02H,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 61  

0915 E500        R     MOV     A,i_ref+01H
0917 3D                ADDC    A,R5
0918 F500        R     MOV     i_ref+01H,A
091A E500        R     MOV     A,i_ref
091C 3C                ADDC    A,R4
091D F500        R     MOV     i_ref,A
091F         ?C0092:
                                           ; SOURCE LINE # 616
091F E4                CLR     A
0920 FF                MOV     R7,A
0921 FE                MOV     R6,A
0922 FD                MOV     R5,A
0923 FC                MOV     R4,A
0924 AB00        R     MOV     R3,k_i_dl+03H
0926 AA00        R     MOV     R2,k_i_dl+02H
0928 A900        R     MOV     R1,k_i_dl+01H
092A A800        R     MOV     R0,k_i_dl
092C C3                CLR     C
092D 120000      E     LCALL   ?C?SLCMP
0930 602C              JZ      ?C0093
                                           ; SOURCE LINE # 617
0932 900000      R     MOV     DPTR,#pos_error_sum
0935 E0                MOVX    A,@DPTR
0936 FC                MOV     R4,A
0937 A3                INC     DPTR
0938 E0                MOVX    A,@DPTR
0939 FD                MOV     R5,A
093A A3                INC     DPTR
093B E0                MOVX    A,@DPTR
093C FE                MOV     R6,A
093D A3                INC     DPTR
093E E0                MOVX    A,@DPTR
093F FF                MOV     R7,A
0940 A800        R     MOV     R0,k_i_dl
0942 120000      E     LCALL   ?C?LMUL
0945 7810              MOV     R0,#010H
0947 120000      E     LCALL   ?C?SLSHR
094A E500        R     MOV     A,i_ref+03H
094C 2F                ADD     A,R7
094D F500        R     MOV     i_ref+03H,A
094F E500        R     MOV     A,i_ref+02H
0951 3E                ADDC    A,R6
0952 F500        R     MOV     i_ref+02H,A
0954 E500        R     MOV     A,i_ref+01H
0956 3D                ADDC    A,R5
0957 F500        R     MOV     i_ref+01H,A
0959 E500        R     MOV     A,i_ref
095B 3C                ADDC    A,R4
095C F500        R     MOV     i_ref,A
095E         ?C0093:
                                           ; SOURCE LINE # 620
095E E4                CLR     A
095F FF                MOV     R7,A
0960 FE                MOV     R6,A
0961 FD                MOV     R5,A
0962 FC                MOV     R4,A
0963 AB00        R     MOV     R3,k_d_dl+03H
0965 AA00        R     MOV     R2,k_d_dl+02H
0967 A900        R     MOV     R1,k_d_dl+01H
0969 A800        R     MOV     R0,k_d_dl
096B C3                CLR     C
096C 120000      E     LCALL   ?C?SLCMP
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 62  

096F 6043              JZ      ?C0094
                                           ; SOURCE LINE # 621
0971 900000      R     MOV     DPTR,#prev_pos_err
0974 E0                MOVX    A,@DPTR
0975 F8                MOV     R0,A
0976 A3                INC     DPTR
0977 E0                MOVX    A,@DPTR
0978 F9                MOV     R1,A
0979 A3                INC     DPTR
097A E0                MOVX    A,@DPTR
097B FA                MOV     R2,A
097C A3                INC     DPTR
097D E0                MOVX    A,@DPTR
097E FB                MOV     R3,A
097F C3                CLR     C
0980 E500        R     MOV     A,pos_error+03H
0982 9B                SUBB    A,R3
0983 FF                MOV     R7,A
0984 E500        R     MOV     A,pos_error+02H
0986 9A                SUBB    A,R2
0987 FE                MOV     R6,A
0988 E500        R     MOV     A,pos_error+01H
098A 99                SUBB    A,R1
098B FD                MOV     R5,A
098C E500        R     MOV     A,pos_error
098E 98                SUBB    A,R0
098F FC                MOV     R4,A
0990 AB00        R     MOV     R3,k_d_dl+03H
0992 AA00        R     MOV     R2,k_d_dl+02H
0994 A900        R     MOV     R1,k_d_dl+01H
0996 A800        R     MOV     R0,k_d_dl
0998 120000      E     LCALL   ?C?LMUL
099B 7810              MOV     R0,#010H
099D 120000      E     LCALL   ?C?SLSHR
09A0 E500        R     MOV     A,i_ref+03H
09A2 2F                ADD     A,R7
09A3 F500        R     MOV     i_ref+03H,A
09A5 E500        R     MOV     A,i_ref+02H
09A7 3E                ADDC    A,R6
09A8 F500        R     MOV     i_ref+02H,A
09AA E500        R     MOV     A,i_ref+01H
09AC 3D                ADDC    A,R5
09AD F500        R     MOV     i_ref+01H,A
09AF E500        R     MOV     A,i_ref
09B1 3C                ADDC    A,R4
09B2 F500        R     MOV     i_ref,A
09B4         ?C0094:
                                           ; SOURCE LINE # 624
09B4 AF00        R     MOV     R7,pos_error+03H
09B6 AE00        R     MOV     R6,pos_error+02H
09B8 AD00        R     MOV     R5,pos_error+01H
09BA AC00        R     MOV     R4,pos_error
09BC 900000      R     MOV     DPTR,#prev_pos_err
09BF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 630
09C2 E4                CLR     A
09C3 FF                MOV     R7,A
09C4 FE                MOV     R6,A
09C5 FD                MOV     R5,A
09C6 FC                MOV     R4,A
09C7 AB00        R     MOV     R3,i_ref+03H
09C9 AA00        R     MOV     R2,i_ref+02H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 63  

09CB A900        R     MOV     R1,i_ref+01H
09CD A800        R     MOV     R0,i_ref
09CF C3                CLR     C
09D0 120000      E     LCALL   ?C?SLCMP
09D3 4004              JC      ?C0095
                                           ; SOURCE LINE # 631
09D5 D200        R     SETB    motor_dir
09D7 8002              SJMP    ?C0096
09D9         ?C0095:
                                           ; SOURCE LINE # 633
09D9 C200        R     CLR     motor_dir
09DB         ?C0096:
                                           ; SOURCE LINE # 639
09DB 900000      E     MOV     DPTR,#c_mem+069H
09DE E0                MOVX    A,@DPTR
09DF FE                MOV     R6,A
09E0 A3                INC     DPTR
09E1 E0                MOVX    A,@DPTR
09E2 FF                MOV     R7,A
09E3 EE                MOV     A,R6
09E4 33                RLC     A
09E5 95E0              SUBB    A,ACC
09E7 FD                MOV     R5,A
09E8 FC                MOV     R4,A
09E9 AB00        R     MOV     R3,i_ref+03H
09EB AA00        R     MOV     R2,i_ref+02H
09ED A900        R     MOV     R1,i_ref+01H
09EF A800        R     MOV     R0,i_ref
09F1 D3                SETB    C
09F2 120000      E     LCALL   ?C?SLCMP
09F5 4016              JC      ?C0097
                                           ; SOURCE LINE # 640
09F7 900000      E     MOV     DPTR,#c_mem+069H
09FA E0                MOVX    A,@DPTR
09FB FE                MOV     R6,A
09FC A3                INC     DPTR
09FD E0                MOVX    A,@DPTR
09FE FF                MOV     R7,A
09FF EE                MOV     A,R6
0A00 33                RLC     A
0A01 95E0              SUBB    A,ACC
0A03 8F00        R     MOV     i_ref+03H,R7
0A05 8E00        R     MOV     i_ref+02H,R6
0A07 F500        R     MOV     i_ref+01H,A
0A09 F500        R     MOV     i_ref,A
0A0B 803C              SJMP    ?C0098
0A0D         ?C0097:
                                           ; SOURCE LINE # 641
                                           ; SOURCE LINE # 642
0A0D 900000      E     MOV     DPTR,#c_mem+069H
0A10 E0                MOVX    A,@DPTR
0A11 FE                MOV     R6,A
0A12 A3                INC     DPTR
0A13 E0                MOVX    A,@DPTR
0A14 FF                MOV     R7,A
0A15 C3                CLR     C
0A16 E4                CLR     A
0A17 9F                SUBB    A,R7
0A18 FF                MOV     R7,A
0A19 E4                CLR     A
0A1A 9E                SUBB    A,R6
0A1B FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 64  

0A1C 33                RLC     A
0A1D 95E0              SUBB    A,ACC
0A1F FD                MOV     R5,A
0A20 FC                MOV     R4,A
0A21 AB00        R     MOV     R3,i_ref+03H
0A23 AA00        R     MOV     R2,i_ref+02H
0A25 A900        R     MOV     R1,i_ref+01H
0A27 A800        R     MOV     R0,i_ref
0A29 C3                CLR     C
0A2A 120000      E     LCALL   ?C?SLCMP
0A2D 501A              JNC     ?C0098
                                           ; SOURCE LINE # 643
0A2F 900000      E     MOV     DPTR,#c_mem+069H
0A32 E0                MOVX    A,@DPTR
0A33 FE                MOV     R6,A
0A34 A3                INC     DPTR
0A35 E0                MOVX    A,@DPTR
0A36 FF                MOV     R7,A
0A37 C3                CLR     C
0A38 E4                CLR     A
0A39 9F                SUBB    A,R7
0A3A FF                MOV     R7,A
0A3B E4                CLR     A
0A3C 9E                SUBB    A,R6
0A3D FE                MOV     R6,A
0A3E 33                RLC     A
0A3F 95E0              SUBB    A,ACC
0A41 8F00        R     MOV     i_ref+03H,R7
0A43 8E00        R     MOV     i_ref+02H,R6
0A45 F500        R     MOV     i_ref+01H,A
0A47 F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 644
0A49         ?C0098:
                                           ; SOURCE LINE # 655
0A49 900000      E     MOV     DPTR,#g_meas+0CH
0A4C E0                MOVX    A,@DPTR
0A4D F8                MOV     R0,A
0A4E A3                INC     DPTR
0A4F E0                MOVX    A,@DPTR
0A50 F9                MOV     R1,A
0A51 A3                INC     DPTR
0A52 E0                MOVX    A,@DPTR
0A53 FA                MOV     R2,A
0A54 A3                INC     DPTR
0A55 E0                MOVX    A,@DPTR
0A56 FB                MOV     R3,A
0A57 C3                CLR     C
0A58 E500        R     MOV     A,i_ref+03H
0A5A 9B                SUBB    A,R3
0A5B F500        R     MOV     curr_error+03H,A
0A5D E500        R     MOV     A,i_ref+02H
0A5F 9A                SUBB    A,R2
0A60 F500        R     MOV     curr_error+02H,A
0A62 E500        R     MOV     A,i_ref+01H
0A64 99                SUBB    A,R1
0A65 F500        R     MOV     curr_error+01H,A
0A67 E500        R     MOV     A,i_ref
0A69 98                SUBB    A,R0
0A6A F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 656
0A6C 900000      R     MOV     DPTR,#curr_error_sum
0A6F E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 65  

0A70 FC                MOV     R4,A
0A71 A3                INC     DPTR
0A72 E0                MOVX    A,@DPTR
0A73 FD                MOV     R5,A
0A74 A3                INC     DPTR
0A75 E0                MOVX    A,@DPTR
0A76 FE                MOV     R6,A
0A77 A3                INC     DPTR
0A78 E0                MOVX    A,@DPTR
0A79 2500        R     ADD     A,curr_error+03H
0A7B FF                MOV     R7,A
0A7C EE                MOV     A,R6
0A7D 3500        R     ADDC    A,curr_error+02H
0A7F FE                MOV     R6,A
0A80 ED                MOV     A,R5
0A81 3500        R     ADDC    A,curr_error+01H
0A83 FD                MOV     R5,A
0A84 EC                MOV     A,R4
0A85 3500        R     ADDC    A,curr_error
0A87 FC                MOV     R4,A
0A88 900000      R     MOV     DPTR,#curr_error_sum
0A8B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 658
0A8E 7FA0              MOV     R7,#0A0H
0A90 7E86              MOV     R6,#086H
0A92 7D01              MOV     R5,#01H
0A94 7C00              MOV     R4,#00H
0A96 900000      R     MOV     DPTR,#curr_error_sum
0A99 E0                MOVX    A,@DPTR
0A9A F8                MOV     R0,A
0A9B A3                INC     DPTR
0A9C E0                MOVX    A,@DPTR
0A9D F9                MOV     R1,A
0A9E A3                INC     DPTR
0A9F E0                MOVX    A,@DPTR
0AA0 FA                MOV     R2,A
0AA1 A3                INC     DPTR
0AA2 E0                MOVX    A,@DPTR
0AA3 FB                MOV     R3,A
0AA4 D3                SETB    C
0AA5 120000      E     LCALL   ?C?SLCMP
0AA8 4010              JC      ?C0100
                                           ; SOURCE LINE # 659
0AAA 7FA0              MOV     R7,#0A0H
0AAC 7E86              MOV     R6,#086H
0AAE 7D01              MOV     R5,#01H
0AB0 7C00              MOV     R4,#00H
0AB2 900000      R     MOV     DPTR,#curr_error_sum
0AB5 120000      E     LCALL   ?C?LSTXDATA
0AB8 802A              SJMP    ?C0101
0ABA         ?C0100:
                                           ; SOURCE LINE # 660
                                           ; SOURCE LINE # 661
0ABA 7F60              MOV     R7,#060H
0ABC 7E79              MOV     R6,#079H
0ABE 7DFE              MOV     R5,#0FEH
0AC0 7CFF              MOV     R4,#0FFH
0AC2 900000      R     MOV     DPTR,#curr_error_sum
0AC5 E0                MOVX    A,@DPTR
0AC6 F8                MOV     R0,A
0AC7 A3                INC     DPTR
0AC8 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 66  

0AC9 F9                MOV     R1,A
0ACA A3                INC     DPTR
0ACB E0                MOVX    A,@DPTR
0ACC FA                MOV     R2,A
0ACD A3                INC     DPTR
0ACE E0                MOVX    A,@DPTR
0ACF FB                MOV     R3,A
0AD0 C3                CLR     C
0AD1 120000      E     LCALL   ?C?SLCMP
0AD4 500E              JNC     ?C0101
                                           ; SOURCE LINE # 662
0AD6 7F60              MOV     R7,#060H
0AD8 7E79              MOV     R6,#079H
0ADA 7DFE              MOV     R5,#0FEH
0ADC 7CFF              MOV     R4,#0FFH
0ADE 900000      R     MOV     DPTR,#curr_error_sum
0AE1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 663
0AE4         ?C0101:
                                           ; SOURCE LINE # 667
0AE4 E4                CLR     A
0AE5 F500        R     MOV     pwm_input+03H,A
0AE7 F500        R     MOV     pwm_input+02H,A
0AE9 F500        R     MOV     pwm_input+01H,A
0AEB F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 670
0AED FF                MOV     R7,A
0AEE FE                MOV     R6,A
0AEF FD                MOV     R5,A
0AF0 FC                MOV     R4,A
0AF1 AB00        R     MOV     R3,k_p_c_dl+03H
0AF3 AA00        R     MOV     R2,k_p_c_dl+02H
0AF5 A900        R     MOV     R1,k_p_c_dl+01H
0AF7 A800        R     MOV     R0,k_p_c_dl
0AF9 C3                CLR     C
0AFA 120000      E     LCALL   ?C?SLCMP
0AFD 6026              JZ      ?C0103
                                           ; SOURCE LINE # 671
0AFF AF00        R     MOV     R7,curr_error+03H
0B01 AE00        R     MOV     R6,curr_error+02H
0B03 AD00        R     MOV     R5,curr_error+01H
0B05 AC00        R     MOV     R4,curr_error
0B07 A800        R     MOV     R0,k_p_c_dl
0B09 120000      E     LCALL   ?C?LMUL
0B0C 7810              MOV     R0,#010H
0B0E 120000      E     LCALL   ?C?SLSHR
0B11 E500        R     MOV     A,pwm_input+03H
0B13 2F                ADD     A,R7
0B14 F500        R     MOV     pwm_input+03H,A
0B16 E500        R     MOV     A,pwm_input+02H
0B18 3E                ADDC    A,R6
0B19 F500        R     MOV     pwm_input+02H,A
0B1B E500        R     MOV     A,pwm_input+01H
0B1D 3D                ADDC    A,R5
0B1E F500        R     MOV     pwm_input+01H,A
0B20 E500        R     MOV     A,pwm_input
0B22 3C                ADDC    A,R4
0B23 F500        R     MOV     pwm_input,A
0B25         ?C0103:
                                           ; SOURCE LINE # 674
0B25 E4                CLR     A
0B26 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 67  

0B27 FE                MOV     R6,A
0B28 FD                MOV     R5,A
0B29 FC                MOV     R4,A
0B2A AB00        R     MOV     R3,k_i_c_dl+03H
0B2C AA00        R     MOV     R2,k_i_c_dl+02H
0B2E A900        R     MOV     R1,k_i_c_dl+01H
0B30 A800        R     MOV     R0,k_i_c_dl
0B32 C3                CLR     C
0B33 120000      E     LCALL   ?C?SLCMP
0B36 602C              JZ      ?C0104
                                           ; SOURCE LINE # 675
0B38 900000      R     MOV     DPTR,#curr_error_sum
0B3B E0                MOVX    A,@DPTR
0B3C FC                MOV     R4,A
0B3D A3                INC     DPTR
0B3E E0                MOVX    A,@DPTR
0B3F FD                MOV     R5,A
0B40 A3                INC     DPTR
0B41 E0                MOVX    A,@DPTR
0B42 FE                MOV     R6,A
0B43 A3                INC     DPTR
0B44 E0                MOVX    A,@DPTR
0B45 FF                MOV     R7,A
0B46 A800        R     MOV     R0,k_i_c_dl
0B48 120000      E     LCALL   ?C?LMUL
0B4B 7810              MOV     R0,#010H
0B4D 120000      E     LCALL   ?C?SLSHR
0B50 E500        R     MOV     A,pwm_input+03H
0B52 2F                ADD     A,R7
0B53 F500        R     MOV     pwm_input+03H,A
0B55 E500        R     MOV     A,pwm_input+02H
0B57 3E                ADDC    A,R6
0B58 F500        R     MOV     pwm_input+02H,A
0B5A E500        R     MOV     A,pwm_input+01H
0B5C 3D                ADDC    A,R5
0B5D F500        R     MOV     pwm_input+01H,A
0B5F E500        R     MOV     A,pwm_input
0B61 3C                ADDC    A,R4
0B62 F500        R     MOV     pwm_input,A
0B64         ?C0104:
                                           ; SOURCE LINE # 678
0B64 E4                CLR     A
0B65 FF                MOV     R7,A
0B66 FE                MOV     R6,A
0B67 FD                MOV     R5,A
0B68 FC                MOV     R4,A
0B69 AB00        R     MOV     R3,k_d_c_dl+03H
0B6B AA00        R     MOV     R2,k_d_c_dl+02H
0B6D A900        R     MOV     R1,k_d_c_dl+01H
0B6F A800        R     MOV     R0,k_d_c_dl
0B71 C3                CLR     C
0B72 120000      E     LCALL   ?C?SLCMP
0B75 6043              JZ      ?C0105
                                           ; SOURCE LINE # 679
0B77 900000      R     MOV     DPTR,#prev_curr_err
0B7A E0                MOVX    A,@DPTR
0B7B F8                MOV     R0,A
0B7C A3                INC     DPTR
0B7D E0                MOVX    A,@DPTR
0B7E F9                MOV     R1,A
0B7F A3                INC     DPTR
0B80 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 68  

0B81 FA                MOV     R2,A
0B82 A3                INC     DPTR
0B83 E0                MOVX    A,@DPTR
0B84 FB                MOV     R3,A
0B85 C3                CLR     C
0B86 E500        R     MOV     A,curr_error+03H
0B88 9B                SUBB    A,R3
0B89 FF                MOV     R7,A
0B8A E500        R     MOV     A,curr_error+02H
0B8C 9A                SUBB    A,R2
0B8D FE                MOV     R6,A
0B8E E500        R     MOV     A,curr_error+01H
0B90 99                SUBB    A,R1
0B91 FD                MOV     R5,A
0B92 E500        R     MOV     A,curr_error
0B94 98                SUBB    A,R0
0B95 FC                MOV     R4,A
0B96 AB00        R     MOV     R3,k_d_c_dl+03H
0B98 AA00        R     MOV     R2,k_d_c_dl+02H
0B9A A900        R     MOV     R1,k_d_c_dl+01H
0B9C A800        R     MOV     R0,k_d_c_dl
0B9E 120000      E     LCALL   ?C?LMUL
0BA1 7810              MOV     R0,#010H
0BA3 120000      E     LCALL   ?C?SLSHR
0BA6 E500        R     MOV     A,pwm_input+03H
0BA8 2F                ADD     A,R7
0BA9 F500        R     MOV     pwm_input+03H,A
0BAB E500        R     MOV     A,pwm_input+02H
0BAD 3E                ADDC    A,R6
0BAE F500        R     MOV     pwm_input+02H,A
0BB0 E500        R     MOV     A,pwm_input+01H
0BB2 3D                ADDC    A,R5
0BB3 F500        R     MOV     pwm_input+01H,A
0BB5 E500        R     MOV     A,pwm_input
0BB7 3C                ADDC    A,R4
0BB8 F500        R     MOV     pwm_input,A
0BBA         ?C0105:
                                           ; SOURCE LINE # 682
0BBA 74FF              MOV     A,#0FFH
0BBC 7F9C              MOV     R7,#09CH
0BBE FE                MOV     R6,A
0BBF FD                MOV     R5,A
0BC0 FC                MOV     R4,A
0BC1 AB00        R     MOV     R3,pwm_input+03H
0BC3 AA00        R     MOV     R2,pwm_input+02H
0BC5 A900        R     MOV     R1,pwm_input+01H
0BC7 A800        R     MOV     R0,pwm_input
0BC9 C3                CLR     C
0BCA 120000      E     LCALL   ?C?SLCMP
0BCD 500D              JNC     ?C0106
                                           ; SOURCE LINE # 683
0BCF 74FF              MOV     A,#0FFH
0BD1 75009C      R     MOV     pwm_input+03H,#09CH
0BD4 F500        R     MOV     pwm_input+02H,A
0BD6 F500        R     MOV     pwm_input+01H,A
0BD8 F500        R     MOV     pwm_input,A
0BDA 801E              SJMP    ?C0107
0BDC         ?C0106:
                                           ; SOURCE LINE # 684
                                           ; SOURCE LINE # 685
0BDC E4                CLR     A
0BDD 7F64              MOV     R7,#064H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 69  

0BDF FE                MOV     R6,A
0BE0 FD                MOV     R5,A
0BE1 FC                MOV     R4,A
0BE2 AB00        R     MOV     R3,pwm_input+03H
0BE4 AA00        R     MOV     R2,pwm_input+02H
0BE6 A900        R     MOV     R1,pwm_input+01H
0BE8 A800        R     MOV     R0,pwm_input
0BEA D3                SETB    C
0BEB 120000      E     LCALL   ?C?SLCMP
0BEE 400A              JC      ?C0107
                                           ; SOURCE LINE # 686
0BF0 E4                CLR     A
0BF1 750064      R     MOV     pwm_input+03H,#064H
0BF4 F500        R     MOV     pwm_input+02H,A
0BF6 F500        R     MOV     pwm_input+01H,A
0BF8 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 687
0BFA         ?C0107:
                                           ; SOURCE LINE # 690
0BFA AF00        R     MOV     R7,curr_error+03H
0BFC AE00        R     MOV     R6,curr_error+02H
0BFE AD00        R     MOV     R5,curr_error+01H
0C00 AC00        R     MOV     R4,curr_error
0C02 900000      R     MOV     DPTR,#prev_curr_err
0C05 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 692
0C08 020000      R     LJMP    ?C0087
                                           ; SOURCE LINE # 695
0C0B         ?C0109:
                                           ; SOURCE LINE # 696
0C0B 900000      E     MOV     DPTR,#g_meas
0C0E E0                MOVX    A,@DPTR
0C0F F8                MOV     R0,A
0C10 A3                INC     DPTR
0C11 E0                MOVX    A,@DPTR
0C12 F9                MOV     R1,A
0C13 A3                INC     DPTR
0C14 E0                MOVX    A,@DPTR
0C15 FA                MOV     R2,A
0C16 A3                INC     DPTR
0C17 E0                MOVX    A,@DPTR
0C18 FB                MOV     R3,A
0C19 900000      E     MOV     DPTR,#g_ref
0C1C E0                MOVX    A,@DPTR
0C1D FC                MOV     R4,A
0C1E A3                INC     DPTR
0C1F E0                MOVX    A,@DPTR
0C20 FD                MOV     R5,A
0C21 A3                INC     DPTR
0C22 E0                MOVX    A,@DPTR
0C23 FE                MOV     R6,A
0C24 A3                INC     DPTR
0C25 E0                MOVX    A,@DPTR
0C26 C3                CLR     C
0C27 9B                SUBB    A,R3
0C28 F500        R     MOV     pos_error+03H,A
0C2A EE                MOV     A,R6
0C2B 9A                SUBB    A,R2
0C2C F500        R     MOV     pos_error+02H,A
0C2E ED                MOV     A,R5
0C2F 99                SUBB    A,R1
0C30 F500        R     MOV     pos_error+01H,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 70  

0C32 EC                MOV     A,R4
0C33 98                SUBB    A,R0
0C34 F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 698
0C36 900000      R     MOV     DPTR,#pos_error_sum
0C39 E0                MOVX    A,@DPTR
0C3A FC                MOV     R4,A
0C3B A3                INC     DPTR
0C3C E0                MOVX    A,@DPTR
0C3D FD                MOV     R5,A
0C3E A3                INC     DPTR
0C3F E0                MOVX    A,@DPTR
0C40 FE                MOV     R6,A
0C41 A3                INC     DPTR
0C42 E0                MOVX    A,@DPTR
0C43 2500        R     ADD     A,pos_error+03H
0C45 FF                MOV     R7,A
0C46 EE                MOV     A,R6
0C47 3500        R     ADDC    A,pos_error+02H
0C49 FE                MOV     R6,A
0C4A ED                MOV     A,R5
0C4B 3500        R     ADDC    A,pos_error+01H
0C4D FD                MOV     R5,A
0C4E EC                MOV     A,R4
0C4F 3500        R     ADDC    A,pos_error
0C51 FC                MOV     R4,A
0C52 900000      R     MOV     DPTR,#pos_error_sum
0C55 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 701
0C58 E4                CLR     A
0C59 7FE8              MOV     R7,#0E8H
0C5B 7E03              MOV     R6,#03H
0C5D FD                MOV     R5,A
0C5E FC                MOV     R4,A
0C5F 900000      R     MOV     DPTR,#pos_error_sum
0C62 E0                MOVX    A,@DPTR
0C63 F8                MOV     R0,A
0C64 A3                INC     DPTR
0C65 E0                MOVX    A,@DPTR
0C66 F9                MOV     R1,A
0C67 A3                INC     DPTR
0C68 E0                MOVX    A,@DPTR
0C69 FA                MOV     R2,A
0C6A A3                INC     DPTR
0C6B E0                MOVX    A,@DPTR
0C6C FB                MOV     R3,A
0C6D D3                SETB    C
0C6E 120000      E     LCALL   ?C?SLCMP
0C71 400F              JC      ?C0110
                                           ; SOURCE LINE # 702
0C73 E4                CLR     A
0C74 7FE8              MOV     R7,#0E8H
0C76 7E03              MOV     R6,#03H
0C78 FD                MOV     R5,A
0C79 FC                MOV     R4,A
0C7A 900000      R     MOV     DPTR,#pos_error_sum
0C7D 120000      E     LCALL   ?C?LSTXDATA
0C80 802A              SJMP    ?C0111
0C82         ?C0110:
                                           ; SOURCE LINE # 703
                                           ; SOURCE LINE # 704
0C82 7F18              MOV     R7,#018H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 71  

0C84 7EFC              MOV     R6,#0FCH
0C86 7DFF              MOV     R5,#0FFH
0C88 7CFF              MOV     R4,#0FFH
0C8A 900000      R     MOV     DPTR,#pos_error_sum
0C8D E0                MOVX    A,@DPTR
0C8E F8                MOV     R0,A
0C8F A3                INC     DPTR
0C90 E0                MOVX    A,@DPTR
0C91 F9                MOV     R1,A
0C92 A3                INC     DPTR
0C93 E0                MOVX    A,@DPTR
0C94 FA                MOV     R2,A
0C95 A3                INC     DPTR
0C96 E0                MOVX    A,@DPTR
0C97 FB                MOV     R3,A
0C98 C3                CLR     C
0C99 120000      E     LCALL   ?C?SLCMP
0C9C 500E              JNC     ?C0111
                                           ; SOURCE LINE # 705
0C9E 7F18              MOV     R7,#018H
0CA0 7EFC              MOV     R6,#0FCH
0CA2 7DFF              MOV     R5,#0FFH
0CA4 7CFF              MOV     R4,#0FFH
0CA6 900000      R     MOV     DPTR,#pos_error_sum
0CA9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 706
0CAC         ?C0111:
                                           ; SOURCE LINE # 709
0CAC E4                CLR     A
0CAD FF                MOV     R7,A
0CAE FE                MOV     R6,A
0CAF FD                MOV     R5,A
0CB0 FC                MOV     R4,A
0CB1 AB00        R     MOV     R3,k_p+03H
0CB3 AA00        R     MOV     R2,k_p+02H
0CB5 A900        R     MOV     R1,k_p+01H
0CB7 A800        R     MOV     R0,k_p
0CB9 C3                CLR     C
0CBA 120000      E     LCALL   ?C?SLCMP
0CBD 601A              JZ      ?C0113
                                           ; SOURCE LINE # 710
0CBF AF00        R     MOV     R7,pos_error+03H
0CC1 AE00        R     MOV     R6,pos_error+02H
0CC3 AD00        R     MOV     R5,pos_error+01H
0CC5 AC00        R     MOV     R4,pos_error
0CC7 A800        R     MOV     R0,k_p
0CC9 120000      E     LCALL   ?C?LMUL
0CCC 7810              MOV     R0,#010H
0CCE 120000      E     LCALL   ?C?SLSHR
0CD1 8F00        R     MOV     pwm_input+03H,R7
0CD3 8E00        R     MOV     pwm_input+02H,R6
0CD5 8D00        R     MOV     pwm_input+01H,R5
0CD7 8C00        R     MOV     pwm_input,R4
0CD9         ?C0113:
                                           ; SOURCE LINE # 714
0CD9 E4                CLR     A
0CDA FF                MOV     R7,A
0CDB FE                MOV     R6,A
0CDC FD                MOV     R5,A
0CDD FC                MOV     R4,A
0CDE AB00        R     MOV     R3,k_i+03H
0CE0 AA00        R     MOV     R2,k_i+02H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 72  

0CE2 A900        R     MOV     R1,k_i+01H
0CE4 A800        R     MOV     R0,k_i
0CE6 C3                CLR     C
0CE7 120000      E     LCALL   ?C?SLCMP
0CEA 602C              JZ      ?C0114
                                           ; SOURCE LINE # 715
0CEC 900000      R     MOV     DPTR,#pos_error_sum
0CEF E0                MOVX    A,@DPTR
0CF0 FC                MOV     R4,A
0CF1 A3                INC     DPTR
0CF2 E0                MOVX    A,@DPTR
0CF3 FD                MOV     R5,A
0CF4 A3                INC     DPTR
0CF5 E0                MOVX    A,@DPTR
0CF6 FE                MOV     R6,A
0CF7 A3                INC     DPTR
0CF8 E0                MOVX    A,@DPTR
0CF9 FF                MOV     R7,A
0CFA A800        R     MOV     R0,k_i
0CFC 120000      E     LCALL   ?C?LMUL
0CFF 7810              MOV     R0,#010H
0D01 120000      E     LCALL   ?C?SLSHR
0D04 E500        R     MOV     A,pwm_input+03H
0D06 2F                ADD     A,R7
0D07 F500        R     MOV     pwm_input+03H,A
0D09 E500        R     MOV     A,pwm_input+02H
0D0B 3E                ADDC    A,R6
0D0C F500        R     MOV     pwm_input+02H,A
0D0E E500        R     MOV     A,pwm_input+01H
0D10 3D                ADDC    A,R5
0D11 F500        R     MOV     pwm_input+01H,A
0D13 E500        R     MOV     A,pwm_input
0D15 3C                ADDC    A,R4
0D16 F500        R     MOV     pwm_input,A
0D18         ?C0114:
                                           ; SOURCE LINE # 719
0D18 E4                CLR     A
0D19 FF                MOV     R7,A
0D1A FE                MOV     R6,A
0D1B FD                MOV     R5,A
0D1C FC                MOV     R4,A
0D1D AB00        R     MOV     R3,k_d+03H
0D1F AA00        R     MOV     R2,k_d+02H
0D21 A900        R     MOV     R1,k_d+01H
0D23 A800        R     MOV     R0,k_d
0D25 C3                CLR     C
0D26 120000      E     LCALL   ?C?SLCMP
0D29 6043              JZ      ?C0115
                                           ; SOURCE LINE # 720
0D2B 900000      R     MOV     DPTR,#prev_pos_err
0D2E E0                MOVX    A,@DPTR
0D2F F8                MOV     R0,A
0D30 A3                INC     DPTR
0D31 E0                MOVX    A,@DPTR
0D32 F9                MOV     R1,A
0D33 A3                INC     DPTR
0D34 E0                MOVX    A,@DPTR
0D35 FA                MOV     R2,A
0D36 A3                INC     DPTR
0D37 E0                MOVX    A,@DPTR
0D38 FB                MOV     R3,A
0D39 C3                CLR     C
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 73  

0D3A E500        R     MOV     A,pos_error+03H
0D3C 9B                SUBB    A,R3
0D3D FF                MOV     R7,A
0D3E E500        R     MOV     A,pos_error+02H
0D40 9A                SUBB    A,R2
0D41 FE                MOV     R6,A
0D42 E500        R     MOV     A,pos_error+01H
0D44 99                SUBB    A,R1
0D45 FD                MOV     R5,A
0D46 E500        R     MOV     A,pos_error
0D48 98                SUBB    A,R0
0D49 FC                MOV     R4,A
0D4A AB00        R     MOV     R3,k_d+03H
0D4C AA00        R     MOV     R2,k_d+02H
0D4E A900        R     MOV     R1,k_d+01H
0D50 A800        R     MOV     R0,k_d
0D52 120000      E     LCALL   ?C?LMUL
0D55 7810              MOV     R0,#010H
0D57 120000      E     LCALL   ?C?SLSHR
0D5A E500        R     MOV     A,pwm_input+03H
0D5C 2F                ADD     A,R7
0D5D F500        R     MOV     pwm_input+03H,A
0D5F E500        R     MOV     A,pwm_input+02H
0D61 3E                ADDC    A,R6
0D62 F500        R     MOV     pwm_input+02H,A
0D64 E500        R     MOV     A,pwm_input+01H
0D66 3D                ADDC    A,R5
0D67 F500        R     MOV     pwm_input+01H,A
0D69 E500        R     MOV     A,pwm_input
0D6B 3C                ADDC    A,R4
0D6C F500        R     MOV     pwm_input,A
0D6E         ?C0115:
                                           ; SOURCE LINE # 724
0D6E AF00        R     MOV     R7,pos_error+03H
0D70 AE00        R     MOV     R6,pos_error+02H
0D72 AD00        R     MOV     R5,pos_error+01H
0D74 AC00        R     MOV     R4,pos_error
0D76 900000      R     MOV     DPTR,#prev_pos_err
0D79 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 726
0D7C E4                CLR     A
0D7D FF                MOV     R7,A
0D7E FE                MOV     R6,A
0D7F FD                MOV     R5,A
0D80 FC                MOV     R4,A
0D81 AB00        R     MOV     R3,pwm_input+03H
0D83 AA00        R     MOV     R2,pwm_input+02H
0D85 A900        R     MOV     R1,pwm_input+01H
0D87 A800        R     MOV     R0,pwm_input
0D89 D3                SETB    C
0D8A 120000      E     LCALL   ?C?SLCMP
0D8D 4005              JC      ?C0116
                                           ; SOURCE LINE # 727
0D8F D200        R     SETB    motor_dir
0D91 020000      R     LJMP    ?C0087
0D94         ?C0116:
                                           ; SOURCE LINE # 729
0D94 C200        R     CLR     motor_dir
                                           ; SOURCE LINE # 731
0D96 020000      R     LJMP    ?C0087
                                           ; SOURCE LINE # 734
0D99         ?C0118:
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 74  

                                           ; SOURCE LINE # 735
0D99 900000      E     MOV     DPTR,#g_ref+018H
0D9C E0                MOVX    A,@DPTR
0D9D 7003              JNZ     $ + 5H
0D9F 020000      R     LJMP    ?C0087
0DA2 200003      E     JB      tension_valid,$ + 6H
0DA5 020000      R     LJMP    ?C0087
                                           ; SOURCE LINE # 737
0DA8 900000      E     MOV     DPTR,#g_ref+08H
0DAB E0                MOVX    A,@DPTR
0DAC FC                MOV     R4,A
0DAD A3                INC     DPTR
0DAE E0                MOVX    A,@DPTR
0DAF FD                MOV     R5,A
0DB0 A3                INC     DPTR
0DB1 E0                MOVX    A,@DPTR
0DB2 FE                MOV     R6,A
0DB3 A3                INC     DPTR
0DB4 E0                MOVX    A,@DPTR
0DB5 F500        R     MOV     i_ref+03H,A
0DB7 8E00        R     MOV     i_ref+02H,R6
0DB9 8D00        R     MOV     i_ref+01H,R5
0DBB 8C00        R     MOV     i_ref,R4
                                           ; SOURCE LINE # 739
0DBD 900000      E     MOV     DPTR,#c_mem+069H
0DC0 E0                MOVX    A,@DPTR
0DC1 FE                MOV     R6,A
0DC2 A3                INC     DPTR
0DC3 E0                MOVX    A,@DPTR
0DC4 FF                MOV     R7,A
0DC5 EE                MOV     A,R6
0DC6 33                RLC     A
0DC7 95E0              SUBB    A,ACC
0DC9 FD                MOV     R5,A
0DCA FC                MOV     R4,A
0DCB AB00        R     MOV     R3,i_ref+03H
0DCD AA00        R     MOV     R2,i_ref+02H
0DCF A900        R     MOV     R1,i_ref+01H
0DD1 A800        R     MOV     R0,i_ref
0DD3 D3                SETB    C
0DD4 120000      E     LCALL   ?C?SLCMP
0DD7 4016              JC      ?C0120
                                           ; SOURCE LINE # 740
0DD9 900000      E     MOV     DPTR,#c_mem+069H
0DDC E0                MOVX    A,@DPTR
0DDD FE                MOV     R6,A
0DDE A3                INC     DPTR
0DDF E0                MOVX    A,@DPTR
0DE0 FF                MOV     R7,A
0DE1 EE                MOV     A,R6
0DE2 33                RLC     A
0DE3 95E0              SUBB    A,ACC
0DE5 8F00        R     MOV     i_ref+03H,R7
0DE7 8E00        R     MOV     i_ref+02H,R6
0DE9 F500        R     MOV     i_ref+01H,A
0DEB F500        R     MOV     i_ref,A
0DED 803C              SJMP    ?C0121
0DEF         ?C0120:
                                           ; SOURCE LINE # 741
                                           ; SOURCE LINE # 742
0DEF 900000      E     MOV     DPTR,#c_mem+069H
0DF2 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 75  

0DF3 FE                MOV     R6,A
0DF4 A3                INC     DPTR
0DF5 E0                MOVX    A,@DPTR
0DF6 FF                MOV     R7,A
0DF7 C3                CLR     C
0DF8 E4                CLR     A
0DF9 9F                SUBB    A,R7
0DFA FF                MOV     R7,A
0DFB E4                CLR     A
0DFC 9E                SUBB    A,R6
0DFD FE                MOV     R6,A
0DFE 33                RLC     A
0DFF 95E0              SUBB    A,ACC
0E01 FD                MOV     R5,A
0E02 FC                MOV     R4,A
0E03 AB00        R     MOV     R3,i_ref+03H
0E05 AA00        R     MOV     R2,i_ref+02H
0E07 A900        R     MOV     R1,i_ref+01H
0E09 A800        R     MOV     R0,i_ref
0E0B C3                CLR     C
0E0C 120000      E     LCALL   ?C?SLCMP
0E0F 501A              JNC     ?C0121
                                           ; SOURCE LINE # 743
0E11 900000      E     MOV     DPTR,#c_mem+069H
0E14 E0                MOVX    A,@DPTR
0E15 FE                MOV     R6,A
0E16 A3                INC     DPTR
0E17 E0                MOVX    A,@DPTR
0E18 FF                MOV     R7,A
0E19 C3                CLR     C
0E1A E4                CLR     A
0E1B 9F                SUBB    A,R7
0E1C FF                MOV     R7,A
0E1D E4                CLR     A
0E1E 9E                SUBB    A,R6
0E1F FE                MOV     R6,A
0E20 33                RLC     A
0E21 95E0              SUBB    A,ACC
0E23 8F00        R     MOV     i_ref+03H,R7
0E25 8E00        R     MOV     i_ref+02H,R6
0E27 F500        R     MOV     i_ref+01H,A
0E29 F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 744
0E2B         ?C0121:
                                           ; SOURCE LINE # 747
0E2B 900000      E     MOV     DPTR,#g_meas+0CH
0E2E E0                MOVX    A,@DPTR
0E2F F8                MOV     R0,A
0E30 A3                INC     DPTR
0E31 E0                MOVX    A,@DPTR
0E32 F9                MOV     R1,A
0E33 A3                INC     DPTR
0E34 E0                MOVX    A,@DPTR
0E35 FA                MOV     R2,A
0E36 A3                INC     DPTR
0E37 E0                MOVX    A,@DPTR
0E38 FB                MOV     R3,A
0E39 C3                CLR     C
0E3A E500        R     MOV     A,i_ref+03H
0E3C 9B                SUBB    A,R3
0E3D F500        R     MOV     curr_error+03H,A
0E3F E500        R     MOV     A,i_ref+02H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 76  

0E41 9A                SUBB    A,R2
0E42 F500        R     MOV     curr_error+02H,A
0E44 E500        R     MOV     A,i_ref+01H
0E46 99                SUBB    A,R1
0E47 F500        R     MOV     curr_error+01H,A
0E49 E500        R     MOV     A,i_ref
0E4B 98                SUBB    A,R0
0E4C F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 748
0E4E 900000      R     MOV     DPTR,#curr_error_sum
0E51 E0                MOVX    A,@DPTR
0E52 FC                MOV     R4,A
0E53 A3                INC     DPTR
0E54 E0                MOVX    A,@DPTR
0E55 FD                MOV     R5,A
0E56 A3                INC     DPTR
0E57 E0                MOVX    A,@DPTR
0E58 FE                MOV     R6,A
0E59 A3                INC     DPTR
0E5A E0                MOVX    A,@DPTR
0E5B 2500        R     ADD     A,curr_error+03H
0E5D FF                MOV     R7,A
0E5E EE                MOV     A,R6
0E5F 3500        R     ADDC    A,curr_error+02H
0E61 FE                MOV     R6,A
0E62 ED                MOV     A,R5
0E63 3500        R     ADDC    A,curr_error+01H
0E65 FD                MOV     R5,A
0E66 EC                MOV     A,R4
0E67 3500        R     ADDC    A,curr_error
0E69 FC                MOV     R4,A
0E6A 900000      R     MOV     DPTR,#curr_error_sum
0E6D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 750
0E70 7FA0              MOV     R7,#0A0H
0E72 7E86              MOV     R6,#086H
0E74 7D01              MOV     R5,#01H
0E76 7C00              MOV     R4,#00H
0E78 900000      R     MOV     DPTR,#curr_error_sum
0E7B E0                MOVX    A,@DPTR
0E7C F8                MOV     R0,A
0E7D A3                INC     DPTR
0E7E E0                MOVX    A,@DPTR
0E7F F9                MOV     R1,A
0E80 A3                INC     DPTR
0E81 E0                MOVX    A,@DPTR
0E82 FA                MOV     R2,A
0E83 A3                INC     DPTR
0E84 E0                MOVX    A,@DPTR
0E85 FB                MOV     R3,A
0E86 D3                SETB    C
0E87 120000      E     LCALL   ?C?SLCMP
0E8A 4010              JC      ?C0123
                                           ; SOURCE LINE # 751
0E8C 7FA0              MOV     R7,#0A0H
0E8E 7E86              MOV     R6,#086H
0E90 7D01              MOV     R5,#01H
0E92 7C00              MOV     R4,#00H
0E94 900000      R     MOV     DPTR,#curr_error_sum
0E97 120000      E     LCALL   ?C?LSTXDATA
0E9A 802A              SJMP    ?C0124
0E9C         ?C0123:
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 77  

                                           ; SOURCE LINE # 752
                                           ; SOURCE LINE # 753
0E9C 7F60              MOV     R7,#060H
0E9E 7E79              MOV     R6,#079H
0EA0 7DFE              MOV     R5,#0FEH
0EA2 7CFF              MOV     R4,#0FFH
0EA4 900000      R     MOV     DPTR,#curr_error_sum
0EA7 E0                MOVX    A,@DPTR
0EA8 F8                MOV     R0,A
0EA9 A3                INC     DPTR
0EAA E0                MOVX    A,@DPTR
0EAB F9                MOV     R1,A
0EAC A3                INC     DPTR
0EAD E0                MOVX    A,@DPTR
0EAE FA                MOV     R2,A
0EAF A3                INC     DPTR
0EB0 E0                MOVX    A,@DPTR
0EB1 FB                MOV     R3,A
0EB2 C3                CLR     C
0EB3 120000      E     LCALL   ?C?SLCMP
0EB6 500E              JNC     ?C0124
                                           ; SOURCE LINE # 754
0EB8 7F60              MOV     R7,#060H
0EBA 7E79              MOV     R6,#079H
0EBC 7DFE              MOV     R5,#0FEH
0EBE 7CFF              MOV     R4,#0FFH
0EC0 900000      R     MOV     DPTR,#curr_error_sum
0EC3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 755
0EC6         ?C0124:
                                           ; SOURCE LINE # 757
0EC6 E4                CLR     A
0EC7 F500        R     MOV     pwm_input+03H,A
0EC9 F500        R     MOV     pwm_input+02H,A
0ECB F500        R     MOV     pwm_input+01H,A
0ECD F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 760
0ECF FF                MOV     R7,A
0ED0 FE                MOV     R6,A
0ED1 FD                MOV     R5,A
0ED2 FC                MOV     R4,A
0ED3 AB00        R     MOV     R3,k_p_c+03H
0ED5 AA00        R     MOV     R2,k_p_c+02H
0ED7 A900        R     MOV     R1,k_p_c+01H
0ED9 A800        R     MOV     R0,k_p_c
0EDB C3                CLR     C
0EDC 120000      E     LCALL   ?C?SLCMP
0EDF 6026              JZ      ?C0126
                                           ; SOURCE LINE # 761
0EE1 AF00        R     MOV     R7,curr_error+03H
0EE3 AE00        R     MOV     R6,curr_error+02H
0EE5 AD00        R     MOV     R5,curr_error+01H
0EE7 AC00        R     MOV     R4,curr_error
0EE9 A800        R     MOV     R0,k_p_c
0EEB 120000      E     LCALL   ?C?LMUL
0EEE 7810              MOV     R0,#010H
0EF0 120000      E     LCALL   ?C?SLSHR
0EF3 E500        R     MOV     A,pwm_input+03H
0EF5 2F                ADD     A,R7
0EF6 F500        R     MOV     pwm_input+03H,A
0EF8 E500        R     MOV     A,pwm_input+02H
0EFA 3E                ADDC    A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 78  

0EFB F500        R     MOV     pwm_input+02H,A
0EFD E500        R     MOV     A,pwm_input+01H
0EFF 3D                ADDC    A,R5
0F00 F500        R     MOV     pwm_input+01H,A
0F02 E500        R     MOV     A,pwm_input
0F04 3C                ADDC    A,R4
0F05 F500        R     MOV     pwm_input,A
0F07         ?C0126:
                                           ; SOURCE LINE # 764
0F07 E4                CLR     A
0F08 FF                MOV     R7,A
0F09 FE                MOV     R6,A
0F0A FD                MOV     R5,A
0F0B FC                MOV     R4,A
0F0C AB00        R     MOV     R3,k_i_c+03H
0F0E AA00        R     MOV     R2,k_i_c+02H
0F10 A900        R     MOV     R1,k_i_c+01H
0F12 A800        R     MOV     R0,k_i_c
0F14 C3                CLR     C
0F15 120000      E     LCALL   ?C?SLCMP
0F18 602C              JZ      ?C0127
                                           ; SOURCE LINE # 765
0F1A 900000      R     MOV     DPTR,#curr_error_sum
0F1D E0                MOVX    A,@DPTR
0F1E FC                MOV     R4,A
0F1F A3                INC     DPTR
0F20 E0                MOVX    A,@DPTR
0F21 FD                MOV     R5,A
0F22 A3                INC     DPTR
0F23 E0                MOVX    A,@DPTR
0F24 FE                MOV     R6,A
0F25 A3                INC     DPTR
0F26 E0                MOVX    A,@DPTR
0F27 FF                MOV     R7,A
0F28 A800        R     MOV     R0,k_i_c
0F2A 120000      E     LCALL   ?C?LMUL
0F2D 7810              MOV     R0,#010H
0F2F 120000      E     LCALL   ?C?SLSHR
0F32 E500        R     MOV     A,pwm_input+03H
0F34 2F                ADD     A,R7
0F35 F500        R     MOV     pwm_input+03H,A
0F37 E500        R     MOV     A,pwm_input+02H
0F39 3E                ADDC    A,R6
0F3A F500        R     MOV     pwm_input+02H,A
0F3C E500        R     MOV     A,pwm_input+01H
0F3E 3D                ADDC    A,R5
0F3F F500        R     MOV     pwm_input+01H,A
0F41 E500        R     MOV     A,pwm_input
0F43 3C                ADDC    A,R4
0F44 F500        R     MOV     pwm_input,A
0F46         ?C0127:
                                           ; SOURCE LINE # 768
0F46 E4                CLR     A
0F47 FF                MOV     R7,A
0F48 FE                MOV     R6,A
0F49 FD                MOV     R5,A
0F4A FC                MOV     R4,A
0F4B AB00        R     MOV     R3,k_d_c+03H
0F4D AA00        R     MOV     R2,k_d_c+02H
0F4F A900        R     MOV     R1,k_d_c+01H
0F51 A800        R     MOV     R0,k_d_c
0F53 C3                CLR     C
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 79  

0F54 120000      E     LCALL   ?C?SLCMP
0F57 6043              JZ      ?C0128
                                           ; SOURCE LINE # 769
0F59 900000      R     MOV     DPTR,#prev_curr_err
0F5C E0                MOVX    A,@DPTR
0F5D F8                MOV     R0,A
0F5E A3                INC     DPTR
0F5F E0                MOVX    A,@DPTR
0F60 F9                MOV     R1,A
0F61 A3                INC     DPTR
0F62 E0                MOVX    A,@DPTR
0F63 FA                MOV     R2,A
0F64 A3                INC     DPTR
0F65 E0                MOVX    A,@DPTR
0F66 FB                MOV     R3,A
0F67 C3                CLR     C
0F68 E500        R     MOV     A,curr_error+03H
0F6A 9B                SUBB    A,R3
0F6B FF                MOV     R7,A
0F6C E500        R     MOV     A,curr_error+02H
0F6E 9A                SUBB    A,R2
0F6F FE                MOV     R6,A
0F70 E500        R     MOV     A,curr_error+01H
0F72 99                SUBB    A,R1
0F73 FD                MOV     R5,A
0F74 E500        R     MOV     A,curr_error
0F76 98                SUBB    A,R0
0F77 FC                MOV     R4,A
0F78 AB00        R     MOV     R3,k_d_c+03H
0F7A AA00        R     MOV     R2,k_d_c+02H
0F7C A900        R     MOV     R1,k_d_c+01H
0F7E A800        R     MOV     R0,k_d_c
0F80 120000      E     LCALL   ?C?LMUL
0F83 7810              MOV     R0,#010H
0F85 120000      E     LCALL   ?C?SLSHR
0F88 E500        R     MOV     A,pwm_input+03H
0F8A 2F                ADD     A,R7
0F8B F500        R     MOV     pwm_input+03H,A
0F8D E500        R     MOV     A,pwm_input+02H
0F8F 3E                ADDC    A,R6
0F90 F500        R     MOV     pwm_input+02H,A
0F92 E500        R     MOV     A,pwm_input+01H
0F94 3D                ADDC    A,R5
0F95 F500        R     MOV     pwm_input+01H,A
0F97 E500        R     MOV     A,pwm_input
0F99 3C                ADDC    A,R4
0F9A F500        R     MOV     pwm_input,A
0F9C         ?C0128:
                                           ; SOURCE LINE # 771
0F9C AF00        R     MOV     R7,curr_error+03H
0F9E AE00        R     MOV     R6,curr_error+02H
0FA0 AD00        R     MOV     R5,curr_error+01H
0FA2 AC00        R     MOV     R4,curr_error
0FA4 900000      R     MOV     DPTR,#prev_curr_err
0FA7 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 773
0FAA E4                CLR     A
0FAB FF                MOV     R7,A
0FAC FE                MOV     R6,A
0FAD FD                MOV     R5,A
0FAE FC                MOV     R4,A
0FAF AB00        R     MOV     R3,pwm_input+03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 80  

0FB1 AA00        R     MOV     R2,pwm_input+02H
0FB3 A900        R     MOV     R1,pwm_input+01H
0FB5 A800        R     MOV     R0,pwm_input
0FB7 C3                CLR     C
0FB8 120000      E     LCALL   ?C?SLCMP
0FBB 4004              JC      ?C0129
                                           ; SOURCE LINE # 774
0FBD D200        R     SETB    motor_dir
0FBF 8072              SJMP    ?C0087
0FC1         ?C0129:
                                           ; SOURCE LINE # 776
0FC1 C200        R     CLR     motor_dir
                                           ; SOURCE LINE # 777
                                           ; SOURCE LINE # 778
0FC3 806E              SJMP    ?C0087
                                           ; SOURCE LINE # 781
0FC5         ?C0131:
                                           ; SOURCE LINE # 783
0FC5 900000      E     MOV     DPTR,#g_ref+010H
0FC8 E0                MOVX    A,@DPTR
0FC9 FC                MOV     R4,A
0FCA A3                INC     DPTR
0FCB E0                MOVX    A,@DPTR
0FCC FD                MOV     R5,A
0FCD A3                INC     DPTR
0FCE E0                MOVX    A,@DPTR
0FCF FE                MOV     R6,A
0FD0 A3                INC     DPTR
0FD1 E0                MOVX    A,@DPTR
0FD2 F500        R     MOV     pwm_input+03H,A
0FD4 8E00        R     MOV     pwm_input+02H,R6
0FD6 8D00        R     MOV     pwm_input+01H,R5
0FD8 8C00        R     MOV     pwm_input,R4
                                           ; SOURCE LINE # 785
0FDA E4                CLR     A
0FDB FF                MOV     R7,A
0FDC FE                MOV     R6,A
0FDD FD                MOV     R5,A
0FDE FC                MOV     R4,A
0FDF AB00        R     MOV     R3,pwm_input+03H
0FE1 AA00        R     MOV     R2,pwm_input+02H
0FE3 A900        R     MOV     R1,pwm_input+01H
0FE5 A800        R     MOV     R0,pwm_input
0FE7 D3                SETB    C
0FE8 120000      E     LCALL   ?C?SLCMP
0FEB 4004              JC      ?C0132
                                           ; SOURCE LINE # 786
0FED D200        R     SETB    motor_dir
0FEF 8002              SJMP    ?C0133
0FF1         ?C0132:
                                           ; SOURCE LINE # 788
0FF1 C200        R     CLR     motor_dir
0FF3         ?C0133:
                                           ; SOURCE LINE # 792
0FF3 74FF              MOV     A,#0FFH
0FF5 7F9C              MOV     R7,#09CH
0FF7 FE                MOV     R6,A
0FF8 FD                MOV     R5,A
0FF9 FC                MOV     R4,A
0FFA AB00        R     MOV     R3,pwm_input+03H
0FFC AA00        R     MOV     R2,pwm_input+02H
0FFE A900        R     MOV     R1,pwm_input+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 81  

1000 A800        R     MOV     R0,pwm_input
1002 C3                CLR     C
1003 120000      E     LCALL   ?C?SLCMP
1006 500D              JNC     ?C0134
                                           ; SOURCE LINE # 793
1008 74FF              MOV     A,#0FFH
100A 75009C      R     MOV     pwm_input+03H,#09CH
100D F500        R     MOV     pwm_input+02H,A
100F F500        R     MOV     pwm_input+01H,A
1011 F500        R     MOV     pwm_input,A
1013 801E              SJMP    ?C0087
1015         ?C0134:
                                           ; SOURCE LINE # 794
                                           ; SOURCE LINE # 795
1015 E4                CLR     A
1016 7F64              MOV     R7,#064H
1018 FE                MOV     R6,A
1019 FD                MOV     R5,A
101A FC                MOV     R4,A
101B AB00        R     MOV     R3,pwm_input+03H
101D AA00        R     MOV     R2,pwm_input+02H
101F A900        R     MOV     R1,pwm_input+01H
1021 A800        R     MOV     R0,pwm_input
1023 D3                SETB    C
1024 120000      E     LCALL   ?C?SLCMP
1027 400A              JC      ?C0087
                                           ; SOURCE LINE # 796
1029 E4                CLR     A
102A 750064      R     MOV     pwm_input+03H,#064H
102D F500        R     MOV     pwm_input+02H,A
102F F500        R     MOV     pwm_input+01H,A
1031 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 797
                                           ; SOURCE LINE # 799
                                           ; SOURCE LINE # 800
1033         ?C0087:
                                           ; SOURCE LINE # 804
1033 E4                CLR     A
1034 7F64              MOV     R7,#064H
1036 FE                MOV     R6,A
1037 FD                MOV     R5,A
1038 FC                MOV     R4,A
1039 AB00        R     MOV     R3,pwm_input+03H
103B AA00        R     MOV     R2,pwm_input+02H
103D A900        R     MOV     R1,pwm_input+01H
103F A800        R     MOV     R0,pwm_input
1041 D3                SETB    C
1042 120000      E     LCALL   ?C?SLCMP
1045 400A              JC      ?C0137
                                           ; SOURCE LINE # 805
1047 E4                CLR     A
1048 750064      R     MOV     pwm_input+03H,#064H
104B F500        R     MOV     pwm_input+02H,A
104D F500        R     MOV     pwm_input+01H,A
104F F500        R     MOV     pwm_input,A
1051         ?C0137:
                                           ; SOURCE LINE # 806
1051 74FF              MOV     A,#0FFH
1053 7F9C              MOV     R7,#09CH
1055 FE                MOV     R6,A
1056 FD                MOV     R5,A
1057 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 82  

1058 AB00        R     MOV     R3,pwm_input+03H
105A AA00        R     MOV     R2,pwm_input+02H
105C A900        R     MOV     R1,pwm_input+01H
105E A800        R     MOV     R0,pwm_input
1060 C3                CLR     C
1061 120000      E     LCALL   ?C?SLCMP
1064 500B              JNC     ?C0138
                                           ; SOURCE LINE # 807
1066 74FF              MOV     A,#0FFH
1068 75009C      R     MOV     pwm_input+03H,#09CH
106B F500        R     MOV     pwm_input+02H,A
106D F500        R     MOV     pwm_input+01H,A
106F F500        R     MOV     pwm_input,A
1071         ?C0138:
                                           ; SOURCE LINE # 810
1071 900000      E     MOV     DPTR,#c_mem+034H
1074 E0                MOVX    A,@DPTR
1075 6401              XRL     A,#01H
1077 6037              JZ      ?C0139
                                           ; SOURCE LINE # 811
1079 AF00        R     MOV     R7,pwm_input+03H
107B AE00        R     MOV     R6,pwm_input+02H
107D AD00        R     MOV     R5,pwm_input+01H
107F AC00        R     MOV     R4,pwm_input
1081 780A              MOV     R0,#0AH
1083 120000      E     LCALL   ?C?LSHL
1086 E4                CLR     A
1087 7B64              MOV     R3,#064H
1089 FA                MOV     R2,A
108A F9                MOV     R1,A
108B F8                MOV     R0,A
108C 120000      E     LCALL   ?C?SLDIV
108F A804              MOV     R0,AR4
1091 A905              MOV     R1,AR5
1093 AA06              MOV     R2,AR6
1095 AB07              MOV     R3,AR7
1097 900000      E     MOV     DPTR,#dev_pwm_limit
109A E0                MOVX    A,@DPTR
109B FF                MOV     R7,A
109C E4                CLR     A
109D FC                MOV     R4,A
109E FD                MOV     R5,A
109F FE                MOV     R6,A
10A0 120000      E     LCALL   ?C?LMUL
10A3 780A              MOV     R0,#0AH
10A5 120000      E     LCALL   ?C?SLSHR
10A8 8F00        R     MOV     pwm_input+03H,R7
10AA 8E00        R     MOV     pwm_input+02H,R6
10AC 8D00        R     MOV     pwm_input+01H,R5
10AE 8C00        R     MOV     pwm_input,R4
10B0         ?C0139:
                                           ; SOURCE LINE # 814
10B0 E4                CLR     A
10B1 FF                MOV     R7,A
10B2 FE                MOV     R6,A
10B3 FD                MOV     R5,A
10B4 FC                MOV     R4,A
10B5 AB00        R     MOV     R3,pwm_input+03H
10B7 AA00        R     MOV     R2,pwm_input+02H
10B9 A900        R     MOV     R1,pwm_input+01H
10BB A800        R     MOV     R0,pwm_input
10BD C3                CLR     C
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 83  

10BE 120000      E     LCALL   ?C?SLCMP
10C1 4004              JC      ?C0140
10C3 7F01              MOV     R7,#01H
10C5 8002              SJMP    ?C0141
10C7         ?C0140:
10C7 7FFF              MOV     R7,#0FFH
10C9         ?C0141:
10C9 900000      E     MOV     DPTR,#pwm_sign
10CC EF                MOV     A,R7
10CD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 816
10CE 300007            JNB     motor_dir,?C0142
                                           ; SOURCE LINE # 817
10D1 7F01              MOV     R7,#01H
10D3 120000      E     LCALL   _MOTOR_DIR_Write
10D6 8005              SJMP    ?C0143
10D8         ?C0142:
                                           ; SOURCE LINE # 819
10D8 E4                CLR     A
10D9 FF                MOV     R7,A
10DA 120000      E     LCALL   _MOTOR_DIR_Write
10DD         ?C0143:
                                           ; SOURCE LINE # 821
10DD AE00        R     MOV     R6,pwm_input+02H
10DF AF00        R     MOV     R7,pwm_input+03H
10E1 120000      E     LCALL   _abs
10E4 120000      E     LCALL   _PWM_MOTORS_WriteCompare1
                                           ; SOURCE LINE # 822
10E7 22                RET     
             ; FUNCTION motor_control (END)

             ; FUNCTION _encoder_reading (BEGIN)
                                           ; SOURCE LINE # 828
;---- Variable 'idx' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 830
0000 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 839
0002 E4                CLR     A
0003 FF                MOV     R7,A
0004 FE                MOV     R6,A
0005 FD                MOV     R5,A
0006 FC                MOV     R4,A
0007 900000      R     MOV     DPTR,#init_rot
000A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 863
000D E500        R     MOV     A,index
000F C3                CLR     C
0010 9403              SUBB    A,#03H
0012 4003              JC      $ + 5H
0014 020000      R     LJMP    ?C0146
0017         ?C0145:
                                           ; SOURCE LINE # 866
0017 300022            JNB     reset_last_value_flag,?C0147
                                           ; SOURCE LINE # 867
;---- Variable 'jj' assigned to Register 'R3' ----
001A 7B03              MOV     R3,#03H
001C         ?C0148:
001C AF03              MOV     R7,AR3
001E 1B                DEC     R3
001F EF                MOV     A,R7
0020 6018              JZ      ?C0149
                                           ; SOURCE LINE # 868
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 84  

0022 E4                CLR     A
0023 FF                MOV     R7,A
0024 FE                MOV     R6,A
0025 FD                MOV     R5,A
0026 FC                MOV     R4,A
0027 EB                MOV     A,R3
0028 25E0              ADD     A,ACC
002A 25E0              ADD     A,ACC
002C 2400        R     ADD     A,#LOW last_value_encoder
002E F582              MOV     DPL,A
0030 E4                CLR     A
0031 3400        R     ADDC    A,#HIGH last_value_encoder
0033 F583              MOV     DPH,A
0035 120000      E     LCALL   ?C?LSTXDATA
0038 80E2              SJMP    ?C0148
003A         ?C0149:
                                           ; SOURCE LINE # 870
003A C200        E     CLR     reset_last_value_flag
                                           ; SOURCE LINE # 871
003C         ?C0147:
                                           ; SOURCE LINE # 875
003C E500        R     MOV     A,index
003E 7018              JNZ     ?C0150
                                           ; SOURCE LINE # 876
0040 120000      E     LCALL   SHIFTREG_ENC_1_ReadData
0043 7801              MOV     R0,#01H
0045 120000      E     LCALL   ?C?ULSHR
0048 EF                MOV     A,R7
0049 EE                MOV     A,R6
004A ED                MOV     A,R5
004B 5403              ANL     A,#03H
004D FD                MOV     R5,A
004E E4                CLR     A
004F FC                MOV     R4,A
0050 900000      R     MOV     DPTR,#data_encoder
0053 120000      E     LCALL   ?C?LSTXDATA
0056 8033              SJMP    ?C0151
0058         ?C0150:
                                           ; SOURCE LINE # 877
                                           ; SOURCE LINE # 878
0058 E500        R     MOV     A,index
005A B40118            CJNE    A,#01H,?C0152
                                           ; SOURCE LINE # 879
005D 120000      E     LCALL   SHIFTREG_ENC_2_ReadData
0060 7801              MOV     R0,#01H
0062 120000      E     LCALL   ?C?ULSHR
0065 EF                MOV     A,R7
0066 EE                MOV     A,R6
0067 ED                MOV     A,R5
0068 5403              ANL     A,#03H
006A FD                MOV     R5,A
006B E4                CLR     A
006C FC                MOV     R4,A
006D 900000      R     MOV     DPTR,#data_encoder
0070 120000      E     LCALL   ?C?LSTXDATA
0073 8016              SJMP    ?C0151
0075         ?C0152:
                                           ; SOURCE LINE # 881
0075 120000      E     LCALL   SHIFTREG_ENC_3_ReadData
0078 7801              MOV     R0,#01H
007A 120000      E     LCALL   ?C?ULSHR
007D EF                MOV     A,R7
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 85  

007E EE                MOV     A,R6
007F ED                MOV     A,R5
0080 5403              ANL     A,#03H
0082 FD                MOV     R5,A
0083 E4                CLR     A
0084 FC                MOV     R4,A
0085 900000      R     MOV     DPTR,#data_encoder
0088 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 882
008B         ?C0151:
                                           ; SOURCE LINE # 885
008B 7B01              MOV     R3,#01H
008D 7A00        R     MOV     R2,#HIGH data_encoder
008F 7900        R     MOV     R1,#LOW data_encoder
0091 120000      E     LCALL   _check_enc_data
0094 4003              JC      $ + 5H
0096 020000      R     LJMP    ?C0154
                                           ; SOURCE LINE # 887
0099 900000      R     MOV     DPTR,#data_encoder
009C E0                MOVX    A,@DPTR
009D FC                MOV     R4,A
009E A3                INC     DPTR
009F E0                MOVX    A,@DPTR
00A0 FD                MOV     R5,A
00A1 A3                INC     DPTR
00A2 E0                MOVX    A,@DPTR
00A3 FE                MOV     R6,A
00A4 A3                INC     DPTR
00A5 E0                MOVX    A,@DPTR
00A6 54C0              ANL     A,#0C0H
00A8 FF                MOV     R7,A
00A9 EE                MOV     A,R6
00AA ED                MOV     A,R5
00AB 5403              ANL     A,#03H
00AD FD                MOV     R5,A
00AE E4                CLR     A
00AF 2F                ADD     A,R7
00B0 FF                MOV     R7,A
00B1 E4                CLR     A
00B2 3E                ADDC    A,R6
00B3 FE                MOV     R6,A
00B4 ED                MOV     A,R5
00B5 34FE              ADDC    A,#0FEH
00B7 FD                MOV     R5,A
00B8 E4                CLR     A
00B9 34FF              ADDC    A,#0FFH
00BB FC                MOV     R4,A
00BC 7802              MOV     R0,#02H
00BE 120000      E     LCALL   ?C?ULSHR
00C1 EE                MOV     A,R6
00C2 33                RLC     A
00C3 95E0              SUBB    A,ACC
00C5 FD                MOV     R5,A
00C6 FC                MOV     R4,A
00C7 E500        R     MOV     A,index
00C9 25E0              ADD     A,ACC
00CB 25E0              ADD     A,ACC
00CD 2400        E     ADD     A,#LOW g_mem+038H
00CF F582              MOV     DPL,A
00D1 E4                CLR     A
00D2 3400        E     ADDC    A,#HIGH g_mem+038H
00D4 F583              MOV     DPH,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 86  

00D6 E0                MOVX    A,@DPTR
00D7 F8                MOV     R0,A
00D8 A3                INC     DPTR
00D9 E0                MOVX    A,@DPTR
00DA F9                MOV     R1,A
00DB A3                INC     DPTR
00DC E0                MOVX    A,@DPTR
00DD FA                MOV     R2,A
00DE A3                INC     DPTR
00DF E0                MOVX    A,@DPTR
00E0 2F                ADD     A,R7
00E1 FF                MOV     R7,A
00E2 EA                MOV     A,R2
00E3 3E                ADDC    A,R6
00E4 FE                MOV     R6,A
00E5 E9                MOV     A,R1
00E6 3D                ADDC    A,R5
00E7 FD                MOV     R5,A
00E8 E8                MOV     A,R0
00E9 3C                ADDC    A,R4
00EA FC                MOV     R4,A
00EB 900000      R     MOV     DPTR,#value_encoder
00EE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 894
00F1 300027            JNB     only_first_time,?C0155
                                           ; SOURCE LINE # 895
00F4 900000      R     MOV     DPTR,#value_encoder
00F7 E0                MOVX    A,@DPTR
00F8 FC                MOV     R4,A
00F9 A3                INC     DPTR
00FA E0                MOVX    A,@DPTR
00FB FD                MOV     R5,A
00FC A3                INC     DPTR
00FD E0                MOVX    A,@DPTR
00FE FE                MOV     R6,A
00FF A3                INC     DPTR
0100 E0                MOVX    A,@DPTR
0101 FF                MOV     R7,A
0102 E500        R     MOV     A,index
0104 25E0              ADD     A,ACC
0106 25E0              ADD     A,ACC
0108 2400        R     ADD     A,#LOW last_value_encoder
010A F582              MOV     DPL,A
010C E4                CLR     A
010D 3400        R     ADDC    A,#HIGH last_value_encoder
010F F583              MOV     DPH,A
0111 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 896
0114 E500        R     MOV     A,index
0116 B40202            CJNE    A,#02H,?C0155
                                           ; SOURCE LINE # 897
0119 C200        R     CLR     only_first_time
                                           ; SOURCE LINE # 898
011B         ?C0155:
                                           ; SOURCE LINE # 901
011B E500        R     MOV     A,index
011D 25E0              ADD     A,ACC
011F 25E0              ADD     A,ACC
0121 2400        R     ADD     A,#LOW last_value_encoder
0123 F582              MOV     DPL,A
0125 E4                CLR     A
0126 3400        R     ADDC    A,#HIGH last_value_encoder
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 87  

0128 F583              MOV     DPH,A
012A E0                MOVX    A,@DPTR
012B F8                MOV     R0,A
012C A3                INC     DPTR
012D E0                MOVX    A,@DPTR
012E F9                MOV     R1,A
012F A3                INC     DPTR
0130 E0                MOVX    A,@DPTR
0131 FA                MOV     R2,A
0132 A3                INC     DPTR
0133 E0                MOVX    A,@DPTR
0134 FB                MOV     R3,A
0135 900000      R     MOV     DPTR,#value_encoder
0138 E0                MOVX    A,@DPTR
0139 FC                MOV     R4,A
013A A3                INC     DPTR
013B E0                MOVX    A,@DPTR
013C FD                MOV     R5,A
013D A3                INC     DPTR
013E E0                MOVX    A,@DPTR
013F FE                MOV     R6,A
0140 A3                INC     DPTR
0141 E0                MOVX    A,@DPTR
0142 C3                CLR     C
0143 9B                SUBB    A,R3
0144 FF                MOV     R7,A
0145 EE                MOV     A,R6
0146 9A                SUBB    A,R2
0147 FE                MOV     R6,A
0148 ED                MOV     A,R5
0149 99                SUBB    A,R1
014A FD                MOV     R5,A
014B EC                MOV     A,R4
014C 98                SUBB    A,R0
014D FC                MOV     R4,A
014E 900000      R     MOV     DPTR,#aux
0151 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 921
0154 E4                CLR     A
0155 FF                MOV     R7,A
0156 7EC0              MOV     R6,#0C0H
0158 FD                MOV     R5,A
0159 FC                MOV     R4,A
015A 900000      R     MOV     DPTR,#aux
015D E0                MOVX    A,@DPTR
015E F8                MOV     R0,A
015F A3                INC     DPTR
0160 E0                MOVX    A,@DPTR
0161 F9                MOV     R1,A
0162 A3                INC     DPTR
0163 E0                MOVX    A,@DPTR
0164 FA                MOV     R2,A
0165 A3                INC     DPTR
0166 E0                MOVX    A,@DPTR
0167 FB                MOV     R3,A
0168 D3                SETB    C
0169 120000      E     LCALL   ?C?SLCMP
016C 4010              JC      ?C0157
                                           ; SOURCE LINE # 922
016E 7400        E     MOV     A,#LOW g_meas+014H
0170 2500        R     ADD     A,index
0172 F582              MOV     DPL,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 88  

0174 E4                CLR     A
0175 3400        E     ADDC    A,#HIGH g_meas+014H
0177 F583              MOV     DPH,A
0179 E0                MOVX    A,@DPTR
017A 14                DEC     A
017B F0                MOVX    @DPTR,A
017C 8068              SJMP    ?C0158
017E         ?C0157:
                                           ; SOURCE LINE # 923
                                           ; SOURCE LINE # 924
017E 7F00              MOV     R7,#00H
0180 7E40              MOV     R6,#040H
0182 7DFF              MOV     R5,#0FFH
0184 7CFF              MOV     R4,#0FFH
0186 900000      R     MOV     DPTR,#aux
0189 E0                MOVX    A,@DPTR
018A F8                MOV     R0,A
018B A3                INC     DPTR
018C E0                MOVX    A,@DPTR
018D F9                MOV     R1,A
018E A3                INC     DPTR
018F E0                MOVX    A,@DPTR
0190 FA                MOV     R2,A
0191 A3                INC     DPTR
0192 E0                MOVX    A,@DPTR
0193 FB                MOV     R3,A
0194 C3                CLR     C
0195 120000      E     LCALL   ?C?SLCMP
0198 5010              JNC     ?C0159
                                           ; SOURCE LINE # 925
019A 7400        E     MOV     A,#LOW g_meas+014H
019C 2500        R     ADD     A,index
019E F582              MOV     DPL,A
01A0 E4                CLR     A
01A1 3400        E     ADDC    A,#HIGH g_meas+014H
01A3 F583              MOV     DPH,A
01A5 E0                MOVX    A,@DPTR
01A6 04                INC     A
01A7 F0                MOVX    @DPTR,A
01A8 803C              SJMP    ?C0158
01AA         ?C0159:
                                           ; SOURCE LINE # 926
                                           ; SOURCE LINE # 927
01AA 900000      R     MOV     DPTR,#aux
01AD E0                MOVX    A,@DPTR
01AE A3                INC     DPTR
01AF E0                MOVX    A,@DPTR
01B0 A3                INC     DPTR
01B1 E0                MOVX    A,@DPTR
01B2 FE                MOV     R6,A
01B3 A3                INC     DPTR
01B4 E0                MOVX    A,@DPTR
01B5 FF                MOV     R7,A
01B6 120000      E     LCALL   _abs
01B9 D3                SETB    C
01BA EF                MOV     A,R7
01BB 9400              SUBB    A,#00H
01BD EE                MOV     A,R6
01BE 6480              XRL     A,#080H
01C0 94C0              SUBB    A,#0C0H
01C2 4022              JC      ?C0158
                                           ; SOURCE LINE # 928
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 89  

01C4 7400        R     MOV     A,#LOW error
01C6 2500        R     ADD     A,index
01C8 F582              MOV     DPL,A
01CA E4                CLR     A
01CB 3400        R     ADDC    A,#HIGH error
01CD F583              MOV     DPH,A
01CF E0                MOVX    A,@DPTR
01D0 04                INC     A
01D1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 929
01D2 7400        R     MOV     A,#LOW error
01D4 2500        R     ADD     A,index
01D6 F582              MOV     DPL,A
01D8 E4                CLR     A
01D9 3400        R     ADDC    A,#HIGH error
01DB F583              MOV     DPH,A
01DD E0                MOVX    A,@DPTR
01DE C3                CLR     C
01DF 940A              SUBB    A,#0AH
01E1 5003              JNC     $ + 5H
01E3 020000      R     LJMP    ?C0146
01E6         ?C0162:
                                           ; SOURCE LINE # 932
                                           ; SOURCE LINE # 933
                                           ; SOURCE LINE # 934
01E6         ?C0158:
                                           ; SOURCE LINE # 936
01E6 7400        R     MOV     A,#LOW error
01E8 2500        R     ADD     A,index
01EA F582              MOV     DPL,A
01EC E4                CLR     A
01ED 3400        R     ADDC    A,#HIGH error
01EF F583              MOV     DPH,A
01F1 E4                CLR     A
01F2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 938
01F3 900000      R     MOV     DPTR,#value_encoder
01F6 E0                MOVX    A,@DPTR
01F7 FC                MOV     R4,A
01F8 A3                INC     DPTR
01F9 E0                MOVX    A,@DPTR
01FA FD                MOV     R5,A
01FB A3                INC     DPTR
01FC E0                MOVX    A,@DPTR
01FD FE                MOV     R6,A
01FE A3                INC     DPTR
01FF E0                MOVX    A,@DPTR
0200 FF                MOV     R7,A
0201 E500        R     MOV     A,index
0203 25E0              ADD     A,ACC
0205 25E0              ADD     A,ACC
0207 2400        R     ADD     A,#LOW last_value_encoder
0209 F582              MOV     DPL,A
020B E4                CLR     A
020C 3400        R     ADDC    A,#HIGH last_value_encoder
020E F583              MOV     DPH,A
0210 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 940
0213 900000      R     MOV     DPTR,#value_encoder
0216 E0                MOVX    A,@DPTR
0217 F8                MOV     R0,A
0218 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 90  

0219 E0                MOVX    A,@DPTR
021A F9                MOV     R1,A
021B A3                INC     DPTR
021C E0                MOVX    A,@DPTR
021D FA                MOV     R2,A
021E A3                INC     DPTR
021F E0                MOVX    A,@DPTR
0220 FB                MOV     R3,A
0221 C000              PUSH    AR0
0223 7400        E     MOV     A,#LOW g_meas+014H
0225 2500        R     ADD     A,index
0227 F582              MOV     DPL,A
0229 E4                CLR     A
022A 3400        E     ADDC    A,#HIGH g_meas+014H
022C F583              MOV     DPH,A
022E E0                MOVX    A,@DPTR
022F FF                MOV     R7,A
0230 33                RLC     A
0231 95E0              SUBB    A,ACC
0233 FE                MOV     R6,A
0234 FD                MOV     R5,A
0235 FC                MOV     R4,A
0236 7810              MOV     R0,#010H
0238 120000      E     LCALL   ?C?LSHL
023B D000              POP     AR0
023D EB                MOV     A,R3
023E 2F                ADD     A,R7
023F FF                MOV     R7,A
0240 EA                MOV     A,R2
0241 3E                ADDC    A,R6
0242 FE                MOV     R6,A
0243 E9                MOV     A,R1
0244 3D                ADDC    A,R5
0245 FD                MOV     R5,A
0246 E8                MOV     A,R0
0247 3C                ADDC    A,R4
0248 FC                MOV     R4,A
0249 900000      R     MOV     DPTR,#value_encoder
024C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 942
024F E500        R     MOV     A,index
0251 25E0              ADD     A,ACC
0253 25E0              ADD     A,ACC
0255 2400        E     ADD     A,#LOW c_mem+044H
0257 F582              MOV     DPL,A
0259 E4                CLR     A
025A 3400        E     ADDC    A,#HIGH c_mem+044H
025C F583              MOV     DPH,A
025E E0                MOVX    A,@DPTR
025F FC                MOV     R4,A
0260 A3                INC     DPTR
0261 E0                MOVX    A,@DPTR
0262 FD                MOV     R5,A
0263 A3                INC     DPTR
0264 E0                MOVX    A,@DPTR
0265 FE                MOV     R6,A
0266 A3                INC     DPTR
0267 E0                MOVX    A,@DPTR
0268 FF                MOV     R7,A
0269 E4                CLR     A
026A FB                MOV     R3,A
026B FA                MOV     R2,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 91  

026C 7980              MOV     R1,#080H
026E 783F              MOV     R0,#03FH
0270 120000      E     LCALL   ?C?FPCMP3
0273 6038              JZ      ?C0163
                                           ; SOURCE LINE # 943
0275 900000      R     MOV     DPTR,#value_encoder
0278 E0                MOVX    A,@DPTR
0279 FC                MOV     R4,A
027A A3                INC     DPTR
027B E0                MOVX    A,@DPTR
027C FD                MOV     R5,A
027D A3                INC     DPTR
027E E0                MOVX    A,@DPTR
027F FE                MOV     R6,A
0280 A3                INC     DPTR
0281 E0                MOVX    A,@DPTR
0282 FF                MOV     R7,A
0283 EC                MOV     A,R4
0284 120000      E     LCALL   ?C?FCASTL
0287 E500        R     MOV     A,index
0289 25E0              ADD     A,ACC
028B 25E0              ADD     A,ACC
028D 2400        E     ADD     A,#LOW c_mem+044H
028F F582              MOV     DPL,A
0291 E4                CLR     A
0292 3400        E     ADDC    A,#HIGH c_mem+044H
0294 F583              MOV     DPH,A
0296 E0                MOVX    A,@DPTR
0297 F8                MOV     R0,A
0298 A3                INC     DPTR
0299 E0                MOVX    A,@DPTR
029A F9                MOV     R1,A
029B A3                INC     DPTR
029C E0                MOVX    A,@DPTR
029D FA                MOV     R2,A
029E A3                INC     DPTR
029F E0                MOVX    A,@DPTR
02A0 FB                MOV     R3,A
02A1 120000      E     LCALL   ?C?FPMUL
02A4 120000      E     LCALL   ?C?CASTF
02A7 900000      R     MOV     DPTR,#value_encoder
02AA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 944
02AD         ?C0163:
                                           ; SOURCE LINE # 946
02AD 900000      R     MOV     DPTR,#value_encoder
02B0 E0                MOVX    A,@DPTR
02B1 FC                MOV     R4,A
02B2 A3                INC     DPTR
02B3 E0                MOVX    A,@DPTR
02B4 FD                MOV     R5,A
02B5 A3                INC     DPTR
02B6 E0                MOVX    A,@DPTR
02B7 FE                MOV     R6,A
02B8 A3                INC     DPTR
02B9 E0                MOVX    A,@DPTR
02BA FF                MOV     R7,A
02BB E500        R     MOV     A,index
02BD 25E0              ADD     A,ACC
02BF 25E0              ADD     A,ACC
02C1 2400        E     ADD     A,#LOW g_meas
02C3 F582              MOV     DPL,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 92  

02C5 E4                CLR     A
02C6 3400        E     ADDC    A,#HIGH g_meas
02C8 F583              MOV     DPH,A
02CA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 949
02CD 900000      E     MOV     DPTR,#c_mem+079H
02D0 E0                MOVX    A,@DPTR
02D1 6008              JZ      ?C0164
                                           ; SOURCE LINE # 950
02D3 900000      R     MOV     DPTR,#handle_index
02D6 7402              MOV     A,#02H
02D8 F0                MOVX    @DPTR,A
02D9 8006              SJMP    ?C0165
02DB         ?C0164:
                                           ; SOURCE LINE # 952
02DB 900000      R     MOV     DPTR,#handle_index
02DE 7401              MOV     A,#01H
02E0 F0                MOVX    @DPTR,A
02E1         ?C0165:
                                           ; SOURCE LINE # 954
02E1 900000      R     MOV     DPTR,#handle_index
02E4 E0                MOVX    A,@DPTR
02E5 FB                MOV     R3,A
02E6 6500        R     XRL     A,index
02E8 6003              JZ      $ + 5H
02EA 020000      R     LJMP    ?C0154
02ED 900000      E     MOV     DPTR,#c_mem+033H
02F0 E0                MOVX    A,@DPTR
02F1 6401              XRL     A,#01H
02F3 6003              JZ      $ + 5H
02F5 020000      R     LJMP    ?C0154
                                           ; SOURCE LINE # 955
02F8 EB                MOV     A,R3
02F9 25E0              ADD     A,ACC
02FB 25E0              ADD     A,ACC
02FD 2400        E     ADD     A,#LOW g_meas
02FF F582              MOV     DPL,A
0301 E4                CLR     A
0302 3400        E     ADDC    A,#HIGH g_meas
0304 F583              MOV     DPH,A
0306 E0                MOVX    A,@DPTR
0307 FC                MOV     R4,A
0308 A3                INC     DPTR
0309 E0                MOVX    A,@DPTR
030A FD                MOV     R5,A
030B A3                INC     DPTR
030C E0                MOVX    A,@DPTR
030D FE                MOV     R6,A
030E A3                INC     DPTR
030F E0                MOVX    A,@DPTR
0310 FF                MOV     R7,A
0311 7400        E     MOV     A,#LOW g_mem+035H
0313 2B                ADD     A,R3
0314 F582              MOV     DPL,A
0316 E4                CLR     A
0317 3400        E     ADDC    A,#HIGH g_mem+035H
0319 F583              MOV     DPH,A
031B E0                MOVX    A,@DPTR
031C F9                MOV     R1,A
031D F8                MOV     R0,A
031E 120000      E     LCALL   ?C?SLSHR
0321 900000      R     MOV     DPTR,#handle_pos
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 93  

0324 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 957
0327 E500        R     MOV     A,h_status
0329 14                DEC     A
032A 6065              JZ      ?C0171
032C 04                INC     A
032D 6003              JZ      $ + 5H
032F 020000      R     LJMP    ?C0154
                                           ; SOURCE LINE # 958
0332         ?C0168:
                                           ; SOURCE LINE # 959
0332 900000      E     MOV     DPTR,#c_mem+09AH
0335 E0                MOVX    A,@DPTR
0336 7025              JNZ     ?C0169
0338 900000      E     MOV     DPTR,#c_mem+096H
033B E0                MOVX    A,@DPTR
033C FC                MOV     R4,A
033D A3                INC     DPTR
033E E0                MOVX    A,@DPTR
033F FD                MOV     R5,A
0340 A3                INC     DPTR
0341 E0                MOVX    A,@DPTR
0342 FE                MOV     R6,A
0343 A3                INC     DPTR
0344 E0                MOVX    A,@DPTR
0345 FF                MOV     R7,A
0346 900000      R     MOV     DPTR,#handle_pos
0349 E0                MOVX    A,@DPTR
034A F8                MOV     R0,A
034B A3                INC     DPTR
034C E0                MOVX    A,@DPTR
034D F9                MOV     R1,A
034E A3                INC     DPTR
034F E0                MOVX    A,@DPTR
0350 FA                MOV     R2,A
0351 A3                INC     DPTR
0352 E0                MOVX    A,@DPTR
0353 FB                MOV     R3,A
0354 D3                SETB    C
0355 120000      E     LCALL   ?C?SLCMP
0358 4003              JC      ?C0169
                                           ; SOURCE LINE # 960
035A 750001      R     MOV     h_status,#01H
                                           ; SOURCE LINE # 961
035D         ?C0169:
                                           ; SOURCE LINE # 962
035D 900000      E     MOV     DPTR,#c_mem+09AH
0360 E0                MOVX    A,@DPTR
0361 6401              XRL     A,#01H
0363 6003              JZ      $ + 5H
0365 020000      R     LJMP    ?C0154
0368 A3                INC     DPTR
0369 E0                MOVX    A,@DPTR
036A FC                MOV     R4,A
036B A3                INC     DPTR
036C E0                MOVX    A,@DPTR
036D FD                MOV     R5,A
036E A3                INC     DPTR
036F E0                MOVX    A,@DPTR
0370 FE                MOV     R6,A
0371 A3                INC     DPTR
0372 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 94  

0373 FF                MOV     R7,A
0374 900000      R     MOV     DPTR,#handle_pos
0377 E0                MOVX    A,@DPTR
0378 F8                MOV     R0,A
0379 A3                INC     DPTR
037A E0                MOVX    A,@DPTR
037B F9                MOV     R1,A
037C A3                INC     DPTR
037D E0                MOVX    A,@DPTR
037E FA                MOV     R2,A
037F A3                INC     DPTR
0380 E0                MOVX    A,@DPTR
0381 FB                MOV     R3,A
0382 C3                CLR     C
0383 120000      E     LCALL   ?C?SLCMP
0386 4003              JC      $ + 5H
0388 020000      R     LJMP    ?C0154
                                           ; SOURCE LINE # 963
038B 750001      R     MOV     h_status,#01H
                                           ; SOURCE LINE # 964
                                           ; SOURCE LINE # 965
038E 020000      R     LJMP    ?C0154
                                           ; SOURCE LINE # 966
0391         ?C0171:
                                           ; SOURCE LINE # 968
0391 900000      E     MOV     DPTR,#c_mem+09AH
0394 E0                MOVX    A,@DPTR
0395 702B              JNZ     ?C0172
0397 7F28              MOV     R7,#028H
0399 FE                MOV     R6,A
039A FD                MOV     R5,A
039B FC                MOV     R4,A
039C 900000      R     MOV     DPTR,#handle_pos
039F E0                MOVX    A,@DPTR
03A0 F8                MOV     R0,A
03A1 A3                INC     DPTR
03A2 E0                MOVX    A,@DPTR
03A3 F9                MOV     R1,A
03A4 A3                INC     DPTR
03A5 E0                MOVX    A,@DPTR
03A6 FA                MOV     R2,A
03A7 A3                INC     DPTR
03A8 E0                MOVX    A,@DPTR
03A9 FB                MOV     R3,A
03AA C3                CLR     C
03AB 120000      E     LCALL   ?C?SLCMP
03AE 5012              JNC     ?C0172
                                           ; SOURCE LINE # 970
03B0 900000      E     MOV     DPTR,#normally_closed_mode
03B3 E0                MOVX    A,@DPTR
03B4 7004              JNZ     ?C0173
                                           ; SOURCE LINE # 971
03B6 04                INC     A
03B7 F0                MOVX    @DPTR,A
03B8 8005              SJMP    ?C0174
03BA         ?C0173:
                                           ; SOURCE LINE # 973
03BA E4                CLR     A
03BB 900000      E     MOV     DPTR,#normally_closed_mode
03BE F0                MOVX    @DPTR,A
03BF         ?C0174:
                                           ; SOURCE LINE # 975
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 95  

03BF E4                CLR     A
03C0 F500        R     MOV     h_status,A
                                           ; SOURCE LINE # 976
03C2         ?C0172:
                                           ; SOURCE LINE # 978
03C2 900000      E     MOV     DPTR,#c_mem+09AH
03C5 E0                MOVX    A,@DPTR
03C6 6401              XRL     A,#01H
03C8 7067              JNZ     ?C0154
03CA 900000      E     MOV     DPTR,#c_mem+09FH
03CD E0                MOVX    A,@DPTR
03CE FC                MOV     R4,A
03CF A3                INC     DPTR
03D0 E0                MOVX    A,@DPTR
03D1 FD                MOV     R5,A
03D2 A3                INC     DPTR
03D3 E0                MOVX    A,@DPTR
03D4 FE                MOV     R6,A
03D5 A3                INC     DPTR
03D6 E0                MOVX    A,@DPTR
03D7 FF                MOV     R7,A
03D8 900000      R     MOV     DPTR,#handle_pos
03DB E0                MOVX    A,@DPTR
03DC F8                MOV     R0,A
03DD A3                INC     DPTR
03DE E0                MOVX    A,@DPTR
03DF F9                MOV     R1,A
03E0 A3                INC     DPTR
03E1 E0                MOVX    A,@DPTR
03E2 FA                MOV     R2,A
03E3 A3                INC     DPTR
03E4 E0                MOVX    A,@DPTR
03E5 FB                MOV     R3,A
03E6 D3                SETB    C
03E7 120000      E     LCALL   ?C?SLCMP
03EA 4045              JC      ?C0154
                                           ; SOURCE LINE # 980
03EC 900000      E     MOV     DPTR,#normally_closed_mode
03EF E0                MOVX    A,@DPTR
03F0 B4012B            CJNE    A,#01H,?C0176
                                           ; SOURCE LINE # 981
03F3 E4                CLR     A
03F4 7F84              MOV     R7,#084H
03F6 7E03              MOV     R6,#03H
03F8 FD                MOV     R5,A
03F9 FC                MOV     R4,A
03FA 900000      R     MOV     DPTR,#handle_pos
03FD E0                MOVX    A,@DPTR
03FE F8                MOV     R0,A
03FF A3                INC     DPTR
0400 E0                MOVX    A,@DPTR
0401 A3                INC     DPTR
0402 E0                MOVX    A,@DPTR
0403 A3                INC     DPTR
0404 E0                MOVX    A,@DPTR
0405 D3                SETB    C
0406 120000      E     LCALL   ?C?SLCMP
0409 400B              JC      ?C0177
                                           ; SOURCE LINE # 982
040B E4                CLR     A
040C 900000      E     MOV     DPTR,#normally_closed_mode
040F F0                MOVX    @DPTR,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 96  

                                           ; SOURCE LINE # 983
0410 900000      R     MOV     DPTR,#wait_for_switch
0413 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 984
0414 8013              SJMP    ?C0179
0416         ?C0177:
                                           ; SOURCE LINE # 986
0416 900000      R     MOV     DPTR,#wait_for_switch
0419 7401              MOV     A,#01H
041B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 987
041C 800B              SJMP    ?C0179
041E         ?C0176:
                                           ; SOURCE LINE # 988
                                           ; SOURCE LINE # 989
041E 900000      E     MOV     DPTR,#normally_closed_mode
0421 7401              MOV     A,#01H
0423 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 990
0424 E4                CLR     A
0425 900000      R     MOV     DPTR,#wait_for_switch
0428 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 991
0429         ?C0179:
                                           ; SOURCE LINE # 994
0429 900000      R     MOV     DPTR,#wait_for_switch
042C E0                MOVX    A,@DPTR
042D 7002              JNZ     ?C0154
                                           ; SOURCE LINE # 995
042F F500        R     MOV     h_status,A
                                           ; SOURCE LINE # 996
                                           ; SOURCE LINE # 998
                                           ; SOURCE LINE # 999
                                           ; SOURCE LINE # 1000
                                           ; SOURCE LINE # 1001
0431         ?C0154:
                                           ; SOURCE LINE # 1003
0431 E500        R     MOV     A,index
0433 14                DEC     A
0434 7003              JNZ     $ + 5H
0436 020000      R     LJMP    ?C0183
0439 14                DEC     A
043A 7003              JNZ     $ + 5H
043C 020000      R     LJMP    ?C0184
043F 2402              ADD     A,#02H
0441 6003              JZ      $ + 5H
0443 020000      R     LJMP    ?C0181
                                           ; SOURCE LINE # 1004
0446         ?C0182:
                                           ; SOURCE LINE # 1005
0446 E4                CLR     A
0447 7F12              MOV     R7,#012H
0449 FE                MOV     R6,A
044A FD                MOV     R5,A
044B FC                MOV     R4,A
044C 900000      R     MOV     DPTR,#v_value
044F E0                MOVX    A,@DPTR
0450 F8                MOV     R0,A
0451 A3                INC     DPTR
0452 E0                MOVX    A,@DPTR
0453 F9                MOV     R1,A
0454 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 97  

0455 E0                MOVX    A,@DPTR
0456 FA                MOV     R2,A
0457 A3                INC     DPTR
0458 E0                MOVX    A,@DPTR
0459 FB                MOV     R3,A
045A 120000      E     LCALL   ?C?LMUL
045D C004              PUSH    AR4
045F C005              PUSH    AR5
0461 C006              PUSH    AR6
0463 C007              PUSH    AR7
0465 E4                CLR     A
0466 7F0B              MOV     R7,#0BH
0468 FE                MOV     R6,A
0469 FD                MOV     R5,A
046A FC                MOV     R4,A
046B 900000      R     MOV     DPTR,#value_encoder
046E E0                MOVX    A,@DPTR
046F F8                MOV     R0,A
0470 A3                INC     DPTR
0471 E0                MOVX    A,@DPTR
0472 F9                MOV     R1,A
0473 A3                INC     DPTR
0474 E0                MOVX    A,@DPTR
0475 FA                MOV     R2,A
0476 A3                INC     DPTR
0477 E0                MOVX    A,@DPTR
0478 FB                MOV     R3,A
0479 120000      E     LCALL   ?C?LMUL
047C D003              POP     AR3
047E D002              POP     AR2
0480 D001              POP     AR1
0482 D000              POP     AR0
0484 C3                CLR     C
0485 EF                MOV     A,R7
0486 9B                SUBB    A,R3
0487 FF                MOV     R7,A
0488 EE                MOV     A,R6
0489 9A                SUBB    A,R2
048A FE                MOV     R6,A
048B ED                MOV     A,R5
048C 99                SUBB    A,R1
048D FD                MOV     R5,A
048E EC                MOV     A,R4
048F 98                SUBB    A,R0
0490 FC                MOV     R4,A
0491 C004              PUSH    AR4
0493 C005              PUSH    AR5
0495 C006              PUSH    AR6
0497 C007              PUSH    AR7
0499 E4                CLR     A
049A 7F09              MOV     R7,#09H
049C FE                MOV     R6,A
049D FD                MOV     R5,A
049E FC                MOV     R4,A
049F 900000      R     MOV     DPTR,#vv_value
04A2 E0                MOVX    A,@DPTR
04A3 F8                MOV     R0,A
04A4 A3                INC     DPTR
04A5 E0                MOVX    A,@DPTR
04A6 F9                MOV     R1,A
04A7 A3                INC     DPTR
04A8 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 98  

04A9 FA                MOV     R2,A
04AA A3                INC     DPTR
04AB E0                MOVX    A,@DPTR
04AC FB                MOV     R3,A
04AD 120000      E     LCALL   ?C?LMUL
04B0 D003              POP     AR3
04B2 D002              POP     AR2
04B4 D001              POP     AR1
04B6 D000              POP     AR0
04B8 EF                MOV     A,R7
04B9 2B                ADD     A,R3
04BA FF                MOV     R7,A
04BB EE                MOV     A,R6
04BC 3A                ADDC    A,R2
04BD FE                MOV     R6,A
04BE ED                MOV     A,R5
04BF 39                ADDC    A,R1
04C0 FD                MOV     R5,A
04C1 EC                MOV     A,R4
04C2 38                ADDC    A,R0
04C3 FC                MOV     R4,A
04C4 C004              PUSH    AR4
04C6 C005              PUSH    AR5
04C8 C006              PUSH    AR6
04CA C007              PUSH    AR7
04CC E4                CLR     A
04CD 7F02              MOV     R7,#02H
04CF FE                MOV     R6,A
04D0 FD                MOV     R5,A
04D1 FC                MOV     R4,A
04D2 900000      R     MOV     DPTR,#vvv_value
04D5 E0                MOVX    A,@DPTR
04D6 F8                MOV     R0,A
04D7 A3                INC     DPTR
04D8 E0                MOVX    A,@DPTR
04D9 F9                MOV     R1,A
04DA A3                INC     DPTR
04DB E0                MOVX    A,@DPTR
04DC FA                MOV     R2,A
04DD A3                INC     DPTR
04DE E0                MOVX    A,@DPTR
04DF FB                MOV     R3,A
04E0 120000      E     LCALL   ?C?LMUL
04E3 A804              MOV     R0,AR4
04E5 A905              MOV     R1,AR5
04E7 AA06              MOV     R2,AR6
04E9 AB07              MOV     R3,AR7
04EB D007              POP     AR7
04ED D006              POP     AR6
04EF D005              POP     AR5
04F1 D004              POP     AR4
04F3 C3                CLR     C
04F4 EF                MOV     A,R7
04F5 9B                SUBB    A,R3
04F6 FF                MOV     R7,A
04F7 EE                MOV     A,R6
04F8 9A                SUBB    A,R2
04F9 FE                MOV     R6,A
04FA ED                MOV     A,R5
04FB 99                SUBB    A,R1
04FC FD                MOV     R5,A
04FD EC                MOV     A,R4
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 99  

04FE 98                SUBB    A,R0
04FF FC                MOV     R4,A
0500 120000      E     LCALL   _filter_vel_1
0503 EE                MOV     A,R6
0504 33                RLC     A
0505 95E0              SUBB    A,ACC
0507 FD                MOV     R5,A
0508 FC                MOV     R4,A
0509 900000      R     MOV     DPTR,#speed_encoder
050C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1006
050F 020000      R     LJMP    ?C0181
                                           ; SOURCE LINE # 1008
0512         ?C0183:
                                           ; SOURCE LINE # 1009
0512 E4                CLR     A
0513 7F12              MOV     R7,#012H
0515 FE                MOV     R6,A
0516 FD                MOV     R5,A
0517 FC                MOV     R4,A
0518 900000      R     MOV     DPTR,#v_value+04H
051B E0                MOVX    A,@DPTR
051C F8                MOV     R0,A
051D A3                INC     DPTR
051E E0                MOVX    A,@DPTR
051F F9                MOV     R1,A
0520 A3                INC     DPTR
0521 E0                MOVX    A,@DPTR
0522 FA                MOV     R2,A
0523 A3                INC     DPTR
0524 E0                MOVX    A,@DPTR
0525 FB                MOV     R3,A
0526 120000      E     LCALL   ?C?LMUL
0529 C004              PUSH    AR4
052B C005              PUSH    AR5
052D C006              PUSH    AR6
052F C007              PUSH    AR7
0531 E4                CLR     A
0532 7F0B              MOV     R7,#0BH
0534 FE                MOV     R6,A
0535 FD                MOV     R5,A
0536 FC                MOV     R4,A
0537 900000      R     MOV     DPTR,#value_encoder
053A E0                MOVX    A,@DPTR
053B F8                MOV     R0,A
053C A3                INC     DPTR
053D E0                MOVX    A,@DPTR
053E F9                MOV     R1,A
053F A3                INC     DPTR
0540 E0                MOVX    A,@DPTR
0541 FA                MOV     R2,A
0542 A3                INC     DPTR
0543 E0                MOVX    A,@DPTR
0544 FB                MOV     R3,A
0545 120000      E     LCALL   ?C?LMUL
0548 D003              POP     AR3
054A D002              POP     AR2
054C D001              POP     AR1
054E D000              POP     AR0
0550 C3                CLR     C
0551 EF                MOV     A,R7
0552 9B                SUBB    A,R3
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 100 

0553 FF                MOV     R7,A
0554 EE                MOV     A,R6
0555 9A                SUBB    A,R2
0556 FE                MOV     R6,A
0557 ED                MOV     A,R5
0558 99                SUBB    A,R1
0559 FD                MOV     R5,A
055A EC                MOV     A,R4
055B 98                SUBB    A,R0
055C FC                MOV     R4,A
055D C004              PUSH    AR4
055F C005              PUSH    AR5
0561 C006              PUSH    AR6
0563 C007              PUSH    AR7
0565 E4                CLR     A
0566 7F09              MOV     R7,#09H
0568 FE                MOV     R6,A
0569 FD                MOV     R5,A
056A FC                MOV     R4,A
056B 900000      R     MOV     DPTR,#vv_value+04H
056E E0                MOVX    A,@DPTR
056F F8                MOV     R0,A
0570 A3                INC     DPTR
0571 E0                MOVX    A,@DPTR
0572 F9                MOV     R1,A
0573 A3                INC     DPTR
0574 E0                MOVX    A,@DPTR
0575 FA                MOV     R2,A
0576 A3                INC     DPTR
0577 E0                MOVX    A,@DPTR
0578 FB                MOV     R3,A
0579 120000      E     LCALL   ?C?LMUL
057C D003              POP     AR3
057E D002              POP     AR2
0580 D001              POP     AR1
0582 D000              POP     AR0
0584 EF                MOV     A,R7
0585 2B                ADD     A,R3
0586 FF                MOV     R7,A
0587 EE                MOV     A,R6
0588 3A                ADDC    A,R2
0589 FE                MOV     R6,A
058A ED                MOV     A,R5
058B 39                ADDC    A,R1
058C FD                MOV     R5,A
058D EC                MOV     A,R4
058E 38                ADDC    A,R0
058F FC                MOV     R4,A
0590 C004              PUSH    AR4
0592 C005              PUSH    AR5
0594 C006              PUSH    AR6
0596 C007              PUSH    AR7
0598 E4                CLR     A
0599 7F02              MOV     R7,#02H
059B FE                MOV     R6,A
059C FD                MOV     R5,A
059D FC                MOV     R4,A
059E 900000      R     MOV     DPTR,#vvv_value+04H
05A1 E0                MOVX    A,@DPTR
05A2 F8                MOV     R0,A
05A3 A3                INC     DPTR
05A4 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 101 

05A5 F9                MOV     R1,A
05A6 A3                INC     DPTR
05A7 E0                MOVX    A,@DPTR
05A8 FA                MOV     R2,A
05A9 A3                INC     DPTR
05AA E0                MOVX    A,@DPTR
05AB FB                MOV     R3,A
05AC 120000      E     LCALL   ?C?LMUL
05AF A804              MOV     R0,AR4
05B1 A905              MOV     R1,AR5
05B3 AA06              MOV     R2,AR6
05B5 AB07              MOV     R3,AR7
05B7 D007              POP     AR7
05B9 D006              POP     AR6
05BB D005              POP     AR5
05BD D004              POP     AR4
05BF C3                CLR     C
05C0 EF                MOV     A,R7
05C1 9B                SUBB    A,R3
05C2 FF                MOV     R7,A
05C3 EE                MOV     A,R6
05C4 9A                SUBB    A,R2
05C5 FE                MOV     R6,A
05C6 ED                MOV     A,R5
05C7 99                SUBB    A,R1
05C8 FD                MOV     R5,A
05C9 EC                MOV     A,R4
05CA 98                SUBB    A,R0
05CB FC                MOV     R4,A
05CC 120000      E     LCALL   _filter_vel_2
05CF EE                MOV     A,R6
05D0 33                RLC     A
05D1 95E0              SUBB    A,ACC
05D3 FD                MOV     R5,A
05D4 FC                MOV     R4,A
05D5 900000      R     MOV     DPTR,#speed_encoder
05D8 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1010
05DB 020000      R     LJMP    ?C0181
                                           ; SOURCE LINE # 1012
05DE         ?C0184:
                                           ; SOURCE LINE # 1013
05DE E4                CLR     A
05DF 7F12              MOV     R7,#012H
05E1 FE                MOV     R6,A
05E2 FD                MOV     R5,A
05E3 FC                MOV     R4,A
05E4 900000      R     MOV     DPTR,#v_value+08H
05E7 E0                MOVX    A,@DPTR
05E8 F8                MOV     R0,A
05E9 A3                INC     DPTR
05EA E0                MOVX    A,@DPTR
05EB F9                MOV     R1,A
05EC A3                INC     DPTR
05ED E0                MOVX    A,@DPTR
05EE FA                MOV     R2,A
05EF A3                INC     DPTR
05F0 E0                MOVX    A,@DPTR
05F1 FB                MOV     R3,A
05F2 120000      E     LCALL   ?C?LMUL
05F5 C004              PUSH    AR4
05F7 C005              PUSH    AR5
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 102 

05F9 C006              PUSH    AR6
05FB C007              PUSH    AR7
05FD E4                CLR     A
05FE 7F0B              MOV     R7,#0BH
0600 FE                MOV     R6,A
0601 FD                MOV     R5,A
0602 FC                MOV     R4,A
0603 900000      R     MOV     DPTR,#value_encoder
0606 E0                MOVX    A,@DPTR
0607 F8                MOV     R0,A
0608 A3                INC     DPTR
0609 E0                MOVX    A,@DPTR
060A F9                MOV     R1,A
060B A3                INC     DPTR
060C E0                MOVX    A,@DPTR
060D FA                MOV     R2,A
060E A3                INC     DPTR
060F E0                MOVX    A,@DPTR
0610 FB                MOV     R3,A
0611 120000      E     LCALL   ?C?LMUL
0614 D003              POP     AR3
0616 D002              POP     AR2
0618 D001              POP     AR1
061A D000              POP     AR0
061C C3                CLR     C
061D EF                MOV     A,R7
061E 9B                SUBB    A,R3
061F FF                MOV     R7,A
0620 EE                MOV     A,R6
0621 9A                SUBB    A,R2
0622 FE                MOV     R6,A
0623 ED                MOV     A,R5
0624 99                SUBB    A,R1
0625 FD                MOV     R5,A
0626 EC                MOV     A,R4
0627 98                SUBB    A,R0
0628 FC                MOV     R4,A
0629 C004              PUSH    AR4
062B C005              PUSH    AR5
062D C006              PUSH    AR6
062F C007              PUSH    AR7
0631 E4                CLR     A
0632 7F09              MOV     R7,#09H
0634 FE                MOV     R6,A
0635 FD                MOV     R5,A
0636 FC                MOV     R4,A
0637 900000      R     MOV     DPTR,#vv_value+08H
063A E0                MOVX    A,@DPTR
063B F8                MOV     R0,A
063C A3                INC     DPTR
063D E0                MOVX    A,@DPTR
063E F9                MOV     R1,A
063F A3                INC     DPTR
0640 E0                MOVX    A,@DPTR
0641 FA                MOV     R2,A
0642 A3                INC     DPTR
0643 E0                MOVX    A,@DPTR
0644 FB                MOV     R3,A
0645 120000      E     LCALL   ?C?LMUL
0648 D003              POP     AR3
064A D002              POP     AR2
064C D001              POP     AR1
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 103 

064E D000              POP     AR0
0650 EF                MOV     A,R7
0651 2B                ADD     A,R3
0652 FF                MOV     R7,A
0653 EE                MOV     A,R6
0654 3A                ADDC    A,R2
0655 FE                MOV     R6,A
0656 ED                MOV     A,R5
0657 39                ADDC    A,R1
0658 FD                MOV     R5,A
0659 EC                MOV     A,R4
065A 38                ADDC    A,R0
065B FC                MOV     R4,A
065C C004              PUSH    AR4
065E C005              PUSH    AR5
0660 C006              PUSH    AR6
0662 C007              PUSH    AR7
0664 E4                CLR     A
0665 7F02              MOV     R7,#02H
0667 FE                MOV     R6,A
0668 FD                MOV     R5,A
0669 FC                MOV     R4,A
066A 900000      R     MOV     DPTR,#vvv_value+08H
066D E0                MOVX    A,@DPTR
066E F8                MOV     R0,A
066F A3                INC     DPTR
0670 E0                MOVX    A,@DPTR
0671 F9                MOV     R1,A
0672 A3                INC     DPTR
0673 E0                MOVX    A,@DPTR
0674 FA                MOV     R2,A
0675 A3                INC     DPTR
0676 E0                MOVX    A,@DPTR
0677 FB                MOV     R3,A
0678 120000      E     LCALL   ?C?LMUL
067B A804              MOV     R0,AR4
067D A905              MOV     R1,AR5
067F AA06              MOV     R2,AR6
0681 AB07              MOV     R3,AR7
0683 D007              POP     AR7
0685 D006              POP     AR6
0687 D005              POP     AR5
0689 D004              POP     AR4
068B C3                CLR     C
068C EF                MOV     A,R7
068D 9B                SUBB    A,R3
068E FF                MOV     R7,A
068F EE                MOV     A,R6
0690 9A                SUBB    A,R2
0691 FE                MOV     R6,A
0692 ED                MOV     A,R5
0693 99                SUBB    A,R1
0694 FD                MOV     R5,A
0695 EC                MOV     A,R4
0696 98                SUBB    A,R0
0697 FC                MOV     R4,A
0698 120000      E     LCALL   _filter_vel_3
069B EE                MOV     A,R6
069C 33                RLC     A
069D 95E0              SUBB    A,ACC
069F FD                MOV     R5,A
06A0 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 104 

06A1 900000      R     MOV     DPTR,#speed_encoder
06A4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1014
                                           ; SOURCE LINE # 1015
06A7         ?C0181:
                                           ; SOURCE LINE # 1017
06A7 E4                CLR     A
06A8 FF                MOV     R7,A
06A9 FE                MOV     R6,A
06AA 7DC0              MOV     R5,#0C0H
06AC 7C40              MOV     R4,#040H
06AE 900000      E     MOV     DPTR,#cycle_time
06B1 E0                MOVX    A,@DPTR
06B2 F8                MOV     R0,A
06B3 A3                INC     DPTR
06B4 E0                MOVX    A,@DPTR
06B5 F9                MOV     R1,A
06B6 A3                INC     DPTR
06B7 E0                MOVX    A,@DPTR
06B8 FA                MOV     R2,A
06B9 A3                INC     DPTR
06BA E0                MOVX    A,@DPTR
06BB FB                MOV     R3,A
06BC 120000      E     LCALL   ?C?FPMUL
06BF C004              PUSH    AR4
06C1 C005              PUSH    AR5
06C3 C006              PUSH    AR6
06C5 C007              PUSH    AR7
06C7 900000      R     MOV     DPTR,#speed_encoder
06CA E0                MOVX    A,@DPTR
06CB FC                MOV     R4,A
06CC A3                INC     DPTR
06CD E0                MOVX    A,@DPTR
06CE FD                MOV     R5,A
06CF A3                INC     DPTR
06D0 E0                MOVX    A,@DPTR
06D1 FE                MOV     R6,A
06D2 A3                INC     DPTR
06D3 E0                MOVX    A,@DPTR
06D4 FF                MOV     R7,A
06D5 EC                MOV     A,R4
06D6 120000      E     LCALL   ?C?FCASTL
06D9 D003              POP     AR3
06DB D002              POP     AR2
06DD D001              POP     AR1
06DF D000              POP     AR0
06E1 120000      E     LCALL   ?C?FPDIV
06E4 120000      E     LCALL   ?C?CASTF
06E7 900000      R     MOV     DPTR,#speed_encoder
06EA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1018
06ED 900000      R     MOV     DPTR,#speed_encoder
06F0 E0                MOVX    A,@DPTR
06F1 FC                MOV     R4,A
06F2 A3                INC     DPTR
06F3 E0                MOVX    A,@DPTR
06F4 FD                MOV     R5,A
06F5 A3                INC     DPTR
06F6 E0                MOVX    A,@DPTR
06F7 FE                MOV     R6,A
06F8 A3                INC     DPTR
06F9 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 105 

06FA FF                MOV     R7,A
06FB E500        R     MOV     A,index
06FD 25E0              ADD     A,ACC
06FF 25E0              ADD     A,ACC
0701 2400        E     ADD     A,#LOW g_meas+01FH
0703 F582              MOV     DPL,A
0705 E4                CLR     A
0706 3400        E     ADDC    A,#HIGH g_meas+01FH
0708 F583              MOV     DPH,A
070A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1040
070D E500        R     MOV     A,index
070F 25E0              ADD     A,ACC
0711 25E0              ADD     A,ACC
0713 2400        R     ADD     A,#LOW vv_value
0715 F582              MOV     DPL,A
0717 E4                CLR     A
0718 3400        R     ADDC    A,#HIGH vv_value
071A F583              MOV     DPH,A
071C E0                MOVX    A,@DPTR
071D FC                MOV     R4,A
071E A3                INC     DPTR
071F E0                MOVX    A,@DPTR
0720 FD                MOV     R5,A
0721 A3                INC     DPTR
0722 E0                MOVX    A,@DPTR
0723 FE                MOV     R6,A
0724 A3                INC     DPTR
0725 E0                MOVX    A,@DPTR
0726 FF                MOV     R7,A
0727 E500        R     MOV     A,index
0729 25E0              ADD     A,ACC
072B 25E0              ADD     A,ACC
072D 2400        R     ADD     A,#LOW vvv_value
072F F582              MOV     DPL,A
0731 E4                CLR     A
0732 3400        R     ADDC    A,#HIGH vvv_value
0734 F583              MOV     DPH,A
0736 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1041
0739 E500        R     MOV     A,index
073B 25E0              ADD     A,ACC
073D 25E0              ADD     A,ACC
073F 2400        R     ADD     A,#LOW v_value
0741 F582              MOV     DPL,A
0743 E4                CLR     A
0744 3400        R     ADDC    A,#HIGH v_value
0746 F583              MOV     DPH,A
0748 E0                MOVX    A,@DPTR
0749 FC                MOV     R4,A
074A A3                INC     DPTR
074B E0                MOVX    A,@DPTR
074C FD                MOV     R5,A
074D A3                INC     DPTR
074E E0                MOVX    A,@DPTR
074F FE                MOV     R6,A
0750 A3                INC     DPTR
0751 E0                MOVX    A,@DPTR
0752 FF                MOV     R7,A
0753 E500        R     MOV     A,index
0755 25E0              ADD     A,ACC
0757 25E0              ADD     A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 106 

0759 2400        R     ADD     A,#LOW vv_value
075B F582              MOV     DPL,A
075D E4                CLR     A
075E 3400        R     ADDC    A,#HIGH vv_value
0760 F583              MOV     DPH,A
0762 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1042
0765 900000      R     MOV     DPTR,#value_encoder
0768 E0                MOVX    A,@DPTR
0769 FC                MOV     R4,A
076A A3                INC     DPTR
076B E0                MOVX    A,@DPTR
076C FD                MOV     R5,A
076D A3                INC     DPTR
076E E0                MOVX    A,@DPTR
076F FE                MOV     R6,A
0770 A3                INC     DPTR
0771 E0                MOVX    A,@DPTR
0772 FF                MOV     R7,A
0773 E500        R     MOV     A,index
0775 25E0              ADD     A,ACC
0777 25E0              ADD     A,ACC
0779 2400        R     ADD     A,#LOW v_value
077B F582              MOV     DPL,A
077D E4                CLR     A
077E 3400        R     ADDC    A,#HIGH v_value
0780 F583              MOV     DPH,A
0782 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1052
0785 300003      R     JNB     pos_reconstruct,$ + 6H
0788 020000      R     LJMP    ?C0146
                                           ; SOURCE LINE # 1053
078B 900000      R     MOV     DPTR,#one_time_execute
078E E0                MOVX    A,@DPTR
078F C3                CLR     C
0790 9422              SUBB    A,#022H
0792 5004              JNC     ?C0186
                                           ; SOURCE LINE # 1054
0794 E0                MOVX    A,@DPTR
0795 04                INC     A
0796 F0                MOVX    @DPTR,A
0797 22                RET     
0798         ?C0186:
                                           ; SOURCE LINE # 1055
                                           ; SOURCE LINE # 1057
0798 900000      E     MOV     DPTR,#c_mem+079H
079B E0                MOVX    A,@DPTR
079C 606E              JZ      ?C0188
                                           ; SOURCE LINE # 1059
079E 900000      E     MOV     DPTR,#g_meas+04H
07A1 E0                MOVX    A,@DPTR
07A2 FC                MOV     R4,A
07A3 A3                INC     DPTR
07A4 E0                MOVX    A,@DPTR
07A5 FD                MOV     R5,A
07A6 A3                INC     DPTR
07A7 E0                MOVX    A,@DPTR
07A8 FE                MOV     R6,A
07A9 A3                INC     DPTR
07AA E0                MOVX    A,@DPTR
07AB FF                MOV     R7,A
07AC 900000      E     MOV     DPTR,#?_calc_turns_fcn?BYTE+04H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 107 

07AF 120000      E     LCALL   ?C?LSTXDATA
07B2 900000      E     MOV     DPTR,#g_meas
07B5 E0                MOVX    A,@DPTR
07B6 FC                MOV     R4,A
07B7 A3                INC     DPTR
07B8 E0                MOVX    A,@DPTR
07B9 FD                MOV     R5,A
07BA A3                INC     DPTR
07BB E0                MOVX    A,@DPTR
07BC FE                MOV     R6,A
07BD A3                INC     DPTR
07BE E0                MOVX    A,@DPTR
07BF FF                MOV     R7,A
07C0 120000      E     LCALL   _calc_turns_fcn
07C3 EE                MOV     A,R6
07C4 33                RLC     A
07C5 95E0              SUBB    A,ACC
07C7 FD                MOV     R5,A
07C8 FC                MOV     R4,A
07C9 900000      R     MOV     DPTR,#init_rot
07CC 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1061
07CF E4                CLR     A
07D0 FF                MOV     R7,A
07D1 FE                MOV     R6,A
07D2 FD                MOV     R5,A
07D3 FC                MOV     R4,A
07D4 900000      E     MOV     DPTR,#c_mem+044H
07D7 E0                MOVX    A,@DPTR
07D8 F8                MOV     R0,A
07D9 A3                INC     DPTR
07DA E0                MOVX    A,@DPTR
07DB F9                MOV     R1,A
07DC A3                INC     DPTR
07DD E0                MOVX    A,@DPTR
07DE FA                MOV     R2,A
07DF A3                INC     DPTR
07E0 E0                MOVX    A,@DPTR
07E1 FB                MOV     R3,A
07E2 120000      E     LCALL   ?C?FPCMP3
07E5 5017              JNC     ?C0189
                                           ; SOURCE LINE # 1062
07E7 900000      R     MOV     DPTR,#init_rot
07EA E0                MOVX    A,@DPTR
07EB FC                MOV     R4,A
07EC A3                INC     DPTR
07ED E0                MOVX    A,@DPTR
07EE FD                MOV     R5,A
07EF A3                INC     DPTR
07F0 E0                MOVX    A,@DPTR
07F1 FE                MOV     R6,A
07F2 A3                INC     DPTR
07F3 E0                MOVX    A,@DPTR
07F4 FF                MOV     R7,A
07F5 120000      E     LCALL   ?C?LNEG
07F8 900000      R     MOV     DPTR,#init_rot
07FB 120000      E     LCALL   ?C?LSTXDATA
07FE         ?C0189:
                                           ; SOURCE LINE # 1064
07FE 900000      R     MOV     DPTR,#init_rot
0801 E0                MOVX    A,@DPTR
0802 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 108 

0803 E0                MOVX    A,@DPTR
0804 A3                INC     DPTR
0805 E0                MOVX    A,@DPTR
0806 A3                INC     DPTR
0807 E0                MOVX    A,@DPTR
0808 900000      E     MOV     DPTR,#g_meas+014H
080B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1066
080C         ?C0188:
                                           ; SOURCE LINE # 1069
080C 7400        E     MOV     A,#LOW c_mem+044H
080E 6401              XRL     A,#01H
0810 4400        E     ORL     A,#HIGH c_mem+044H
0812 602C              JZ      ?C0190
                                           ; SOURCE LINE # 1070
0814 900000      E     MOV     DPTR,#g_meas
0817 E0                MOVX    A,@DPTR
0818 FC                MOV     R4,A
0819 A3                INC     DPTR
081A E0                MOVX    A,@DPTR
081B FD                MOV     R5,A
081C A3                INC     DPTR
081D E0                MOVX    A,@DPTR
081E FE                MOV     R6,A
081F A3                INC     DPTR
0820 E0                MOVX    A,@DPTR
0821 FF                MOV     R7,A
0822 EC                MOV     A,R4
0823 120000      E     LCALL   ?C?FCASTL
0826 900000      E     MOV     DPTR,#c_mem+044H
0829 E0                MOVX    A,@DPTR
082A F8                MOV     R0,A
082B A3                INC     DPTR
082C E0                MOVX    A,@DPTR
082D F9                MOV     R1,A
082E A3                INC     DPTR
082F E0                MOVX    A,@DPTR
0830 FA                MOV     R2,A
0831 A3                INC     DPTR
0832 E0                MOVX    A,@DPTR
0833 FB                MOV     R3,A
0834 120000      E     LCALL   ?C?FPDIV
0837 120000      E     LCALL   ?C?CASTF
083A 900000      E     MOV     DPTR,#g_meas
083D 120000      E     LCALL   ?C?LSTXDATA
0840         ?C0190:
                                           ; SOURCE LINE # 1072
0840 900000      E     MOV     DPTR,#g_meas
0843 E0                MOVX    A,@DPTR
0844 F8                MOV     R0,A
0845 A3                INC     DPTR
0846 E0                MOVX    A,@DPTR
0847 F9                MOV     R1,A
0848 A3                INC     DPTR
0849 E0                MOVX    A,@DPTR
084A FA                MOV     R2,A
084B A3                INC     DPTR
084C E0                MOVX    A,@DPTR
084D FB                MOV     R3,A
084E C000              PUSH    AR0
0850 900000      R     MOV     DPTR,#init_rot
0853 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 109 

0854 FC                MOV     R4,A
0855 A3                INC     DPTR
0856 E0                MOVX    A,@DPTR
0857 FD                MOV     R5,A
0858 A3                INC     DPTR
0859 E0                MOVX    A,@DPTR
085A FE                MOV     R6,A
085B A3                INC     DPTR
085C E0                MOVX    A,@DPTR
085D FF                MOV     R7,A
085E 7810              MOV     R0,#010H
0860 120000      E     LCALL   ?C?LSHL
0863 D000              POP     AR0
0865 EB                MOV     A,R3
0866 2F                ADD     A,R7
0867 FF                MOV     R7,A
0868 EA                MOV     A,R2
0869 3E                ADDC    A,R6
086A FE                MOV     R6,A
086B E9                MOV     A,R1
086C 3D                ADDC    A,R5
086D FD                MOV     R5,A
086E E8                MOV     A,R0
086F 3C                ADDC    A,R4
0870 FC                MOV     R4,A
0871 900000      E     MOV     DPTR,#g_meas
0874 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1074
0877 7400        E     MOV     A,#LOW c_mem+044H
0879 6401              XRL     A,#01H
087B 4400        E     ORL     A,#HIGH c_mem+044H
087D 602C              JZ      ?C0191
                                           ; SOURCE LINE # 1075
087F 900000      E     MOV     DPTR,#g_meas
0882 E0                MOVX    A,@DPTR
0883 FC                MOV     R4,A
0884 A3                INC     DPTR
0885 E0                MOVX    A,@DPTR
0886 FD                MOV     R5,A
0887 A3                INC     DPTR
0888 E0                MOVX    A,@DPTR
0889 FE                MOV     R6,A
088A A3                INC     DPTR
088B E0                MOVX    A,@DPTR
088C FF                MOV     R7,A
088D EC                MOV     A,R4
088E 120000      E     LCALL   ?C?FCASTL
0891 900000      E     MOV     DPTR,#c_mem+044H
0894 E0                MOVX    A,@DPTR
0895 F8                MOV     R0,A
0896 A3                INC     DPTR
0897 E0                MOVX    A,@DPTR
0898 F9                MOV     R1,A
0899 A3                INC     DPTR
089A E0                MOVX    A,@DPTR
089B FA                MOV     R2,A
089C A3                INC     DPTR
089D E0                MOVX    A,@DPTR
089E FB                MOV     R3,A
089F 120000      E     LCALL   ?C?FPMUL
08A2 120000      E     LCALL   ?C?CASTF
08A5 900000      E     MOV     DPTR,#g_meas
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 110 

08A8 120000      E     LCALL   ?C?LSTXDATA
08AB         ?C0191:
                                           ; SOURCE LINE # 1078
08AB 900000      E     MOV     DPTR,#g_meas
08AE E0                MOVX    A,@DPTR
08AF FC                MOV     R4,A
08B0 A3                INC     DPTR
08B1 E0                MOVX    A,@DPTR
08B2 FD                MOV     R5,A
08B3 A3                INC     DPTR
08B4 E0                MOVX    A,@DPTR
08B5 FE                MOV     R6,A
08B6 A3                INC     DPTR
08B7 E0                MOVX    A,@DPTR
08B8 FF                MOV     R7,A
08B9 900000      E     MOV     DPTR,#g_refNew
08BC 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1080
08BF 900000      E     MOV     DPTR,#g_ref+018H
08C2 E0                MOVX    A,@DPTR
08C3 FF                MOV     R7,A
08C4 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1082
08C7 D200        R     SETB    pos_reconstruct
                                           ; SOURCE LINE # 1083
                                           ; SOURCE LINE # 1084
                                           ; SOURCE LINE # 1085
08C9         ?C0146:
08C9 22                RET     
             ; FUNCTION _encoder_reading (END)

             ; FUNCTION analog_read_end (BEGIN)
                                           ; SOURCE LINE # 1091
0000         ?C0192:
                                           ; SOURCE LINE # 1121
0000 120000      E     LCALL   ADC_STATUS_Read
0003 EF                MOV     A,R7
0004 700A              JNZ     ?C0193
                                           ; SOURCE LINE # 1122
0006 3000F7            JNB     interrupt_flag,?C0192
                                           ; SOURCE LINE # 1123
0009 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1124
000B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1125
                                           ; SOURCE LINE # 1126
000E 80F0              SJMP    ?C0192
0010         ?C0193:
                                           ; SOURCE LINE # 1129
0010 900000      E     MOV     DPTR,#ADC_buf+01H
0013 E0                MOVX    A,@DPTR
0014 249A              ADD     A,#09AH
0016 FF                MOV     R7,A
0017 900000      E     MOV     DPTR,#ADC_buf
001A E0                MOVX    A,@DPTR
001B 34F9              ADDC    A,#0F9H
001D FE                MOV     R6,A
001E 33                RLC     A
001F 95E0              SUBB    A,ACC
0021 FD                MOV     R5,A
0022 FC                MOV     R4,A
0023 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 111 

0024 7BA0              MOV     R3,#0A0H
0026 7A07              MOV     R2,#07H
0028 F9                MOV     R1,A
0029 F8                MOV     R0,A
002A 120000      E     LCALL   ?C?LMUL
002D 7807              MOV     R0,#07H
002F 120000      E     LCALL   ?C?SLSHR
0032 900000      E     MOV     DPTR,#dev_tension
0035 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1131
0038 300005            JNB     interrupt_flag,?C0195
                                           ; SOURCE LINE # 1132
003B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1133
003D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1134
0040         ?C0195:
                                           ; SOURCE LINE # 1138
0040 E4                CLR     A
0041 FF                MOV     R7,A
0042 FE                MOV     R6,A
0043 FD                MOV     R5,A
0044 FC                MOV     R4,A
0045 900000      E     MOV     DPTR,#dev_tension
0048 E0                MOVX    A,@DPTR
0049 F8                MOV     R0,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C F9                MOV     R1,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F FA                MOV     R2,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 FB                MOV     R3,A
0053 D3                SETB    C
0054 120000      E     LCALL   ?C?SLCMP
0057 5003              JNC     $ + 5H
0059 020000      R     LJMP    ?C0196
                                           ; SOURCE LINE # 1141
005C D200        E     SETB    tension_valid
                                           ; SOURCE LINE # 1143
005E 900000      E     MOV     DPTR,#g_mem+07BH
0061 E0                MOVX    A,@DPTR
0062 6003              JZ      ?C0197
                                           ; SOURCE LINE # 1144
0064 120000      R     LCALL   pwm_limit_search
0067         ?C0197:
                                           ; SOURCE LINE # 1147
0067 900000      E     MOV     DPTR,#ADC_buf+03H
006A E0                MOVX    A,@DPTR
006B 249A              ADD     A,#09AH
006D FF                MOV     R7,A
006E 900000      E     MOV     DPTR,#ADC_buf+02H
0071 E0                MOVX    A,@DPTR
0072 34F9              ADDC    A,#0F9H
0074 FE                MOV     R6,A
0075 33                RLC     A
0076 95E0              SUBB    A,ACC
0078 FD                MOV     R5,A
0079 FC                MOV     R4,A
007A E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 112 

007B 7BAB              MOV     R3,#0ABH
007D 7A64              MOV     R2,#064H
007F F9                MOV     R1,A
0080 F8                MOV     R0,A
0081 120000      E     LCALL   ?C?LMUL
0084 780D              MOV     R0,#0DH
0086 120000      E     LCALL   ?C?SLSHR
0089 900000      E     MOV     DPTR,#pwm_sign
008C E0                MOVX    A,@DPTR
008D FD                MOV     R5,A
008E 33                RLC     A
008F 95E0              SUBB    A,ACC
0091 FC                MOV     R4,A
0092 120000      E     LCALL   ?C?IMUL
0095 EE                MOV     A,R6
0096 33                RLC     A
0097 95E0              SUBB    A,ACC
0099 FD                MOV     R5,A
009A FC                MOV     R4,A
009B 120000      E     LCALL   _filter_i1
009E 900000      E     MOV     DPTR,#g_meas+0CH
00A1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1150
00A4 900000      E     MOV     DPTR,#g_meas
00A7 E0                MOVX    A,@DPTR
00A8 FC                MOV     R4,A
00A9 A3                INC     DPTR
00AA E0                MOVX    A,@DPTR
00AB FD                MOV     R5,A
00AC A3                INC     DPTR
00AD E0                MOVX    A,@DPTR
00AE FE                MOV     R6,A
00AF A3                INC     DPTR
00B0 E0                MOVX    A,@DPTR
00B1 FF                MOV     R7,A
00B2 900000      E     MOV     DPTR,#g_mem+035H
00B5 E0                MOVX    A,@DPTR
00B6 F9                MOV     R1,A
00B7 F8                MOV     R0,A
00B8 120000      E     LCALL   ?C?SLSHR
00BB C004              PUSH    AR4
00BD C005              PUSH    AR5
00BF C006              PUSH    AR6
00C1 C007              PUSH    AR7
00C3 900000      E     MOV     DPTR,#g_meas+01FH
00C6 E0                MOVX    A,@DPTR
00C7 FC                MOV     R4,A
00C8 A3                INC     DPTR
00C9 E0                MOVX    A,@DPTR
00CA FD                MOV     R5,A
00CB A3                INC     DPTR
00CC E0                MOVX    A,@DPTR
00CD FE                MOV     R6,A
00CE A3                INC     DPTR
00CF E0                MOVX    A,@DPTR
00D0 FF                MOV     R7,A
00D1 900000      E     MOV     DPTR,#g_mem+035H
00D4 E0                MOVX    A,@DPTR
00D5 F8                MOV     R0,A
00D6 120000      E     LCALL   ?C?SLSHR
00D9 900000      E     MOV     DPTR,#?_curr_estim?BYTE+04H
00DC 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 113 

00DF 900000      E     MOV     DPTR,#g_ref
00E2 E0                MOVX    A,@DPTR
00E3 FC                MOV     R4,A
00E4 A3                INC     DPTR
00E5 E0                MOVX    A,@DPTR
00E6 FD                MOV     R5,A
00E7 A3                INC     DPTR
00E8 E0                MOVX    A,@DPTR
00E9 FE                MOV     R6,A
00EA A3                INC     DPTR
00EB E0                MOVX    A,@DPTR
00EC FF                MOV     R7,A
00ED A801              MOV     R0,AR1
00EF 120000      E     LCALL   ?C?SLSHR
00F2 900000      E     MOV     DPTR,#?_curr_estim?BYTE+08H
00F5 120000      E     LCALL   ?C?LSTXDATA
00F8 D007              POP     AR7
00FA D006              POP     AR6
00FC D005              POP     AR5
00FE D004              POP     AR4
0100 120000      E     LCALL   _curr_estim
0103 A804              MOV     R0,AR4
0105 A905              MOV     R1,AR5
0107 AA06              MOV     R2,AR6
0109 AB07              MOV     R3,AR7
010B 900000      E     MOV     DPTR,#g_meas+0CH
010E E0                MOVX    A,@DPTR
010F FC                MOV     R4,A
0110 A3                INC     DPTR
0111 E0                MOVX    A,@DPTR
0112 FD                MOV     R5,A
0113 A3                INC     DPTR
0114 E0                MOVX    A,@DPTR
0115 FE                MOV     R6,A
0116 A3                INC     DPTR
0117 E0                MOVX    A,@DPTR
0118 C3                CLR     C
0119 9B                SUBB    A,R3
011A FF                MOV     R7,A
011B EE                MOV     A,R6
011C 9A                SUBB    A,R2
011D FE                MOV     R6,A
011E ED                MOV     A,R5
011F 99                SUBB    A,R1
0120 FD                MOV     R5,A
0121 EC                MOV     A,R4
0122 98                SUBB    A,R0
0123 FC                MOV     R4,A
0124 120000      E     LCALL   _filter_curr_diff
0127 EE                MOV     A,R6
0128 33                RLC     A
0129 95E0              SUBB    A,ACC
012B FD                MOV     R5,A
012C FC                MOV     R4,A
012D 900000      E     MOV     DPTR,#g_meas+010H
0130 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1154
0133 300005            JNB     interrupt_flag,?C0198
                                           ; SOURCE LINE # 1155
0136 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1156
0138 120000      R     LCALL   interrupt_manager
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 114 

                                           ; SOURCE LINE # 1157
013B         ?C0198:
                                           ; SOURCE LINE # 1160
013B 900000      E     MOV     DPTR,#g_mem+06FH
013E E0                MOVX    A,@DPTR
013F 7004              JNZ     ?C0199
                                           ; SOURCE LINE # 1161
0141 F500        R     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1162
0143 F500        R     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1163
0145         ?C0199:
                                           ; SOURCE LINE # 1168
0145 E500        R     MOV     A,emg_1_status
0147 14                DEC     A
0148 7003              JNZ     $ + 5H
014A 020000      R     LJMP    ?C0207
014D 14                DEC     A
014E 7003              JNZ     $ + 5H
0150 020000      R     LJMP    ?C0208
0153 14                DEC     A
0154 7003              JNZ     $ + 5H
0156 020000      R     LJMP    ?C0211
0159 2403              ADD     A,#03H
015B 6003              JZ      $ + 5H
015D 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1169
0160         ?C0201:
                                           ; SOURCE LINE # 1170
0160 900000      E     MOV     DPTR,#ADC_buf+04H
0163 E0                MOVX    A,@DPTR
0164 FE                MOV     R6,A
0165 A3                INC     DPTR
0166 E0                MOVX    A,@DPTR
0167 FF                MOV     R7,A
0168 EE                MOV     A,R6
0169 33                RLC     A
016A 95E0              SUBB    A,ACC
016C FD                MOV     R5,A
016D FC                MOV     R4,A
016E 120000      E     LCALL   _filter_ch1
0171 8F00        R     MOV     i_aux+03H,R7
0173 8E00        R     MOV     i_aux+02H,R6
0175 8D00        R     MOV     i_aux+01H,R5
0177 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1171
0179 780A              MOV     R0,#0AH
017B 120000      E     LCALL   ?C?LSHL
017E 900000      E     MOV     DPTR,#g_mem+070H
0181 E0                MOVX    A,@DPTR
0182 F8                MOV     R0,A
0183 A3                INC     DPTR
0184 E0                MOVX    A,@DPTR
0185 F9                MOV     R1,A
0186 A3                INC     DPTR
0187 E0                MOVX    A,@DPTR
0188 FA                MOV     R2,A
0189 A3                INC     DPTR
018A E0                MOVX    A,@DPTR
018B FB                MOV     R3,A
018C 120000      E     LCALL   ?C?ULDIV
018F 8F00        R     MOV     i_aux+03H,R7
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 115 

0191 8E00        R     MOV     i_aux+02H,R6
0193 8D00        R     MOV     i_aux+01H,R5
0195 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1173
0197 300005            JNB     interrupt_flag,?C0202
                                           ; SOURCE LINE # 1174
019A C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1175
019C 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1176
019F         ?C0202:
                                           ; SOURCE LINE # 1178
019F E4                CLR     A
01A0 FF                MOV     R7,A
01A1 FE                MOV     R6,A
01A2 FD                MOV     R5,A
01A3 FC                MOV     R4,A
01A4 AB00        R     MOV     R3,i_aux+03H
01A6 AA00        R     MOV     R2,i_aux+02H
01A8 A900        R     MOV     R1,i_aux+01H
01AA A800        R     MOV     R0,i_aux
01AC C3                CLR     C
01AD 120000      E     LCALL   ?C?SLCMP
01B0 500B              JNC     ?C0203
                                           ; SOURCE LINE # 1179
01B2 E4                CLR     A
01B3 F500        R     MOV     i_aux+03H,A
01B5 F500        R     MOV     i_aux+02H,A
01B7 F500        R     MOV     i_aux+01H,A
01B9 F500        R     MOV     i_aux,A
01BB 801E              SJMP    ?C0204
01BD         ?C0203:
                                           ; SOURCE LINE # 1181
01BD E4                CLR     A
01BE FF                MOV     R7,A
01BF 7E04              MOV     R6,#04H
01C1 FD                MOV     R5,A
01C2 FC                MOV     R4,A
01C3 AB00        R     MOV     R3,i_aux+03H
01C5 AA00        R     MOV     R2,i_aux+02H
01C7 A900        R     MOV     R1,i_aux+01H
01C9 A800        R     MOV     R0,i_aux
01CB D3                SETB    C
01CC 120000      E     LCALL   ?C?SLCMP
01CF 400A              JC      ?C0204
                                           ; SOURCE LINE # 1182
01D1 E4                CLR     A
01D2 F500        R     MOV     i_aux+03H,A
01D4 750004      R     MOV     i_aux+02H,#04H
01D7 F500        R     MOV     i_aux+01H,A
01D9 F500        R     MOV     i_aux,A
01DB         ?C0204:
                                           ; SOURCE LINE # 1184
01DB AF00        R     MOV     R7,i_aux+03H
01DD AE00        R     MOV     R6,i_aux+02H
01DF AD00        R     MOV     R5,i_aux+01H
01E1 AC00        R     MOV     R4,i_aux
01E3 900000      E     MOV     DPTR,#g_meas+017H
01E6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1186
01E9 200003      E     JB      interrupt_flag,$ + 6H
01EC 020000      R     LJMP    ?C0200
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 116 

                                           ; SOURCE LINE # 1187
01EF C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1188
01F1 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1189
                                           ; SOURCE LINE # 1191
01F4 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1193
01F7         ?C0207:
                                           ; SOURCE LINE # 1194
01F7 E4                CLR     A
01F8 900000      R     MOV     DPTR,#emg_counter_1
01FB F0                MOVX    @DPTR,A
01FC A3                INC     DPTR
01FD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1195
01FE FF                MOV     R7,A
01FF FE                MOV     R6,A
0200 FD                MOV     R5,A
0201 FC                MOV     R4,A
0202 900000      E     MOV     DPTR,#g_mem+070H
0205 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1196
0208 750002      R     MOV     emg_1_status,#02H
                                           ; SOURCE LINE # 1198
020B 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1200
020E         ?C0208:
                                           ; SOURCE LINE # 1201
020E 900000      R     MOV     DPTR,#emg_counter_1+01H
0211 E0                MOVX    A,@DPTR
0212 04                INC     A
0213 F0                MOVX    @DPTR,A
0214 7006              JNZ     ?C0261
0216 900000      R     MOV     DPTR,#emg_counter_1
0219 E0                MOVX    A,@DPTR
021A 04                INC     A
021B F0                MOVX    @DPTR,A
021C         ?C0261:
                                           ; SOURCE LINE # 1202
021C 900000      R     MOV     DPTR,#emg_counter_1
021F E0                MOVX    A,@DPTR
0220 6401              XRL     A,#01H
0222 7004              JNZ     ?C0262
0224 A3                INC     DPTR
0225 E0                MOVX    A,@DPTR
0226 64F4              XRL     A,#0F4H
0228         ?C0262:
0228 6003              JZ      $ + 5H
022A 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1203
022D 900000      R     MOV     DPTR,#emg_counter_1
0230 F0                MOVX    @DPTR,A
0231 A3                INC     DPTR
0232 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1204
0233 7F01              MOV     R7,#01H
0235 120000      E     LCALL   _LED_REG_Write
                                           ; SOURCE LINE # 1206
0238 300005            JNB     interrupt_flag,?C0210
                                           ; SOURCE LINE # 1207
023B C200        E     CLR     interrupt_flag
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 117 

                                           ; SOURCE LINE # 1208
023D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1209
0240         ?C0210:
                                           ; SOURCE LINE # 1211
0240 750003      R     MOV     emg_1_status,#03H
                                           ; SOURCE LINE # 1212
                                           ; SOURCE LINE # 1213
0243 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1215
0246         ?C0211:
                                           ; SOURCE LINE # 1217
0246 900000      R     MOV     DPTR,#emg_counter_1+01H
0249 E0                MOVX    A,@DPTR
024A 04                INC     A
024B F0                MOVX    @DPTR,A
024C 7006              JNZ     ?C0263
024E 900000      R     MOV     DPTR,#emg_counter_1
0251 E0                MOVX    A,@DPTR
0252 04                INC     A
0253 F0                MOVX    @DPTR,A
0254         ?C0263:
                                           ; SOURCE LINE # 1218
0254 900000      E     MOV     DPTR,#g_mem+070H
0257 E0                MOVX    A,@DPTR
0258 F8                MOV     R0,A
0259 A3                INC     DPTR
025A E0                MOVX    A,@DPTR
025B F9                MOV     R1,A
025C A3                INC     DPTR
025D E0                MOVX    A,@DPTR
025E FA                MOV     R2,A
025F A3                INC     DPTR
0260 E0                MOVX    A,@DPTR
0261 FB                MOV     R3,A
0262 C000              PUSH    AR0
0264 C001              PUSH    AR1
0266 C002              PUSH    AR2
0268 C003              PUSH    AR3
026A 900000      E     MOV     DPTR,#ADC_buf+04H
026D E0                MOVX    A,@DPTR
026E FE                MOV     R6,A
026F A3                INC     DPTR
0270 E0                MOVX    A,@DPTR
0271 FF                MOV     R7,A
0272 EE                MOV     A,R6
0273 33                RLC     A
0274 95E0              SUBB    A,ACC
0276 FD                MOV     R5,A
0277 FC                MOV     R4,A
0278 120000      E     LCALL   _filter_ch1
027B D003              POP     AR3
027D D002              POP     AR2
027F D001              POP     AR1
0281 D000              POP     AR0
0283 EB                MOV     A,R3
0284 2F                ADD     A,R7
0285 FF                MOV     R7,A
0286 EA                MOV     A,R2
0287 3E                ADDC    A,R6
0288 FE                MOV     R6,A
0289 E9                MOV     A,R1
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 118 

028A 3D                ADDC    A,R5
028B FD                MOV     R5,A
028C E8                MOV     A,R0
028D 3C                ADDC    A,R4
028E FC                MOV     R4,A
028F 900000      E     MOV     DPTR,#g_mem+070H
0292 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1220
0295 300005            JNB     interrupt_flag,?C0212
                                           ; SOURCE LINE # 1221
0298 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1222
029A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1223
029D         ?C0212:
                                           ; SOURCE LINE # 1225
029D 900000      R     MOV     DPTR,#emg_counter_1
02A0 E0                MOVX    A,@DPTR
02A1 B40339            CJNE    A,#03H,?C0200
02A4 A3                INC     DPTR
02A5 E0                MOVX    A,@DPTR
02A6 B4E834            CJNE    A,#0E8H,?C0200
                                           ; SOURCE LINE # 1226
02A9 900000      E     MOV     DPTR,#g_mem+070H
02AC E0                MOVX    A,@DPTR
02AD FC                MOV     R4,A
02AE A3                INC     DPTR
02AF E0                MOVX    A,@DPTR
02B0 FD                MOV     R5,A
02B1 A3                INC     DPTR
02B2 E0                MOVX    A,@DPTR
02B3 FE                MOV     R6,A
02B4 A3                INC     DPTR
02B5 E0                MOVX    A,@DPTR
02B6 FF                MOV     R7,A
02B7 E4                CLR     A
02B8 7BE8              MOV     R3,#0E8H
02BA 7A03              MOV     R2,#03H
02BC F9                MOV     R1,A
02BD F8                MOV     R0,A
02BE 120000      E     LCALL   ?C?ULDIV
02C1 900000      E     MOV     DPTR,#g_mem+070H
02C4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1228
02C7 300005            JNB     interrupt_flag,?C0214
                                           ; SOURCE LINE # 1229
02CA C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1230
02CC 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1231
02CF         ?C0214:
                                           ; SOURCE LINE # 1233
02CF E4                CLR     A
02D0 FF                MOV     R7,A
02D1 120000      E     LCALL   _LED_REG_Write
                                           ; SOURCE LINE # 1234
02D4 E4                CLR     A
02D5 900000      R     MOV     DPTR,#emg_counter_1
02D8 F0                MOVX    @DPTR,A
02D9 A3                INC     DPTR
02DA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1236
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 119 

02DB F500        R     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1237
                                           ; SOURCE LINE # 1238
                                           ; SOURCE LINE # 1240
                                           ; SOURCE LINE # 1241
                                           ; SOURCE LINE # 1242
02DD         ?C0200:
                                           ; SOURCE LINE # 1244
02DD 300005            JNB     interrupt_flag,?C0216
                                           ; SOURCE LINE # 1245
02E0 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1246
02E2 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1247
02E5         ?C0216:
                                           ; SOURCE LINE # 1249
02E5 E500        R     MOV     A,emg_2_status
02E7 14                DEC     A
02E8 7003              JNZ     $ + 5H
02EA 020000      R     LJMP    ?C0223
02ED 14                DEC     A
02EE 7003              JNZ     $ + 5H
02F0 020000      R     LJMP    ?C0225
02F3 14                DEC     A
02F4 7003              JNZ     $ + 5H
02F6 020000      R     LJMP    ?C0228
02F9 14                DEC     A
02FA 7003              JNZ     $ + 5H
02FC 020000      R     LJMP    ?C0235
02FF 2404              ADD     A,#04H
0301 6003              JZ      $ + 5H
0303 020000      R     LJMP    ?C0217
                                           ; SOURCE LINE # 1250
0306         ?C0218:
                                           ; SOURCE LINE # 1251
0306 900000      E     MOV     DPTR,#ADC_buf+06H
0309 E0                MOVX    A,@DPTR
030A FE                MOV     R6,A
030B A3                INC     DPTR
030C E0                MOVX    A,@DPTR
030D FF                MOV     R7,A
030E EE                MOV     A,R6
030F 33                RLC     A
0310 95E0              SUBB    A,ACC
0312 FD                MOV     R5,A
0313 FC                MOV     R4,A
0314 120000      E     LCALL   _filter_ch2
0317 8F00        R     MOV     i_aux+03H,R7
0319 8E00        R     MOV     i_aux+02H,R6
031B 8D00        R     MOV     i_aux+01H,R5
031D 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1252
031F 780A              MOV     R0,#0AH
0321 120000      E     LCALL   ?C?LSHL
0324 900000      E     MOV     DPTR,#g_mem+074H
0327 E0                MOVX    A,@DPTR
0328 F8                MOV     R0,A
0329 A3                INC     DPTR
032A E0                MOVX    A,@DPTR
032B F9                MOV     R1,A
032C A3                INC     DPTR
032D E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 120 

032E FA                MOV     R2,A
032F A3                INC     DPTR
0330 E0                MOVX    A,@DPTR
0331 FB                MOV     R3,A
0332 120000      E     LCALL   ?C?ULDIV
0335 8F00        R     MOV     i_aux+03H,R7
0337 8E00        R     MOV     i_aux+02H,R6
0339 8D00        R     MOV     i_aux+01H,R5
033B 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1254
033D 300005            JNB     interrupt_flag,?C0219
                                           ; SOURCE LINE # 1255
0340 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1256
0342 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1257
0345         ?C0219:
                                           ; SOURCE LINE # 1259
0345 E4                CLR     A
0346 FF                MOV     R7,A
0347 FE                MOV     R6,A
0348 FD                MOV     R5,A
0349 FC                MOV     R4,A
034A AB00        R     MOV     R3,i_aux+03H
034C AA00        R     MOV     R2,i_aux+02H
034E A900        R     MOV     R1,i_aux+01H
0350 A800        R     MOV     R0,i_aux
0352 C3                CLR     C
0353 120000      E     LCALL   ?C?SLCMP
0356 500B              JNC     ?C0220
                                           ; SOURCE LINE # 1260
0358 E4                CLR     A
0359 F500        R     MOV     i_aux+03H,A
035B F500        R     MOV     i_aux+02H,A
035D F500        R     MOV     i_aux+01H,A
035F F500        R     MOV     i_aux,A
0361 801E              SJMP    ?C0221
0363         ?C0220:
                                           ; SOURCE LINE # 1262
0363 E4                CLR     A
0364 FF                MOV     R7,A
0365 7E04              MOV     R6,#04H
0367 FD                MOV     R5,A
0368 FC                MOV     R4,A
0369 AB00        R     MOV     R3,i_aux+03H
036B AA00        R     MOV     R2,i_aux+02H
036D A900        R     MOV     R1,i_aux+01H
036F A800        R     MOV     R0,i_aux
0371 D3                SETB    C
0372 120000      E     LCALL   ?C?SLCMP
0375 400A              JC      ?C0221
                                           ; SOURCE LINE # 1263
0377 E4                CLR     A
0378 F500        R     MOV     i_aux+03H,A
037A 750004      R     MOV     i_aux+02H,#04H
037D F500        R     MOV     i_aux+01H,A
037F F500        R     MOV     i_aux,A
0381         ?C0221:
                                           ; SOURCE LINE # 1265
0381 AF00        R     MOV     R7,i_aux+03H
0383 AE00        R     MOV     R6,i_aux+02H
0385 AD00        R     MOV     R5,i_aux+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 121 

0387 AC00        R     MOV     R4,i_aux
0389 900000      E     MOV     DPTR,#g_meas+01BH
038C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1267
038F 020000      R     LJMP    ?C0217
                                           ; SOURCE LINE # 1269
0392         ?C0223:
                                           ; SOURCE LINE # 1270
0392 E4                CLR     A
0393 900000      R     MOV     DPTR,#emg_counter_2
0396 F0                MOVX    @DPTR,A
0397 A3                INC     DPTR
0398 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1271
0399 FF                MOV     R7,A
039A FE                MOV     R6,A
039B FD                MOV     R5,A
039C FC                MOV     R4,A
039D 900000      E     MOV     DPTR,#g_mem+074H
03A0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1273
03A3 300005            JNB     interrupt_flag,?C0224
                                           ; SOURCE LINE # 1274
03A6 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1275
03A8 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1276
03AB         ?C0224:
                                           ; SOURCE LINE # 1278
03AB 750004      R     MOV     emg_2_status,#04H
                                           ; SOURCE LINE # 1279
03AE 020000      R     LJMP    ?C0217
                                           ; SOURCE LINE # 1281
03B1         ?C0225:
                                           ; SOURCE LINE # 1282
03B1 900000      R     MOV     DPTR,#emg_counter_2+01H
03B4 E0                MOVX    A,@DPTR
03B5 04                INC     A
03B6 F0                MOVX    @DPTR,A
03B7 7006              JNZ     ?C0265
03B9 900000      R     MOV     DPTR,#emg_counter_2
03BC E0                MOVX    A,@DPTR
03BD 04                INC     A
03BE F0                MOVX    @DPTR,A
03BF         ?C0265:
                                           ; SOURCE LINE # 1283
03BF 900000      R     MOV     DPTR,#emg_counter_2
03C2 E0                MOVX    A,@DPTR
03C3 6401              XRL     A,#01H
03C5 7004              JNZ     ?C0266
03C7 A3                INC     DPTR
03C8 E0                MOVX    A,@DPTR
03C9 64F4              XRL     A,#0F4H
03CB         ?C0266:
03CB 6003              JZ      $ + 5H
03CD 020000      R     LJMP    ?C0217
                                           ; SOURCE LINE # 1284
03D0 900000      R     MOV     DPTR,#emg_counter_2
03D3 F0                MOVX    @DPTR,A
03D4 A3                INC     DPTR
03D5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1285
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 122 

03D6 7F01              MOV     R7,#01H
03D8 120000      E     LCALL   _LED_REG_Write
                                           ; SOURCE LINE # 1287
03DB 300005            JNB     interrupt_flag,?C0227
                                           ; SOURCE LINE # 1288
03DE C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1289
03E0 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1290
03E3         ?C0227:
                                           ; SOURCE LINE # 1292
03E3 750003      R     MOV     emg_2_status,#03H
                                           ; SOURCE LINE # 1293
                                           ; SOURCE LINE # 1294
03E6 020000      R     LJMP    ?C0217
                                           ; SOURCE LINE # 1296
03E9         ?C0228:
                                           ; SOURCE LINE # 1298
03E9 900000      R     MOV     DPTR,#emg_counter_2+01H
03EC E0                MOVX    A,@DPTR
03ED 04                INC     A
03EE F0                MOVX    @DPTR,A
03EF 7006              JNZ     ?C0267
03F1 900000      R     MOV     DPTR,#emg_counter_2
03F4 E0                MOVX    A,@DPTR
03F5 04                INC     A
03F6 F0                MOVX    @DPTR,A
03F7         ?C0267:
                                           ; SOURCE LINE # 1299
03F7 900000      E     MOV     DPTR,#g_mem+074H
03FA E0                MOVX    A,@DPTR
03FB F8                MOV     R0,A
03FC A3                INC     DPTR
03FD E0                MOVX    A,@DPTR
03FE F9                MOV     R1,A
03FF A3                INC     DPTR
0400 E0                MOVX    A,@DPTR
0401 FA                MOV     R2,A
0402 A3                INC     DPTR
0403 E0                MOVX    A,@DPTR
0404 FB                MOV     R3,A
0405 C000              PUSH    AR0
0407 C001              PUSH    AR1
0409 C002              PUSH    AR2
040B C003              PUSH    AR3
040D 900000      E     MOV     DPTR,#ADC_buf+06H
0410 E0                MOVX    A,@DPTR
0411 FE                MOV     R6,A
0412 A3                INC     DPTR
0413 E0                MOVX    A,@DPTR
0414 FF                MOV     R7,A
0415 EE                MOV     A,R6
0416 33                RLC     A
0417 95E0              SUBB    A,ACC
0419 FD                MOV     R5,A
041A FC                MOV     R4,A
041B 120000      E     LCALL   _filter_ch2
041E D003              POP     AR3
0420 D002              POP     AR2
0422 D001              POP     AR1
0424 D000              POP     AR0
0426 EB                MOV     A,R3
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 123 

0427 2F                ADD     A,R7
0428 FF                MOV     R7,A
0429 EA                MOV     A,R2
042A 3E                ADDC    A,R6
042B FE                MOV     R6,A
042C E9                MOV     A,R1
042D 3D                ADDC    A,R5
042E FD                MOV     R5,A
042F E8                MOV     A,R0
0430 3C                ADDC    A,R4
0431 FC                MOV     R4,A
0432 900000      E     MOV     DPTR,#g_mem+074H
0435 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1301
0438 300005            JNB     interrupt_flag,?C0229
                                           ; SOURCE LINE # 1302
043B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1303
043D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1304
0440         ?C0229:
                                           ; SOURCE LINE # 1306
0440 900000      R     MOV     DPTR,#emg_counter_2
0443 E0                MOVX    A,@DPTR
0444 6403              XRL     A,#03H
0446 7004              JNZ     ?C0268
0448 A3                INC     DPTR
0449 E0                MOVX    A,@DPTR
044A 64E8              XRL     A,#0E8H
044C         ?C0268:
044C 6003              JZ      $ + 5H
044E 020000      R     LJMP    ?C0217
                                           ; SOURCE LINE # 1307
0451 900000      E     MOV     DPTR,#g_mem+074H
0454 E0                MOVX    A,@DPTR
0455 FC                MOV     R4,A
0456 A3                INC     DPTR
0457 E0                MOVX    A,@DPTR
0458 FD                MOV     R5,A
0459 A3                INC     DPTR
045A E0                MOVX    A,@DPTR
045B FE                MOV     R6,A
045C A3                INC     DPTR
045D E0                MOVX    A,@DPTR
045E FF                MOV     R7,A
045F E4                CLR     A
0460 7BE8              MOV     R3,#0E8H
0462 7A03              MOV     R2,#03H
0464 F9                MOV     R1,A
0465 F8                MOV     R0,A
0466 120000      E     LCALL   ?C?ULDIV
0469 900000      E     MOV     DPTR,#g_mem+074H
046C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1308
046F E4                CLR     A
0470 FF                MOV     R7,A
0471 120000      E     LCALL   _LED_REG_Write
                                           ; SOURCE LINE # 1309
0474 E4                CLR     A
0475 900000      R     MOV     DPTR,#emg_counter_2
0478 F0                MOVX    @DPTR,A
0479 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 124 

047A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1311
047B 300005            JNB     interrupt_flag,?C0231
                                           ; SOURCE LINE # 1312
047E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1313
0480 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1314
0483         ?C0231:
                                           ; SOURCE LINE # 1317
0483 900000      E     MOV     DPTR,#c_mem+033H
0486 E0                MOVX    A,@DPTR
0487 FF                MOV     R7,A
0488 6402              XRL     A,#02H
048A 600E              JZ      ?C0233
048C EF                MOV     A,R7
048D 6403              XRL     A,#03H
048F 6009              JZ      ?C0233
0491 EF                MOV     A,R7
0492 6404              XRL     A,#04H
0494 6004              JZ      ?C0233
0496 EF                MOV     A,R7
0497 B4053A            CJNE    A,#05H,?C0232
049A         ?C0233:
                                           ; SOURCE LINE # 1320
                                           ; SOURCE LINE # 1321
049A 900000      E     MOV     DPTR,#c_mem+034H
049D E0                MOVX    A,@DPTR
049E 7028              JNZ     ?C0234
                                           ; SOURCE LINE # 1322
04A0 900000      E     MOV     DPTR,#g_meas
04A3 E0                MOVX    A,@DPTR
04A4 FC                MOV     R4,A
04A5 A3                INC     DPTR
04A6 E0                MOVX    A,@DPTR
04A7 FD                MOV     R5,A
04A8 A3                INC     DPTR
04A9 E0                MOVX    A,@DPTR
04AA FE                MOV     R6,A
04AB A3                INC     DPTR
04AC E0                MOVX    A,@DPTR
04AD FF                MOV     R7,A
04AE 900000      E     MOV     DPTR,#g_ref
04B1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1323
04B4 900000      E     MOV     DPTR,#g_meas+04H
04B7 E0                MOVX    A,@DPTR
04B8 FC                MOV     R4,A
04B9 A3                INC     DPTR
04BA E0                MOVX    A,@DPTR
04BB FD                MOV     R5,A
04BC A3                INC     DPTR
04BD E0                MOVX    A,@DPTR
04BE FE                MOV     R6,A
04BF A3                INC     DPTR
04C0 E0                MOVX    A,@DPTR
04C1 FF                MOV     R7,A
04C2 900000      E     MOV     DPTR,#g_ref+04H
04C5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1324
04C8         ?C0234:
                                           ; SOURCE LINE # 1325
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 125 

04C8 900000      E     MOV     DPTR,#c_mem+032H
04CB E0                MOVX    A,@DPTR
04CC FF                MOV     R7,A
04CD 900000      E     MOV     DPTR,#g_ref+018H
04D0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1326
04D1 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1327
04D4         ?C0232:
                                           ; SOURCE LINE # 1328
04D4 E4                CLR     A
04D5 F500        R     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1329
                                           ; SOURCE LINE # 1330
04D7 8007              SJMP    ?C0217
                                           ; SOURCE LINE # 1332
04D9         ?C0235:
                                           ; SOURCE LINE # 1333
04D9 E500        R     MOV     A,emg_1_status
04DB 7003              JNZ     ?C0217
                                           ; SOURCE LINE # 1334
04DD 750002      R     MOV     emg_2_status,#02H
                                           ; SOURCE LINE # 1335
                                           ; SOURCE LINE # 1337
                                           ; SOURCE LINE # 1338
                                           ; SOURCE LINE # 1339
04E0         ?C0217:
                                           ; SOURCE LINE # 1341
04E0 30005E            JNB     interrupt_flag,?C0239
                                           ; SOURCE LINE # 1342
04E3 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1343
04E5 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1344
                                           ; SOURCE LINE # 1345
04E8 8057              SJMP    ?C0239
04EA         ?C0196:
                                           ; SOURCE LINE # 1346
                                           ; SOURCE LINE # 1348
04EA 750001      R     MOV     emg_1_status,#01H
                                           ; SOURCE LINE # 1349
04ED 750001      R     MOV     emg_2_status,#01H
                                           ; SOURCE LINE # 1351
04F0 C200        E     CLR     tension_valid
                                           ; SOURCE LINE # 1353
04F2 300005            JNB     interrupt_flag,?C0240
                                           ; SOURCE LINE # 1354
04F5 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1355
04F7 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1356
04FA         ?C0240:
                                           ; SOURCE LINE # 1358
04FA 900000      E     MOV     DPTR,#c_mem+06FH
04FD E0                MOVX    A,@DPTR
04FE 6020              JZ      ?C0241
                                           ; SOURCE LINE # 1359
0500 900000      E     MOV     DPTR,#c_mem+033H
0503 E0                MOVX    A,@DPTR
0504 FF                MOV     R7,A
0505 6402              XRL     A,#02H
0507 600E              JZ      ?C0243
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 126 

0509 EF                MOV     A,R7
050A 6403              XRL     A,#03H
050C 6009              JZ      ?C0243
050E EF                MOV     A,R7
050F 6404              XRL     A,#04H
0511 6004              JZ      ?C0243
0513 EF                MOV     A,R7
0514 B40509            CJNE    A,#05H,?C0241
0517         ?C0243:
                                           ; SOURCE LINE # 1362
                                           ; SOURCE LINE # 1363
0517 E4                CLR     A
0518 900000      E     MOV     DPTR,#g_ref+018H
051B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1364
051C FF                MOV     R7,A
051D 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1365
                                           ; SOURCE LINE # 1366
0520         ?C0241:
                                           ; SOURCE LINE # 1369
0520 E4                CLR     A
0521 FF                MOV     R7,A
0522 FE                MOV     R6,A
0523 FD                MOV     R5,A
0524 FC                MOV     R4,A
0525 900000      E     MOV     DPTR,#g_meas+0CH
0528 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1372
052B E4                CLR     A
052C FF                MOV     R7,A
052D FE                MOV     R6,A
052E FD                MOV     R5,A
052F FC                MOV     R4,A
0530 900000      E     MOV     DPTR,#g_meas+017H
0533 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1373
0536 E4                CLR     A
0537 FF                MOV     R7,A
0538 FE                MOV     R6,A
0539 FD                MOV     R5,A
053A FC                MOV     R4,A
053B 900000      E     MOV     DPTR,#g_meas+01BH
053E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1375
0541         ?C0239:
                                           ; SOURCE LINE # 1377
0541 300005            JNB     interrupt_flag,?C0245
                                           ; SOURCE LINE # 1378
0544 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1379
0546 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1380
                                           ; SOURCE LINE # 1381
0549         ?C0245:
0549 22                RET     
             ; FUNCTION analog_read_end (END)

             ; FUNCTION overcurrent_control (BEGIN)
                                           ; SOURCE LINE # 1387
                                           ; SOURCE LINE # 1388
0000 900000      E     MOV     DPTR,#c_mem+069H
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 127 

0003 E0                MOVX    A,@DPTR
0004 FE                MOV     R6,A
0005 A3                INC     DPTR
0006 E0                MOVX    A,@DPTR
0007 FF                MOV     R7,A
0008 4E                ORL     A,R6
0009 6068              JZ      ?C0253
                                           ; SOURCE LINE # 1390
000B EE                MOV     A,R6
000C 33                RLC     A
000D 95E0              SUBB    A,ACC
000F FD                MOV     R5,A
0010 FC                MOV     R4,A
0011 900000      E     MOV     DPTR,#g_meas+0CH
0014 E0                MOVX    A,@DPTR
0015 F8                MOV     R0,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 F9                MOV     R1,A
0019 A3                INC     DPTR
001A E0                MOVX    A,@DPTR
001B FA                MOV     R2,A
001C A3                INC     DPTR
001D E0                MOVX    A,@DPTR
001E FB                MOV     R3,A
001F D3                SETB    C
0020 120000      E     LCALL   ?C?SLCMP
0023 4008              JC      ?C0247
                                           ; SOURCE LINE # 1392
0025 900000      E     MOV     DPTR,#dev_pwm_limit
0028 E0                MOVX    A,@DPTR
0029 14                DEC     A
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1394
002B 802D              SJMP    ?C0248
002D         ?C0247:
002D 900000      E     MOV     DPTR,#c_mem+06AH
0030 E0                MOVX    A,@DPTR
0031 24F6              ADD     A,#0F6H
0033 FF                MOV     R7,A
0034 900000      E     MOV     DPTR,#c_mem+069H
0037 E0                MOVX    A,@DPTR
0038 34FF              ADDC    A,#0FFH
003A FE                MOV     R6,A
003B 33                RLC     A
003C 95E0              SUBB    A,ACC
003E FD                MOV     R5,A
003F FC                MOV     R4,A
0040 900000      E     MOV     DPTR,#g_meas+0CH
0043 E0                MOVX    A,@DPTR
0044 F8                MOV     R0,A
0045 A3                INC     DPTR
0046 E0                MOVX    A,@DPTR
0047 F9                MOV     R1,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FA                MOV     R2,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D FB                MOV     R3,A
004E C3                CLR     C
004F 120000      E     LCALL   ?C?SLCMP
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 128 

0052 5006              JNC     ?C0248
                                           ; SOURCE LINE # 1396
0054 900000      E     MOV     DPTR,#dev_pwm_limit
0057 E0                MOVX    A,@DPTR
0058 04                INC     A
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1397
005A         ?C0248:
                                           ; SOURCE LINE # 1400
005A 900000      E     MOV     DPTR,#dev_pwm_limit
005D E0                MOVX    A,@DPTR
005E FF                MOV     R7,A
005F C3                CLR     C
0060 9400              SUBB    A,#00H
0062 5003              JNC     ?C0250
                                           ; SOURCE LINE # 1401
0064 E4                CLR     A
0065 F0                MOVX    @DPTR,A
0066 22                RET     
0067         ?C0250:
                                           ; SOURCE LINE # 1403
0067 EF                MOV     A,R7
0068 D3                SETB    C
0069 9464              SUBB    A,#064H
006B 4006              JC      ?C0253
                                           ; SOURCE LINE # 1404
006D 900000      E     MOV     DPTR,#dev_pwm_limit
0070 7464              MOV     A,#064H
0072 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1405
                                           ; SOURCE LINE # 1406
0073         ?C0253:
0073 22                RET     
             ; FUNCTION overcurrent_control (END)

             ; FUNCTION pwm_limit_search (BEGIN)
                                           ; SOURCE LINE # 1412
                                           ; SOURCE LINE # 1416
0000 E4                CLR     A
0001 7F9C              MOV     R7,#09CH
0003 7E63              MOV     R6,#063H
0005 FD                MOV     R5,A
0006 FC                MOV     R4,A
0007 900000      E     MOV     DPTR,#dev_tension
000A E0                MOVX    A,@DPTR
000B F8                MOV     R0,A
000C A3                INC     DPTR
000D E0                MOVX    A,@DPTR
000E F9                MOV     R1,A
000F A3                INC     DPTR
0010 E0                MOVX    A,@DPTR
0011 FA                MOV     R2,A
0012 A3                INC     DPTR
0013 E0                MOVX    A,@DPTR
0014 FB                MOV     R3,A
0015 D3                SETB    C
0016 120000      E     LCALL   ?C?SLCMP
0019 4006              JC      ?C0254
                                           ; SOURCE LINE # 1417
001B E4                CLR     A
001C 900000      E     MOV     DPTR,#dev_pwm_limit
001F F0                MOVX    @DPTR,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 129 

                                           ; SOURCE LINE # 1418
0020 22                RET     
0021         ?C0254:
0021 E4                CLR     A
0022 7FEC              MOV     R7,#0ECH
0024 7E2C              MOV     R6,#02CH
0026 FD                MOV     R5,A
0027 FC                MOV     R4,A
0028 900000      E     MOV     DPTR,#dev_tension
002B E0                MOVX    A,@DPTR
002C F8                MOV     R0,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F F9                MOV     R1,A
0030 A3                INC     DPTR
0031 E0                MOVX    A,@DPTR
0032 FA                MOV     R2,A
0033 A3                INC     DPTR
0034 E0                MOVX    A,@DPTR
0035 FB                MOV     R3,A
0036 C3                CLR     C
0037 120000      E     LCALL   ?C?SLCMP
003A 5007              JNC     ?C0256
                                           ; SOURCE LINE # 1419
003C 900000      E     MOV     DPTR,#dev_pwm_limit
003F 7464              MOV     A,#064H
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1420
0042 22                RET     
0043         ?C0256:
                                           ; SOURCE LINE # 1421
0043 900000      E     MOV     DPTR,#dev_tension
0046 E0                MOVX    A,@DPTR
0047 FC                MOV     R4,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FD                MOV     R5,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D FE                MOV     R6,A
004E A3                INC     DPTR
004F E0                MOVX    A,@DPTR
0050 2414              ADD     A,#014H
0052 FF                MOV     R7,A
0053 EE                MOV     A,R6
0054 34D3              ADDC    A,#0D3H
0056 FE                MOV     R6,A
0057 ED                MOV     A,R5
0058 34FF              ADDC    A,#0FFH
005A FD                MOV     R5,A
005B EC                MOV     A,R4
005C 34FF              ADDC    A,#0FFH
005E FC                MOV     R4,A
005F 7809              MOV     R0,#09H
0061 120000      E     LCALL   ?C?SLSHR
0064 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 1422
0066 7400        R     MOV     A,#LOW pwm_preload_values
0068 2F                ADD     A,R7
0069 F582              MOV     DPL,A
006B E4                CLR     A
006C 3400        R     ADDC    A,#HIGH pwm_preload_values
C51 COMPILER V9.51   INTERRUPTIONS                                                         07/12/2017 09:23:31 PAGE 130 

006E F583              MOV     DPH,A
0070 E0                MOVX    A,@DPTR
0071 900000      E     MOV     DPTR,#dev_pwm_limit
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1423
                                           ; SOURCE LINE # 1424
0075         ?C0258:
0075 22                RET     
             ; FUNCTION pwm_limit_search (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   8758    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    234      24
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9      84
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
